var vo=Object.create;var qt=Object.defineProperty;var wo=Object.getOwnPropertyDescriptor;var xo=Object.getOwnPropertyNames;var ko=Object.getPrototypeOf,Eo=Object.prototype.hasOwnProperty;var Lo=(e,r,o)=>r in e?qt(e,r,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[r]=o;var Mo=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports);var So=(e,r,o,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of xo(r))!Eo.call(e,i)&&i!==o&&qt(e,i,{get:()=>r[i],enumerable:!(n=wo(r,i))||n.enumerable});return e};var Et=(e,r,o)=>(o=e!=null?vo(ko(e)):{},So(r||!e||!e.__esModule?qt(o,"default",{value:e,enumerable:!0}):o,e));var xr=(e,r,o)=>(Lo(e,typeof r!="symbol"?r+"":r,o),o),kr=(e,r,o)=>{if(!r.has(e))throw TypeError("Cannot "+o)};var Lt=(e,r,o)=>(kr(e,r,"read from private field"),o?o.call(e):r.get(e)),Er=(e,r,o)=>{if(r.has(e))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(e):r.set(e,o)},Lr=(e,r,o,n)=>(kr(e,r,"write to private field"),n?n.call(e,o):r.set(e,o),o);var ut=Mo((dt,ft)=>{(function(){var e,r,o,n,i,d,h,p,y,k,m,E,T,R,S,D,I,K,$,g,re,W,pe,U,se,Q,ye,ne,oe,Ne,Me,Ae,ce,ge,Ce,Se,Re,Be,ve,ke,je,gt,fe,ue,tr,Pt,rr,mt,Fe,bt,or,q,sr,ir,lr,nr,ae,ar,cr,dr,fr,ur,_r,hr,Ft,Ut,Ht,pr,gr,mr,yt,vt,br,me,yr,Ye,we,jt,ee,te,Te,wt,xt,Ee=[].slice;ee=function(){var t,s,l,a,c;for(t={},c="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),a=0,s=c.length;a<s;a++)l=c[a],t["[object "+l+"]"]=l.toLowerCase();return function(f){var u;return u=Object.prototype.toString.call(f),t[u]||"object"}}(),mt=function(t,s,l){return s==null&&(s=0),l==null&&(l=1),t<s&&(t=s),t>l&&(t=l),t},te=function(t){return t.length>=3?Array.prototype.slice.call(t):t[0]},re=function(t){var s,l;for(t._clipped=!1,t._unclipped=t.slice(0),s=l=0;l<3;s=++l)s<3?((t[s]<0||t[s]>255)&&(t._clipped=!0),t[s]<0&&(t[s]=0),t[s]>255&&(t[s]=255)):s===3&&(t[s]<0&&(t[s]=0),t[s]>1&&(t[s]=1));return t._clipped||delete t._unclipped,t},n=Math.PI,me=Math.round,U=Math.cos,oe=Math.floor,ae=Math.pow,Fe=Math.log,Ye=Math.sin,we=Math.sqrt,R=Math.atan2,q=Math.max,T=Math.abs,h=n*2,i=n/3,r=n/180,d=180/n,g=function(){return arguments[0]instanceof e?arguments[0]:function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,arguments,function(){})},g.default=g,E=[],typeof ft<"u"&&ft!==null&&ft.exports!=null&&(ft.exports=g),typeof define=="function"&&define.amd?define([],function(){return g}):(br=typeof dt<"u"&&dt!==null?dt:this,br.chroma=g),g.version="1.4.1",m={},y=[],k=!1,e=function(){function t(){var s,l,a,c,f,u,_,b,w;for(u=this,l=[],b=0,c=arguments.length;b<c;b++)s=arguments[b],s!=null&&l.push(s);if(l.length>1&&(_=l[l.length-1]),m[_]!=null)u._rgb=re(m[_](te(l.slice(0,-1))));else{for(k||(y=y.sort(function(L,N){return N.p-L.p}),k=!0),w=0,f=y.length;w<f&&(a=y[w],_=a.test.apply(a,l),!_);w++);_&&(u._rgb=re(m[_].apply(m,l)))}u._rgb==null&&console.warn("unknown format: "+l),u._rgb==null&&(u._rgb=[0,0,0]),u._rgb.length===3&&u._rgb.push(1)}return t.prototype.toString=function(){return this.hex()},t}(),g._input=m;g.brewer=K={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var t,s;s=[];for(t in K)s.push(K[t.toLowerCase()]=K[t]);return s}(),Te={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},g.colors=pe=Te,fe=function(){var t,s,l,a,c,f,u,_,b;return s=te(arguments),c=s[0],t=s[1],l=s[2],_=(c+16)/116,u=isNaN(t)?_:_+t/500,b=isNaN(l)?_:_-l/200,_=o.Yn*ue(_),u=o.Xn*ue(u),b=o.Zn*ue(b),f=xt(3.2404542*u-1.5371385*_-.4985314*b),a=xt(-.969266*u+1.8760108*_+.041556*b),l=xt(.0556434*u-.2040259*_+1.0572252*b),[f,a,l,s.length>3?s[3]:1]},xt=function(t){return 255*(t<=.00304?12.92*t:1.055*ae(t,1/2.4)-.055)},ue=function(t){return t>o.t1?t*t*t:o.t2*(t-o.t0)},o={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Ft=function(){var t,s,l,a,c,f,u,_;return a=te(arguments),l=a[0],s=a[1],t=a[2],c=mr(l,s,t),f=c[0],u=c[1],_=c[2],[116*u-16,500*(f-u),200*(u-_)]},yt=function(t){return(t/=255)<=.04045?t/12.92:ae((t+.055)/1.055,2.4)},wt=function(t){return t>o.t3?ae(t,1/3):t/o.t2+o.t0},mr=function(){var t,s,l,a,c,f,u;return a=te(arguments),l=a[0],s=a[1],t=a[2],l=yt(l),s=yt(s),t=yt(t),c=wt((.4124564*l+.3575761*s+.1804375*t)/o.Xn),f=wt((.2126729*l+.7151522*s+.072175*t)/o.Yn),u=wt((.0193339*l+.119192*s+.9503041*t)/o.Zn),[c,f,u]},g.lab=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["lab"]),function(){})},m.lab=fe,e.prototype.lab=function(){return Ft(this._rgb)},S=function(t){var s,l,a,c,f,u,_,b,w,L,N;return t=function(){var M,x,O;for(O=[],x=0,M=t.length;x<M;x++)c=t[x],O.push(g(c));return O}(),t.length===2?(w=function(){var M,x,O;for(O=[],x=0,M=t.length;x<M;x++)c=t[x],O.push(c.lab());return O}(),f=w[0],u=w[1],s=function(M){var x,O;return O=function(){var C,P;for(P=[],x=C=0;C<=2;x=++C)P.push(f[x]+M*(u[x]-f[x]));return P}(),g.lab.apply(g,O)}):t.length===3?(L=function(){var M,x,O;for(O=[],x=0,M=t.length;x<M;x++)c=t[x],O.push(c.lab());return O}(),f=L[0],u=L[1],_=L[2],s=function(M){var x,O;return O=function(){var C,P;for(P=[],x=C=0;C<=2;x=++C)P.push((1-M)*(1-M)*f[x]+2*(1-M)*M*u[x]+M*M*_[x]);return P}(),g.lab.apply(g,O)}):t.length===4?(N=function(){var M,x,O;for(O=[],x=0,M=t.length;x<M;x++)c=t[x],O.push(c.lab());return O}(),f=N[0],u=N[1],_=N[2],b=N[3],s=function(M){var x,O;return O=function(){var C,P;for(P=[],x=C=0;C<=2;x=++C)P.push((1-M)*(1-M)*(1-M)*f[x]+3*(1-M)*(1-M)*M*u[x]+3*(1-M)*M*M*_[x]+M*M*M*b[x]);return P}(),g.lab.apply(g,O)}):t.length===5&&(l=S(t.slice(0,3)),a=S(t.slice(2,5)),s=function(M){return M<.5?l(M*2):a((M-.5)*2)}),s},g.bezier=function(t){var s;return s=S(t),s.scale=function(){return g.scale(s)},s},g.cubehelix=function(t,s,l,a,c){var f,u,_;return t==null&&(t=300),s==null&&(s=-1.5),l==null&&(l=1),a==null&&(a=1),c==null&&(c=[0,1]),f=0,ee(c)==="array"?u=c[1]-c[0]:(u=0,c=[c,c]),_=function(b){var w,L,N,M,x,O,C,P,X;return w=h*((t+120)/360+s*b),C=ae(c[0]+u*b,a),O=f!==0?l[0]+b*f:l,L=O*C*(1-C)/2,M=U(w),X=Ye(w),P=C+L*(-.14861*M+1.78277*X),x=C+L*(-.29227*M-.90649*X),N=C+L*(1.97294*M),g(re([P*255,x*255,N*255,1]))},_.start=function(b){return b==null?t:(t=b,_)},_.rotations=function(b){return b==null?s:(s=b,_)},_.gamma=function(b){return b==null?a:(a=b,_)},_.hue=function(b){return b==null?l:(l=b,ee(l)==="array"?(f=l[1]-l[0],f===0&&(l=l[1])):f=0,_)},_.lightness=function(b){return b==null?c:(ee(b)==="array"?(c=b,u=b[1]-b[0]):(c=[b,b],u=0),_)},_.scale=function(){return g.scale(_)},_.hue(l),_},g.random=function(){var t,s,l,a;for(s="0123456789abcdef",t="#",l=a=0;a<6;l=++a)t+=s.charAt(oe(Math.random()*16));return new e(t)},E=[],Se=function(t,s,l,a){var c,f,u,_;for(l==null&&(l=.5),a==null&&(a="rgb"),ee(t)!=="object"&&(t=g(t)),ee(s)!=="object"&&(s=g(s)),u=0,f=E.length;u<f;u++)if(c=E[u],a===c[0]){_=c[1](t,s,l,a);break}if(_==null)throw"color mode "+a+" is not supported";return _.alpha(t.alpha()+l*(s.alpha()-t.alpha()))},g.interpolate=Se,e.prototype.interpolate=function(t,s,l){return Se(this,t,s,l)},g.mix=Se,e.prototype.mix=e.prototype.interpolate,m.rgb=function(){var t,s,l,a;s=te(arguments),l=[];for(t in s)a=s[t],l.push(a);return l},g.rgb=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["rgb"]),function(){})},e.prototype.rgb=function(t){return t==null&&(t=!0),t?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},e.prototype.rgba=function(t){return t==null&&(t=!0),t?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},y.push({p:3,test:function(t){var s;if(s=te(arguments),ee(s)==="array"&&s.length===3||s.length===4&&ee(s[3])==="number"&&s[3]>=0&&s[3]<=1)return"rgb"}}),m.lrgb=m.rgb,ve=function(t,s,l,a){var c,f;return c=t._rgb,f=s._rgb,new e(we(ae(c[0],2)*(1-l)+ae(f[0],2)*l),we(ae(c[1],2)*(1-l)+ae(f[1],2)*l),we(ae(c[2],2)*(1-l)+ae(f[2],2)*l),a)},p=function(t){var s,l,a,c,f,u;for(l=1/t.length,u=[0,0,0,0],c=0,a=t.length;c<a;c++)s=t[c],f=s._rgb,u[0]+=ae(f[0],2)*l,u[1]+=ae(f[1],2)*l,u[2]+=ae(f[2],2)*l,u[3]+=f[3]*l;return u[0]=we(u[0]),u[1]=we(u[1]),u[2]=we(u[2]),u[3]>1&&(u[3]=1),new e(re(u))},E.push(["lrgb",ve]),g.average=function(t,s){var l,a,c,f,u,_,b,w,L,N,M,x,O;if(s==null&&(s="rgb"),L=t.length,t=t.map(function(C){return g(C)}),b=t.splice(0,1)[0],s==="lrgb")return p(t);x=b.get(s),f=[],u=0,_=0;for(w in x)x[w]=x[w]||0,f.push(isNaN(x[w])?0:1),s.charAt(w)==="h"&&!isNaN(x[w])&&(l=x[w]/180*n,u+=U(l),_+=Ye(l));for(a=b.alpha(),M=0,N=t.length;M<N;M++){c=t[M],O=c.get(s),a+=c.alpha();for(w in x)isNaN(O[w])||(f[w]+=1,s.charAt(w)==="h"?(l=O[w]/180*n,u+=U(l),_+=Ye(l)):x[w]+=O[w])}for(w in x)if(s.charAt(w)==="h"){for(l=R(_/f[w],u/f[w])/n*180;l<0;)l+=360;for(;l>=360;)l-=360;x[w]=l}else x[w]=x[w]/f[w];return g(x,s).alpha(a/L)},Me=function(t){var s,l,a,c,f,u;if(t.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(t.length===4||t.length===7)&&(t=t.substr(1)),t.length===3&&(t=t.split(""),t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),u=parseInt(t,16),c=u>>16,a=u>>8&255,l=u&255,[c,a,l,1];if(t.match(/^#?([A-Fa-f0-9]{8})$/))return t.length===9&&(t=t.substr(1)),u=parseInt(t,16),c=u>>24&255,a=u>>16&255,l=u>>8&255,s=me((u&255)/255*100)/100,[c,a,l,s];if(m.css!=null&&(f=m.css(t)))return f;throw"unknown color: "+t},fr=function(t,s){var l,a,c,f,u,_,b;return s==null&&(s="auto"),u=t[0],c=t[1],a=t[2],l=t[3],s==="auto"&&(s=l<1?"rgba":"rgb"),u=Math.round(u),c=Math.round(c),a=Math.round(a),b=u<<16|c<<8|a,_="000000"+b.toString(16),_=_.substr(_.length-6),f="0"+me(l*255).toString(16),f=f.substr(f.length-2),"#"+function(){switch(s.toLowerCase()){case"rgba":return _+f;case"argb":return f+_;default:return _}}()},m.hex=function(t){return Me(t)},g.hex=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["hex"]),function(){})},e.prototype.hex=function(t){return t==null&&(t="auto"),fr(this._rgb,t)},y.push({p:4,test:function(t){if(arguments.length===1&&ee(t)==="string")return"hex"}}),ge=function(){var t,s,l,a,c,f,u,_,b,w,L,N,M,x;if(t=te(arguments),c=t[0],L=t[1],u=t[2],L===0)b=a=s=u*255;else{for(x=[0,0,0],l=[0,0,0],M=u<.5?u*(1+L):u+L-u*L,N=2*u-M,c/=360,x[0]=c+1/3,x[1]=c,x[2]=c-1/3,f=_=0;_<=2;f=++_)x[f]<0&&(x[f]+=1),x[f]>1&&(x[f]-=1),6*x[f]<1?l[f]=N+(M-N)*6*x[f]:2*x[f]<1?l[f]=M:3*x[f]<2?l[f]=N+(M-N)*(2/3-x[f])*6:l[f]=N;w=[me(l[0]*255),me(l[1]*255),me(l[2]*255)],b=w[0],a=w[1],s=w[2]}return t.length>3?[b,a,s,t[3]]:[b,a,s]},_r=function(t,s,l){var a,c,f,u,_;return t!==void 0&&t.length>=3&&(u=t,t=u[0],s=u[1],l=u[2]),t/=255,s/=255,l/=255,f=Math.min(t,s,l),q=Math.max(t,s,l),c=(q+f)/2,q===f?(_=0,a=Number.NaN):_=c<.5?(q-f)/(q+f):(q-f)/(2-q-f),t===q?a=(s-l)/(q-f):s===q?a=2+(l-t)/(q-f):l===q&&(a=4+(t-s)/(q-f)),a*=60,a<0&&(a+=360),[a,_,c]},g.hsl=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["hsl"]),function(){})},m.hsl=ge,e.prototype.hsl=function(){return _r(this._rgb)},Ce=function(){var t,s,l,a,c,f,u,_,b,w,L,N,M,x,O,C,P,X;if(t=te(arguments),c=t[0],C=t[1],X=t[2],X*=255,C===0)b=a=s=X;else switch(c===360&&(c=0),c>360&&(c-=360),c<0&&(c+=360),c/=60,f=oe(c),l=c-f,u=X*(1-C),_=X*(1-C*l),P=X*(1-C*(1-l)),f){case 0:w=[X,P,u],b=w[0],a=w[1],s=w[2];break;case 1:L=[_,X,u],b=L[0],a=L[1],s=L[2];break;case 2:N=[u,X,P],b=N[0],a=N[1],s=N[2];break;case 3:M=[u,_,X],b=M[0],a=M[1],s=M[2];break;case 4:x=[P,u,X],b=x[0],a=x[1],s=x[2];break;case 5:O=[X,u,_],b=O[0],a=O[1],s=O[2]}return[b,a,s,t.length>3?t[3]:1]},hr=function(){var t,s,l,a,c,f,u,_,b;return u=te(arguments),f=u[0],l=u[1],t=u[2],c=Math.min(f,l,t),q=Math.max(f,l,t),s=q-c,b=q/255,q===0?(a=Number.NaN,_=0):(_=s/q,f===q&&(a=(l-t)/s),l===q&&(a=2+(t-f)/s),t===q&&(a=4+(f-l)/s),a*=60,a<0&&(a+=360)),[a,_,b]},g.hsv=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["hsv"]),function(){})},m.hsv=Ce,e.prototype.hsv=function(){return hr(this._rgb)},lr=function(t){var s,l,a;return ee(t)==="number"&&t>=0&&t<=16777215?(a=t>>16,l=t>>8&255,s=t&255,[a,l,s,1]):(console.warn("unknown num color: "+t),[0,0,0,1])},pr=function(){var t,s,l,a;return a=te(arguments),l=a[0],s=a[1],t=a[2],(l<<16)+(s<<8)+t},g.num=function(t){return new e(t,"num")},e.prototype.num=function(t){return t==null&&(t="rgb"),pr(this._rgb,t)},m.num=lr,y.push({p:1,test:function(t){if(arguments.length===1&&ee(t)==="number"&&t>=0&&t<=16777215)return"num"}}),Ne=function(){var t,s,l,a,c,f,u,_,b,w,L,N,M,x,O,C,P,X,ie,A;if(l=te(arguments),_=l[0],c=l[1],s=l[2],c=c/100,u=u/100*255,t=c*255,c===0)N=u=a=s;else switch(_===360&&(_=0),_>360&&(_-=360),_<0&&(_+=360),_/=60,b=oe(_),f=_-b,w=s*(1-c),L=w+t*(1-f),ie=w+t*f,A=w+t,b){case 0:M=[A,ie,w],N=M[0],u=M[1],a=M[2];break;case 1:x=[L,A,w],N=x[0],u=x[1],a=x[2];break;case 2:O=[w,A,ie],N=O[0],u=O[1],a=O[2];break;case 3:C=[w,L,A],N=C[0],u=C[1],a=C[2];break;case 4:P=[ie,w,A],N=P[0],u=P[1],a=P[2];break;case 5:X=[A,w,L],N=X[0],u=X[1],a=X[2]}return[N,u,a,l.length>3?l[3]:1]},dr=function(){var t,s,l,a,c,f,u,_,b;return b=te(arguments),_=b[0],c=b[1],s=b[2],u=Math.min(_,c,s),q=Math.max(_,c,s),a=q-u,l=a*100/255,t=u/(255-a)*100,a===0?f=Number.NaN:(_===q&&(f=(c-s)/a),c===q&&(f=2+(s-_)/a),s===q&&(f=4+(_-c)/a),f*=60,f<0&&(f+=360)),[f,l,t]},g.hcg=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["hcg"]),function(){})},m.hcg=Ne,e.prototype.hcg=function(){return dr(this._rgb)},se=function(t){var s,l,a,c,f,u,_,b;if(t=t.toLowerCase(),g.colors!=null&&g.colors[t])return Me(g.colors[t]);if(f=t.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(_=f.slice(1,4),c=u=0;u<=2;c=++u)_[c]=+_[c];_[3]=1}else if(f=t.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(_=f.slice(1,5),c=b=0;b<=3;c=++b)_[c]=+_[c];else if(f=t.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(_=f.slice(1,4),c=s=0;s<=2;c=++s)_[c]=me(_[c]*2.55);_[3]=1}else if(f=t.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(_=f.slice(1,5),c=l=0;l<=2;c=++l)_[c]=me(_[c]*2.55);_[3]=+_[3]}else(f=t.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(a=f.slice(1,4),a[1]*=.01,a[2]*=.01,_=ge(a),_[3]=1):(f=t.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(a=f.slice(1,4),a[1]*=.01,a[2]*=.01,_=ge(a),_[3]=+f[4]);return _},cr=function(t){var s;if(s=t[3]<1?"rgba":"rgb",s==="rgb")return s+"("+t.slice(0,3).map(me).join(",")+")";if(s==="rgba")return s+"("+t.slice(0,3).map(me).join(",")+","+t[3]+")"},vt=function(t){return me(t*100)/100},ce=function(t,s){var l;return l=s<1?"hsla":"hsl",t[0]=vt(t[0]||0),t[1]=vt(t[1]*100)+"%",t[2]=vt(t[2]*100)+"%",l==="hsla"&&(t[3]=s),l+"("+t.join(",")+")"},m.css=function(t){return se(t)},g.css=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["css"]),function(){})},e.prototype.css=function(t){if(t==null&&(t="rgb"),t.slice(0,3)==="rgb")return cr(this._rgb);if(t.slice(0,3)==="hsl")return ce(this.hsl(),this.alpha())},m.named=function(t){return Me(Te[t])},y.push({p:5,test:function(t){if(arguments.length===1&&Te[t]!=null)return"named"}}),e.prototype.name=function(t){var s,l;arguments.length&&(Te[t]&&(this._rgb=Me(Te[t])),this._rgb[3]=1),s=this.hex("rgb");for(l in Te)if(s===Te[l])return l;return s},tr=function(){var t,s,l,a;return a=te(arguments),l=a[0],t=a[1],s=a[2],s=s*r,[l,U(s)*t,Ye(s)*t]},Pt=function(){var t,s,l,a,c,f,u,_,b,w,L;return l=te(arguments),_=l[0],c=l[1],u=l[2],w=tr(_,c,u),t=w[0],s=w[1],a=w[2],L=fe(t,s,a),b=L[0],f=L[1],a=L[2],[b,f,a,l.length>3?l[3]:1]},gt=function(){var t,s,l,a,c,f;return f=te(arguments),c=f[0],t=f[1],s=f[2],l=we(t*t+s*s),a=(R(s,t)*d+360)%360,me(l*1e4)===0&&(a=Number.NaN),[c,l,a]},Ut=function(){var t,s,l,a,c,f,u;return f=te(arguments),c=f[0],l=f[1],s=f[2],u=Ft(c,l,s),a=u[0],t=u[1],s=u[2],gt(a,t,s)},g.lch=function(){var t;return t=te(arguments),new e(t,"lch")},g.hcl=function(){var t;return t=te(arguments),new e(t,"hcl")},m.lch=Pt,m.hcl=function(){var t,s,l,a;return a=te(arguments),s=a[0],t=a[1],l=a[2],Pt([l,t,s])},e.prototype.lch=function(){return Ut(this._rgb)},e.prototype.hcl=function(){return Ut(this._rgb).reverse()},ar=function(t){var s,l,a,c,f,u,_,b,w;return t==null&&(t="rgb"),b=te(arguments),_=b[0],c=b[1],s=b[2],_=_/255,c=c/255,s=s/255,f=1-Math.max(_,Math.max(c,s)),a=f<1?1/(1-f):0,l=(1-_-f)*a,u=(1-c-f)*a,w=(1-s-f)*a,[l,u,w,f]},W=function(){var t,s,l,a,c,f,u,_,b;return s=te(arguments),a=s[0],u=s[1],b=s[2],f=s[3],t=s.length>4?s[4]:1,f===1?[0,0,0,t]:(_=a>=1?0:255*(1-a)*(1-f),c=u>=1?0:255*(1-u)*(1-f),l=b>=1?0:255*(1-b)*(1-f),[_,c,l,t])},m.cmyk=function(){return W(te(arguments))},g.cmyk=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["cmyk"]),function(){})},e.prototype.cmyk=function(){return ar(this._rgb)},m.gl=function(){var t,s,l,a,c;for(a=function(){var f,u;f=te(arguments),u=[];for(s in f)c=f[s],u.push(c);return u}.apply(this,arguments),t=l=0;l<=2;t=++l)a[t]*=255;return a},g.gl=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["gl"]),function(){})},e.prototype.gl=function(){var t;return t=this._rgb,[t[0]/255,t[1]/255,t[2]/255,t[3]]},Ht=function(t,s,l){var a;return a=te(arguments),t=a[0],s=a[1],l=a[2],t=bt(t),s=bt(s),l=bt(l),.2126*t+.7152*s+.0722*l},bt=function(t){return t/=255,t<=.03928?t/12.92:ae((t+.055)/1.055,2.4)},je=function(t,s,l,a){var c,f;return c=t._rgb,f=s._rgb,new e(c[0]+l*(f[0]-c[0]),c[1]+l*(f[1]-c[1]),c[2]+l*(f[2]-c[2]),a)},E.push(["rgb",je]),e.prototype.luminance=function(t,s){var l,a,c,f,u;return s==null&&(s="rgb"),arguments.length?(f=this._rgb,t===0?f=[0,0,0,this._rgb[3]]:t===1?f=[255,255,255,this[3]]:(l=Ht(this._rgb),a=1e-7,c=20,u=function(_,b){var w,L;return L=_.interpolate(b,.5,s),w=L.luminance(),Math.abs(t-w)<a||!c--?L:w>t?u(_,L):u(L,b)},l>t?f=u(g("black"),this).rgba():f=u(this,g("white")).rgba()),g(f).alpha(this.alpha())):Ht(this._rgb)},jt=function(t){var s,l,a,c;return c=t/100,c<66?(a=255,l=-155.25485562709179-.44596950469579133*(l=c-2)+104.49216199393888*Fe(l),s=c<20?0:-254.76935184120902+.8274096064007395*(s=c-10)+115.67994401066147*Fe(s)):(a=351.97690566805693+.114206453784165*(a=c-55)-40.25366309332127*Fe(a),l=325.4494125711974+.07943456536662342*(l=c-50)-28.0852963507957*Fe(l),s=255),[a,l,s]},gr=function(){var t,s,l,a,c,f,u,_,b;for(u=te(arguments),f=u[0],l=u[1],t=u[2],c=1e3,a=4e4,s=.4;a-c>s;)b=(a+c)*.5,_=jt(b),_[2]/_[0]>=t/f?a=b:c=b;return me(b)},g.temperature=g.kelvin=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["temperature"]),function(){})},m.temperature=m.kelvin=m.K=jt,e.prototype.temperature=function(){return gr(this._rgb)},e.prototype.kelvin=e.prototype.temperature,g.contrast=function(t,s){var l,a,c,f;return((c=ee(t))==="string"||c==="number")&&(t=new e(t)),((f=ee(s))==="string"||f==="number")&&(s=new e(s)),l=t.luminance(),a=s.luminance(),l>a?(l+.05)/(a+.05):(a+.05)/(l+.05)},g.distance=function(t,s,l){var a,c,f,u,_,b,w;l==null&&(l="lab"),((_=ee(t))==="string"||_==="number")&&(t=new e(t)),((b=ee(s))==="string"||b==="number")&&(s=new e(s)),f=t.get(l),u=s.get(l),w=0;for(c in f)a=(f[c]||0)-(u[c]||0),w+=a*a;return Math.sqrt(w)},g.deltaE=function(t,s,l,a){var c,f,u,_,b,w,L,N,M,x,O,C,P,X,ie,A,Le,be,j,V,_e,v,z,H,G,F,B;for(l==null&&(l=1),a==null&&(a=1),((Le=ee(t))==="string"||Le==="number")&&(t=new e(t)),((be=ee(s))==="string"||be==="number")&&(s=new e(s)),j=t.lab(),c=j[0],u=j[1],b=j[2],V=s.lab(),f=V[0],_=V[1],w=V[2],L=we(u*u+b*b),N=we(_*_+w*w),z=c<16?.511:.040975*c/(1+.01765*c),_e=.0638*L/(1+.0131*L)+.638,A=L<1e-6?0:R(b,u)*180/n;A<0;)A+=360;for(;A>=360;)A-=360;return H=A>=164&&A<=345?.56+T(.2*U(n*(A+168)/180)):.36+T(.4*U(n*(A+35)/180)),M=L*L*L*L,ie=we(M/(M+1900)),v=_e*(ie*H+1-ie),X=c-f,P=L-N,O=u-_,C=b-w,x=O*O+C*C-P*P,G=X/(l*z),F=P/(a*_e),B=v,we(G*G+F*F+x/(B*B))},e.prototype.get=function(t){var s,l,a,c,f,u;return a=this,f=t.split("."),c=f[0],s=f[1],u=a[c](),s?(l=c.indexOf(s),l>-1?u[l]:console.warn("unknown channel "+s+" in mode "+c)):u},e.prototype.set=function(t,s){var l,a,c,f,u,_;if(c=this,u=t.split("."),f=u[0],l=u[1],l)if(_=c[f](),a=f.indexOf(l),a>-1)if(ee(s)==="string")switch(s.charAt(0)){case"+":_[a]+=+s;break;case"-":_[a]+=+s;break;case"*":_[a]*=+s.substr(1);break;case"/":_[a]/=+s.substr(1);break;default:_[a]=+s}else _[a]=s;else console.warn("unknown channel "+l+" in mode "+f);else _=s;return g(_,f).alpha(c.alpha())},e.prototype.clipped=function(){return this._rgb._clipped||!1},e.prototype.alpha=function(t){return arguments.length?g.rgb([this._rgb[0],this._rgb[1],this._rgb[2],t]):this._rgb[3]},e.prototype.darken=function(t){var s,l;return t==null&&(t=1),l=this,s=l.lab(),s[0]-=o.Kn*t,g.lab(s).alpha(l.alpha())},e.prototype.brighten=function(t){return t==null&&(t=1),this.darken(-t)},e.prototype.darker=e.prototype.darken,e.prototype.brighter=e.prototype.brighten,e.prototype.saturate=function(t){var s,l;return t==null&&(t=1),l=this,s=l.lch(),s[1]+=t*o.Kn,s[1]<0&&(s[1]=0),g.lch(s).alpha(l.alpha())},e.prototype.desaturate=function(t){return t==null&&(t=1),this.saturate(-t)},e.prototype.premultiply=function(){var t,s;return s=this.rgb(),t=this.alpha(),g(s[0]*t,s[1]*t,s[2]*t,t)},D=function(t,s,l){if(!D[l])throw"unknown blend mode "+l;return D[l](t,s)},I=function(t){return function(s,l){var a,c;return a=g(l).rgb(),c=g(s).rgb(),g(t(a,c),"rgb")}},ne=function(t){return function(s,l){var a,c,f;for(f=[],a=c=0;c<=3;a=++c)f[a]=t(s[a],l[a]);return f}},ir=function(t,s){return t},sr=function(t,s){return t*s/255},Q=function(t,s){return t>s?s:t},rr=function(t,s){return t>s?t:s},yr=function(t,s){return 255*(1-(1-t/255)*(1-s/255))},nr=function(t,s){return s<128?2*t*s/255:255*(1-2*(1-t/255)*(1-s/255))},$=function(t,s){return 255*(1-(1-s/255)/(t/255))},ye=function(t,s){return t===255||(t=255*(s/255)/(1-t/255),t>255)?255:t},D.normal=I(ne(ir)),D.multiply=I(ne(sr)),D.screen=I(ne(yr)),D.overlay=I(ne(nr)),D.darken=I(ne(Q)),D.lighten=I(ne(rr)),D.dodge=I(ne(ye)),D.burn=I(ne($)),g.blend=D,g.analyze=function(t){var s,l,a,c;for(a={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},l=0,s=t.length;l<s;l++)c=t[l],c!=null&&!isNaN(c)&&(a.values.push(c),a.sum+=c,c<a.min&&(a.min=c),c>a.max&&(a.max=c),a.count+=1);return a.domain=[a.min,a.max],a.limits=function(f,u){return g.limits(a,f,u)},a},g.scale=function(t,s){var l,a,c,f,u,_,b,w,L,N,M,x,O,C,P,X,ie,A,Le,be,j,V,_e;return N="rgb",M=g("#ccc"),P=0,_=!1,u=[0,1],C=[],O=[0,0],l=!1,c=[],x=!1,L=0,w=1,f=!1,a={},X=!0,b=1,V=function(v){var z,H,G,F,B,J;if(v==null&&(v=["#fff","#000"]),v!=null&&ee(v)==="string"&&g.brewer!=null&&(v=g.brewer[v]||g.brewer[v.toLowerCase()]||v),ee(v)==="array"){for(v.length===1&&(v=[v[0],v[0]]),v=v.slice(0),z=G=0,F=v.length-1;0<=F?G<=F:G>=F;z=0<=F?++G:--G)H=v[z],ee(H)==="string"&&(v[z]=g(H));for(C.length=0,z=J=0,B=v.length-1;0<=B?J<=B:J>=B;z=0<=B?++J:--J)C.push(z/(v.length-1))}return j(),c=v},Le=function(v){var z,H;if(l!=null){for(H=l.length-1,z=0;z<H&&v>=l[z];)z++;return z-1}return 0},_e=function(v){return v},ie=function(v){var z,H,G,F,B;return B=v,l.length>2&&(F=l.length-1,z=Le(v),G=l[0]+(l[1]-l[0])*(0+P*.5),H=l[F-1]+(l[F]-l[F-1])*(1-P*.5),B=L+(l[z]+(l[z+1]-l[z])*.5-G)/(H-G)*(w-L)),B},be=function(v,z){var H,G,F,B,J,Z,le,Y;if(z==null&&(z=!1),isNaN(v)||v===null)return M;if(z?Y=v:l&&l.length>2?(H=Le(v),Y=H/(l.length-2)):w!==L?Y=(v-L)/(w-L):Y=1,z||(Y=_e(Y)),b!==1&&(Y=ae(Y,b)),Y=O[0]+Y*(1-O[0]-O[1]),Y=Math.min(1,Math.max(0,Y)),B=Math.floor(Y*1e4),X&&a[B])G=a[B];else{if(ee(c)==="array")for(F=J=0,le=C.length-1;0<=le?J<=le:J>=le;F=0<=le?++J:--J){if(Z=C[F],Y<=Z){G=c[F];break}if(Y>=Z&&F===C.length-1){G=c[F];break}if(Y>Z&&Y<C[F+1]){Y=(Y-Z)/(C[F+1]-Z),G=g.interpolate(c[F],c[F+1],Y,N);break}}else ee(c)==="function"&&(G=c(Y));X&&(a[B]=G)}return G},j=function(){return a={}},V(t),A=function(v){var z;return z=g(be(v)),x&&z[x]?z[x]():z},A.classes=function(v){var z;return v!=null?(ee(v)==="array"?(l=v,u=[v[0],v[v.length-1]]):(z=g.analyze(u),v===0?l=[z.min,z.max]:l=g.limits(z,"e",v)),A):l},A.domain=function(v){var z,H,G,F,B,J,Z;if(!arguments.length)return u;if(L=v[0],w=v[v.length-1],C=[],G=c.length,v.length===G&&L!==w)for(B=0,F=v.length;B<F;B++)H=v[B],C.push((H-L)/(w-L));else for(z=Z=0,J=G-1;0<=J?Z<=J:Z>=J;z=0<=J?++Z:--Z)C.push(z/(G-1));return u=[L,w],A},A.mode=function(v){return arguments.length?(N=v,j(),A):N},A.range=function(v,z){return V(v,z),A},A.out=function(v){return x=v,A},A.spread=function(v){return arguments.length?(P=v,A):P},A.correctLightness=function(v){return v==null&&(v=!0),f=v,j(),f?_e=function(z){var H,G,F,B,J,Z,le,Y,de;for(H=be(0,!0).lab()[0],G=be(1,!0).lab()[0],le=H>G,F=be(z,!0).lab()[0],J=H+(G-H)*z,B=F-J,Y=0,de=1,Z=20;Math.abs(B)>.01&&Z-- >0;)(function(){return le&&(B*=-1),B<0?(Y=z,z+=(de-z)*.5):(de=z,z+=(Y-z)*.5),F=be(z,!0).lab()[0],B=F-J})();return z}:_e=function(z){return z},A},A.padding=function(v){return v!=null?(ee(v)==="number"&&(v=[v,v]),O=v,A):O},A.colors=function(v,z){var H,G,F,B,J,Z,le,Y,de;if(arguments.length<2&&(z="hex"),Z=[],arguments.length===0)Z=c.slice(0);else if(v===1)Z=[A(.5)];else if(v>1)G=u[0],H=u[1]-G,Z=function(){le=[];for(var he=0;0<=v?he<v:he>v;0<=v?he++:he--)le.push(he);return le}.apply(this).map(function(he){return A(G+he/(v-1)*H)});else{if(t=[],Y=[],l&&l.length>2)for(F=de=1,J=l.length;1<=J?de<J:de>J;F=1<=J?++de:--de)Y.push((l[F-1]+l[F])*.5);else Y=u;Z=Y.map(function(he){return A(he)})}return g[z]&&(Z=Z.map(function(he){return he[z]()})),Z},A.cache=function(v){return v!=null?(X=v,A):X},A.gamma=function(v){return v!=null?(b=v,A):b},A.nodata=function(v){return v!=null?(M=g(v),A):M},A},g.scales==null&&(g.scales={}),g.scales.cool=function(){return g.scale([g.hsl(180,1,.9),g.hsl(250,.7,.4)])},g.scales.hot=function(){return g.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},g.analyze=function(t,s,l){var a,c,f,u,_,b,w;if(_={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},l==null&&(l=function(){return!0}),a=function(L){L!=null&&!isNaN(L)&&(_.values.push(L),_.sum+=L,L<_.min&&(_.min=L),L>_.max&&(_.max=L),_.count+=1)},w=function(L,N){if(l(L,N))return s!=null&&ee(s)==="function"?a(s(L)):s!=null&&ee(s)==="string"||ee(s)==="number"?a(L[s]):a(L)},ee(t)==="array")for(u=0,f=t.length;u<f;u++)b=t[u],w(b);else for(c in t)b=t[c],w(b,c);return _.domain=[_.min,_.max],_.limits=function(L,N){return g.limits(_,L,N)},_},g.limits=function(t,s,l){var a,c,f,u,_,b,w,L,N,M,x,O,C,P,X,ie,A,Le,be,j,V,_e,v,z,H,G,F,B,J,Z,le,Y,de,he,Xe,Ve,Ke,Ze,Je,Qe,vr,et,tt,rt,ot,st,it,lt,nt,at,yo,De,kt,wr,Oe,ct;if(s==null&&(s="equal"),l==null&&(l=7),ee(t)==="array"&&(t=g.analyze(t)),H=t.min,q=t.max,yo=t.sum,Oe=t.values.sort(function($t,Gt){return $t-Gt}),l===1)return[H,q];if(v=[],s.substr(0,1)==="c"&&(v.push(H),v.push(q)),s.substr(0,1)==="e"){for(v.push(H),j=le=1,Xe=l-1;1<=Xe?le<=Xe:le>=Xe;j=1<=Xe?++le:--le)v.push(H+j/l*(q-H));v.push(q)}else if(s.substr(0,1)==="l"){if(H<=0)throw"Logarithmic scales are only possible for values > 0";for(G=Math.LOG10E*Fe(H),z=Math.LOG10E*Fe(q),v.push(H),j=ct=1,Ve=l-1;1<=Ve?ct<=Ve:ct>=Ve;j=1<=Ve?++ct:--ct)v.push(ae(10,G+j/l*(z-G)));v.push(q)}else if(s.substr(0,1)==="q"){for(v.push(H),j=a=1,et=l-1;1<=et?a<=et:a>=et;j=1<=et?++a:--a)Y=(Oe.length-1)*j/l,de=oe(Y),de===Y?v.push(Oe[de]):(he=Y-de,v.push(Oe[de]*(1-he)+Oe[de+1]*he));v.push(q)}else if(s.substr(0,1)==="k"){for(B=Oe.length,P=new Array(B),Le=new Array(l),at=!0,J=0,ie=null,ie=[],ie.push(H),j=c=1,tt=l-1;1<=tt?c<=tt:c>=tt;j=1<=tt?++c:--c)ie.push(H+j/l*(q-H));for(ie.push(q);at;){for(V=f=0,rt=l-1;0<=rt?f<=rt:f>=rt;V=0<=rt?++f:--f)Le[V]=0;for(j=u=0,ot=B-1;0<=ot?u<=ot:u>=ot;j=0<=ot?++u:--u){for(wr=Oe[j],F=Number.MAX_VALUE,V=_=0,st=l-1;0<=st?_<=st:_>=st;V=0<=st?++_:--_)be=T(ie[V]-wr),be<F&&(F=be,X=V);Le[X]++,P[j]=X}for(Z=new Array(l),V=b=0,it=l-1;0<=it?b<=it:b>=it;V=0<=it?++b:--b)Z[V]=null;for(j=w=0,lt=B-1;0<=lt?w<=lt:w>=lt;j=0<=lt?++w:--w)A=P[j],Z[A]===null?Z[A]=Oe[j]:Z[A]+=Oe[j];for(V=L=0,nt=l-1;0<=nt?L<=nt:L>=nt;V=0<=nt?++L:--L)Z[V]*=1/Le[V];for(at=!1,V=N=0,Ke=l-1;0<=Ke?N<=Ke:N>=Ke;V=0<=Ke?++N:--N)if(Z[V]!==ie[j]){at=!0;break}ie=Z,J++,J>200&&(at=!1)}for(_e={},V=M=0,Ze=l-1;0<=Ze?M<=Ze:M>=Ze;V=0<=Ze?++M:--M)_e[V]=[];for(j=x=0,Je=B-1;0<=Je?x<=Je:x>=Je;j=0<=Je?++x:--x)A=P[j],_e[A].push(Oe[j]);for(De=[],V=O=0,Qe=l-1;0<=Qe?O<=Qe:O>=Qe;V=0<=Qe?++O:--O)De.push(_e[V][0]),De.push(_e[V][_e[V].length-1]);for(De=De.sort(function($t,Gt){return $t-Gt}),v.push(De[0]),j=C=1,vr=De.length-1;C<=vr;j=C+=2)kt=De[j],!isNaN(kt)&&v.indexOf(kt)===-1&&v.push(kt)}return v},Ae=function(t,s,l){var a,c,f,u;return a=te(arguments),t=a[0],s=a[1],l=a[2],isNaN(t)&&(t=0),t/=360,t<1/3?(c=(1-s)/3,u=(1+s*U(h*t)/U(i-h*t))/3,f=1-(c+u)):t<2/3?(t-=1/3,u=(1-s)/3,f=(1+s*U(h*t)/U(i-h*t))/3,c=1-(u+f)):(t-=2/3,f=(1-s)/3,c=(1+s*U(h*t)/U(i-h*t))/3,u=1-(f+c)),u=mt(l*u*3),f=mt(l*f*3),c=mt(l*c*3),[u*255,f*255,c*255,a.length>3?a[3]:1]},ur=function(){var t,s,l,a,c,f,u,_;return u=te(arguments),f=u[0],s=u[1],t=u[2],h=Math.PI*2,f/=255,s/=255,t/=255,c=Math.min(f,s,t),a=(f+s+t)/3,_=1-c/a,_===0?l=0:(l=(f-s+(f-t))/2,l/=Math.sqrt((f-s)*(f-s)+(f-t)*(s-t)),l=Math.acos(l),t>s&&(l=h-l),l/=h),[l*360,_,a]},g.hsi=function(){return function(t,s,l){l.prototype=t.prototype;var a=new l,c=t.apply(a,s);return Object(c)===c?c:a}(e,Ee.call(arguments).concat(["hsi"]),function(){})},m.hsi=Ae,e.prototype.hsi=function(){return ur(this._rgb)},Re=function(t,s,l,a){var c,f,u,_,b,w,L,N,M,x,O,C,P;return a==="hsl"?(C=t.hsl(),P=s.hsl()):a==="hsv"?(C=t.hsv(),P=s.hsv()):a==="hcg"?(C=t.hcg(),P=s.hcg()):a==="hsi"?(C=t.hsi(),P=s.hsi()):(a==="lch"||a==="hcl")&&(a="hcl",C=t.hcl(),P=s.hcl()),a.substr(0,1)==="h"&&(u=C[0],x=C[1],w=C[2],_=P[0],O=P[1],L=P[2]),!isNaN(u)&&!isNaN(_)?(_>u&&_-u>180?c=_-(u+360):_<u&&u-_>180?c=_+360-u:c=_-u,f=u+l*c):isNaN(u)?isNaN(_)?f=Number.NaN:(f=_,(w===1||w===0)&&a!=="hsv"&&(M=O)):(f=u,(L===1||L===0)&&a!=="hsv"&&(M=x)),M==null&&(M=x+l*(O-x)),b=w+l*(L-w),N=g[a](f,M,b)},E=E.concat(function(){var t,s,l,a;for(l=["hsv","hsl","hsi","hcl","lch","hcg"],a=[],s=0,t=l.length;s<t;s++)or=l[s],a.push([or,Re]);return a}()),ke=function(t,s,l,a){var c,f;return c=t.num(),f=s.num(),g.num(c+(f-c)*l,"num")},E.push(["num",ke]),Be=function(t,s,l,a){var c,f,u;return f=t.lab(),u=s.lab(),c=new e(f[0]+l*(u[0]-f[0]),f[1]+l*(u[1]-f[1]),f[2]+l*(u[2]-f[2]),a)},E.push(["lab",Be])}).call(dt)});var Ue=new WeakMap,Mr=!0,Oo=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,zo=Oo?5e6:1e7,Mt=0,$e=0,Sr=performance.now();function Co(){let e=performance.now(),r=e-Sr,o=Mt,n=$e*1e3/r,i=1e3/o,d=$e;return Mt=0,$e=0,Sr=e,{avg:o,real_fps:n,virtual_fps:i,num_frames:d,elapsed:r}}function No(e){Mt=(Mt*$e+e)/($e+1),$e+=1}var Cr=(e,...r)=>e.map((o,n)=>[o,r[n]]).flat().filter(o=>!!o).join(""),Ao=()=>{let e,r=new Promise(o=>{e=o});return r.resolve=e,r},Ie=new Map;async function Ro(e){return await new Promise(requestAnimationFrame),await Ie.get(e)}async function Nr(e,r){if(Ie.has(e)&&(await Ie.get(e),Ie.has(e))){await Ie.get(e);return}Ie.set(e,Ao());try{return await r()}finally{let o=Ie.get(e);Ie.delete(e),o.resolve()}}var To=":host{position:absolute;top:0px;left:0px;right:0px;bottom:0px;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch;}div.rt-virtual-panel{position:absolute;top:0;left:0;right:0;pointer-events:none;}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%;}div.rt-tree-container{display:flex;align-items:center;height:100%;}slot{position:absolute;overflow:hidden;overflow-anchor:none;}",Do=":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px;}",Io=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"});let e="<slot></slot>";this.shadowRoot.innerHTML=Cr`
            <style>
                ${To}
            </style>
            <style>
                ${Do}
            </style>
            <div class="rt-virtual-panel"></div>
            <div class="rt-scroll-table-clip">
                ${e}
            </div>
        `;let[,r,o,n]=this.shadowRoot.children;this._sub_cell_style=r,this._table_clip=n,this._virtual_panel=o,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode==="both"||this._virtual_mode==="vertical"?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),this._virtual_mode==="both"||this._virtual_mode==="horizontal"?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),this._virtual_mode!=="both"?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(e,r){let{start_row:o,end_row:n}=this._calculate_row_range(e),{start_col:i,end_col:d}=this._calculate_column_range(r);return this._nrows=e,{start_col:i,end_col:d,start_row:o,end_row:n}}_calculate_row_range(e){let{height:r}=this._container_size,o=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length,i=Math.max(1,this._virtual_panel.offsetHeight-this.clientHeight),d=Math.max(Math.ceil(this.scrollTop),0)/i,h=r/o-n,p=Math.max(0,Math.ceil((e||0)-h))*d,y=Math.max(0,Math.min(p+h,e));return{start_row:p,end_row:y}}_calc_start_column(){let e=this._view_cache.config.row_pivots.length,r=0,o=0,n=0;for(;o<this.scrollLeft;){let i=this._column_sizes.indices[r+e];n=this.scrollLeft-o,r+=1,o+=i!==void 0?i:60}return r+=n/(this._column_sizes.indices[r+e-1]||60),Math.max(0,r-1)}_calculate_column_range(e){if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let r=this._calc_start_column(),o=this.table_model.num_columns()||Math.min(e,Math.ceil(this._container_size.width/60)),n=r+o+1;return{start_col:r,end_col:n}}}_max_scroll_column(e){let r=0;if(this._view_cache.config.row_pivots.length>0)for(let i of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))r+=i;let o=this._view_cache.config.row_pivots.length,n=e;for(;r<this._container_size.width&&n>=0;)n--,r+=this._column_sizes.indices[n+o]||60;return Math.min(e-1,n+1)}_validate_viewport({start_col:e,end_col:r,start_row:o,end_row:n}){o=Math.floor(o),n=Math.ceil(n),e=Math.floor(e),r=Math.ceil(r);let i=this._start_col!==e,d=this._start_row!==o||this._end_row!==n||this._end_col!==r;return this._start_col=e,this._end_col=r,this._start_row=o,this._end_row=n,{invalid_column:i,invalid_row:d}}_calc_scrollable_column_width(e){let r=this._view_cache.config.row_pivots.length,o=this._max_scroll_column(e),n=r,i=0;for(;n<o+r;)i+=this._column_sizes.indices[n]||60,n++;return i}_update_virtual_panel_width(e,r){if(e)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((o,n)=>o+n,0)+"px";else{let o=this._calc_scrollable_column_width(r);if(o!==0){let n=this._container_size.width+o+2;this._virtual_panel.style.width=n+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(e){let{row_height:r=19}=this._column_sizes,o=this._view_cache.config.column_pivots.length*r,n;if(this._virtual_mode==="horizontal"||this._virtual_mode==="none")n=e*r+o;else{let i=this.clientHeight/(this._table_clip.offsetHeight-o);n=Math.min(zo,e*r*i)}this._virtual_panel.style.height=`${n}px`}async draw(e={}){return typeof e.throttle<"u"&&!e.throttle?await Or.call(this,e):await Nr(this,()=>Or.call(this,e))}async _draw_flush(){await Ro(this)}update_sub_cell_offset(e){let r=this._column_sizes.row_height*(e.start_row%1)||0,o=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(e.start_col)]*(e.start_col%1)||0,n=this._sub_cell_style.sheet?.cssRules[0].style;n&&(n.setProperty("--regular-table--clip-x",`${o}px`),n.setProperty("--regular-table--clip-y",`${r}px`),n.setProperty("--regular-table--transform-x",`-${o}px`),n.setProperty("--regular-table--transform-y",`-${r}px`))}};async function Or(e){let r=Mr&&performance.now(),{invalid_viewport:o=!0,preserve_width:n=!1}=e,{num_columns:i,num_rows:d,row_height:h}=await this._view_cache.view(0,0,0,0);this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(d),n||this._update_virtual_panel_width(o,i);let p=this._calculate_viewport(d,i),{invalid_row:y,invalid_column:k}=this._validate_viewport(p);if(this._invalid_schema||y||k||o){let m=[],E=!0;for await(let T of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,n,p,i)){T!==void 0&&(m=m.concat(T)),E&&(this.update_sub_cell_offset(p),E=!1),this._is_styling=!0;let R=this._style_callbacks;for(let S of R)await S({detail:this});if(this._is_styling=!1,!this._invalidated&&T!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(m,h),this.table_model.header.reset_header_cache(),n||this._update_virtual_panel_width(this._invalid_schema||k,i),this._invalid_schema=!1}else this.update_sub_cell_offset(p);Mr&&No(performance.now()-r)}var Wo=!1,Po=class extends Io{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}async _on_scroll(e){e.stopPropagation(),await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this)),Wo&&(this.addEventListener("touchmove",this._on_touchmove.bind(this)),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!0}))}_on_mousewheel(e){if(!window.safari)return;let{clientWidth:r,clientHeight:o,scrollTop:n,scrollLeft:i}=this;e.preventDefault(),e.returnValue=!1;let d=Math.max(1,this._virtual_panel.offsetHeight-o),h=Math.max(1,this._virtual_panel.offsetWidth-r);this.scrollTop=Math.max(0,Math.min(d,n+e.deltaY)),this.scrollLeft=Math.max(0,Math.min(h,i+e.deltaX)),this._on_scroll(e)}_on_touchmove(e){e.stopPropagation(),e.preventDefault(),e.returnValue=!1;let{clientWidth:r,clientHeight:o}=this,n=Math.max(1,this._virtual_panel.offsetHeight-o),i=Math.max(1,this._virtual_panel.offsetWidth-r);this.scrollTop=Math.min(n,this._memo_scroll_top+(this._memo_touch_startY-e.touches[0].pageY)),this.scrollLeft=Math.min(i,this._memo_scroll_left+(this._memo_touch_startX-e.touches[0].pageX)),this._on_scroll(e)}_on_touchstart(e){this._memo_touch_startY=e.touches[0].pageY,this._memo_touch_startX=e.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(e){let r=e.target;for(;r.tagName!=="TD"&&r.tagName!=="TH";)if(r=r.parentElement,!this.contains(r))return;let o=e.target.classList.contains("rt-column-resize"),n=Ue.get(r);if(o){e.stopImmediatePropagation(),r.style.minWidth="",r.style.maxWidth="",e.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[n.size_key]=void 0,this._column_sizes.auto[n.size_key]=void 0,this._column_sizes.indices[n.size_key]=void 0);for(let i of e.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let d of e.shiftKey?i:[i[n._virtual_x]])d&&(d.style.minWidth="",d.style.maxWidth="",d.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(e){if(e.button!==0)return;let r=e.target;for(;r.tagName!=="TD"&&r.tagName!=="TH";)if(r=r.parentElement,!this.contains(r))return;let o=e.target.classList.contains("rt-column-resize"),n=Ue.get(r);o&&(this._on_resize_column(e,r,n),e.stopImmediatePropagation())}async _on_click_or_dblclick(e){let r=performance.now();this._last_clicked_time&&r-this._last_clicked_time<500?(this._last_clicked_time=r,await this._on_dblclick(e)):(this._last_clicked_time=r,await this._on_click(e))}_on_resize_column(e,r,o){let{_virtual_x:n,size_key:i}=o,d=e.pageX,h=n+r.colSpan-1,p=this.table_model.header.get_column_header(h),y=this._column_sizes.indices[i],k=E=>Nr(this,async()=>await this._on_resize_column_move(E,p,d,y,i,h)),m=()=>{document.removeEventListener("mousemove",k),document.removeEventListener("mouseup",m);let E=this._column_sizes.override[i],T=this._column_sizes.indices[i]!==E;this._column_sizes.indices[i]=E,T&&this.draw()};document.addEventListener("mousemove",k),document.addEventListener("mouseup",m)}async _on_resize_column_move(e,r,o,n,i,d){await new Promise(requestAnimationFrame);let h=e.pageX-o,p=Math.max(1,n+h);if(this._column_sizes.override[i]=p,h<0)await this.draw({preserve_width:!0,throttle:!1});else{r.style.minWidth=p+"px",r.style.maxWidth=p+"px";let y=this._column_sizes.auto[i];for(let k of this.table_model.body.cells){let m=k[d];m&&(m.style.maxWidth=m.style.minWidth=p+"px",m.classList.toggle("rt-cell-clip",y>p))}}}},Fo=class{constructor(e){this._name=e,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let e=this._elements[this._index];return this._index+=1,e}},Ar=class{constructor(e,r,o){this._column_sizes=e,this._container=r,this._span_factory=new Fo("span"),this.table=o,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(e,r){Ue.set(e,r)}_get_or_create_metadata(e){if(e===void 0)return{};if(Ue.has(e))return Ue.get(e);{let r={};return Ue.set(e,r),r}}_replace_cell(e,r){let{tr:o,row_container:n}=this._get_row(e),i=n[r];return i&&(o.removeChild(i),n.splice(r,1,void 0)),i}_fetch_cell(e,r){if(!(e<0||r<0))return this.cells[e]?.[r]}_get_row(e){let r=this.rows[e];r||(r=this.rows[e]=document.createElement("tr"),this.table.appendChild(r));let o=this.cells[e];return o||(o=this.cells[e]=[]),{tr:r,row_container:o}}_get_cell(e="TD",r,o){let{tr:n,row_container:i}=this._get_row(r),d=i[o];if(d||(o<i.length?(d=i[o]=document.createElement(e),n.insertBefore(d,i.slice(o+1).find(h=>h))):(d=i[o]=document.createElement(e),n.appendChild(d))),d.tagName!==e){let h=document.createElement(e);n.replaceChild(h,d),this.cells[r].splice(o,1,h),d=h}return d}_clean_columns(e){for(let r=0;r<this.rows.length;r++){let o=this.rows[r],n=this.cells[r];this.cells[r]=n.slice(0,e[r]||e);let i=this.cells[r].filter(d=>d!==void 0).length;for(;o.children[i];)o.removeChild(o.children[i])}}_clean_rows(e){for(;this.table.children[e];)this.table.removeChild(this.table.children[e]);this.rows=this.rows.slice(0,e),this.cells=this.cells.slice(0,e)}},Uo=class extends Ar{constructor(...e){super(...e),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(e,r,o){let n=this._get_cell("TH",r,e[r]||0);if(e[r]+=1,n.removeAttribute("colspan"),n.style.minWidth="0",n.textContent="",o instanceof HTMLElement)n.appendChild(o);else{let d=this._span_factory.get("span");d.textContent=o,n.appendChild(d)}let i=this._span_factory.get("span");return i.className="rt-column-resize",n.appendChild(i),n}_draw_group(e,r,o){let n=this._get_or_create_metadata(o);return n.column_header=e,n.value=r,n.value=r,n}_draw_th(e,r,o,n,i){let d=this._get_or_create_metadata(o);if(d.column_header=e,d.value=r,d.size_key=i.length?i[0]:i,!(i.length>1)){let h=this._column_sizes.override[d.size_key],p=this._column_sizes.auto[d.size_key];h?(o.classList.toggle("rt-cell-clip",p>h),o.style.minWidth=h+"px",o.style.maxWidth=h+"px"):p?(o.classList.remove("rt-cell-clip"),o.style.maxWidth="",o.style.minWidth=p+"px"):(o.style.maxWidth="",o.style.maxWidth="")}return d}get_column_header(e){return this._get_cell("TH",this.num_rows()-1,e)}draw(e,r,o,n,i,d,h,p,y){let k=r?.length;if(k===0)return;let m,E,T,R;p=typeof p>"u"?k-1:p;for(let S=0;S<k;S++){if(T=r[S]?r[S]:"",this._offset_cache[S]=this._offset_cache[S]||0,S<p)y&&this._group_header_cache?.[S]?.[0]?.value===T?(m=this._group_header_cache[S][1],this._group_header_cache[S][2]+=1,o===1&&(this._group_header_cache[S][0].row_header_x=i),m.setAttribute("colspan",this._group_header_cache[S][2])):(m=this._draw_group_th(this._offset_cache,S,T),E=this._draw_group(r,T,m),this._group_header_cache[S]=[E,m,1]);else{m=this._draw_group_th(this._offset_cache,S,T),E=this._draw_th(e||r,T,m,n,i),typeof R>"u"&&(R={th:m,metadata:E});for(let[D]of this._group_header_cache)D.size_key=E.size_key;m.removeAttribute("colspan")}this._get_row(S).tr.classList.toggle("rt-autosize",S===p),m.classList.toggle("rt-group-corner",n===void 0),E&&(E.x=typeof n>"u"?n:Math.floor(n),E.column_header_y=S,E.x0=Math.floor(d),E._virtual_x=h,o===1&&(E.row_header_x=i))}return this._clean_rows(this._offset_cache.length),R=R||{th:m,metadata:E},R}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},Ho=class extends Ar{_draw_td(e,r,o,n,{column_name:i},{ridx_offset:d},h){let p=this._get_cell(e,r,n),y=this._get_or_create_metadata(p);y.y=r+Math.floor(d),y.size_key=h,e==="TD"&&(y.column_header=i);let k=this._column_sizes.override[y.size_key];if(k){let m=this._column_sizes.auto[y.size_key];p.classList.toggle("rt-cell-clip",m>k),p.style.minWidth=k+"px",p.style.maxWidth=k+"px"}else p.classList.remove("rt-cell-clip"),p.style.minWidth="",p.style.maxWidth="";return y.value!==o&&(o instanceof HTMLElement?(p.textContent="",p.appendChild(o)):p.textContent=o),y.value=o,{td:p,metadata:y}}draw(e,r,o,n=!1,i,d,h,p){let{cidx:y,column_data:k,row_headers:m,column_data_listener_metadata:E}=r,{row_height:T}=o,R,S=[],D=[],I=0,K=[];for(let $=0;$<(n?o.row_headers_length:1);$++){I=0;for(let g of k){let re=m?.[I],W;if(n){let pe=g[$],U=this._fetch_cell(I-(S[$]||1),y+$),se=this._get_or_create_metadata(U),Q=this._fetch_cell(I,y+$-(K[I]||1)),ye=this._get_or_create_metadata(Q);p&&Q&&(ye.value===pe||pe===void 0)&&!Q.hasAttribute("rowspan")?(K[I]=K[I]?K[I]+1:2,Q.setAttribute("colspan",K[I]),this._replace_cell(I,y+$)):p&&U&&se.value===pe&&!U.hasAttribute("colspan")?(S[$]=S[$]?S[$]+1:2,U.setAttribute("rowspan",S[$]),this._replace_cell(I,y+$)):(W=this._draw_td("TH",I,pe,y+$,r,o,$),W.td.style.display="",W.td.removeAttribute("rowspan"),W.td.removeAttribute("colspan"),W.metadata.row_header=g,W.metadata.row_header_x=$,W.metadata.y0=Math.floor(o.ridx_offset),W.metadata.y1=Math.ceil(o.y1),W.metadata._virtual_x=$,typeof d<"u"&&(W.metadata.x0=Math.floor(d)),S[$]=1,K[I]=1,D[$]=W)}else W=this._draw_td("TD",I,g,y,r,o,h),E&&(W.metadata.user=E[I]),W.metadata.x=typeof i>"u"?i:Math.floor(i),W.metadata.x1=Math.ceil(o.x1),W.metadata.row_header=re||[],W.metadata.y0=Math.floor(o.ridx_offset),W.metadata.y1=Math.ceil(o.y1),W.metadata.dx=Math.floor(i-d),W.metadata.dy=W.metadata.y-Math.floor(W.metadata.y0),W.metadata._virtual_x=y,typeof d<"u"&&(W.metadata.x0=Math.floor(d)),D[0]=W;if(I++,R=W?W.metadata:R,T=T||W?.td.offsetHeight,I*T>e)break}}return this._clean_rows(I),{tds:D,ridx:I,metadata:R,row_height:T}}clean({ridx:e,cidx:r}){this._clean_rows(e),this._clean_columns(r)}},zr=class{constructor(e,r,o){this.clear(o);let[n]=o.children,[i,d]=n.children;this.table=n,this._column_sizes=r,this.header=new Uo(r,e,i),this.body=new Ho(r,e,d),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(e){e.innerHTML=Cr`
            <table cellspacing="0">
                <thead></thead>
                <tbody></tbody>
            </table>
        `}autosize_cells(e,r){for(;e.length>0;){let[o,n]=e.pop(),i=o.getBoundingClientRect();this._column_sizes.row_height=r||Math.max(10,Math.min(this._column_sizes.row_height||i.height,i.height)),this._column_sizes.indices[n.size_key]=i.width;let d=this._column_sizes.override[n.size_key]!==void 0;i.width&&!d&&(this._column_sizes.auto[n.size_key]=i.width),o.style.minWidth==="0px"&&(o.style.minWidth=`${i.width}px`)}}async*draw(e,r,o,n,i,d){let{width:h,height:p}=e,{view:y,config:k}=r,{data:m,row_headers:E,column_headers:T,metadata:R,column_header_merge_depth:S,merge_headers:D="both"}=await y(Math.floor(i.start_col),Math.floor(i.start_row),Math.ceil(i.end_col),Math.ceil(i.end_row)),I=D==="both"||D==="row",K=D==="both"||D==="column",{start_row:$=0,start_col:g=0,end_col:re=0,end_row:W=0}=i;E&&(this._row_headers_length=E.reduce((oe,Ne)=>Math.max(oe,Ne.length),0),E=E.map(oe=>(oe.length=this._row_headers_length,oe))),r.config.column_pivots=Array.from(Array(T?.[0]?.length||0).keys()),r.config.row_pivots=Array.from(Array(E?.[0]?.length||0).keys());let pe=this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(i.start_col)]||0,U={viewport_width:0,selected_id:o,ridx_offset:$,sub_cell_offset:pe,x0:g,x1:re,y1:W,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},se,Q=0,ye=[],ne=!0;if(E?.length>0){let oe=k.row_pivots.join(","),Ne={column_name:oe,cidx:0,column_data:E,row_headers:E,first_col:ne},Me=Q+Math.floor(g);se=this.body.draw(p,Ne,{...U,x0:0},!0,void 0,void 0,Me,I);let Ae=[];for(let ce=0;ce<r.config.row_pivots.length;ce++){let ge=this.header.draw(oe,Array(r.config.column_pivots.length).fill(""),1,void 0,ce,g,ce,S,K);ge&&Ae.push(ge)}if(ne=!1,U.viewport_width+=Ae.reduce((ce,{th:ge},Ce)=>ce+(this._column_sizes.indices[Ce]||ge.offsetWidth),0),U.row_height=U.row_height||se.row_height,Q=E[0].length,!n)for(let ce=0;ce<r.config.row_pivots.length;ce++){let{td:ge,metadata:Ce}=se.tds[ce]||{},{th:Se,metadata:Re}=Ae[ce]||{};(ge||Se)&&ye.push([Se||ge,Re||Ce])}}try{let oe=0,Ne=d-i.start_col;for(;oe<Ne;){if(!m[oe]){let ve=Math.max(i.end_col,0);i.start_col=ve;let ke=0,je=0;for(;this._column_sizes.indices.length>Q+g+ke+1&&je+U.viewport_width<h;)ke++,je+=this._column_sizes.indices[Q+g+ke];if(je+U.viewport_width<h){let ue=Math.min(d,ve+5);i.end_col=Math.max(1,Math.min(d,ue))}else i.end_col=Math.max(1,Math.min(d,ve+ke));let gt=y(Math.floor(i.start_col),Math.floor(i.start_row),Math.ceil(i.end_col),Math.ceil(i.end_row));yield void 0;let fe=await gt;if(typeof fe.column_header_merge_depth<"u"&&(S=fe.column_header_merge_depth),typeof fe.merge_headers<"u"&&(D=fe.merge_headers),fe.data.length===0){yield ye;return}i.end_col=i.start_col+fe.data.length;for(let ue=0;ue<fe.data.length;ue++)m[oe+ue]=fe.data[ue],fe.metadata&&(R[oe+ue]=fe.metadata[ue]),T&&(T[oe+ue]=fe.column_headers?.[ue])}let Me=T?.[oe]||"",Ae=m[oe],ce=R?.[oe],ge={column_name:Me,cidx:Q,column_data:Ae,column_data_listener_metadata:ce,row_headers:E,first_col:ne},Ce=oe+g,Se=Q+Math.floor(g),Re=this.header.draw(void 0,Me,void 0,Ce,Se,g,Q,S,K);if(se=this.body.draw(p,ge,U,!1,Ce,g,Se,I),ne=!1,!n)for(let{td:ve,metadata:ke}of se.tds)ye.push([Re?.th||ve,Re?.metadata||ke]);let Be=this._column_sizes.indices[Q+Math.floor(g)];if(Be?U.viewport_width+=Be:U.viewport_width+=Re?.th?.offsetWidth||se.tds.reduce((ve,ke)=>ve+ke.td?.offsetWidth,0),U.row_height=U.row_height||se.row_height,Q++,oe++,U.viewport_width-U.sub_cell_offset>h){this.body.clean({ridx:se?.ridx||0,cidx:Q}),this.header.clean(),yield ye,U.viewport_width=0;for(let[ve]of ye)U.viewport_width+=ve.offsetWidth;if(U.viewport_width-U.sub_cell_offset>h)return}}this.body.clean({ridx:se?.ridx||0,cidx:Q}),this.header.clean(),yield ye}finally{this.body.clean({ridx:se?.ridx||0,cidx:Q}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},jo=["both","horizontal","vertical","none"],$o=class extends Po{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new zr(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let e=0;e<this.table_model.header.num_columns();e++){let r=this.table_model.header.get_column_header(e);r.style.minWidth="",r.style.maxWidth=""}}clear(){this.table_model=new zr(this._table_clip,this._column_sizes,this)}addStyleListener(e){this._style_callbacks=this._style_callbacks.concat(e);let r=!0;return()=>{if(!r)return;r=!1;let o=this._style_callbacks=this._style_callbacks.slice(),n=o.indexOf(e);o.splice(n,1)}}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(e){if(!(typeof e>"u")){if(e instanceof HTMLElement)return Ue.get(e);if(e.row_header_x>=0){if(e.row_header_x<this._view_cache.config.row_pivots.length){let r=this.table_model.body._fetch_cell(e.y,e.row_header_x);return this.getMeta(r)}}else if(e.column_header_y>=0){if(e.column_header_y<this._view_cache.config.column_pivots.length){let r=this.table_model.body._fetch_cell(e.column_header_y,e.y);return this.getMeta(r)}}else return this.getMeta(this.table_model.body._fetch_cell(e.dy,e.dx+this.table_model._row_headers_length))}}getDrawFPS(){return Co()}async scrollToCell(e,r){if(!this._view_cache){console.warn("data listener not configured");return}let o=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length*o,i=(this._table_clip.offsetHeight-n)%o,d=(this._virtual_panel.offsetHeight-i)/this._nrows;this.scrollTop=Math.ceil(d*r);let h=0;for(;e>0;)e--,h+=this._column_sizes.indices[e+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(h),await new Promise(requestAnimationFrame),await this._draw_flush()}setDataListener(e,{virtual_mode:r="both"}={}){let o={},n={row_pivots:[],column_pivots:[]};console.assert(jo.indexOf(r)>-1,`Unknown virtual_mode ${r};  valid options are "both" (default), "horizontal", "vertical" or "none"`),this._virtual_mode=r,this._invalid_schema=!0,this._view_cache={view:e,config:n,schema:o},this._setup_virtual_scroll()}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",$o);var St='regular-table{padding:0;margin:12px 0 0 12px;font-family:inherit;--rt-hover--border-color:var(--inactive--color,#c5c9d080);}regular-table div[tabindex]{outline:none;}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;}regular-table th{text-align:center;}regular-table thead tr:not(.rt-autosize) th{overflow:hidden;max-width:0px;}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right;}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right;}regular-table tbody th{text-align:left;}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%;}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left;}regular-table thead tr:last-child th{border-bottom:1px solid#8b868045;}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important;}regular-table th{position:relative;}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid#eee;height:100%;}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding-right:5px;padding-left:5px;padding-top:0px;padding-bottom:0px;height:19px;}regular-table table *{box-sizing:border-box;}regular-table table{position:absolute;color:#666;outline:none;}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family);}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family);}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px#1a7da1;}regular-table .rt-selected td{background-color:#eee;}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis;}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%;}regular-table th span.rt-group-name{text-align:left;}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%;}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize;}regular-table a{color:var(--rt-pos-cell--color);}regular-table a:visited{color:var(--active--color);}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-group{box-shadow:0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-is-top{box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045);}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}perspective-viewer[settings] tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer[settings]) tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0px -4px var(--inactive--border-color,#8b868045);}tr:only-child th{box-shadow:none!important;}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover:after{border-color:var(--rt-hover--border-color,#c5c9d080)!important;background-color:transparent;box-shadow:0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:hover th.psp-tree-leaf.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr.psp-menu-open:hover:after{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:last-child:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080),0px 3px 0px rgba(0,0,0,0.05),0px 5px 0px rgba(0,0,0,0.01);}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent;}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent;}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:0px;border-right-color:transparent;}regular-table tbody tr:hover{color:inherit;}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color,#c5c9d080)!important;}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color,#c5c9d080)!important;}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody td,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody{transform:translate(0,var(--regular-table--transform-y,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child th,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)var(--regular-table--clip-y,0),var(--regular-table--clip-x,0)200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr:last-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr:last-child:after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:not(:first-child):after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:not(:first-child):after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:hover:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:hover:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner){clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}regular-table{outline:none;}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px;}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background:var(--icon--color);border:5.5px solid var(--plugin--background);max-height:50%;max-width:50%;min-width:10%;min-height:10%;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th{height:0px;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th span{display:none;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th{height:0px;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th span{display:none;}perspective-viewer[settings] .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}perspective-viewer[settings] .psp-menu-enabled:hover,perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}perspective-viewer[settings] td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}perspective-viewer[settings] tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}perspective-viewer[settings] tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}:host-context(perspective-viewer[settings]) .psp-menu-enabled:hover,:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}:host-context(perspective-viewer[settings]) tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}perspective-viewer regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer) regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}.psp-sort-enabled:hover{cursor:pointer;}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:white!important;background-color:#ea7319!important;border-color:#ea7319!important;}.psp-row-selected.psp-tree-label:not(:hover):before{color:white;}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,0.2)!important;}.psp-error{color:red;}td:focus{outline:#666;outline-style:dotted;outline-width:1px;}perspective-viewer.dragging regular-table{pointer-events:none;}:host-context(perspective-viewer.dragging) regular-table{pointer-events:none;}.psp-header-border:last-child{border-right-width:0px;}.psp-header-sort-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}.psp-header-sort-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}.psp-header-sort-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-desc-icon--mask-image);mask-image:var(--sort-col-desc-icon--mask-image);}.psp-header-sort-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-asc-icon--mask-image);mask-image:var(--sort-col-asc-icon--mask-image);}tbody th:last-of-type{border-right:1px solid var(--inactive--border-color,#8b868045);overflow:hidden;text-overflow:ellipsis;}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,var(--inactive--border-color,#eee)10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none;}.psp-tree-label{max-width:0px;min-width:0px;}.psp-tree-label:before{color:var(--icon--color);font-family:var(--button--font-family,inherit);padding-right:11px;}.psp-tree-label-expand:before{content:var(--tree-label-expand--content,"+");}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content,"-");}.psp-tree-label-expand,.psp-tree-label-collapse{cursor:pointer;}.psp-tree-label:hover:before{color:var(--active--color);text-shadow:0px 0px 5px var(--active--color);}.psp-tree-leaf{padding-left:24px;}.psp-align-right{text-align:right;}.psp-align-left{text-align:left;}.psp-positive:not(:focus){color:var(--rt-pos-cell--color);}.psp-negative:not(:focus){color:var(--rt-neg-cell--color);}regular-table table tbody td{min-width:52px!important;}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed#999;border-bottom-width:0px;border-left-width:0px;}.boolean-editable{cursor:pointer;}regular-table table{user-select:none;color:inherit;border-collapse:separate;}regular-table table th{font-weight:400;}regular-table table td,regular-table table th{border-color:var(--inactive--border-color,#8b868045);height:23px;}regular-table table .psp-header-group{text-overflow:ellipsis;}regular-table table th.psp-header-leaf{border-bottom-width:0px;}regular-table table th.psp-header-leaf span{height:23px;min-height:23px;}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px;}regular-table table tbody th:empty{background-position:0px -10px;}regular-table table td.psp-select-region,regular-table table th.psp-select-region{background-color:var(--icon--color)!important;color:var(--plugin--background)!important;border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-select-region.psp-menu-open{box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}regular-table #psp-column-edit-buttons th:not(.rt-group-corner) span:not(.rt-column-resize):before{content:var(--datagrid-column-edit-button--content,"Edit");}perspective-viewer:not([settings]) regular-table #psp-column-edit-buttons:after{content:none;}:host-context(perspective-viewer:not([settings])) regular-table #psp-column-edit-buttons:after{content:none;}regular-table table thead tr:last-child:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-bottom:1px solid var(--inactive--border-color);}regular-table table tbody tr:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-top:1px solid transparent;}regular-table table tbody tr:not(:first-child):after{border-top:1px solid var(--inactive--border-color);}regular-table table tbody tr:hover:not(:first-child):after{border-top:1px solid var(--rt-hover--border-color);}regular-table table tbody tr:hover+tr:after{border-top:1px solid var(--rt-hover--border-color);}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}';function qo(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function Bt(e,r,o){let n=Array.from(e.children[0].children[0].children),i=n.length,d=r.hasAttribute("settings");if(i<=1?n[0]?.removeAttribute("id"):n.forEach((h,p)=>{let y=d?1:0,k=p===i-(y+1)?"psp-column-titles":p===i-y?"psp-column-edit-buttons":null;k?h.setAttribute("id",k):h.removeAttribute("id")}),r.classList.toggle("psp-menu-open",!!o),d&&i>=2){let h=Array.from(n[i-2].children),p=Array.from(n[i-1].children);if(h&&p){n.slice(0,i-2).forEach(y=>{Array.from(y.children).forEach(k=>{k.classList.toggle("psp-menu-open",!1)})});for(let y=0;y<h.length;y++){let k=h[y],m=p[y],E=k.textContent===o;if(k.classList.toggle("psp-menu-open",E),m.classList.toggle("psp-menu-open",E),this._config.columns.length>1)for(let T of e.querySelectorAll("td")){let R=e.getMeta(T),S=R.column_header[R.column_header.length-2]===o;T.classList.toggle("psp-menu-open",S)}}}}}function Tr(e,r){let o=Array.from(e.children[0].children[0].children);if(o.length>0){Bt.call(this,e,r,this._column_settings_selected_column);let[n]=o.splice(this._config.split_by.length,1);Rr.call(this,e,n,!1);let[i]=o.splice(this._config.split_by.length,1);i&&Rr.call(this,e,i,!0)}}function Rr(e,r,o){let n=e._view_cache.config.row_pivots.length-1;for(let i of r?.children){let d=e.getMeta(i),h=d.column_header?.[this._config.split_by.length],p=this._config.sort.find(D=>D[0]===h),y=d.row_header_x===n,k=typeof d.x>"u";y=y||(d.x+1)%this._config.columns.length===0,i.classList.toggle("psp-header-border",y),i.classList.toggle("psp-header-group",!1),i.classList.toggle("psp-header-leaf",!0),i.classList.toggle("psp-is-top",!1),i.classList.toggle("psp-header-corner",k),i.classList.toggle("psp-header-sort-asc",!o&&!!p&&p[1]==="asc"),i.classList.toggle("psp-header-sort-desc",!o&&!!p&&p[1]==="desc"),i.classList.toggle("psp-header-sort-col-asc",!o&&!!p&&p[1]==="col asc"),i.classList.toggle("psp-header-sort-col-desc",!o&&!!p&&p[1]==="col desc");let m=qo.call(this,d),E=m==="integer"||m==="float",T=m==="string",R=m==="date",S=m==="datetime";i.classList.toggle("psp-align-right",E),i.classList.toggle("psp-align-left",!E),i.classList.toggle("psp-menu-enabled",(T||E||R||S)&&!k&&d.column_header_y==this._config.split_by.length+1),i.classList.toggle("psp-sort-enabled",(T||E||R||S)&&!k&&d.column_header_y===this._config.split_by.length),i.classList.toggle("psp-is-width-override",e._column_sizes?.override[d.size_key]!==void 0)}}function Dr(e){let r=e._view_cache.config.row_pivots.length-1,o=Array.from(e.children[0].children[0].children),n=[],i=new Set,d=e.children[0];for(let h=0;h<o.length;h++){let p=d.rows[h],y=new Set;for(let k=0;k<p.cells.length;k++){let m=p.cells[k];m.style.backgroundColor="";let E=e.getMeta(m),T=E.row_header_x===r||E.x>=0;m.classList.toggle("psp-align-right",!1),m.classList.toggle("psp-align-left",!1),m.classList.toggle("psp-header-group",!0),m.classList.toggle("psp-header-leaf",!1),m.classList.toggle("psp-header-border",T),m.classList.toggle("psp-header-group-corner",typeof E.x>"u"),m.classList.toggle("psp-color-mode-bar",!1),m.classList.toggle("psp-header-sort-asc",!1),m.classList.toggle("psp-header-sort-desc",!1),m.classList.toggle("psp-header-sort-col-asc",!1),m.classList.toggle("psp-header-sort-col-desc",!1),m.classList.toggle("psp-sort-enabled",!1);let R=p.cells[k],S=k,D,I;for(;n[h]&&n[h][S];++S);for(y.add(S),D=S;D<S+R.colSpan;++D)for(I=h;I<h+R.rowSpan;++I)n[I]||(n[I]=[]),n[I][D]=!0;R.classList.toggle("psp-is-top",h===0||!i.has(D))}i=y}}var ze=Symbol("Plugin Symbol");function Ir(e,r,[,,,,,o,n],[,,,,,i,d],h){let p=this._ids?.[e.dy]?.join("|"),y=(h?e.column_header.slice(0,-1):e.column_header).join("|");if(this.last_reverse_columns?.has(y)&&this.last_reverse_ids?.has(p)){let k=this.last_reverse_ids?.get(p),m=this.last_reverse_columns.get(y);this._is_old_viewport?this.last_meta?.[m]?.[k]>e.user?(r.style.setProperty("--pulse--background-color-start",i),r.style.setProperty("--pulse--background-color-end",d),r.style.animationName==="pulse_neg"?r.style.animation="pulse_neg2 0.5s linear":r.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[m]?.[k]<e.user?(r.style.setProperty("--pulse--background-color-start",o),r.style.setProperty("--pulse--background-color-end",n),r.style.animationName==="pulse_pos"?r.style.animation="pulse_pos2 0.5s linear":r.style.animation="pulse_pos 0.5s linear"):k!==e.dy&&(r.style.animation=""):r.style.animation=""}else r.style.animation=""}var Yt=Et(ut(),1);function Xt(e,r){return Yt.default.mix(e,`rgb(${r[0]},${r[1]},${r[2]})`,.5).hex()}function We([e,r,o,n],i=[255,255,255]){function d(h,p){return((1-n)*(i[h]/255)+n*(p/255))*255}return[d(0,e),d(1,r),d(2,o)]}function Pe([e,r,o]){return Math.sqrt(e*e*.299+r*r*.587+o*o*.114)>130?"#161616":"#ffffff"}function Bo(e){let[r,o,n]=e.rgb(),[i,d,h]=e.set("hsl.h",(e.get("hsl.h")-15)%360).rgb(),[p,y,k]=e.set("hsl.h",(e.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${i},${d},${h}),rgb(${r},${o},${n}) 50%,rgb(${p},${y},${k}))`}function xe(e){let r=(0,Yt.default)(e),o=Bo(r),n=r.rgb();return[e,...n,o,`rgba(${n[0]},${n[1]},${n[2]},1)`,`rgba(${n[0]},${n[1]},${n[2]},0)`]}function Wr(e,r,o,n){let i=o.user>0,d=o.user<0,h;e?.pos_bg_color!==void 0?h=e.pos_bg_color:h=this._pos_bg_color;let p;e?.neg_bg_color!==void 0?p=e.neg_bg_color:p=this._neg_bg_color;let y=i?h:d?p:["",...this._plugin_background,""];{let[S,D,I,K,$]=y;if(r.style.position="",e?.number_bg_mode==="color")r.style.animation="",r.style.backgroundColor=S;else if(e?.number_bg_mode==="gradient"){let g=Math.max(0,Math.min(1,Math.abs(o.user/e.bg_gradient))),re=this._plugin_background,W=Pe(We([D,I,K,g],re));r.style.animation="",r.style.color=W,r.style.backgroundColor=`rgba(${D},${I},${K},${g})`}else e?.number_bg_mode==="pulse"?(Ir.call(this,o,r,h,p,n),r.style.backgroundColor=""):(e?.number_bg_mode==="disabled"||e?.number_bg_mode,r.style.animation="",r.style.backgroundColor="")}let[k,m,E,T,R]=(()=>e?.pos_fg_color!==void 0?i?e.pos_fg_color:d?e.neg_fg_color:["",...this._plugin_background,""]:i?this._pos_fg_color:d?this._neg_fg_color:["",...this._plugin_background,""])();if(e?.number_fg_mode==="disabled")if(e?.number_bg_mode==="color"){let S=this._plugin_background,D=Pe(We([y[1],y[2],y[3],1],S));r.style.color=D}else e?.number_bg_mode==="gradient"||(r.style.color="");else e?.number_fg_mode==="bar"?(r.style.color="",r.style.position="relative",R!==""&&r.children.length>0&&r.children[0].nodeType===Node.ELEMENT_NODE&&(r.children[0].style.background=R)):(e?.number_fg_mode==="color"||!e?.number_fg_mode)&&(r.style.color=k)}var Vt=Et(ut(),1);function Pr(e,r,o){let n=o.column_header?.[this._config.split_by.length],[i,d,h,p,y]=(()=>e?.color!==void 0?e.color:this._color)();if(e?.string_color_mode==="foreground"&&o.user!==null)r.style.color=i,r.style.backgroundColor="",e?.format==="link"&&(r.children[0].style.color=i);else if(e?.string_color_mode==="background"&&o.user!==null){let k=this._plugin_background,m=Pe(We([d,h,p,1],k));r.style.color=m,r.style.backgroundColor=i}else if(e?.string_color_mode==="series"&&o.user!==null){this._series_color_map.has(n)||(this._series_color_map.set(n,new Map),this._series_color_seed.set(n,0));let k=this._series_color_map.get(n);if(!k.has(o.user)){let W=this._series_color_seed.get(n);k.set(o.user,W),this._series_color_seed.set(n,W+1)}let m=k.get(o.user),[E,T,R]=(0,Vt.default)(i).hsl();E=E+m*150%360;let S=(0,Vt.default)(E,T,R,"hsl"),[D,I,K]=S.rgb(),$=S.hex(),g=this._plugin_background,re=Pe(We([D,I,K,1],g));r.style.color=re,r.style.backgroundColor=$}else r.style.backgroundColor="",r.style.color=""}var Ts=Et(ut(),1);function Fr(e,r,o){let n=o.column_header?.[this._config.split_by.length],[i,d,h,p,y]=(()=>e?.color!==void 0?e.color:this._color)();if(e?.datetime_color_mode==="foreground"&&o.user!==null)r.style.color=i,r.style.backgroundColor="";else if(e?.datetime_color_mode==="background"&&o.user!==null){let k=this._plugin_background,m=Pe(We([d,h,p,1],k));r.style.color=m,r.style.backgroundColor=i}else r.style.backgroundColor="",r.style.color=""}function Ur(e,r,o){let[n]=o.user===!0?this._pos_fg_color:o.user===!1?this._neg_fg_color:["",0,0,0,""];r.style.backgroundColor="",r.style.color=n}function Hr(e,r,o){let n=typeof o.value!=null&&typeof o.value!=null&&o.value?.toString()?.trim().length>0,i=o.row_header_x>=this._config.group_by.length,d=e.getMeta({dx:0,dy:o.y-o.y0+1}),h=d&&d.row_header&&typeof d.row_header[o.row_header_x+1]<"u";r.classList.toggle("psp-tree-label",n&&!i),r.classList.toggle("psp-tree-label-expand",n&&!i&&!h),r.classList.toggle("psp-tree-label-collapse",n&&!i&&h),r.classList.toggle("psp-tree-leaf",n&&i)}function Yo(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function jr(e,r){let o=e[ze]||{},n=r.hasAttribute("settings");for(let i of e.children[0].children[1].children)for(let d of i.children){let h=e.getMeta(d),p=h.column_header?.[this._config.split_by.length],y=Yo.call(this,h),k=o[p],m=y==="integer"||y==="float";m?Wr.call(this,k,d,h,n):y==="boolean"?Ur.call(this,k,d,h):y==="string"?Pr.call(this,k,d,h):y==="date"||y==="datetime"?Fr.call(this,k,d,h):(d.style.backgroundColor="",d.style.color=""),d.classList.toggle("psp-bool-type",y==="boolean"&&h.user!==null);let E=d.tagName==="TH";E&&Hr.call(this,e,d,h),d.classList.toggle("psp-align-right",!E&&m),d.classList.toggle("psp-align-left",E||!m),d.classList.toggle("psp-color-mode-bar",k?.number_fg_mode==="bar"&&m)}}async function $r(e,r,o,n){let d=e.getMeta(n).column_header[this._config.split_by.length],p=(o.shiftKey?Xo:Vo).call(this,d);this._preserve_focus_state=!0,await r.restore({sort:p})}function Xo(e){let r=[],o=!1;for(let n of this._config.sort){let[i,d]=n;if(i===e){o=!0;let h=Gr.call(this,e,d);h&&r.push(h)}else r.push(n)}return o||r.push([e,"desc"]),r}function Vo(e){for(let[r,o]of this._config.sort)if(r===e){let n=Gr.call(this,e,o);return n?[n]:[]}return[[e,"desc"]]}function Gr(e,r){let n=this._config.split_by.length>0?Zo:Ko,i=r?n[r]:"desc";if(i)return[e,i]}var Ko={desc:"asc",asc:void 0},Zo={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};async function qr(e,r){let o=e.getMeta(r.target),n=r.target.classList.contains("psp-tree-label-collapse");r.shiftKey&&n?this._view.set_depth(o.row_header.filter(i=>i!==void 0).length-2):r.shiftKey?this._view.set_depth(o.row_header.filter(i=>i!==void 0).length-1):n?this._view.collapse(o.y):this._view.expand(o.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),e.draw()}async function Br(e,r,o){if(o.which!==1)return;let n=o.target;if(n.tagName!=="A"){for(;n.tagName!=="TD"&&n.tagName!=="TH";)if(n=n.parentElement,!e.contains(n))return;if(n.classList.contains("psp-tree-label")){qr.call(this,e,o),o.stopImmediatePropagation();return}if(n.classList.contains("psp-menu-enabled")){let d=e.getMeta(n).column_header?.[this._config.split_by.length];await r.toggleColumnSettings(d),o.preventDefault(),o.stopImmediatePropagation()}else n.classList.contains("psp-sort-enabled")&&($r.call(this,e,r,o,n),o.stopImmediatePropagation())}}function Yr(e,r){if(r.which!==1)return;let o=r.target;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!e.contains(o))return;(o.classList.contains("psp-tree-label")&&r.offsetX<26||o.classList.contains("psp-header-leaf")&&!o.classList.contains("psp-header-corner"))&&r.stopImmediatePropagation()}function Xr(e,r=!1){let o=this._config.group_by.length===0&&this._config.split_by.length===0,n=e.hasAttribute("selectable"),i=r||e.children[0].dataset.editMode==="EDIT";return o&&!n&&i}function Vr(e,r,o){let n=e[ze]||{},i=Xr.call(this,r);o.classList.toggle("edit-mode-allowed",Xr.call(this,r,!0));for(let d of e.querySelectorAll("td")){let h=e.getMeta(d),p=this.get_psp_type(h);if(i&&this._is_editable[h.x]){let y=h.column_header[this._config.split_by.length];p==="string"&&n[y]?.format==="link"?(d.toggleAttribute("contenteditable",!1),d.classList.toggle("boolean-editable",!1)):p==="boolean"?(d.toggleAttribute("contenteditable",!1),d.classList.toggle("boolean-editable",h.user!==null)):(i!==d.hasAttribute("contenteditable")&&d.toggleAttribute("contenteditable",i),d.classList.toggle("boolean-editable",!1))}else d.toggleAttribute("contenteditable",!1),d.classList.toggle("boolean-editable",!1)}}var Ot=(e,r,o)=>{let n=e.querySelectorAll("td"),i=o.get(e),d=e.getRootNode();if(i){for(let h of n){let p=e.getMeta(h);if(p.x===i.x&&p.y===i.y)return d.activeElement!==h&&h.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&e.contains(d.activeElement)&&d.activeElement.blur()}};function Kt(e,r,o){let n=e.getMeta(o),i=r._schema[r._column_paths[n.x]];if(n){let d=o.textContent,h=r._ids[n.y-n.y0][0];if(i==="float"||i==="integer"){if(d=parseFloat(d.replace(/,/g,"")),isNaN(d))return!1}else if(i==="date"||i==="datetime"){if(d=Date.parse(d),isNaN(d))return!1}else i==="boolean"&&(d=d==="true"?!1:d==="false"?!0:null);let p={__INDEX__:h,[r._column_paths[n.x]]:d};return r._table.update([p],{port_id:r._edit_port}),!0}}function Kr(e,r,o){let n=e.getMeta(o.target);if(typeof n?.x<"u"){let i=this._is_editable[n.x],d=this.get_psp_type(n)==="boolean",h=o.target.textContent==="-";i&&d&&!h&&Kt(e,this,o.target)}}function Qo(e){let r;return async function(...o){if(!!r&&await r&&!!r)return;let n;r=new Promise(i=>n=i),await e.apply(this,o),r=void 0,n()}}function Zr(){if(this.isContentEditable){let e=this.getRootNode().getSelection().getRangeAt(0),r=e.cloneRange();return r.selectNodeContents(this),r.setEnd(e.endContainer,e.endOffset),r.toString().length}else return this.target.selectionStart}var Ge=Qo(async function(e,r,o,n,i){let d=e.getMeta(o),h=this._column_paths.length,p=this._num_rows,y=r.get(e);if(!y)return;d.x+n<h&&0<=d.x+n&&(y.x=d.x+n),d.y+i<p&&0<=d.y+i&&(y.y=d.y+i);let k=Math.max(d.x0-10,0),m=Math.min(d.x0+10,h),E=Math.max(d.y0-5,0),T=Math.min(d.y0+10,p),R=d.x0+n,S=d.y0+i;for(;!Ot(e,void 0,r)&&R>=k&&R<m&&S>=E&&S<T;)await e.scrollToCell(R,S,h,p),r.set(e,y),R+=n,S+=i});function es(e,r,o){return r.getMeta(o).y===e._num_rows-1}function Jr(e,r,o,n){let i=e.getRootNode().activeElement;switch(n.target.classList.remove("psp-error"),n.key){case"Enter":n.preventDefault(),es(this,e,i)?(i.blur(),o.delete(e)):n.shiftKey?Ge.call(this,e,o,i,0,-1):Ge.call(this,e,o,i,0,1);break;case"ArrowLeft":Zr.call(i)==0&&(n.preventDefault(),Ge.call(this,e,o,i,-1,0));break;case"ArrowUp":n.preventDefault(),Ge.call(this,e,o,i,0,-1);break;case"ArrowRight":Zr.call(i)==i.textContent.length&&(n.preventDefault(),Ge.call(this,e,o,i,1,0));break;case"ArrowDown":n.preventDefault(),Ge.call(this,e,o,i,0,1);break;default:}}function zt(e,r=!1){let o=this._config.group_by.length===0&&this._config.split_by.length===0,n=e.hasAttribute("selectable"),i=r||e.children[0]._edit_mode==="EDIT";return o&&!n&&i}function Qr(e,r,o,n){if(this._edit_mode==="EDIT"){if(!zt.call(this,r))return;Jr.call(this,e,r,o,n)}else console.log(`Mode ${this._edit_mode} for "keydown" event not yet implemented`)}function eo(e,r,o){if(this._edit_mode==="EDIT"){if(!zt.call(this,r))return;Kr.call(this,e,r,o)}else this._edit_mode==="READ_ONLY"||this._edit_mode==="SELECT_COLUMN"||this._edit_mode==="SELECT_ROW"||this._edit_mode==="SELECT_REGION"||console.log(`Mode ${this._edit_mode} for "click" event not yet implemented`)}function to(e,r,o,n){if(zt.call(this,r)&&o.has(e)){n.target.classList.remove("psp-error");let i=o.get(e);o.delete(e),i.content!==n.target.textContent&&(Kt(e,this,n.target)||(n.target.textContent=i.content,n.target.classList.add("psp-error"),n.target.focus()))}}function ro(e,r,o,n){let i=e.getMeta(n.target);if(i){let d={x:i.x,y:i.y,content:n.target.textContent};o.set(e,d)}}async function _t({_view:e,_config:r},o,n){let i=r.group_by,d=r.split_by,h=o>=0?o:0,p=h+1,y=await e.to_json({start_row:h,end_row:p}),m=y.map(K=>K.__ROW_PATH__)[0]||[],E=i.map((K,$)=>{let g=m[$];return g?[K,"==",g]:void 0}).filter(K=>K),T=i.length>0?n+1:n,R=Object.keys(y[0])[T],S={row:y[0]},D=[];if(R){let K=R.split("|");S.column_names=[K[d.length]],D=d.map(($,g)=>{let re=K[g];return re?[$,"==",re]:void 0}).filter($=>$).filter(([,,$])=>$!=="__ROW_PATH__")}let I=r.filter.concat(E).concat(D);return S.config={filter:I},S}async function oo(e,r,o,n){let i=e.getMeta(n.target);if(!r.hasAttribute("selectable")||n.handled||n.which!==1||!i)return;let d=this._ids[i.y-i.y0];if(i&&i.y>=0){let h=o.get(e),p=!!h&&h.reduce((R,S,D)=>R&&S===d[D],!0),y=!!h&&d.length===h.length&&p,k={selected:!y},{row:m,column_names:E,config:T}=await _t(this,i.y,i.x);y?(o.delete(e),k={...k,row:m,config:{filter:structuredClone(this._config.filter)}}):(o.set(e,d),k={...k,row:m,column_names:E,config:T}),await e.draw({preserve_width:!0}),n.handled=!0,r.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:k}))}}function so(e,r,o){if(!r.hasAttribute("selectable"))return;let n=o.has(e),i=o.get(e);for(let d of e.querySelectorAll("td"))if(!n)d.classList.toggle("psp-row-selected",!1),d.classList.toggle("psp-row-subselected",!1);else{let h=e.getMeta(d),p=this._ids[h.y-h.y0],y=i.reduce((k,m,E)=>k&&m===p[E],!0);d.classList.toggle("psp-row-selected",p.length===i.length&&y),d.classList.toggle("psp-row-subselected",p.length!==i.length&&y)}for(let d of e.querySelectorAll("tbody th")){let h=e.getMeta(d),p=this._ids[h.y-h.y0];if(!n||!!p[h.row_header_x])d.classList.toggle("psp-row-selected",!1),d.classList.toggle("psp-row-subselected",!1);else{let y=i.reduce((k,m,E)=>k&&m===p[E],!0);d.classList.toggle("psp-row-selected",p.length===i.length&&y),d.classList.toggle("psp-row-subselected",p.length!==i.length&&y)}}}async function io(e,r,o){o.delete(e);for(let n of e.querySelectorAll("td,th"))n.classList.toggle("psp-row-selected",!1),n.classList.toggle("psp-row-subselected",!1)}var fo=Et(ut(),1);var lo={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(e){return e?"true":"false"}}},rs={types:{float:{format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},datetime:{format:{dateStyle:"short",timeStyle:"medium"}},date:{format:{dateStyle:"short"}}}},Ct=class{constructor(){this._formatters=new Map}create_datetime_formatter(r,o){let n={dateStyle:"short",timeStyle:"medium"};if(r==="datetime")if(o.date_format?.format!=="custom"){let i={...n,timeZone:o.date_format?.timeZone,dateStyle:o.date_format?.dateStyle,timeStyle:o.date_format?.timeStyle};return i.dateStyle==="disabled"?i.dateStyle=void 0:i.dateStyle===void 0&&(i.dateStyle="short"),i.timeStyle==="disabled"?i.timeStyle=void 0:i.timeStyle===void 0&&(i.timeStyle="medium"),new Intl.DateTimeFormat(navigator.languages,i)}else{let i={timeZone:o.date_format?.timeZone,second:o.date_format?.second,minute:o.date_format?.minute,hour:o.date_format?.hour,day:o.date_format?.day,weekday:o.date_format?.weekday,month:o.date_format?.month,year:o.date_format?.year,hour12:o.date_format?.hour12,fractionalSecondDigits:o.date_format?.fractionalSecondDigits};return i.year==="disabled"?i.year=void 0:i.year===void 0&&(i.year="2-digit"),i.month==="disabled"?i.month=void 0:i.month===void 0&&(i.month="numeric"),i.day==="disabled"?i.day=void 0:i.day===void 0&&(i.day="numeric"),i.weekday==="disabled"&&(i.weekday=void 0),i.hour==="disabled"?i.hour=void 0:i.hour===void 0&&(i.hour="numeric"),i.minute==="disabled"?i.minute=void 0:i.minute===void 0&&(i.minute="numeric"),i.second==="disabled"?i.second=void 0:i.second===void 0&&(i.second="numeric"),i.hour12===void 0&&(i.hour12=!0),new Intl.DateTimeFormat(navigator.languages,i)}else{let i={...n.format,dateStyle:o.date_format?.dateStyle};return i.dateStyle==="disabled"?i.dateStyle=void 0:i.dateStyle===void 0&&(i.dateStyle="short"),new Intl.DateTimeFormat(navigator.languages,i)}}create_number_formatter(r,o){let n=rs.types[r]?.format;return o.number_format!==void 0&&(n=o.number_format),new lo[r](navigator.languages,n)}create_boolean_formatter(r,o){return new lo[r](navigator.languages,{})}get(r,o){let n=[r,...Object.values(o.date_format??{}),...Object.values(o.number_format??{})].join("-");return this._formatters.has(n)||(r==="date"||r==="datetime"?this._formatters.set(n,this.create_datetime_formatter(r,o)):r==="integer"||r==="float"?this._formatters.set(n,this.create_number_formatter(r,o)):r==="boolean"?this._formatters.set(n,this.create_boolean_formatter(r,o)):this._formatters.set(n,!1)),this._formatters.get(n)}};var os=new Ct,no=1;function Nt(e,r,o={},n=!1){if(r===null)return"-";let i=n&&this._table_schema[e]||this._schema[e]||"string",d=o[e]||{};if((i==="integer"||i==="float")&&d?.number_fg_mode==="bar"){let p=Math.max(0,Math.min(no,Math.abs(r/d.fg_gradient)*no)),y=this._div_factory.get(),k=r>=0?"left":"right",m=(p*100).toFixed(2);return y.setAttribute("style",`width:calc(${m}% - 4px);position:absolute;${k}:2px;height:80%;top:10%;pointer-events:none;`),y}else if(d?.format==="link"&&i==="string"){let p=document.createElement("a");return p.setAttribute("href",r),p.setAttribute("target","_blank"),p.textContent=r,p}else if(d?.format==="bold"&&i==="string"){let p=document.createElement("b");return p.textContent=r,p}else if(d?.format==="italics"&&i==="string"){let p=document.createElement("i");return p.textContent=r,p}else{let p=os.get(i,d);return p?p.format(r):r}}function*ao(e=[],r,o){let n=o[ze];for(let i of e){i=["TOTAL",...i];let d=i[i.length-1];i=i.slice(0,i.length-1).fill("");let h=Nt.call(this,r[i.length-1],d,n,!0);h instanceof HTMLElement?i=i.concat(h):i=i.concat({toString:()=>h}),i.length=r.length+1,yield i}}function co(e){let r,o,n,i,d;return async function(p,y,k,m,E){let T={},R;m-y>0&&E-k>0?(this._is_old_viewport=this._last_window?.start_row===k&&this._last_window?.end_row===E&&this._last_window?.start_col===y&&this._last_window?.end_col===m,R={start_row:k,start_col:y,end_row:E,end_col:m,id:!0},T=JSON.parse(await this._view.to_columns_string(R)),this._last_window=R,this._ids=T.__ID__,this._reverse_columns=this._column_paths.slice(y,m).reduce((g,re,W)=>(g.set(re,W),g),new Map),this._reverse_ids=this._ids.reduce((g,re,W)=>(g.set(re?.join("|"),W),g),new Map)):this._div_factory.clear();let S=[],D=[],I=[],K=[],$=e.hasAttribute("settings");for(let g=y;g<Math.min(m,this._column_paths.length);++g){let re=this._column_paths[g],W=re.split("|"),pe=T[re]||new Array(E-k).fill(null);S.push(pe.map(U=>Nt.call(this,W[this._config.split_by.length],U,p[ze]))),D.push(pe),$&&W.push(""),I.push(W),K.push(re)}return m-y>0&&E-k>0&&(this.last_column_paths=o,this.last_meta=r,this.last_ids=n,this.last_reverse_ids=i,this.last_reverse_columns=d,o=K,r=D,n=this._ids,i=this._reverse_ids,d=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(ao.call(this,T.__ROW_PATH__,this._config.group_by,p)),column_headers:I,data:S,metadata:D,column_header_merge_depth:Math.max(0,this._config.split_by.length)}}}function At(e,r,o){let n=window.getComputedStyle(e).getPropertyValue(r).trim();return n.length>0?n:o}var Zt=class{constructor(r){this._name=r,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let r=this._elements[this._index];return this._index+=1,r}};function ss(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}async function Jt(e,r,o,n={}){let i=await o.get_config(),d=Array.isArray(i.expressions)?Object.fromEntries(i.expressions.map(Q=>[Q[0],Q[1]])):i.expressions,[h,p,y,k,m,E,T]=await Promise.all([r.schema(),r.validate_expressions(d),o.num_rows(),o.schema(),o.expression_schema(),o.column_paths(),this.parentElement.getEditPort()]),R=(0,fo.default)(At(e,"--plugin--background","#FFFFFF")).rgb(),S=xe(At(e,"--rt-pos-cell--color","#338DCD")),D=xe(At(e,"--rt-neg-cell--color","#FF5942")),I=xe(Xt(S[0],R)),K=xe(Xt(D[0],R)),$=xe(At(e,"--active--color","#ff0000")),g={...k,...m},re={...h,...p.expression_schema},W=E.filter(Q=>Q!=="__ROW_PATH__"&&Q!=="__ID__"),pe=[],U=[];for(let Q of W){let ne=Q.split("|")[i.split_by.length];U.push(g[ne]),pe.push(!!h[ne])}let se=Object.assign(n,{_edit_port:T,_view:o,_table:r,_table_schema:re,_config:i,_num_rows:y,_schema:g,_ids:[],_plugin_background:R,_color:$,_pos_fg_color:S,_neg_fg_color:D,_pos_bg_color:I,_neg_bg_color:K,_column_paths:W,_column_types:U,_is_editable:pe,_selection_state:{selected_areas:[],dirty:!1},_row_header_types:i.group_by.map(Q=>re[Q]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:ss});return se._div_factory=se._div_factory||new Zt("div"),e.setDataListener(co(this.parentElement).bind(se,e),{virtual_mode:window.getComputedStyle(e).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),se}async function uo(e,r,o){let n=e.getMeta(o.target);if(!n)return;let{x:i,y:d}=n,{row:h,column_names:p,config:y}=await _t(this,d,i);r.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:h,column_names:p,config:y}}))}var is="mouse-selected-area",_o=(e,r,{className:o=is,selected:n=[]}={})=>(e.model._selection_state={selected_areas:n,dirty:!0},r.addEventListener("mousedown",ls(e,r,o)),r.addEventListener("mouseover",ns(e,r,o)),r.addEventListener("mouseup",as(e,r,o)),r.addStyleListener(()=>ht(e,r,o)),r),ls=(e,r,o)=>n=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={};let i=r.getMeta(n.target);if(i&&i.x!==void 0&&i.y!==void 0){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={x:i.x,y:i.y},e.model._selection_state.old_selected_areas=e.model._selection_state.selected_areas,e.model._selection_state.selected_areas=[];let d={x0:i.x,x1:i.x,y0:i.y,y1:i.y};e.model._selection_state.potential_selection=d,ht(e,r,o,e.model._selection_state.selected_areas.concat([d]));return}}e.model._selection_state.selected_areas=[]},ns=(e,r,o)=>n=>{if((e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN")&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0){let i=r.getMeta(n.target);if(i&&i.x!==void 0&&i.y!==void 0){let d={x0:Math.min(i.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(i.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(i.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(i.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.potential_selection=d,ht(e,r,o,e.model._selection_state.selected_areas.concat([d]))}}},as=(e,r,o)=>n=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){let i=r.getMeta(n.target);if(e.model._selection_state.old_selected_areas.length>0){let d=e.model._selection_state.old_selected_areas[0];if(d.x0===d.x1&&d.y0===d.y1&&d.x0===i.x&&d.y0===i.y){e.model._selection_state.selected_areas=[],e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0,ht(e,r,o,[]);return}}if(e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0&&i.x!==void 0&&i.y!==void 0){let d={x0:Math.min(i.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(i.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(i.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(i.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.selected_areas.push(d),ht(e,r,o)}e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0}};function cs(e,r,{x0:o,x1:n,y0:i,y1:d}){let h={},p=r.model._edit_mode;o!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(p)>-1&&(h.start_col=o),n!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(p)>-1&&(h.end_col=n+1),i!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(p)>-1&&(h.start_row=i),d!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(p)>-1&&(h.end_row=d+1),e.setSelection(h)}var ht=(e,r,o,n)=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){n=e.model._selection_state.selected_areas.slice(0),e.model._selection_state.potential_selection&&n.push(e.model._selection_state.potential_selection);let i=r.querySelectorAll("tbody td");if(n.length>0)cs(e.parentElement,e,n[0]),ds(e,r,n,o);else{e.parentElement.setSelection();for(let d of i)d.classList.remove(o)}}else if(e.model._selection_state.dirty){e.model._selection_state.dirty=!1;let i=r.querySelectorAll("tbody td");for(let d of i)d.classList.remove(o)}},ds=(e,r,o,n)=>{if(e.model._edit_mode==="SELECT_REGION"&&o.length>0){let i=r.querySelectorAll("tbody td");for(let d of i){let h=r.getMeta(d),p=!1;for(let{x0:y,x1:k,y0:m,y1:E}of o)y!==void 0&&m!==void 0&&k!==void 0&&E!==void 0&&y<=h.x&&h.x<=k&&m<=h.y&&h.y<=E&&(p=!0,e.model._selection_state.dirty=!0,d.classList.add(n));p||d.classList.remove(n)}}else if(e.model._edit_mode==="SELECT_ROW"&&o.length>0){let i=r.querySelectorAll("tbody td");for(let d of i){let h=r.getMeta(d),p=!1;for(let{x0:y,x1:k,y0:m,y1:E}of o)y!==void 0&&m!==void 0&&k!==void 0&&E!==void 0&&m<=h.y&&h.y<=E&&(e.model._selection_state.dirty=!0,p=!0,d.classList.add(n));p||d.classList.remove(n)}}else if(e.model._edit_mode==="SELECT_COLUMN"&&o.length>0){let i=r.querySelectorAll("tbody td");for(let d of i){let h=r.getMeta(d),p=!1;for(let{x0:y,x1:k,y0:m,y1:E}of o)y!==void 0&&m!==void 0&&k!==void 0&&E!==void 0&&y<=h.x&&h.x<=k&&(e.model._selection_state.dirty=!0,p=!0,d.classList.add(n));p||d.classList.remove(n)}}};async function ho(e){let r=this.parentElement,o=await r.getTable(!0);if(this._initialized)await Jt.call(this,this.regular_table,o,e,this.model);else{this.innerHTML="",this.shadowRoot?this.shadowRoot.appendChild(this.regular_table):this.appendChild(this.regular_table),this.model=await Jt.call(this,this.regular_table,o,e),_o(this,this.regular_table,{className:"psp-select-region"}),this.regular_table.addStyleListener(jr.bind(this.model,this.regular_table,r)),this.regular_table.addStyleListener(Dr.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(Tr.bind(this.model,this.regular_table,r)),this.regular_table.addEventListener("click",Yr.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",Br.bind(this.model,this.regular_table,r));let n=new WeakMap;this.regular_table.addStyleListener(so.bind(this.model,this.regular_table,r,n)),this.regular_table.addEventListener("mousedown",oo.bind(this.model,this.regular_table,r,n)),this.regular_table.addEventListener("psp-deselect-all",io.bind(this.model,this.regular_table,r,n)),this.regular_table.addEventListener("click",uo.bind(this.model,this.regular_table,r));let i=new WeakMap;this.regular_table.addStyleListener(Vr.bind(this.model,this.regular_table,r,this)),this.regular_table.addStyleListener(Ot.bind(this.model,this.regular_table,r,i)),this.regular_table.addEventListener("click",eo.bind(this.model,this.regular_table,r)),this.regular_table.addEventListener("focusin",ro.bind(this.model,this.regular_table,r,i)),this.regular_table.addEventListener("focusout",to.bind(this.model,this.regular_table,r,i)),this.regular_table.addEventListener("keydown",Qr.bind(this.model,this.regular_table,r,i)),r.addEventListener("perspective-toggle-column-settings",d=>{if(this.isConnected){if(Bt.call(this.model,this.regular_table,r,d.detail.column_name),!d.detail.open){this.model._column_settings_selected_column=null;return}this.model._column_settings_selected_column=d.detail.column_name}}),this._initialized=!0}}function Rt(e,r=!1){if(!this._initialized)return;r&&(this._cached_column_sizes=e);let o={},{group_by:n,columns:i}=this.model._config,d=n?.length>0?n.length+1:0;for(let h of Object.keys(e))if(h==="__ROW_PATH__")o[d-1]=e[h];else{let p=this.model._column_paths.indexOf(h);o[p+d]=e[h]}this.regular_table._column_sizes.override=o}function Tt(){if(!this._initialized)return[];if(this._cached_column_sizes){let d=this._cached_column_sizes;return this._cached_column_sizes=void 0,d}let e=this.regular_table._column_sizes.override,{group_by:r,columns:o}=this.model._config,n=r?.length>0?r.length+1:0,i={};for(let d of Object.keys(e))if(e[d]!==void 0){let h=d-n;h>-1?i[this.model._column_paths[h]]=e[d]:h===-1&&(i.__ROW_PATH__=e[d])}return i}var pt=["READ_ONLY","EDIT","SELECT_ROW","SELECT_COLUMN","SELECT_REGION"];function Dt(e=void 0){typeof e>"u"&&(e=pt[(pt.indexOf(this._edit_mode)+1)%pt.length]),this.model._edit_mode=e,this.parentElement.setSelection(),this.model._selection_state={selected_areas:[],dirty:!0},this._edit_mode=e,this.dataset.editMode=e,this._edit_button!==void 0&&(this._edit_button.dataset.editMode=e)}function It(e=void 0){typeof e>"u"&&(e=!this._is_scroll_lock),this._is_scroll_lock=e,this.classList.toggle("sub-cell-scroll-disabled",e),this._scroll_lock!==void 0&&this._scroll_lock.classList.toggle("lock-scroll",e)}function po(e,r){e=JSON.parse(JSON.stringify(e)),r=JSON.parse(JSON.stringify(r));let o={};if(e.columns)for(let[d,h]of Object.entries(e.columns))h.column_size_override!==void 0&&(o[d]=h.column_size_override,delete h.column_size_override);let n={};if(r)for(let[d,h]of Object.entries(r))n[d]={...h,pos_fg_color:h.pos_fg_color?xe(h.pos_fg_color):void 0,neg_fg_color:h.neg_fg_color?xe(h.neg_fg_color):void 0,pos_bg_color:h.pos_bg_color?xe(h.pos_bg_color):void 0,neg_bg_color:h.neg_bg_color?xe(h.neg_bg_color):void 0,color:h.color?xe(h.color):void 0};"edit_mode"in e&&(pt.indexOf(e.edit_mode)!==-1?Dt.call(this,e.edit_mode):console.error("Unknown edit mode "+e.edit_mode)),"scroll_lock"in e&&It.call(this,e.scroll_lock);let i=this.regular_table;Rt.call(this,o,!0),i[ze]=n}function go(){if(this.regular_table){let e={columns:{},scroll_lock:!!this._is_scroll_lock,edit_mode:this._edit_mode},r=Tt.call(this);for(let o of Object.keys(r||{}))e.columns[o]||(e.columns[o]={}),e.columns[o].column_size_override=r[o];return JSON.parse(JSON.stringify(e))}return{}}async function mo(e){if(this.parentElement&&await this.activate(e),!this.isConnected||this.offsetParent==null)return;let r=Tt.call(this),o=this.regular_table.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.regular_table.scrollTop=0,this.regular_table.scrollLeft=0,this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this.regular_table._resetAutoSize()),Rt.call(this,r),await o,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}function Qt(e,r){return e==="integer"||e==="float"?{datagrid_number_style:{fg_gradient:0,pos_fg_color:this.model._pos_fg_color[0],neg_fg_color:this.model._neg_fg_color[0],number_fg_mode:"color",bg_gradient:0,pos_bg_color:this.model._pos_bg_color[0],neg_bg_color:this.model._neg_bg_color[0],number_bg_mode:"disabled"},number_string_format:!0}:e==="date"||e==="datetime"||e==="string"?{[e==="date"||e==="datetime"?"datagrid_datetime_style":"datagrid_string_style"]:{color:this.model._color[0],bg_color:this.model._color[0]}}:null}var He,er=class extends HTMLElement{constructor(){super(),this.regular_table=document.createElement("regular-table"),this.regular_table.part="regular-table",this._is_scroll_lock=!1,this._edit_mode="READ_ONLY";let r=er;r.renderTarget=="shadow"&&(Lt(r,He)||(Lr(r,He,new CSSStyleSheet),Lt(r,He).replaceSync(St)),this.attachShadow({mode:"open"}).adoptedStyleSheets.push(Lt(r,He)))}connectedCallback(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar"));let r=this.parentElement;r&&r.appendChild(this._toolbar)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}async activate(r){return await ho.call(this,r)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){return["Columns"]}get priority(){return 1}can_render_column_styles(r,o){return r!=="boolean"}column_style_controls(r,o){return Qt.call(this,r,o)}async draw(r){return await mo.call(this,r)}async update(r){this.model._num_rows=await r.num_rows(),await this.regular_table.draw()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return go.call(this)}restore(r,o){return po.call(this,r,o)}async restyle(r){await this.draw(r)}delete(){this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}},qe=er;He=new WeakMap,xr(qe,"renderTarget",window.CSS?.supports&&window.CSS?.supports("selector(:host-context(foo))")?"shadow":"light"),Er(qe,He,void 0);var bo=':host{position:relative;display:block;}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0;}:host #toolbar{display:flex;align-items:center;height:36px;}:host #toolbar .hover-target{margin:0;display:inline-flex;align-items:center;height:48px;cursor:pointer;}:host #toolbar .hover-target:hover{outline:4px solid var(--icon--color);background-color:var(--icon--color);}:host #slot-container{flex:1;position:relative;}#scroll_lock.lock-scroll:before{-webkit-mask-image:var(--toolbar-scroll-lock-active--content);}#scroll_lock:before{-webkit-mask-image:var(--toolbar-scroll-lock--content);}#select_mode:before{content:"highlight_alt";}#edit_mode:before{-webkit-mask-image:"";}#edit_mode[data-edit-mode="READ_ONLY"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--edit--content);}:host(.aggregated) #toolbar #edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="SELECT_ROW"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-row--content);}#edit_mode[data-edit-mode="SELECT_COLUMN"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-column--content);}#edit_mode[data-edit-mode="SELECT_REGION"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-region--content);}#edit_mode[data-edit-mode="READ_ONLY"] span:before{content:var(--edit-mode--read-only--content,"Read Only");}#edit_mode[data-edit-mode="EDIT"] span:before{content:var(--edit-mode--edit--content,"Editable");}#edit_mode[data-edit-mode="SELECT_ROW"] span:before{content:var(--edit-mode--select-row--content,"Row Select");}#edit_mode[data-edit-mode="SELECT_COLUMN"] span:before{content:var(--edit-mode--select-column--content,"Column Select");}#edit_mode[data-edit-mode="SELECT_REGION"] span:before{content:var(--edit-mode--select-region--content,"Region Select");}#scroll_lock span:before{content:var(--scroll-lock-toggle--content,"Free Scroll");}#scroll_lock.lock-scroll span:before{content:var(--scroll-lock-alt-toggle--content,"Align Scroll");}.button:before{width:21px;height:21px;content:"";-webkit-mask-size:cover;mask-size:cover;background-color:var(--icon--color,#ccc);}.button.editable:before,.button.lock-scroll:before{color:inherit;}.button{display:inline-flex;justify-content:center;align-items:center;user-select:none;padding:0 5px;border:1px solid transparent;border-radius:3px;border:1px solid transparent;box-sizing:border-box;display:inline-flex;font-size:var(--label--font-size,0.75em);height:22px;user-select:none;white-space:nowrap;width:37px;}.button>span{display:none;margin:0;padding:0;}.hover-target:hover .button{position:relative;background-color:var(--icon--color);color:var(--plugin--background);opacity:1;display:flex;align-items:center;cursor:pointer;}.hover-target:hover .button:before{background-color:var(--plugin--background);}.hover-target:hover .button>span{display:block;position:absolute;top:calc(100% + 3px);left:50%;translate:-50%;margin:0;padding:5px;height:auto;white-space:pre-wrap;line-height:1;font-size:9px;background-color:var(--icon--color);width:35px;text-align:center;border-radius:0 0 3px 3px;}';var Wt=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
            <style>
                ${bo}
            </style>
            <div id="toolbar">
                <span class="hover-target">
                    <span id="scroll_lock" class="button">
                        <span></span>
                    </span>
                </span>
                <span class="hover-target">
                    <span id="edit_mode" class="button" data-edit-mode="READ_ONLY">
                        <span></span>
                    </span>
                </span>
            </div>
        `;let r=this.parentElement,o=r.querySelector("perspective-viewer-datagrid");o._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),o._scroll_lock.addEventListener("click",()=>It.call(o)),o._edit_button=this.shadowRoot.querySelector("#edit_mode"),o._edit_button.addEventListener("click",()=>{Dt.call(o),o.regular_table.draw(),r.dispatchEvent(new Event("perspective-config-update"))})}};function us(){let e=document.createElement("style");e.textContent=St,document.head.insertBefore(e,document.head.firstChild)}async function _s(){customElements.define("perspective-viewer-datagrid-toolbar",Wt),customElements.define("perspective-viewer-datagrid",qe),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}_s();us();
/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */
/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
//# sourceMappingURL=perspective-viewer-datagrid.js.map
