var xo=Object.create;var Yt=Object.defineProperty;var ko=Object.getOwnPropertyDescriptor;var Eo=Object.getOwnPropertyNames;var Lo=Object.getPrototypeOf,Mo=Object.prototype.hasOwnProperty;var So=(e,t,o)=>t in e?Yt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var Oo=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var zo=(e,t,o,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let l of Eo(t))!Mo.call(e,l)&&l!==o&&Yt(e,l,{get:()=>t[l],enumerable:!(n=ko(t,l))||n.enumerable});return e};var Mt=(e,t,o)=>(o=e!=null?xo(Lo(e)):{},zo(t||!e||!e.__esModule?Yt(o,"default",{value:e,enumerable:!0}):o,e));var xr=(e,t,o)=>(So(e,typeof t!="symbol"?t+"":t,o),o),kr=(e,t,o)=>{if(!t.has(e))throw TypeError("Cannot "+o)};var St=(e,t,o)=>(kr(e,t,"read from private field"),o?o.call(e):t.get(e)),Er=(e,t,o)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,o)},Lr=(e,t,o,n)=>(kr(e,t,"write to private field"),n?n.call(e,o):t.set(e,o),o);var pt=Oo((ht,ut)=>{(function(){var e,t,o,n,l,d,u,p,b,x,g,E,I,T,S,W,A,q,j,v,te,N,ue,re,ze,J,oe,ie,_e,Fe,se,Ne,Ue,Se,ce,pe,Ce,Ae,Re,Ve,ye,Ee,je,qe,ge,me,rr,vt,He,yt,or,$,sr,ir,lr,nr,ae,ar,cr,dr,_r,fr,hr,ur,Ut,jt,Ht,pr,gr,mr,wt,xt,br,be,vr,Ke,we,Gt,Q,ee,Te,kt,Et,Le=[].slice;Q=function(){var r,s,i,a,c;for(r={},c="Boolean Number String Function Array Date RegExp Undefined Null".split(" "),a=0,s=c.length;a<s;a++)i=c[a],r["[object "+i+"]"]=i.toLowerCase();return function(_){var f;return f=Object.prototype.toString.call(_),r[f]||"object"}}(),vt=function(r,s,i){return s==null&&(s=0),i==null&&(i=1),r<s&&(r=s),r>i&&(r=i),r},ee=function(r){return r.length>=3?Array.prototype.slice.call(r):r[0]},te=function(r){var s,i;for(r._clipped=!1,r._unclipped=r.slice(0),s=i=0;i<3;s=++i)s<3?((r[s]<0||r[s]>255)&&(r._clipped=!0),r[s]<0&&(r[s]=0),r[s]>255&&(r[s]=255)):s===3&&(r[s]<0&&(r[s]=0),r[s]>1&&(r[s]=1));return r._clipped||delete r._unclipped,r},n=Math.PI,be=Math.round,re=Math.cos,_e=Math.floor,ae=Math.pow,He=Math.log,Ke=Math.sin,we=Math.sqrt,T=Math.atan2,$=Math.max,I=Math.abs,u=n*2,l=n/3,t=n/180,d=180/n,v=function(){return arguments[0]instanceof e?arguments[0]:function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,arguments,function(){})},v.default=v,E=[],typeof ut<"u"&&ut!==null&&ut.exports!=null&&(ut.exports=v),typeof define=="function"&&define.amd?define([],function(){return v}):(br=typeof ht<"u"&&ht!==null?ht:this,br.chroma=v),v.version="1.4.1",g={},b=[],x=!1,e=function(){function r(){var s,i,a,c,_,f,h,m,w;for(f=this,i=[],m=0,c=arguments.length;m<c;m++)s=arguments[m],s!=null&&i.push(s);if(i.length>1&&(h=i[i.length-1]),g[h]!=null)f._rgb=te(g[h](ee(i.slice(0,-1))));else{for(x||(b=b.sort(function(L,R){return R.p-L.p}),x=!0),w=0,_=b.length;w<_&&(a=b[w],h=a.test.apply(a,i),!h);w++);h&&(f._rgb=te(g[h].apply(g,i)))}f._rgb==null&&console.warn("unknown format: "+i),f._rgb==null&&(f._rgb=[0,0,0]),f._rgb.length===3&&f._rgb.push(1)}return r.prototype.toString=function(){return this.hex()},r}(),v._input=g;v.brewer=q={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},function(){var r,s;s=[];for(r in q)s.push(q[r.toLowerCase()]=q[r]);return s}(),Te={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},v.colors=ue=Te,je=function(){var r,s,i,a,c,_,f,h,m;return s=ee(arguments),c=s[0],r=s[1],i=s[2],h=(c+16)/116,f=isNaN(r)?h:h+r/500,m=isNaN(i)?h:h-i/200,h=o.Yn*qe(h),f=o.Xn*qe(f),m=o.Zn*qe(m),_=Et(3.2404542*f-1.5371385*h-.4985314*m),a=Et(-.969266*f+1.8760108*h+.041556*m),i=Et(.0556434*f-.2040259*h+1.0572252*m),[_,a,i,s.length>3?s[3]:1]},Et=function(r){return 255*(r<=.00304?12.92*r:1.055*ae(r,1/2.4)-.055)},qe=function(r){return r>o.t1?r*r*r:o.t2*(r-o.t0)},o={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},Ut=function(){var r,s,i,a,c,_,f,h;return a=ee(arguments),i=a[0],s=a[1],r=a[2],c=mr(i,s,r),_=c[0],f=c[1],h=c[2],[116*f-16,500*(_-f),200*(f-h)]},wt=function(r){return(r/=255)<=.04045?r/12.92:ae((r+.055)/1.055,2.4)},kt=function(r){return r>o.t3?ae(r,1/3):r/o.t2+o.t0},mr=function(){var r,s,i,a,c,_,f;return a=ee(arguments),i=a[0],s=a[1],r=a[2],i=wt(i),s=wt(s),r=wt(r),c=kt((.4124564*i+.3575761*s+.1804375*r)/o.Xn),_=kt((.2126729*i+.7151522*s+.072175*r)/o.Yn),f=kt((.0193339*i+.119192*s+.9503041*r)/o.Zn),[c,_,f]},v.lab=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["lab"]),function(){})},g.lab=je,e.prototype.lab=function(){return Ut(this._rgb)},S=function(r){var s,i,a,c,_,f,h,m,w,L,R;return r=function(){var M,k,O;for(O=[],k=0,M=r.length;k<M;k++)c=r[k],O.push(v(c));return O}(),r.length===2?(w=function(){var M,k,O;for(O=[],k=0,M=r.length;k<M;k++)c=r[k],O.push(c.lab());return O}(),_=w[0],f=w[1],s=function(M){var k,O;return O=function(){var C,P;for(P=[],k=C=0;C<=2;k=++C)P.push(_[k]+M*(f[k]-_[k]));return P}(),v.lab.apply(v,O)}):r.length===3?(L=function(){var M,k,O;for(O=[],k=0,M=r.length;k<M;k++)c=r[k],O.push(c.lab());return O}(),_=L[0],f=L[1],h=L[2],s=function(M){var k,O;return O=function(){var C,P;for(P=[],k=C=0;C<=2;k=++C)P.push((1-M)*(1-M)*_[k]+2*(1-M)*M*f[k]+M*M*h[k]);return P}(),v.lab.apply(v,O)}):r.length===4?(R=function(){var M,k,O;for(O=[],k=0,M=r.length;k<M;k++)c=r[k],O.push(c.lab());return O}(),_=R[0],f=R[1],h=R[2],m=R[3],s=function(M){var k,O;return O=function(){var C,P;for(P=[],k=C=0;C<=2;k=++C)P.push((1-M)*(1-M)*(1-M)*_[k]+3*(1-M)*(1-M)*M*f[k]+3*(1-M)*M*M*h[k]+M*M*M*m[k]);return P}(),v.lab.apply(v,O)}):r.length===5&&(i=S(r.slice(0,3)),a=S(r.slice(2,5)),s=function(M){return M<.5?i(M*2):a((M-.5)*2)}),s},v.bezier=function(r){var s;return s=S(r),s.scale=function(){return v.scale(s)},s},v.cubehelix=function(r,s,i,a,c){var _,f,h;return r==null&&(r=300),s==null&&(s=-1.5),i==null&&(i=1),a==null&&(a=1),c==null&&(c=[0,1]),_=0,Q(c)==="array"?f=c[1]-c[0]:(f=0,c=[c,c]),h=function(m){var w,L,R,M,k,O,C,P,X;return w=u*((r+120)/360+s*m),C=ae(c[0]+f*m,a),O=_!==0?i[0]+m*_:i,L=O*C*(1-C)/2,M=re(w),X=Ke(w),P=C+L*(-.14861*M+1.78277*X),k=C+L*(-.29227*M-.90649*X),R=C+L*(1.97294*M),v(te([P*255,k*255,R*255,1]))},h.start=function(m){return m==null?r:(r=m,h)},h.rotations=function(m){return m==null?s:(s=m,h)},h.gamma=function(m){return m==null?a:(a=m,h)},h.hue=function(m){return m==null?i:(i=m,Q(i)==="array"?(_=i[1]-i[0],_===0&&(i=i[1])):_=0,h)},h.lightness=function(m){return m==null?c:(Q(m)==="array"?(c=m,f=m[1]-m[0]):(c=[m,m],f=0),h)},h.scale=function(){return v.scale(h)},h.hue(i),h},v.random=function(){var r,s,i,a;for(s="0123456789abcdef",r="#",i=a=0;a<6;i=++a)r+=s.charAt(_e(Math.random()*16));return new e(r)},E=[],pe=function(r,s,i,a){var c,_,f,h;for(i==null&&(i=.5),a==null&&(a="rgb"),Q(r)!=="object"&&(r=v(r)),Q(s)!=="object"&&(s=v(s)),f=0,_=E.length;f<_;f++)if(c=E[f],a===c[0]){h=c[1](r,s,i,a);break}if(h==null)throw"color mode "+a+" is not supported";return h.alpha(r.alpha()+i*(s.alpha()-r.alpha()))},v.interpolate=pe,e.prototype.interpolate=function(r,s,i){return pe(this,r,s,i)},v.mix=pe,e.prototype.mix=e.prototype.interpolate,g.rgb=function(){var r,s,i,a;s=ee(arguments),i=[];for(r in s)a=s[r],i.push(a);return i},v.rgb=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["rgb"]),function(){})},e.prototype.rgb=function(r){return r==null&&(r=!0),r?this._rgb.map(Math.round).slice(0,3):this._rgb.slice(0,3)},e.prototype.rgba=function(r){return r==null&&(r=!0),r?[Math.round(this._rgb[0]),Math.round(this._rgb[1]),Math.round(this._rgb[2]),this._rgb[3]]:this._rgb.slice(0)},b.push({p:3,test:function(r){var s;if(s=ee(arguments),Q(s)==="array"&&s.length===3||s.length===4&&Q(s[3])==="number"&&s[3]>=0&&s[3]<=1)return"rgb"}}),g.lrgb=g.rgb,Re=function(r,s,i,a){var c,_;return c=r._rgb,_=s._rgb,new e(we(ae(c[0],2)*(1-i)+ae(_[0],2)*i),we(ae(c[1],2)*(1-i)+ae(_[1],2)*i),we(ae(c[2],2)*(1-i)+ae(_[2],2)*i),a)},p=function(r){var s,i,a,c,_,f;for(i=1/r.length,f=[0,0,0,0],c=0,a=r.length;c<a;c++)s=r[c],_=s._rgb,f[0]+=ae(_[0],2)*i,f[1]+=ae(_[1],2)*i,f[2]+=ae(_[2],2)*i,f[3]+=_[3]*i;return f[0]=we(f[0]),f[1]=we(f[1]),f[2]=we(f[2]),f[3]>1&&(f[3]=1),new e(te(f))},E.push(["lrgb",Re]),v.average=function(r,s){var i,a,c,_,f,h,m,w,L,R,M,k,O;if(s==null&&(s="rgb"),L=r.length,r=r.map(function(C){return v(C)}),m=r.splice(0,1)[0],s==="lrgb")return p(r);k=m.get(s),_=[],f=0,h=0;for(w in k)k[w]=k[w]||0,_.push(isNaN(k[w])?0:1),s.charAt(w)==="h"&&!isNaN(k[w])&&(i=k[w]/180*n,f+=re(i),h+=Ke(i));for(a=m.alpha(),M=0,R=r.length;M<R;M++){c=r[M],O=c.get(s),a+=c.alpha();for(w in k)isNaN(O[w])||(_[w]+=1,s.charAt(w)==="h"?(i=O[w]/180*n,f+=re(i),h+=Ke(i)):k[w]+=O[w])}for(w in k)if(s.charAt(w)==="h"){for(i=T(h/_[w],f/_[w])/n*180;i<0;)i+=360;for(;i>=360;)i-=360;k[w]=i}else k[w]=k[w]/_[w];return v(k,s).alpha(a/L)},se=function(r){var s,i,a,c,_,f;if(r.match(/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/))return(r.length===4||r.length===7)&&(r=r.substr(1)),r.length===3&&(r=r.split(""),r=r[0]+r[0]+r[1]+r[1]+r[2]+r[2]),f=parseInt(r,16),c=f>>16,a=f>>8&255,i=f&255,[c,a,i,1];if(r.match(/^#?([A-Fa-f0-9]{8})$/))return r.length===9&&(r=r.substr(1)),f=parseInt(r,16),c=f>>24&255,a=f>>16&255,i=f>>8&255,s=be((f&255)/255*100)/100,[c,a,i,s];if(g.css!=null&&(_=g.css(r)))return _;throw"unknown color: "+r},_r=function(r,s){var i,a,c,_,f,h,m;return s==null&&(s="auto"),f=r[0],c=r[1],a=r[2],i=r[3],s==="auto"&&(s=i<1?"rgba":"rgb"),f=Math.round(f),c=Math.round(c),a=Math.round(a),m=f<<16|c<<8|a,h="000000"+m.toString(16),h=h.substr(h.length-6),_="0"+be(i*255).toString(16),_=_.substr(_.length-2),"#"+function(){switch(s.toLowerCase()){case"rgba":return h+_;case"argb":return _+h;default:return h}}()},g.hex=function(r){return se(r)},v.hex=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["hex"]),function(){})},e.prototype.hex=function(r){return r==null&&(r="auto"),_r(this._rgb,r)},b.push({p:4,test:function(r){if(arguments.length===1&&Q(r)==="string")return"hex"}}),Se=function(){var r,s,i,a,c,_,f,h,m,w,L,R,M,k;if(r=ee(arguments),c=r[0],L=r[1],f=r[2],L===0)m=a=s=f*255;else{for(k=[0,0,0],i=[0,0,0],M=f<.5?f*(1+L):f+L-f*L,R=2*f-M,c/=360,k[0]=c+1/3,k[1]=c,k[2]=c-1/3,_=h=0;h<=2;_=++h)k[_]<0&&(k[_]+=1),k[_]>1&&(k[_]-=1),6*k[_]<1?i[_]=R+(M-R)*6*k[_]:2*k[_]<1?i[_]=M:3*k[_]<2?i[_]=R+(M-R)*(2/3-k[_])*6:i[_]=R;w=[be(i[0]*255),be(i[1]*255),be(i[2]*255)],m=w[0],a=w[1],s=w[2]}return r.length>3?[m,a,s,r[3]]:[m,a,s]},hr=function(r,s,i){var a,c,_,f,h;return r!==void 0&&r.length>=3&&(f=r,r=f[0],s=f[1],i=f[2]),r/=255,s/=255,i/=255,_=Math.min(r,s,i),$=Math.max(r,s,i),c=($+_)/2,$===_?(h=0,a=Number.NaN):h=c<.5?($-_)/($+_):($-_)/(2-$-_),r===$?a=(s-i)/($-_):s===$?a=2+(i-r)/($-_):i===$&&(a=4+(r-s)/($-_)),a*=60,a<0&&(a+=360),[a,h,c]},v.hsl=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["hsl"]),function(){})},g.hsl=Se,e.prototype.hsl=function(){return hr(this._rgb)},ce=function(){var r,s,i,a,c,_,f,h,m,w,L,R,M,k,O,C,P,X;if(r=ee(arguments),c=r[0],C=r[1],X=r[2],X*=255,C===0)m=a=s=X;else switch(c===360&&(c=0),c>360&&(c-=360),c<0&&(c+=360),c/=60,_=_e(c),i=c-_,f=X*(1-C),h=X*(1-C*i),P=X*(1-C*(1-i)),_){case 0:w=[X,P,f],m=w[0],a=w[1],s=w[2];break;case 1:L=[h,X,f],m=L[0],a=L[1],s=L[2];break;case 2:R=[f,X,P],m=R[0],a=R[1],s=R[2];break;case 3:M=[f,h,X],m=M[0],a=M[1],s=M[2];break;case 4:k=[P,f,X],m=k[0],a=k[1],s=k[2];break;case 5:O=[X,f,h],m=O[0],a=O[1],s=O[2]}return[m,a,s,r.length>3?r[3]:1]},ur=function(){var r,s,i,a,c,_,f,h,m;return f=ee(arguments),_=f[0],i=f[1],r=f[2],c=Math.min(_,i,r),$=Math.max(_,i,r),s=$-c,m=$/255,$===0?(a=Number.NaN,h=0):(h=s/$,_===$&&(a=(i-r)/s),i===$&&(a=2+(r-_)/s),r===$&&(a=4+(_-i)/s),a*=60,a<0&&(a+=360)),[a,h,m]},v.hsv=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["hsv"]),function(){})},g.hsv=ce,e.prototype.hsv=function(){return ur(this._rgb)},lr=function(r){var s,i,a;return Q(r)==="number"&&r>=0&&r<=16777215?(a=r>>16,i=r>>8&255,s=r&255,[a,i,s,1]):(console.warn("unknown num color: "+r),[0,0,0,1])},pr=function(){var r,s,i,a;return a=ee(arguments),i=a[0],s=a[1],r=a[2],(i<<16)+(s<<8)+r},v.num=function(r){return new e(r,"num")},e.prototype.num=function(r){return r==null&&(r="rgb"),pr(this._rgb,r)},g.num=lr,b.push({p:1,test:function(r){if(arguments.length===1&&Q(r)==="number"&&r>=0&&r<=16777215)return"num"}}),Fe=function(){var r,s,i,a,c,_,f,h,m,w,L,R,M,k,O,C,P,X,le,D;if(i=ee(arguments),h=i[0],c=i[1],s=i[2],c=c/100,f=f/100*255,r=c*255,c===0)R=f=a=s;else switch(h===360&&(h=0),h>360&&(h-=360),h<0&&(h+=360),h/=60,m=_e(h),_=h-m,w=s*(1-c),L=w+r*(1-_),le=w+r*_,D=w+r,m){case 0:M=[D,le,w],R=M[0],f=M[1],a=M[2];break;case 1:k=[L,D,w],R=k[0],f=k[1],a=k[2];break;case 2:O=[w,D,le],R=O[0],f=O[1],a=O[2];break;case 3:C=[w,L,D],R=C[0],f=C[1],a=C[2];break;case 4:P=[le,w,D],R=P[0],f=P[1],a=P[2];break;case 5:X=[D,w,L],R=X[0],f=X[1],a=X[2]}return[R,f,a,i.length>3?i[3]:1]},dr=function(){var r,s,i,a,c,_,f,h,m;return m=ee(arguments),h=m[0],c=m[1],s=m[2],f=Math.min(h,c,s),$=Math.max(h,c,s),a=$-f,i=a*100/255,r=f/(255-a)*100,a===0?_=Number.NaN:(h===$&&(_=(c-s)/a),c===$&&(_=2+(s-h)/a),s===$&&(_=4+(h-c)/a),_*=60,_<0&&(_+=360)),[_,i,r]},v.hcg=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["hcg"]),function(){})},g.hcg=Fe,e.prototype.hcg=function(){return dr(this._rgb)},ze=function(r){var s,i,a,c,_,f,h,m;if(r=r.toLowerCase(),v.colors!=null&&v.colors[r])return se(v.colors[r]);if(_=r.match(/rgb\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*\)/)){for(h=_.slice(1,4),c=f=0;f<=2;c=++f)h[c]=+h[c];h[3]=1}else if(_=r.match(/rgba\(\s*(\-?\d+),\s*(\-?\d+)\s*,\s*(\-?\d+)\s*,\s*([01]|[01]?\.\d+)\)/))for(h=_.slice(1,5),c=m=0;m<=3;c=++m)h[c]=+h[c];else if(_=r.match(/rgb\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/)){for(h=_.slice(1,4),c=s=0;s<=2;c=++s)h[c]=be(h[c]*2.55);h[3]=1}else if(_=r.match(/rgba\(\s*(\-?\d+(?:\.\d+)?)%,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/)){for(h=_.slice(1,5),c=i=0;i<=2;c=++i)h[c]=be(h[c]*2.55);h[3]=+h[3]}else(_=r.match(/hsl\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*\)/))?(a=_.slice(1,4),a[1]*=.01,a[2]*=.01,h=Se(a),h[3]=1):(_=r.match(/hsla\(\s*(\-?\d+(?:\.\d+)?),\s*(\-?\d+(?:\.\d+)?)%\s*,\s*(\-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)/))&&(a=_.slice(1,4),a[1]*=.01,a[2]*=.01,h=Se(a),h[3]=+_[4]);return h},cr=function(r){var s;if(s=r[3]<1?"rgba":"rgb",s==="rgb")return s+"("+r.slice(0,3).map(be).join(",")+")";if(s==="rgba")return s+"("+r.slice(0,3).map(be).join(",")+","+r[3]+")"},xt=function(r){return be(r*100)/100},Ue=function(r,s){var i;return i=s<1?"hsla":"hsl",r[0]=xt(r[0]||0),r[1]=xt(r[1]*100)+"%",r[2]=xt(r[2]*100)+"%",i==="hsla"&&(r[3]=s),i+"("+r.join(",")+")"},g.css=function(r){return ze(r)},v.css=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["css"]),function(){})},e.prototype.css=function(r){if(r==null&&(r="rgb"),r.slice(0,3)==="rgb")return cr(this._rgb);if(r.slice(0,3)==="hsl")return Ue(this.hsl(),this.alpha())},g.named=function(r){return se(Te[r])},b.push({p:5,test:function(r){if(arguments.length===1&&Te[r]!=null)return"named"}}),e.prototype.name=function(r){var s,i;arguments.length&&(Te[r]&&(this._rgb=se(Te[r])),this._rgb[3]=1),s=this.hex("rgb");for(i in Te)if(s===Te[i])return i;return s},ge=function(){var r,s,i,a;return a=ee(arguments),i=a[0],r=a[1],s=a[2],s=s*t,[i,re(s)*r,Ke(s)*r]},me=function(){var r,s,i,a,c,_,f,h,m,w,L;return i=ee(arguments),h=i[0],c=i[1],f=i[2],w=ge(h,c,f),r=w[0],s=w[1],a=w[2],L=je(r,s,a),m=L[0],_=L[1],a=L[2],[m,_,a,i.length>3?i[3]:1]},Ee=function(){var r,s,i,a,c,_;return _=ee(arguments),c=_[0],r=_[1],s=_[2],i=we(r*r+s*s),a=(T(s,r)*d+360)%360,be(i*1e4)===0&&(a=Number.NaN),[c,i,a]},jt=function(){var r,s,i,a,c,_,f;return _=ee(arguments),c=_[0],i=_[1],s=_[2],f=Ut(c,i,s),a=f[0],r=f[1],s=f[2],Ee(a,r,s)},v.lch=function(){var r;return r=ee(arguments),new e(r,"lch")},v.hcl=function(){var r;return r=ee(arguments),new e(r,"hcl")},g.lch=me,g.hcl=function(){var r,s,i,a;return a=ee(arguments),s=a[0],r=a[1],i=a[2],me([i,r,s])},e.prototype.lch=function(){return jt(this._rgb)},e.prototype.hcl=function(){return jt(this._rgb).reverse()},ar=function(r){var s,i,a,c,_,f,h,m,w;return r==null&&(r="rgb"),m=ee(arguments),h=m[0],c=m[1],s=m[2],h=h/255,c=c/255,s=s/255,_=1-Math.max(h,Math.max(c,s)),a=_<1?1/(1-_):0,i=(1-h-_)*a,f=(1-c-_)*a,w=(1-s-_)*a,[i,f,w,_]},N=function(){var r,s,i,a,c,_,f,h,m;return s=ee(arguments),a=s[0],f=s[1],m=s[2],_=s[3],r=s.length>4?s[4]:1,_===1?[0,0,0,r]:(h=a>=1?0:255*(1-a)*(1-_),c=f>=1?0:255*(1-f)*(1-_),i=m>=1?0:255*(1-m)*(1-_),[h,c,i,r])},g.cmyk=function(){return N(ee(arguments))},v.cmyk=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["cmyk"]),function(){})},e.prototype.cmyk=function(){return ar(this._rgb)},g.gl=function(){var r,s,i,a,c;for(a=function(){var _,f;_=ee(arguments),f=[];for(s in _)c=_[s],f.push(c);return f}.apply(this,arguments),r=i=0;i<=2;r=++i)a[r]*=255;return a},v.gl=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["gl"]),function(){})},e.prototype.gl=function(){var r;return r=this._rgb,[r[0]/255,r[1]/255,r[2]/255,r[3]]},Ht=function(r,s,i){var a;return a=ee(arguments),r=a[0],s=a[1],i=a[2],r=yt(r),s=yt(s),i=yt(i),.2126*r+.7152*s+.0722*i},yt=function(r){return r/=255,r<=.03928?r/12.92:ae((r+.055)/1.055,2.4)},ye=function(r,s,i,a){var c,_;return c=r._rgb,_=s._rgb,new e(c[0]+i*(_[0]-c[0]),c[1]+i*(_[1]-c[1]),c[2]+i*(_[2]-c[2]),a)},E.push(["rgb",ye]),e.prototype.luminance=function(r,s){var i,a,c,_,f;return s==null&&(s="rgb"),arguments.length?(_=this._rgb,r===0?_=[0,0,0,this._rgb[3]]:r===1?_=[255,255,255,this[3]]:(i=Ht(this._rgb),a=1e-7,c=20,f=function(h,m){var w,L;return L=h.interpolate(m,.5,s),w=L.luminance(),Math.abs(r-w)<a||!c--?L:w>r?f(h,L):f(L,m)},i>r?_=f(v("black"),this).rgba():_=f(this,v("white")).rgba()),v(_).alpha(this.alpha())):Ht(this._rgb)},Gt=function(r){var s,i,a,c;return c=r/100,c<66?(a=255,i=-155.25485562709179-.44596950469579133*(i=c-2)+104.49216199393888*He(i),s=c<20?0:-254.76935184120902+.8274096064007395*(s=c-10)+115.67994401066147*He(s)):(a=351.97690566805693+.114206453784165*(a=c-55)-40.25366309332127*He(a),i=325.4494125711974+.07943456536662342*(i=c-50)-28.0852963507957*He(i),s=255),[a,i,s]},gr=function(){var r,s,i,a,c,_,f,h,m;for(f=ee(arguments),_=f[0],i=f[1],r=f[2],c=1e3,a=4e4,s=.4;a-c>s;)m=(a+c)*.5,h=Gt(m),h[2]/h[0]>=r/_?a=m:c=m;return be(m)},v.temperature=v.kelvin=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["temperature"]),function(){})},g.temperature=g.kelvin=g.K=Gt,e.prototype.temperature=function(){return gr(this._rgb)},e.prototype.kelvin=e.prototype.temperature,v.contrast=function(r,s){var i,a,c,_;return((c=Q(r))==="string"||c==="number")&&(r=new e(r)),((_=Q(s))==="string"||_==="number")&&(s=new e(s)),i=r.luminance(),a=s.luminance(),i>a?(i+.05)/(a+.05):(a+.05)/(i+.05)},v.distance=function(r,s,i){var a,c,_,f,h,m,w;i==null&&(i="lab"),((h=Q(r))==="string"||h==="number")&&(r=new e(r)),((m=Q(s))==="string"||m==="number")&&(s=new e(s)),_=r.get(i),f=s.get(i),w=0;for(c in _)a=(_[c]||0)-(f[c]||0),w+=a*a;return Math.sqrt(w)},v.deltaE=function(r,s,i,a){var c,_,f,h,m,w,L,R,M,k,O,C,P,X,le,D,Me,ve,H,V,fe,y,z,U,G,F,Y;for(i==null&&(i=1),a==null&&(a=1),((Me=Q(r))==="string"||Me==="number")&&(r=new e(r)),((ve=Q(s))==="string"||ve==="number")&&(s=new e(s)),H=r.lab(),c=H[0],f=H[1],m=H[2],V=s.lab(),_=V[0],h=V[1],w=V[2],L=we(f*f+m*m),R=we(h*h+w*w),z=c<16?.511:.040975*c/(1+.01765*c),fe=.0638*L/(1+.0131*L)+.638,D=L<1e-6?0:T(m,f)*180/n;D<0;)D+=360;for(;D>=360;)D-=360;return U=D>=164&&D<=345?.56+I(.2*re(n*(D+168)/180)):.36+I(.4*re(n*(D+35)/180)),M=L*L*L*L,le=we(M/(M+1900)),y=fe*(le*U+1-le),X=c-_,P=L-R,O=f-h,C=m-w,k=O*O+C*C-P*P,G=X/(i*z),F=P/(a*fe),Y=y,we(G*G+F*F+k/(Y*Y))},e.prototype.get=function(r){var s,i,a,c,_,f;return a=this,_=r.split("."),c=_[0],s=_[1],f=a[c](),s?(i=c.indexOf(s),i>-1?f[i]:console.warn("unknown channel "+s+" in mode "+c)):f},e.prototype.set=function(r,s){var i,a,c,_,f,h;if(c=this,f=r.split("."),_=f[0],i=f[1],i)if(h=c[_](),a=_.indexOf(i),a>-1)if(Q(s)==="string")switch(s.charAt(0)){case"+":h[a]+=+s;break;case"-":h[a]+=+s;break;case"*":h[a]*=+s.substr(1);break;case"/":h[a]/=+s.substr(1);break;default:h[a]=+s}else h[a]=s;else console.warn("unknown channel "+i+" in mode "+_);else h=s;return v(h,_).alpha(c.alpha())},e.prototype.clipped=function(){return this._rgb._clipped||!1},e.prototype.alpha=function(r){return arguments.length?v.rgb([this._rgb[0],this._rgb[1],this._rgb[2],r]):this._rgb[3]},e.prototype.darken=function(r){var s,i;return r==null&&(r=1),i=this,s=i.lab(),s[0]-=o.Kn*r,v.lab(s).alpha(i.alpha())},e.prototype.brighten=function(r){return r==null&&(r=1),this.darken(-r)},e.prototype.darker=e.prototype.darken,e.prototype.brighter=e.prototype.brighten,e.prototype.saturate=function(r){var s,i;return r==null&&(r=1),i=this,s=i.lch(),s[1]+=r*o.Kn,s[1]<0&&(s[1]=0),v.lch(s).alpha(i.alpha())},e.prototype.desaturate=function(r){return r==null&&(r=1),this.saturate(-r)},e.prototype.premultiply=function(){var r,s;return s=this.rgb(),r=this.alpha(),v(s[0]*r,s[1]*r,s[2]*r,r)},W=function(r,s,i){if(!W[i])throw"unknown blend mode "+i;return W[i](r,s)},A=function(r){return function(s,i){var a,c;return a=v(i).rgb(),c=v(s).rgb(),v(r(a,c),"rgb")}},ie=function(r){return function(s,i){var a,c,_;for(_=[],a=c=0;c<=3;a=++c)_[a]=r(s[a],i[a]);return _}},ir=function(r,s){return r},sr=function(r,s){return r*s/255},J=function(r,s){return r>s?s:r},rr=function(r,s){return r>s?r:s},vr=function(r,s){return 255*(1-(1-r/255)*(1-s/255))},nr=function(r,s){return s<128?2*r*s/255:255*(1-2*(1-r/255)*(1-s/255))},j=function(r,s){return 255*(1-(1-s/255)/(r/255))},oe=function(r,s){return r===255||(r=255*(s/255)/(1-r/255),r>255)?255:r},W.normal=A(ie(ir)),W.multiply=A(ie(sr)),W.screen=A(ie(vr)),W.overlay=A(ie(nr)),W.darken=A(ie(J)),W.lighten=A(ie(rr)),W.dodge=A(ie(oe)),W.burn=A(ie(j)),v.blend=W,v.analyze=function(r){var s,i,a,c;for(a={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},i=0,s=r.length;i<s;i++)c=r[i],c!=null&&!isNaN(c)&&(a.values.push(c),a.sum+=c,c<a.min&&(a.min=c),c>a.max&&(a.max=c),a.count+=1);return a.domain=[a.min,a.max],a.limits=function(_,f){return v.limits(a,_,f)},a},v.scale=function(r,s){var i,a,c,_,f,h,m,w,L,R,M,k,O,C,P,X,le,D,Me,ve,H,V,fe;return R="rgb",M=v("#ccc"),P=0,h=!1,f=[0,1],C=[],O=[0,0],i=!1,c=[],k=!1,L=0,w=1,_=!1,a={},X=!0,m=1,V=function(y){var z,U,G,F,Y,Z;if(y==null&&(y=["#fff","#000"]),y!=null&&Q(y)==="string"&&v.brewer!=null&&(y=v.brewer[y]||v.brewer[y.toLowerCase()]||y),Q(y)==="array"){for(y.length===1&&(y=[y[0],y[0]]),y=y.slice(0),z=G=0,F=y.length-1;0<=F?G<=F:G>=F;z=0<=F?++G:--G)U=y[z],Q(U)==="string"&&(y[z]=v(U));for(C.length=0,z=Z=0,Y=y.length-1;0<=Y?Z<=Y:Z>=Y;z=0<=Y?++Z:--Z)C.push(z/(y.length-1))}return H(),c=y},Me=function(y){var z,U;if(i!=null){for(U=i.length-1,z=0;z<U&&y>=i[z];)z++;return z-1}return 0},fe=function(y){return y},le=function(y){var z,U,G,F,Y;return Y=y,i.length>2&&(F=i.length-1,z=Me(y),G=i[0]+(i[1]-i[0])*(0+P*.5),U=i[F-1]+(i[F]-i[F-1])*(1-P*.5),Y=L+(i[z]+(i[z+1]-i[z])*.5-G)/(U-G)*(w-L)),Y},ve=function(y,z){var U,G,F,Y,Z,K,ne,B;if(z==null&&(z=!1),isNaN(y)||y===null)return M;if(z?B=y:i&&i.length>2?(U=Me(y),B=U/(i.length-2)):w!==L?B=(y-L)/(w-L):B=1,z||(B=fe(B)),m!==1&&(B=ae(B,m)),B=O[0]+B*(1-O[0]-O[1]),B=Math.min(1,Math.max(0,B)),Y=Math.floor(B*1e4),X&&a[Y])G=a[Y];else{if(Q(c)==="array")for(F=Z=0,ne=C.length-1;0<=ne?Z<=ne:Z>=ne;F=0<=ne?++Z:--Z){if(K=C[F],B<=K){G=c[F];break}if(B>=K&&F===C.length-1){G=c[F];break}if(B>K&&B<C[F+1]){B=(B-K)/(C[F+1]-K),G=v.interpolate(c[F],c[F+1],B,R);break}}else Q(c)==="function"&&(G=c(B));X&&(a[Y]=G)}return G},H=function(){return a={}},V(r),D=function(y){var z;return z=v(ve(y)),k&&z[k]?z[k]():z},D.classes=function(y){var z;return y!=null?(Q(y)==="array"?(i=y,f=[y[0],y[y.length-1]]):(z=v.analyze(f),y===0?i=[z.min,z.max]:i=v.limits(z,"e",y)),D):i},D.domain=function(y){var z,U,G,F,Y,Z,K;if(!arguments.length)return f;if(L=y[0],w=y[y.length-1],C=[],G=c.length,y.length===G&&L!==w)for(Y=0,F=y.length;Y<F;Y++)U=y[Y],C.push((U-L)/(w-L));else for(z=K=0,Z=G-1;0<=Z?K<=Z:K>=Z;z=0<=Z?++K:--K)C.push(z/(G-1));return f=[L,w],D},D.mode=function(y){return arguments.length?(R=y,H(),D):R},D.range=function(y,z){return V(y,z),D},D.out=function(y){return k=y,D},D.spread=function(y){return arguments.length?(P=y,D):P},D.correctLightness=function(y){return y==null&&(y=!0),_=y,H(),_?fe=function(z){var U,G,F,Y,Z,K,ne,B,de;for(U=ve(0,!0).lab()[0],G=ve(1,!0).lab()[0],ne=U>G,F=ve(z,!0).lab()[0],Z=U+(G-U)*z,Y=F-Z,B=0,de=1,K=20;Math.abs(Y)>.01&&K-- >0;)(function(){return ne&&(Y*=-1),Y<0?(B=z,z+=(de-z)*.5):(de=z,z+=(B-z)*.5),F=ve(z,!0).lab()[0],Y=F-Z})();return z}:fe=function(z){return z},D},D.padding=function(y){return y!=null?(Q(y)==="number"&&(y=[y,y]),O=y,D):O},D.colors=function(y,z){var U,G,F,Y,Z,K,ne,B,de;if(arguments.length<2&&(z="hex"),K=[],arguments.length===0)K=c.slice(0);else if(y===1)K=[D(.5)];else if(y>1)G=f[0],U=f[1]-G,K=function(){ne=[];for(var he=0;0<=y?he<y:he>y;0<=y?he++:he--)ne.push(he);return ne}.apply(this).map(function(he){return D(G+he/(y-1)*U)});else{if(r=[],B=[],i&&i.length>2)for(F=de=1,Z=i.length;1<=Z?de<Z:de>Z;F=1<=Z?++de:--de)B.push((i[F-1]+i[F])*.5);else B=f;K=B.map(function(he){return D(he)})}return v[z]&&(K=K.map(function(he){return he[z]()})),K},D.cache=function(y){return y!=null?(X=y,D):X},D.gamma=function(y){return y!=null?(m=y,D):m},D.nodata=function(y){return y!=null?(M=v(y),D):M},D},v.scales==null&&(v.scales={}),v.scales.cool=function(){return v.scale([v.hsl(180,1,.9),v.hsl(250,.7,.4)])},v.scales.hot=function(){return v.scale(["#000","#f00","#ff0","#fff"],[0,.25,.75,1]).mode("rgb")},v.analyze=function(r,s,i){var a,c,_,f,h,m,w;if(h={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0},i==null&&(i=function(){return!0}),a=function(L){L!=null&&!isNaN(L)&&(h.values.push(L),h.sum+=L,L<h.min&&(h.min=L),L>h.max&&(h.max=L),h.count+=1)},w=function(L,R){if(i(L,R))return s!=null&&Q(s)==="function"?a(s(L)):s!=null&&Q(s)==="string"||Q(s)==="number"?a(L[s]):a(L)},Q(r)==="array")for(f=0,_=r.length;f<_;f++)m=r[f],w(m);else for(c in r)m=r[c],w(m,c);return h.domain=[h.min,h.max],h.limits=function(L,R){return v.limits(h,L,R)},h},v.limits=function(r,s,i){var a,c,_,f,h,m,w,L,R,M,k,O,C,P,X,le,D,Me,ve,H,V,fe,y,z,U,G,F,Y,Z,K,ne,B,de,he,Ze,Je,Qe,et,tt,rt,yr,ot,st,it,lt,nt,at,ct,dt,_t,wo,De,Lt,wr,Oe,ft;if(s==null&&(s="equal"),i==null&&(i=7),Q(r)==="array"&&(r=v.analyze(r)),U=r.min,$=r.max,wo=r.sum,Oe=r.values.sort(function($t,qt){return $t-qt}),i===1)return[U,$];if(y=[],s.substr(0,1)==="c"&&(y.push(U),y.push($)),s.substr(0,1)==="e"){for(y.push(U),H=ne=1,Ze=i-1;1<=Ze?ne<=Ze:ne>=Ze;H=1<=Ze?++ne:--ne)y.push(U+H/i*($-U));y.push($)}else if(s.substr(0,1)==="l"){if(U<=0)throw"Logarithmic scales are only possible for values > 0";for(G=Math.LOG10E*He(U),z=Math.LOG10E*He($),y.push(U),H=ft=1,Je=i-1;1<=Je?ft<=Je:ft>=Je;H=1<=Je?++ft:--ft)y.push(ae(10,G+H/i*(z-G)));y.push($)}else if(s.substr(0,1)==="q"){for(y.push(U),H=a=1,ot=i-1;1<=ot?a<=ot:a>=ot;H=1<=ot?++a:--a)B=(Oe.length-1)*H/i,de=_e(B),de===B?y.push(Oe[de]):(he=B-de,y.push(Oe[de]*(1-he)+Oe[de+1]*he));y.push($)}else if(s.substr(0,1)==="k"){for(Y=Oe.length,P=new Array(Y),Me=new Array(i),_t=!0,Z=0,le=null,le=[],le.push(U),H=c=1,st=i-1;1<=st?c<=st:c>=st;H=1<=st?++c:--c)le.push(U+H/i*($-U));for(le.push($);_t;){for(V=_=0,it=i-1;0<=it?_<=it:_>=it;V=0<=it?++_:--_)Me[V]=0;for(H=f=0,lt=Y-1;0<=lt?f<=lt:f>=lt;H=0<=lt?++f:--f){for(wr=Oe[H],F=Number.MAX_VALUE,V=h=0,nt=i-1;0<=nt?h<=nt:h>=nt;V=0<=nt?++h:--h)ve=I(le[V]-wr),ve<F&&(F=ve,X=V);Me[X]++,P[H]=X}for(K=new Array(i),V=m=0,at=i-1;0<=at?m<=at:m>=at;V=0<=at?++m:--m)K[V]=null;for(H=w=0,ct=Y-1;0<=ct?w<=ct:w>=ct;H=0<=ct?++w:--w)D=P[H],K[D]===null?K[D]=Oe[H]:K[D]+=Oe[H];for(V=L=0,dt=i-1;0<=dt?L<=dt:L>=dt;V=0<=dt?++L:--L)K[V]*=1/Me[V];for(_t=!1,V=R=0,Qe=i-1;0<=Qe?R<=Qe:R>=Qe;V=0<=Qe?++R:--R)if(K[V]!==le[H]){_t=!0;break}le=K,Z++,Z>200&&(_t=!1)}for(fe={},V=M=0,et=i-1;0<=et?M<=et:M>=et;V=0<=et?++M:--M)fe[V]=[];for(H=k=0,tt=Y-1;0<=tt?k<=tt:k>=tt;H=0<=tt?++k:--k)D=P[H],fe[D].push(Oe[H]);for(De=[],V=O=0,rt=i-1;0<=rt?O<=rt:O>=rt;V=0<=rt?++O:--O)De.push(fe[V][0]),De.push(fe[V][fe[V].length-1]);for(De=De.sort(function($t,qt){return $t-qt}),y.push(De[0]),H=C=1,yr=De.length-1;C<=yr;H=C+=2)Lt=De[H],!isNaN(Lt)&&y.indexOf(Lt)===-1&&y.push(Lt)}return y},Ne=function(r,s,i){var a,c,_,f;return a=ee(arguments),r=a[0],s=a[1],i=a[2],isNaN(r)&&(r=0),r/=360,r<1/3?(c=(1-s)/3,f=(1+s*re(u*r)/re(l-u*r))/3,_=1-(c+f)):r<2/3?(r-=1/3,f=(1-s)/3,_=(1+s*re(u*r)/re(l-u*r))/3,c=1-(f+_)):(r-=2/3,_=(1-s)/3,c=(1+s*re(u*r)/re(l-u*r))/3,f=1-(_+c)),f=vt(i*f*3),_=vt(i*_*3),c=vt(i*c*3),[f*255,_*255,c*255,a.length>3?a[3]:1]},fr=function(){var r,s,i,a,c,_,f,h;return f=ee(arguments),_=f[0],s=f[1],r=f[2],u=Math.PI*2,_/=255,s/=255,r/=255,c=Math.min(_,s,r),a=(_+s+r)/3,h=1-c/a,h===0?i=0:(i=(_-s+(_-r))/2,i/=Math.sqrt((_-s)*(_-s)+(_-r)*(s-r)),i=Math.acos(i),r>s&&(i=u-i),i/=u),[i*360,h,a]},v.hsi=function(){return function(r,s,i){i.prototype=r.prototype;var a=new i,c=r.apply(a,s);return Object(c)===c?c:a}(e,Le.call(arguments).concat(["hsi"]),function(){})},g.hsi=Ne,e.prototype.hsi=function(){return fr(this._rgb)},Ce=function(r,s,i,a){var c,_,f,h,m,w,L,R,M,k,O,C,P;return a==="hsl"?(C=r.hsl(),P=s.hsl()):a==="hsv"?(C=r.hsv(),P=s.hsv()):a==="hcg"?(C=r.hcg(),P=s.hcg()):a==="hsi"?(C=r.hsi(),P=s.hsi()):(a==="lch"||a==="hcl")&&(a="hcl",C=r.hcl(),P=s.hcl()),a.substr(0,1)==="h"&&(f=C[0],k=C[1],w=C[2],h=P[0],O=P[1],L=P[2]),!isNaN(f)&&!isNaN(h)?(h>f&&h-f>180?c=h-(f+360):h<f&&f-h>180?c=h+360-f:c=h-f,_=f+i*c):isNaN(f)?isNaN(h)?_=Number.NaN:(_=h,(w===1||w===0)&&a!=="hsv"&&(M=O)):(_=f,(L===1||L===0)&&a!=="hsv"&&(M=k)),M==null&&(M=k+i*(O-k)),m=w+i*(L-w),R=v[a](_,M,m)},E=E.concat(function(){var r,s,i,a;for(i=["hsv","hsl","hsi","hcl","lch","hcg"],a=[],s=0,r=i.length;s<r;s++)or=i[s],a.push([or,Ce]);return a}()),Ve=function(r,s,i,a){var c,_;return c=r.num(),_=s.num(),v.num(c+(_-c)*i,"num")},E.push(["num",Ve]),Ae=function(r,s,i,a){var c,_,f;return _=r.lab(),f=s.lab(),c=new e(_[0]+i*(f[0]-_[0]),_[1]+i*(f[1]-_[1]),_[2]+i*(f[2]-_[2]),a)},E.push(["lab",Ae])}).call(ht)});var Ge=new WeakMap,Mr=!0,Co=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,No=Co?5e6:1e7,Ot=0,Ye=0,Sr=performance.now();function Ao(){let e=performance.now(),t=e-Sr,o=Ot,n=Ye*1e3/t,l=1e3/o,d=Ye;return Ot=0,Ye=0,Sr=e,{avg:o,real_fps:n,virtual_fps:l,num_frames:d,elapsed:t}}function Ro(e){Ot=(Ot*Ye+e)/(Ye+1),Ye+=1}var Cr=(e,...t)=>e.map((o,n)=>[o,t[n]]).flat().filter(o=>!!o).join(""),To=()=>{let e,t=new Promise(o=>{e=o});return t.resolve=e,t},Ie=new Map;async function Do(e){return await new Promise(requestAnimationFrame),await Ie.get(e)}async function Nr(e,t){if(Ie.has(e)&&(await Ie.get(e),Ie.has(e))){await Ie.get(e);return}Ie.set(e,To());try{return await t()}finally{let o=Ie.get(e);Ie.delete(e),o.resolve()}}var Io=":host{position:absolute;top:0px;left:0px;right:0px;bottom:0px;overflow:scroll;overflow-anchor:none;overscroll-behavior:none;-webkit-overflow-scrolling:touch;}div.rt-virtual-panel{position:absolute;top:0;left:0;right:0;pointer-events:none;}div.rt-scroll-table-clip{position:sticky;contain:strict;overflow-anchor:none;width:100%;height:100%;}div.rt-tree-container{display:flex;align-items:center;height:100%;}slot{position:absolute;overflow:hidden;overflow-anchor:none;}",Wo=":host ::slotted(table){--regular-table--transform-x:0px;--regular-table--transform-y:0px;--regular-table--clip-x:0px;--regular-table--clip-y:0px;}",Po=class extends HTMLElement{create_shadow_dom(){this.attachShadow({mode:"open"});let e="<slot></slot>";this.shadowRoot.innerHTML=Cr`
            <style>
                ${Io}
            </style>
            <style>
                ${Wo}
            </style>
            <div class="rt-virtual-panel"></div>
            <div class="rt-scroll-table-clip">${e}</div>
        `;let[,t,o,n]=this.shadowRoot.children;this._sub_cell_style=t,this._table_clip=n,this._virtual_panel=o,this._setup_virtual_scroll()}_setup_virtual_scroll(){this._table_clip&&(this._virtual_mode==="both"||this._virtual_mode==="vertical"?this._table_clip.style.top="0px":this._table_clip.style.removeProperty("top"),this._virtual_mode==="both"||this._virtual_mode==="horizontal"?this._table_clip.style.left="0px":this._table_clip.style.removeProperty("left"),this._virtual_mode!=="both"?this._table_clip.style.contain="none":this._table_clip.style.removeProperty("contain"))}_calculate_viewport(e,t){let{start_row:o,end_row:n}=this._calculate_row_range(e),{start_col:l,end_col:d}=this._calculate_column_range(t);return this._nrows=e,{start_col:l,end_col:d,start_row:o,end_row:n}}_calculate_row_range(e){let{height:t}=this._container_size,o=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length,l=Math.max(1,this._virtual_panel.offsetHeight-t),d=Math.max(Math.ceil(this.scrollTop),0)/l,u=t/o-n,p=Math.max(0,(e||0)-u)*d,b=Math.max(0,Math.min(p+u,e));return{start_row:p,end_row:b}}_calc_start_column(){let e=this._view_cache.config.row_pivots.length,t=0,o=0,n=0;for(;o<this.scrollLeft;){let l=this._column_sizes.indices[t+e];n=this.scrollLeft-o,t+=1,o+=l!==void 0?l:60}return t+=n/(this._column_sizes.indices[t+e-1]||60),Math.max(0,t-1)}_calculate_column_range(e){if(this._virtual_mode==="none"||this._virtual_mode==="vertical")return{start_col:0,end_col:1/0};{let t=this._calc_start_column(),o=this.table_model.num_columns()||Math.min(e,Math.ceil(this._container_size.width/60)),n=t+o+1;return{start_col:t,end_col:n}}}_max_scroll_column(e){let t=0;if(this._view_cache.config.row_pivots.length>0)for(let l of this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length))t+=l;let o=this._view_cache.config.row_pivots.length,n=e;for(;t<this._container_size.width&&n>=0;)n--,t+=this._column_sizes.indices[n+o]||60;return Math.min(e-1,n+1)}_validate_viewport({start_col:e,end_col:t,start_row:o,end_row:n}){o=Math.floor(o),n=Math.ceil(n),e=Math.floor(e),t=Math.ceil(t);let l=this._start_col!==e,d=this._start_row!==o||this._end_row!==n||this._end_col!==t;return this._start_col=e,this._end_col=t,this._start_row=o,this._end_row=n,{invalid_column:l,invalid_row:d}}_calc_scrollable_column_width(e){let t=this._view_cache.config.row_pivots.length,o=this._max_scroll_column(e),n=t,l=0;for(;n<o+t;)l+=this._column_sizes.indices[n]||60,n++;if(n<this._column_sizes.indices.length){let d=this._column_sizes.indices.slice(0,this._view_cache.config.row_pivots.length).reduce((u,p)=>u+p,0);l+=Math.max(0,this._column_sizes.indices[n]-(this._container_size.width-d)||0)}return l}_update_virtual_panel_width(e,t){if(e)if(this._virtual_mode==="vertical"||this._virtual_mode==="none")this._virtual_panel.style.width=this._column_sizes.indices.reduce((o,n)=>o+n,0)+"px";else{let o=this._calc_scrollable_column_width(t);if(o!==0){let n=this._container_size.width+o+2;this._virtual_panel.style.width=n+"px"}else this._virtual_panel.style.width="1px"}}_update_virtual_panel_height(e){let{row_height:t=19}=this._column_sizes,o=this._view_cache.config.column_pivots.length*t,n;n=Math.min(No,e*t+o),this._virtual_panel.style.height=`${n}px`}async draw(e={}){return typeof e.throttle<"u"&&!e.throttle?await Or.call(this,e):await Nr(this,()=>Or.call(this,e))}async _draw_flush(){await Do(this)}update_sub_cell_offset(e){let t=this._column_sizes.row_height*(e.start_row%1)||0,o=this._column_sizes.indices[(this.table_model._row_headers_length||0)+Math.floor(e.start_col)]*(e.start_col%1)||0,n=this._sub_cell_style.sheet?.cssRules[0].style;n&&(n.setProperty("--regular-table--clip-x",`${o}px`),n.setProperty("--regular-table--clip-y",`${t}px`),n.setProperty("--regular-table--transform-x",`-${o}px`),n.setProperty("--regular-table--transform-y",`-${t}px`))}};async function Or(e){let t=Mr&&performance.now(),{invalid_viewport:o=!0,preserve_width:n=!1}=e,{num_columns:l,num_rows:d,num_row_headers:u,num_column_headers:p,row_height:b}=await this._view_cache.view(0,0,0,0);u!==void 0&&(this._view_cache.row_pivots=Array(u).fill(0)),p!==void 0&&(this._view_cache.column_pivots=Array(p).fill(0)),this._container_size={width:this._virtual_mode==="none"||this._virtual_mode==="vertical"?1/0:this._table_clip.clientWidth,height:this._virtual_mode==="none"||this._virtual_mode==="horizontal"?1/0:this._table_clip.clientHeight},this._update_virtual_panel_height(d),n||this._update_virtual_panel_width(o,l);let x=this._calculate_viewport(d,l),{invalid_row:g,invalid_column:E}=this._validate_viewport(x);if(this._invalid_schema||g||E||o){let I=[],T=!0;for await(let S of this.table_model.draw(this._container_size,this._view_cache,this._selected_id,n,x,l)){S!==void 0&&(I=I.concat(S)),T&&(this.update_sub_cell_offset(x),T=!1),this._is_styling=!0;let W=this._style_callbacks;for(let A of W)await A({detail:this});if(this._is_styling=!1,!this._invalidated&&S!==void 0)break;this._invalidated=!1}this.table_model.autosize_cells(I,b),this.table_model.header.reset_header_cache(),n||this._update_virtual_panel_width(this._invalid_schema||E,l),this._invalid_schema=!1}else this.update_sub_cell_offset(x);Mr&&Ro(performance.now()-t)}var Fo=!1,Uo=class extends Po{register_listeners(){this.addEventListener("mousedown",this._on_click_or_dblclick.bind(this)),this.addEventListener("scroll",this._on_scroll.bind(this),{passive:!0}),this._register_glitch_scroll_listeners()}async _on_scroll(e){e.stopPropagation(),await this.draw({invalid_viewport:!1}),this.dispatchEvent(new CustomEvent("regular-table-scroll"))}_register_glitch_scroll_listeners(){this.addEventListener("mousewheel",this._on_mousewheel.bind(this)),Fo&&(this.addEventListener("touchmove",this._on_touchmove.bind(this)),this.addEventListener("touchstart",this._on_touchstart.bind(this),{passive:!0}))}_on_mousewheel(e){if(!window.safari)return;let{clientWidth:t,clientHeight:o,scrollTop:n,scrollLeft:l}=this;e.preventDefault(),e.returnValue=!1;let d=Math.max(1,this._virtual_panel.offsetHeight-o),u=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.max(0,Math.min(d,n+e.deltaY)),this.scrollLeft=Math.max(0,Math.min(u,l+e.deltaX)),this._on_scroll(e)}_on_touchmove(e){e.stopPropagation(),e.preventDefault(),e.returnValue=!1;let{clientWidth:t,clientHeight:o}=this,n=Math.max(1,this._virtual_panel.offsetHeight-o),l=Math.max(1,this._virtual_panel.offsetWidth-t);this.scrollTop=Math.min(n,this._memo_scroll_top+(this._memo_touch_startY-e.touches[0].pageY)),this.scrollLeft=Math.min(l,this._memo_scroll_left+(this._memo_touch_startX-e.touches[0].pageX)),this._on_scroll(e)}_on_touchstart(e){this._memo_touch_startY=e.touches[0].pageY,this._memo_touch_startX=e.touches[0].pageX,this._memo_scroll_top=this.scrollTop,this._memo_scroll_left=this.scrollLeft}async _on_dblclick(e){let t=e.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let o=e.target.classList.contains("rt-column-resize"),n=Ge.get(t);if(o){e.stopImmediatePropagation(),t.style.minWidth="",t.style.maxWidth="",e.shiftKey?(this._column_sizes.override=[],this._column_sizes.auto=[],this._column_sizes.indices=[]):(this._column_sizes.override[n.size_key]=void 0,this._column_sizes.auto[n.size_key]=void 0,this._column_sizes.indices[n.size_key]=void 0);for(let l of e.shiftKey?[this.table_model.header.cells[this.table_model.header.cells.length-1],...this.table_model.body.cells]:this.table_model.body.cells)for(let d of e.shiftKey?l:[l[n._virtual_x]])d&&(d.style.minWidth="",d.style.maxWidth="",d.classList.remove("rt-cell-clip"));await this.draw()}}async _on_click(e){if(e.button!==0)return;let t=e.target;for(;t.tagName!=="TD"&&t.tagName!=="TH";)if(t=t.parentElement,!this.contains(t))return;let o=e.target.classList.contains("rt-column-resize"),n=Ge.get(t);o&&(this._on_resize_column(e,t,n),e.stopImmediatePropagation())}async _on_click_or_dblclick(e){let t=performance.now();this._last_clicked_time&&t-this._last_clicked_time<500?(this._last_clicked_time=t,await this._on_dblclick(e)):(this._last_clicked_time=t,await this._on_click(e))}_on_resize_column(e,t,o){let{_virtual_x:n,size_key:l}=o,d=e.pageX,u=n+t.colSpan-1,p=this.table_model.header.get_column_header(u),b=this._column_sizes.indices[l],x=E=>Nr(this,async()=>await this._on_resize_column_move(E,p,d,b,l,u)),g=()=>{document.removeEventListener("mousemove",x),document.removeEventListener("mouseup",g);let E=this._column_sizes.override[l],I=this._column_sizes.indices[l]!==E;this._column_sizes.indices[l]=E,I&&this.draw()};document.addEventListener("mousemove",x),document.addEventListener("mouseup",g)}async _on_resize_column_move(e,t,o,n,l,d){await new Promise(requestAnimationFrame);let u=e.pageX-o,p=Math.max(1,n+u);if(this._column_sizes.override[l]=p,u<0)await this.draw({preserve_width:!0,throttle:!1});else{t.style.minWidth=p+"px",t.style.maxWidth=p+"px";let b=this._column_sizes.auto[l];for(let x of this.table_model.body.cells){let g=x[d];g&&(g.style.maxWidth=g.style.minWidth=p+"px",g.classList.toggle("rt-cell-clip",b>p))}}}},jo=class{constructor(e){this._name=e,this._elements=[],this._index=0}reset(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let e=this._elements[this._index];return this._index+=1,e}},Ar=class{constructor(e,t,o){this._column_sizes=e,this._container=t,this._span_factory=new jo("span"),this.table=o,this.cells=[],this.rows=[]}num_columns(){return this._get_row(Math.max(0,this.rows.length-1)).row_container.length}num_rows(){return this.cells.length}_set_metadata(e,t){Ge.set(e,t)}_get_or_create_metadata(e){if(e===void 0)return{};if(Ge.has(e))return Ge.get(e);{let t={};return Ge.set(e,t),t}}_replace_cell(e,t){let{tr:o,row_container:n}=this._get_row(e),l=n[t];return l&&(o.removeChild(l),n.splice(t,1,void 0)),l}_fetch_cell(e,t){if(!(e<0||t<0))return this.cells[e]?.[t]}_get_row(e){let t=this.rows[e];t||(t=this.rows[e]=document.createElement("tr"),this.table.appendChild(t));let o=this.cells[e];return o||(o=this.cells[e]=[]),{tr:t,row_container:o}}_get_cell(e="TD",t,o){let{tr:n,row_container:l}=this._get_row(t),d=l[o];if(d||(o<l.length?(d=l[o]=document.createElement(e),n.insertBefore(d,l.slice(o+1).find(u=>u))):(d=l[o]=document.createElement(e),n.appendChild(d))),d.tagName!==e){let u=document.createElement(e);n.replaceChild(u,d),this.cells[t].splice(o,1,u),d=u}return d}_clean_columns(e){for(let t=0;t<this.rows.length;t++){let o=this.rows[t],n=this.cells[t];this.cells[t]=n.slice(0,e[t]||e);let l=this.cells[t].filter(d=>d!==void 0).length;for(;o.children[l];)o.removeChild(o.children[l])}}_clean_rows(e){for(;this.table.children[e];)this.table.removeChild(this.table.children[e]);this.rows=this.rows.slice(0,e),this.cells=this.cells.slice(0,e)}},Ho=class extends Ar{constructor(...e){super(...e),this._group_header_cache=[],this._offset_cache=[]}_draw_group_th(e,t,o){let n=this._get_cell("TH",t,e[t]||0);if(e[t]+=1,n.removeAttribute("colspan"),n.style.minWidth="0",n.textContent="",o instanceof HTMLElement)n.appendChild(o);else{let d=this._span_factory.get("span");d.textContent=o,n.appendChild(d)}let l=this._span_factory.get("span");return l.className="rt-column-resize",n.appendChild(l),n}_draw_group(e,t,o){let n=this._get_or_create_metadata(o);return n.column_header=e,n.value=t,n.value=t,n}_draw_th(e,t,o,n,l){let d=this._get_or_create_metadata(o);if(d.column_header=e,d.value=t,d.size_key=l.length?l[0]:l,!(l.length>1)){let u=this._column_sizes.override[d.size_key],p=this._column_sizes.auto[d.size_key];u?(o.classList.toggle("rt-cell-clip",p>u),o.style.minWidth=u+"px",o.style.maxWidth=u+"px"):p?(o.classList.remove("rt-cell-clip"),o.style.maxWidth="",o.style.minWidth=p+"px"):(o.style.maxWidth="",o.style.maxWidth="")}return d}get_column_header(e){return this._get_cell("TH",this.num_rows()-1,e)}draw(e,t,o,n,l,d,u,p,b){let x=t?.length;if(x===0)return;let g,E,I,T;p=typeof p>"u"?x-1:p;for(let S=0;S<x;S++){if(I=t[S]?t[S]:"",this._offset_cache[S]=this._offset_cache[S]||0,S<p)b&&this._group_header_cache?.[S]?.[0]?.value===I?(g=this._group_header_cache[S][1],this._group_header_cache[S][2]+=1,o===1&&(this._group_header_cache[S][0].row_header_x=l),g.setAttribute("colspan",this._group_header_cache[S][2])):(g=this._draw_group_th(this._offset_cache,S,I),E=this._draw_group(t,I,g),this._group_header_cache[S]=[E,g,1]);else{g=this._draw_group_th(this._offset_cache,S,I),E=this._draw_th(e||t,I,g,n,l),typeof T>"u"&&(T={th:g,metadata:E});for(let[W]of this._group_header_cache)W.size_key=E.size_key;g.removeAttribute("colspan")}this._get_row(S).tr.classList.toggle("rt-autosize",S===p),g.classList.toggle("rt-group-corner",n===void 0),E&&(E.x=typeof n>"u"?n:Math.floor(n),E.column_header_y=S,E.x0=Math.floor(d),E._virtual_x=u,o===1&&(E.row_header_x=l))}return this._clean_rows(this._offset_cache.length),T=T||{th:g,metadata:E},T}clean(){this._clean_columns(this._offset_cache)}reset_header_cache(){this._offset_cache=[],this._group_header_cache=[]}},Go=class extends Ar{_draw_td(e,t,o,n,{column_name:l},{ridx_offset:d},u){let p=this._get_cell(e,t,n),b=this._get_or_create_metadata(p);b.y=t+Math.floor(d),b.size_key=u,e==="TD"&&(b.column_header=l);let x=this._column_sizes.override[b.size_key];if(x){let g=this._column_sizes.auto[b.size_key];p.classList.toggle("rt-cell-clip",g>x),p.style.minWidth=x+"px",p.style.maxWidth=x+"px"}else p.classList.remove("rt-cell-clip"),p.style.minWidth="",p.style.maxWidth="";return b.value!==o&&(o instanceof HTMLElement?(p.textContent="",p.appendChild(o)):p.textContent=o),b.value=o,{td:p,metadata:b}}draw(e,t,o,n=!1,l,d,u,p){let{cidx:b,column_data:x,row_headers:g,column_data_listener_metadata:E}=t,{row_height:I}=o,T,S=[],W=[],A=0,q=[];for(let j=0;j<(n?o.row_headers_length:1);j++){A=0;for(let v of x){let te=g?.[A],N;if(n){let ue=v[j],re=this._fetch_cell(A-(S[j]||1),b+j),ze=this._get_or_create_metadata(re),J=this._fetch_cell(A,b+j-(q[A]||1)),oe=this._get_or_create_metadata(J);p&&J&&(oe.value===ue||ue===void 0)&&!J.hasAttribute("rowspan")?(q[A]=q[A]?q[A]+1:2,J.setAttribute("colspan",q[A]),this._replace_cell(A,b+j)):p&&re&&ze.value===ue&&!re.hasAttribute("colspan")?(S[j]=S[j]?S[j]+1:2,re.setAttribute("rowspan",S[j]),this._replace_cell(A,b+j)):(N=this._draw_td("TH",A,ue,b+j,t,o,j),N.td.style.display="",N.td.removeAttribute("rowspan"),N.td.removeAttribute("colspan"),N.metadata.row_header=v,N.metadata.row_header_x=j,N.metadata.y0=Math.floor(o.ridx_offset),N.metadata.y1=Math.ceil(o.y1),N.metadata._virtual_x=j,typeof d<"u"&&(N.metadata.x0=Math.floor(d)),S[j]=1,q[A]=1,W[j]=N)}else N=this._draw_td("TD",A,v,b,t,o,u),E&&(N.metadata.user=E[A]),N.metadata.x=typeof l>"u"?l:Math.floor(l),N.metadata.x1=Math.ceil(o.x1),N.metadata.row_header=te||[],N.metadata.y0=Math.floor(o.ridx_offset),N.metadata.y1=Math.ceil(o.y1),N.metadata.dx=Math.floor(l-d),N.metadata.dy=N.metadata.y-Math.floor(N.metadata.y0),N.metadata._virtual_x=b,typeof d<"u"&&(N.metadata.x0=Math.floor(d)),W[0]=N;if(A++,T=N?N.metadata:T,I=I||N?.td.offsetHeight,A*I>e)break}}return this._clean_rows(A),{tds:W,ridx:A,metadata:T,row_height:I}}clean({ridx:e,cidx:t}){this._clean_rows(e),this._clean_columns(t)}},zr=class{constructor(e,t,o){this.clear(o);let[n]=o.children,[l,d]=n.children;this.table=n,this._column_sizes=t,this.header=new Ho(t,e,l),this.body=new Go(t,e,d),this.fragment=document.createDocumentFragment()}num_columns(){return this.header.num_columns()}clear(e){e.innerHTML=Cr`
            <table cellspacing="0">
                <thead></thead>
                <tbody></tbody>
            </table>
        `}autosize_cells(e,t){for(;e.length>0;){let[o,n]=e.pop(),l=o.getBoundingClientRect();this._column_sizes.row_height=t||Math.max(10,Math.min(this._column_sizes.row_height||l.height,l.height)),this._column_sizes.indices[n.size_key]=l.width;let d=this._column_sizes.override[n.size_key]!==void 0;l.width&&!d&&(this._column_sizes.auto[n.size_key]=l.width),o.style.minWidth==="0px"&&(o.style.minWidth=`${l.width}px`)}}async*draw(e,t,o,n,l,d){let{width:u,height:p}=e,{view:b,config:x}=t,{data:g,row_headers:E,column_headers:I,metadata:T,num_row_headers:S,num_column_headers:W,column_header_merge_depth:A,merge_headers:q="both"}=await b(Math.floor(l.start_col),Math.floor(l.start_row),Math.ceil(l.end_col),Math.ceil(l.end_row));S!==void 0&&(this._view_cache.row_pivots=Array(S).fill(0)),W!==void 0&&(this._view_cache.column_pivots=Array(W).fill(0));let j=q==="both"||q==="row",v=q==="both"||q==="column",{start_row:te=0,start_col:N=0,end_col:ue=0,end_row:re=0}=l;E&&(this._row_headers_length=E.reduce((se,Ne)=>Math.max(se,Ne.length),0),E=E.map(se=>(se.length=this._row_headers_length,se))),t.config.column_pivots=Array(I?.[0]?.length||0).fill(0),t.config.row_pivots=Array(E?.[0]?.length||0).fill(0);let ze=this._column_sizes.indices[(this._row_headers_length||0)+Math.floor(l.start_col)]||0,J={viewport_width:0,selected_id:o,ridx_offset:te,sub_cell_offset:ze,x0:N,x1:ue,y1:re,row_height:this._column_sizes.row_height,row_headers_length:this._row_headers_length},oe,ie=0,_e=[],Fe=!0;if(E?.length>0){let se=x.row_pivots.join(","),Ne={column_name:se,cidx:0,column_data:E,row_headers:E,first_col:Fe},Ue=ie+Math.floor(N);oe=this.body.draw(p,Ne,{...J,x0:0},!0,void 0,void 0,Ue,j);let Se=[];for(let ce=0;ce<t.config.row_pivots.length;ce++){let pe=this.header.draw(se,Array(t.config.column_pivots.length).fill(""),1,void 0,ce,N,ce,A,v);pe&&Se.push(pe)}if(Fe=!1,J.viewport_width+=Se.reduce((ce,{th:pe},Ce)=>ce+(this._column_sizes.indices[Ce]||pe.offsetWidth),0),J.row_height=J.row_height||oe.row_height,ie=E[0].length,!n)for(let ce=0;ce<t.config.row_pivots.length;ce++){let{td:pe,metadata:Ce}=oe.tds[ce]||{},{th:Ae,metadata:Re}=Se[ce]||{};(pe||Ae)&&_e.push([Ae||pe,Re||Ce])}}try{let se=0,Ne=d-l.start_col;for(;se<Ne;){if(!g[se]){let ye=Math.max(l.end_col,0);l.start_col=ye;let Ee=0,je=0;for(;this._column_sizes.indices.length>ie+N+Ee+1&&je+J.viewport_width<u;)Ee++,je+=this._column_sizes.indices[ie+N+Ee];if(je+J.viewport_width<u){let me=Math.min(d,ye+5);l.end_col=Math.max(1,Math.min(d,me))}else l.end_col=Math.max(1,Math.min(d,ye+Ee));let qe=b(Math.floor(l.start_col),Math.floor(l.start_row),Math.ceil(l.end_col),Math.ceil(l.end_row));yield void 0;let ge=await qe;if(typeof ge.column_header_merge_depth<"u"&&(A=ge.column_header_merge_depth),typeof ge.merge_headers<"u"&&(q=ge.merge_headers),ge.data.length===0){yield _e;return}l.end_col=l.start_col+ge.data.length;for(let me=0;me<ge.data.length;me++)g[se+me]=ge.data[me],ge.metadata&&(T[se+me]=ge.metadata[me]),I&&(I[se+me]=ge.column_headers?.[me])}let Ue=I?.[se]||"",Se=g[se],ce=T?.[se],pe={column_name:Ue,cidx:ie,column_data:Se,column_data_listener_metadata:ce,row_headers:E,first_col:Fe},Ce=se+N,Ae=ie+Math.floor(N),Re=this.header.draw(void 0,Ue,void 0,Ce,Ae,N,ie,A,v);if(oe=this.body.draw(p,pe,J,!1,Ce,N,Ae,j),Fe=!1,!n)for(let{td:ye,metadata:Ee}of oe.tds)_e.push([Re?.th||ye,Re?.metadata||Ee]);let Ve=this._column_sizes.indices[ie+Math.floor(N)];if(Ve?J.viewport_width+=Ve:J.viewport_width+=Re?.th?.offsetWidth||oe.tds.reduce((ye,Ee)=>ye+Ee.td?.offsetWidth,0),J.row_height=J.row_height||oe.row_height,ie++,se++,J.viewport_width-J.sub_cell_offset>u){this.body.clean({ridx:oe?.ridx||0,cidx:ie}),this.header.clean(),yield _e,J.viewport_width=0;for(let[ye]of _e)J.viewport_width+=ye.offsetWidth;if(J.viewport_width-J.sub_cell_offset>u)return}}this.body.clean({ridx:oe?.ridx||0,cidx:ie}),this.header.clean(),yield _e}finally{this.body.clean({ridx:oe?.ridx||0,cidx:ie}),this.header.clean(),this.body._span_factory.reset(),this.header._span_factory.reset()}}},$o=["both","horizontal","vertical","none"],qo=class extends Uo{constructor(){super(),this._column_sizes={auto:[],override:[],indices:[]},this._style_callbacks=[],this._initialized=!1}connectedCallback(){this._initialized||(this.create_shadow_dom(),this.register_listeners(),this.setAttribute("tabindex","0"),this._initialized=!0,this.table_model=new zr(this._table_clip,this._column_sizes,this))}_reset_viewport(){this._start_row=void 0,this._end_row=void 0,this._start_col=void 0,this._end_col=void 0}_reset_scroll(){this._column_sizes.indices=[],this.scrollTop=0,this.scrollLeft=0,this._reset_viewport()}_resetAutoSize(){this._column_sizes.auto=[],this._column_sizes.override=[],this._column_sizes.indices=[];for(let e=0;e<this.table_model.header.num_columns();e++){let t=this.table_model.header.get_column_header(e);t.style.minWidth="",t.style.maxWidth=""}}clear(){this.table_model=new zr(this._table_clip,this._column_sizes,this)}addStyleListener(e){this._style_callbacks=this._style_callbacks.concat(e);let t=!0;return()=>{if(!t)return;t=!1;let o=this._style_callbacks=this._style_callbacks.slice(),n=o.indexOf(e);o.splice(n,1)}}removeStyleListener(e){let t=this._style_callbacks.length;this._style_callbacks=this._style_callbacks.filter(o=>o!==e),console.assert(this._style_callbacks.length===t-1,"No listener found")}invalidate(){if(!this._is_styling)throw new Error("Cannot call `invalidate()` outside of a `StyleListener`");this._invalidated=!0}getMeta(e){if(!(typeof e>"u")){if(e instanceof HTMLElement)return Ge.get(e);if(e.row_header_x>=0){if(e.row_header_x<this._view_cache.config.row_pivots.length){let t=this.table_model.body._fetch_cell(e.y,e.row_header_x);return this.getMeta(t)}}else if(e.column_header_y>=0){if(e.column_header_y<this._view_cache.config.column_pivots.length){let t=this.table_model.body._fetch_cell(e.column_header_y,e.y);return this.getMeta(t)}}else return this.getMeta(this.table_model.body._fetch_cell(e.dy,e.dx+this.table_model._row_headers_length))}}getDrawFPS(){return Ao()}async scrollToCell(e,t){if(!this._view_cache){console.warn("data listener not configured");return}let o=this._column_sizes.row_height||19,n=this._view_cache.config.column_pivots.length*o,l=(this._table_clip.offsetHeight-n)%o,d=(this._virtual_panel.offsetHeight-l)/this._nrows;this.scrollTop=Math.ceil(d*t);let u=0;for(;e>0;)e--,u+=this._column_sizes.indices[e+this._view_cache.config.row_pivots.length]||60;this.scrollLeft=Math.ceil(u),await new Promise(requestAnimationFrame),await this._draw_flush()}setDataListener(e,{virtual_mode:t="both",preserve_state:o=!1}={}){if(console.assert($o.indexOf(t)>-1,`Unknown virtual_mode ${t};  valid options are "both" (default), "horizontal", "vertical" or "none"`),o)console.assert(!virtual_mode_changed,"preserve_state called with modified virtual_mode"),this._view_cache.view=e;else{let n=this._virtual_mode=t,l={row_pivots:[],column_pivots:[]};this._virtual_mode=t,this._invalid_schema=!0,this._view_cache={view:e,config:l},n&&this._setup_virtual_scroll()}}__noop_jsdoc_hints(){}};document.createElement("regular-table").constructor===HTMLElement&&window.customElements.define("regular-table",qo);var zt='regular-table{padding:0;margin:12px 0 0 12px;font-family:inherit;--rt-hover--border-color:var(--inactive--color,#c5c9d080);}regular-table div[tabindex]{outline:none;}regular-table>div{position:absolute;top:0;left:0;right:0;bottom:0;overflow:hidden;}regular-table th{text-align:center;}regular-table thead tr:not(.rt-autosize) th{overflow:hidden;max-width:0px;}regular-table thead tr:last-child .rt-float,regular-table tbody .rt-float{text-align:right;}regular-table thead .rt-integer,regular-table tbody .rt-integer{text-align:right;}regular-table tbody th{text-align:left;}regular-table span.rt-tree-container{display:flex;align-items:center;height:100%;}regular-table thead .rt-string,regular-table tbody .rt-string,regular-table thead .rt-date,regular-table tbody .rt-date,regular-table thead .rt-datetime,regular-table tbody .rt-datetime{text-align:left;}regular-table thead tr:last-child th{border-bottom:1px solid#8b868045;}regular-table tbody tr:first-child td,regular-table tbody tr:first-child th{border-top:1px solid transparent!important;}regular-table th{position:relative;}regular-table tr th span.rt-tree-group{margin-left:5px;margin-right:15px;border-left:1px solid#eee;height:100%;}regular-table td,regular-table th{white-space:nowrap;font-size:12px;padding-right:5px;padding-left:5px;padding-top:0px;padding-bottom:0px;height:19px;}regular-table table *{box-sizing:border-box;}regular-table table{position:absolute;color:#666;outline:none;}regular-table span.rt-row-header-icon{color:#aaa;padding-right:4px;font-family:var(--button--font-family);}regular-table span.rt-column-header-icon{font-size:10px;padding-left:3px;display:inline-block;width:10px;font-family:var(--button--font-family);}regular-table span.rt-row-header-icon:hover{color:#1a7da1;text-shadow:0px 0px 3px#1a7da1;}regular-table .rt-selected td{background-color:#eee;}regular-table .rt-cell-clip{overflow:hidden;text-overflow:ellipsis;}regular-table td span.rt-group-name,regular-table th span.rt-group-name{margin-right:-5px;padding-right:5px;padding-left:8px;flex:1;height:100%;}regular-table th span.rt-group-name{text-align:left;}regular-table td th span.rt-group-leaf,regular-table th span.rt-group-leaf{margin-left:16px;height:100%;}regular-table .rt-column-resize{height:100%;width:10px;position:absolute;top:0;right:0;cursor:col-resize;}regular-table a{color:var(--rt-pos-cell--color);}regular-table a:visited{color:var(--active--color);}.psp-header-border:not(.psp-is-top):not(.psp-header-leaf){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-group{box-shadow:0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-is-top{box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045);}.psp-is-top.psp-header-group:not(.psp-header-group-corner){box-shadow:5px 4px 0px -4px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}.psp-header-border.psp-header-group:not(.psp-is-top):not(.psp-header-group-corner){box-shadow:1px 0px var(--inactive--border-color,#8b868045),0px 10px 0 -9px var(--inactive--border-color,#8b868045);}perspective-viewer[settings] tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer[settings]) tr.rt-autosize .psp-header-leaf.psp-header-border:not(.psp-menu-enabled){box-shadow:1px 0px var(--inactive--border-color,#8b868045);}.psp-header-leaf.psp-header-border{box-shadow:5px -4px 0px -4px var(--inactive--border-color,#8b868045);}tr:only-child th{box-shadow:none!important;}regular-table tbody tr:hover th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover:after{border-color:var(--rt-hover--border-color,#c5c9d080)!important;background-color:transparent;box-shadow:0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:hover th.psp-tree-leaf.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover th.psp-tree-label.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr.psp-menu-open:hover:after{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:last-child:hover td.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color),0px 1px 0px var(--rt-hover--border-color,#c5c9d080);}regular-table tbody tr:hover+tr th.psp-tree-leaf:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr th.psp-tree-label:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td:not(.psp-row-selected):not(.psp-row-subselected){border-top-color:transparent;}regular-table tbody tr th:first-child:not(:empty),regular-table tbody tr th:first-child:empty+th:not(:empty),regular-table tbody tr th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr td:first-child{border-left-width:1px;border-left-color:transparent;}regular-table tbody tr th:last-child,regular-table tbody tr td:last-child{border-right-width:0px;border-right-color:transparent;}regular-table tbody tr:hover{color:inherit;}regular-table tbody tr:hover th:first-child:not(:empty),regular-table tbody tr:hover th:first-child:empty+th:not(:empty),regular-table tbody tr:hover th:first-child:empty~th:empty+th:not(:empty),regular-table tbody tr:hover td:first-child{border-left-color:var(--rt-hover--border-color,#c5c9d080)!important;}regular-table tbody tr:hover th:last-child,regular-table tbody tr:hover td:last-child{border-right-color:var(--rt-hover--border-color,#c5c9d080)!important;}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody td,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead th:not(.rt-group-corner){transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody{transform:translate(0,var(--regular-table--transform-y,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td,perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child th,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child th{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:first-child td:first-of-type,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:first-child td:first-of-type{clip-path:polygon(var(--regular-table--clip-x,0)var(--regular-table--clip-y,0),var(--regular-table--clip-x,0)200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr:last-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr:last-child:after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:not(:first-child):after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:not(:first-child):after{transform:translate(var(--regular-table--transform-x,0px));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table tbody tr:hover:first-child:after,:host(:not(.sub-cell-scroll-disabled)) regular-table table tbody tr:hover:first-child:after{clip-path:polygon(0 var(--regular-table--clip-y,0),0 200%,200% 200%,200% var(--regular-table--clip-y,0));}perspective-viewer-datagrid:not(.sub-cell-scroll-disabled) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner),:host(:not(.sub-cell-scroll-disabled)) regular-table table thead tr th.rt-group-corner+th:not(.rt-group-corner){clip-path:polygon(var(--regular-table--clip-x,0)0,var(--regular-table--clip-x,0)200%,200% 200%,200% 0);}regular-table{outline:none;}regular-table::-webkit-scrollbar,regular-table::-webkit-scrollbar-corner{background-color:transparent;height:12px;width:12px;}regular-table::-webkit-scrollbar-thumb{background-clip:content-box;background:var(--icon--color);border:5.5px solid var(--plugin--background);max-height:50%;max-width:50%;min-width:10%;min-height:10%;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th{height:0px;}perspective-viewer:not([settings]) regular-table table tr.rt-autosize+tr th span{display:none;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th{height:0px;}:host-context(perspective-viewer:not([settings])) regular-table table tr.rt-autosize+tr th span{display:none;}perspective-viewer[settings] .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}perspective-viewer[settings] .psp-menu-enabled:hover,perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}perspective-viewer[settings] tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}perspective-viewer[settings] td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}perspective-viewer[settings] tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}perspective-viewer[settings] tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) .psp-menu-enabled{padding:0 6px;font-size:8px;border-radius:3px 3px 0 0;}:host-context(perspective-viewer[settings]) .psp-menu-enabled:hover,:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open{color:var(--plugin--background);background-color:var(--icon--color);border-bottom-color:var(--icon--color);cursor:pointer;}:host-context(perspective-viewer[settings]) tr:not(.rt-autosize) th.psp-menu-open:before{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;height:8px;width:10px;-webkit-mask-image:var(--column-settings-icon--mask-image);mask-image:var(--column-settings-icon--mask-image);margin-right:4px;background-color:var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color);}:host-context(perspective-viewer[settings]) tr:first-child td.psp-menu-open{border-top-color:var(--icon--color)!important;}:host-context(perspective-viewer[settings]) tr:last-child td.psp-menu-open{box-shadow:inset -2px 0px 0px var(--icon--color),inset 2px 0px 0px var(--icon--color),inset 0px -2px 0px var(--icon--color);}perspective-viewer regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}:host-context(perspective-viewer) regular-table table thead tr:last-child th{border-bottom-width:1px;border-bottom-color:var(--inactive--border-color,#8b868045);}.psp-sort-enabled:hover{cursor:pointer;}.psp-row-selected,:hover .psp-row-selected,:hover th.psp-tree-leaf.psp-row-selected,:hover th.psp-tree-label.psp-row-selected{color:white!important;background-color:#ea7319!important;border-color:#ea7319!important;}.psp-row-selected.psp-tree-label:not(:hover):before{color:white;}.psp-row-subselected,:hover .psp-row-subselected,:hover th.psp-tree-leaf.psp-row-subselected,:hover th.psp-tree-label.psp-row-subselected{background:rgba(234,115,25,0.2)!important;}.psp-error{color:red;}td:focus{outline:#666;outline-style:dotted;outline-width:1px;}perspective-viewer.dragging regular-table{pointer-events:none;}:host-context(perspective-viewer.dragging) regular-table{pointer-events:none;}.psp-header-border:last-child{border-right-width:0px;}.psp-header-sort-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-desc-icon--mask-image);mask-image:var(--sort-desc-icon--mask-image);}.psp-header-sort-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-asc-icon--mask-image);mask-image:var(--sort-asc-icon--mask-image);}.psp-header-sort-col-desc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-desc-icon--mask-image);mask-image:var(--sort-col-desc-icon--mask-image);}.psp-header-sort-col-asc:after{background-repeat:no-repeat;background-color:var(--icon--color);content:"";display:inline-block;-webkit-mask-size:cover;mask-size:cover;width:14px;height:12px;-webkit-mask-image:var(--sort-col-asc-icon--mask-image);mask-image:var(--sort-col-asc-icon--mask-image);}tbody th:last-of-type{border-right:1px solid var(--inactive--border-color,#8b868045);overflow:hidden;text-overflow:ellipsis;}tbody th:empty{background-image:linear-gradient(to right,transparent 9px,var(--inactive--border-color,#eee)10px,transparent 11px);background-repeat:no-repeat;min-width:20px;max-width:20px;pointer-events:none;}.psp-tree-label{max-width:0px;min-width:0px;}.psp-tree-label:before{color:var(--icon--color);font-family:var(--button--font-family,inherit);padding-right:11px;}.psp-tree-label-expand:before{content:var(--tree-label-expand--content,"+");}.psp-tree-label-collapse:before{content:var(--tree-label-collapse--content,"-");}.psp-tree-label-expand,.psp-tree-label-collapse{cursor:pointer;}.psp-tree-label:hover:before{color:var(--active--color);text-shadow:0px 0px 5px var(--active--color);}.psp-tree-leaf{padding-left:24px;}.psp-align-right{text-align:right;}.psp-align-left{text-align:left;}.psp-positive:not(:focus){color:var(--rt-pos-cell--color);}.psp-negative:not(:focus){color:var(--rt-neg-cell--color);}regular-table table tbody td{min-width:52px!important;}.psp-is-width-override .rt-column-resize,.rt-column-resize:hover{border:1px dashed#999;border-bottom-width:0px;border-left-width:0px;}.boolean-editable{cursor:pointer;}regular-table table{user-select:none;color:inherit;border-collapse:separate;}regular-table table th{font-weight:400;}regular-table table td,regular-table table th{border-color:var(--inactive--border-color,#8b868045);height:23px;}regular-table table .psp-header-group{text-overflow:ellipsis;}regular-table table th.psp-header-leaf{border-bottom-width:0px;}regular-table table th.psp-header-leaf span{height:23px;min-height:23px;}regular-table table td,regular-table table th.psp-tree-label,regular-table table th.psp-tree-label,regular-table table th.psp-tree-leaf,regular-table table tbody tr:first-child th{border-style:solid;border-width:0px;border-top-width:1px;}regular-table table tbody th:empty{background-position:0px -10px;}regular-table table td.psp-select-region,regular-table table th.psp-select-region{background-color:var(--icon--color)!important;color:var(--plugin--background)!important;border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected),regular-table tbody tr:hover+tr td.psp-select-region:not(.psp-row-selected):not(.psp-row-subselected){border-color:var(--plugin--background)!important;}regular-table tbody tr:hover td.psp-select-region.psp-menu-open:not(.psp-row-selected):not(.psp-row-subselected){box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}:host-context(perspective-viewer[settings]) td.psp-select-region.psp-menu-open{box-shadow:inset -2px 0px 0px var(--plugin--background),inset 2px 0px 0px var(--plugin--background);}regular-table #psp-column-edit-buttons th:not(.rt-group-corner) span:not(.rt-column-resize):before{content:var(--datagrid-column-edit-button--content,"Edit");}perspective-viewer:not([settings]) regular-table #psp-column-edit-buttons:after{content:none;}:host-context(perspective-viewer:not([settings])) regular-table #psp-column-edit-buttons:after{content:none;}regular-table table thead tr:last-child:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-bottom:1px solid var(--inactive--border-color);}regular-table table tbody tr:after{width:10000px;box-sizing:border-box;display:block;height:23px;content:" ";border-top:1px solid transparent;}regular-table table tbody tr:not(:first-child):after{border-top:1px solid var(--inactive--border-color);}regular-table table tbody tr:hover:not(:first-child):after{border-top:1px solid var(--rt-hover--border-color);}regular-table table tbody tr:hover+tr:after{border-top:1px solid var(--rt-hover--border-color);}@keyframes pulse_pos{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_pos2{0%{background-color:var(--pulse--background-color-start,rgba(0,128,255,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(0,128,255,0));}}@keyframes pulse_neg{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}@keyframes pulse_neg2{0%{background-color:var(--pulse--background-color-start,rgba(255,25,0,0.5));}100%{background-color:var(--pulse--background-color-end,rgba(255,25,0,0));}}';var xe=Symbol("Plugin Symbol");function Bo(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function Bt(e,t,o){let n=Array.from(e.children[0].children[0].children),l=n.length,d=t.hasAttribute("settings");if(l<=1?n[0]?.removeAttribute("id"):n.forEach((u,p)=>{let b=d?1:0,x=p===l-(b+1)?"psp-column-titles":p===l-b?"psp-column-edit-buttons":null;x?u.setAttribute("id",x):u.removeAttribute("id")}),t.classList.toggle("psp-menu-open",!!o),d&&l>=2){let u=Array.from(n[l-2].children),p=Array.from(n[l-1].children);if(u&&p){n.slice(0,l-2).forEach(b=>{Array.from(b.children).forEach(x=>{x.classList.toggle("psp-menu-open",!1)})});for(let b=0;b<u.length;b++){let x=u[b],g=p[b],E=x.textContent===o;if(x.classList.toggle("psp-menu-open",E),g.classList.toggle("psp-menu-open",E),this._config.columns.length>1)for(let I of e.querySelectorAll("td")){let T=e.getMeta(I),S=T.column_header[T.column_header.length-2]===o;I.classList.toggle("psp-menu-open",S)}}}}}function Tr(e,t){let o=Array.from(e.children[0].children[0].children);if(o.length>0){Bt.call(this,e,t,this._column_settings_selected_column);let[n]=o.splice(this._config.split_by.length,1);Rr.call(this,e,n,!1);let[l]=o.splice(this._config.split_by.length,1);l&&Rr.call(this,e,l,!0)}}function Rr(e,t,o){let n=e._view_cache.config.row_pivots.length-1;for(let l of t?.children){let d=e.getMeta(l),u=d.column_header?.[this._config.split_by.length],p=this._config.sort.find(W=>W[0]===u),b=d.row_header_x===n,x=typeof d.x>"u";b=b||(d.x+1)%this._config.columns.length===0,l.classList.toggle("psp-header-border",b),l.classList.toggle("psp-header-group",!1),l.classList.toggle("psp-header-leaf",!0),l.classList.toggle("psp-is-top",!1),l.classList.toggle("psp-header-corner",x),l.classList.toggle("psp-header-sort-asc",!o&&!!p&&p[1]==="asc"),l.classList.toggle("psp-header-sort-desc",!o&&!!p&&p[1]==="desc"),l.classList.toggle("psp-header-sort-col-asc",!o&&!!p&&p[1]==="col asc"),l.classList.toggle("psp-header-sort-col-desc",!o&&!!p&&p[1]==="col desc");let g=Bo.call(this,d),E=g==="integer"||g==="float",I=g==="string",T=g==="date",S=g==="datetime";l.classList.toggle("psp-align-right",E),l.classList.toggle("psp-align-left",!E),l.classList.toggle("psp-menu-enabled",(I||E||T||S)&&!x&&d.column_header_y==this._config.split_by.length+1),l.classList.toggle("psp-sort-enabled",(I||E||T||S)&&!x&&d.column_header_y===this._config.split_by.length),l.classList.toggle("psp-is-width-override",e._column_sizes?.override[d.size_key]!==void 0)}}function Dr(e){let t=e._view_cache.config.row_pivots.length-1,o=Array.from(e.children[0].children[0].children),n=[],l=new Set,d=e.children[0];for(let u=0;u<o.length;u++){let p=d.rows[u],b=new Set;for(let x=0;x<p.cells.length;x++){let g=p.cells[x];g.style.backgroundColor="";let E=e.getMeta(g),I=E.row_header_x===t||E.x>=0;g.classList.toggle("psp-align-right",!1),g.classList.toggle("psp-align-left",!1),g.classList.toggle("psp-header-group",!0),g.classList.toggle("psp-header-leaf",!1),g.classList.toggle("psp-header-border",I),g.classList.toggle("psp-header-group-corner",typeof E.x>"u"),g.classList.toggle("psp-color-mode-bar",!1),g.classList.toggle("psp-header-sort-asc",!1),g.classList.toggle("psp-header-sort-desc",!1),g.classList.toggle("psp-header-sort-col-asc",!1),g.classList.toggle("psp-header-sort-col-desc",!1),g.classList.toggle("psp-sort-enabled",!1);let T=p.cells[x],S=x,W,A;for(;n[u]&&n[u][S];++S);for(b.add(S),W=S;W<S+T.colSpan;++W)for(A=u;A<u+T.rowSpan;++A)n[A]||(n[A]=[]),n[A][W]=!0;T.classList.toggle("psp-is-top",u===0||!l.has(W))}l=b}}function Ir(e,t,[,,,,,o,n],[,,,,,l,d],u){let p=this._ids?.[e.dy]?.join("|"),b=(u?e.column_header.slice(0,-1):e.column_header).join("|");if(this.last_reverse_columns?.has(b)&&this.last_reverse_ids?.has(p)){let x=this.last_reverse_ids?.get(p),g=this.last_reverse_columns.get(b);this._is_old_viewport?this.last_meta?.[g]?.[x]>e.user?(t.style.setProperty("--pulse--background-color-start",l),t.style.setProperty("--pulse--background-color-end",d),t.style.animationName==="pulse_neg"?t.style.animation="pulse_neg2 0.5s linear":t.style.animation="pulse_neg 0.5s linear"):this.last_meta?.[g]?.[x]<e.user?(t.style.setProperty("--pulse--background-color-start",o),t.style.setProperty("--pulse--background-color-end",n),t.style.animationName==="pulse_pos"?t.style.animation="pulse_pos2 0.5s linear":t.style.animation="pulse_pos 0.5s linear"):x!==e.dy&&(t.style.animation=""):t.style.animation=""}else t.style.animation=""}var Xt=Mt(pt(),1);function Vt(e,t){return Xt.default.mix(e,`rgb(${t[0]},${t[1]},${t[2]})`,.5).hex()}function We([e,t,o,n],l=[255,255,255]){function d(u,p){return((1-n)*(l[u]/255)+n*(p/255))*255}return[d(0,e),d(1,t),d(2,o)]}function Pe([e,t,o]){return Math.sqrt(e*e*.299+t*t*.587+o*o*.114)>130?"#161616":"#ffffff"}function Xo(e){let[t,o,n]=e.rgb(),[l,d,u]=e.set("hsl.h",(e.get("hsl.h")-15)%360).rgb(),[p,b,x]=e.set("hsl.h",(e.get("hsl.h")+15)%360).rgb();return`linear-gradient(to right top,rgb(${l},${d},${u}),rgb(${t},${o},${n}) 50%,rgb(${p},${b},${x}))`}function ke(e){let t=(0,Xt.default)(e),o=Xo(t),n=t.rgb();return[e,...n,o,`rgba(${n[0]},${n[1]},${n[2]},1)`,`rgba(${n[0]},${n[1]},${n[2]},0)`]}function Wr(e,t,o,n){let l=o.user>0,d=o.user<0,u;e?.pos_bg_color!==void 0?u=e.pos_bg_color:u=this._pos_bg_color;let p;e?.neg_bg_color!==void 0?p=e.neg_bg_color:p=this._neg_bg_color;let b=l?u:d?p:["",...this._plugin_background,""];{let[S,W,A,q,j]=b;if(t.style.position="",e?.number_bg_mode==="color")t.style.animation="",t.style.backgroundColor=S;else if(e?.number_bg_mode==="gradient"){let v=Math.max(0,Math.min(1,Math.abs(o.user/e.bg_gradient))),te=this._plugin_background,N=Pe(We([W,A,q,v],te));t.style.animation="",t.style.color=N,t.style.backgroundColor=`rgba(${W},${A},${q},${v})`}else e?.number_bg_mode==="pulse"?(Ir.call(this,o,t,u,p,n),t.style.backgroundColor=""):(e?.number_bg_mode==="disabled"||e?.number_bg_mode,t.style.animation="",t.style.backgroundColor="")}let[x,g,E,I,T]=(()=>e?.pos_fg_color!==void 0?l?e.pos_fg_color:d?e.neg_fg_color:["",...this._plugin_background,""]:l?this._pos_fg_color:d?this._neg_fg_color:["",...this._plugin_background,""])();if(e?.number_fg_mode==="disabled")if(e?.number_bg_mode==="color"){let S=this._plugin_background,W=Pe(We([b[1],b[2],b[3],1],S));t.style.color=W}else e?.number_bg_mode==="gradient"||(t.style.color="");else e?.number_fg_mode==="bar"?(t.style.color="",t.style.position="relative",T!==""&&t.children.length>0&&t.children[0].nodeType===Node.ELEMENT_NODE&&(t.children[0].style.background=T)):(e?.number_fg_mode==="color"||!e?.number_fg_mode)&&(t.style.color=x)}var Kt=Mt(pt(),1);function Pr(e,t,o){let n=o.column_header?.[this._config.split_by.length],[l,d,u,p,b]=(()=>e?.color!==void 0?e.color:this._color)();if(e?.string_color_mode==="foreground"&&o.user!==null)t.style.color=l,t.style.backgroundColor="",e?.format==="link"&&(t.children[0].style.color=l);else if(e?.string_color_mode==="background"&&o.user!==null){let x=this._plugin_background,g=Pe(We([d,u,p,1],x));t.style.color=g,t.style.backgroundColor=l}else if(e?.string_color_mode==="series"&&o.user!==null){this._series_color_map.has(n)||(this._series_color_map.set(n,new Map),this._series_color_seed.set(n,0));let x=this._series_color_map.get(n);if(!x.has(o.user)){let N=this._series_color_seed.get(n);x.set(o.user,N),this._series_color_seed.set(n,N+1)}let g=x.get(o.user),[E,I,T]=(0,Kt.default)(l).hsl();E=E+g*150%360;let S=(0,Kt.default)(E,I,T,"hsl"),[W,A,q]=S.rgb(),j=S.hex(),v=this._plugin_background,te=Pe(We([W,A,q,1],v));t.style.color=te,t.style.backgroundColor=j}else t.style.backgroundColor="",t.style.color=""}var Ds=Mt(pt(),1);function Fr(e,t,o){let n=o.column_header?.[this._config.split_by.length],[l,d,u,p,b]=(()=>e?.color!==void 0?e.color:this._color)();if(e?.datetime_color_mode==="foreground"&&o.user!==null)t.style.color=l,t.style.backgroundColor="";else if(e?.datetime_color_mode==="background"&&o.user!==null){let x=this._plugin_background,g=Pe(We([d,u,p,1],x));t.style.color=g,t.style.backgroundColor=l}else t.style.backgroundColor="",t.style.color=""}function Ur(e,t,o){let[n]=o.user===!0?this._pos_fg_color:o.user===!1?this._neg_fg_color:["",0,0,0,""];t.style.backgroundColor="",t.style.color=n}function jr(e,t,o){let n=typeof o.value!=null&&typeof o.value!=null&&o.value?.toString()?.trim().length>0,l=o.row_header_x>=this._config.group_by.length,d=e.getMeta({dx:0,dy:o.y-o.y0+1}),u=d&&d.row_header&&typeof d.row_header[o.row_header_x+1]<"u";t.classList.toggle("psp-tree-label",n&&!l),t.classList.toggle("psp-tree-label-expand",n&&!l&&!u),t.classList.toggle("psp-tree-label-collapse",n&&!l&&u),t.classList.toggle("psp-tree-leaf",n&&l)}function Vo(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}function Hr(e,t){let o=e[xe]||{},n=t.hasAttribute("settings");for(let l of e.children[0].children[1].children)for(let d of l.children){let u=e.getMeta(d),p=u.column_header?.[this._config.split_by.length],b=Vo.call(this,u),x=o[p],g=b==="integer"||b==="float";g?Wr.call(this,x,d,u,n):b==="boolean"?Ur.call(this,x,d,u):b==="string"?Pr.call(this,x,d,u):b==="date"||b==="datetime"?Fr.call(this,x,d,u):(d.style.backgroundColor="",d.style.color=""),d.classList.toggle("psp-bool-type",b==="boolean"&&u.user!==null);let E=d.tagName==="TH";E&&jr.call(this,e,d,u),d.classList.toggle("psp-align-right",!E&&g),d.classList.toggle("psp-align-left",E||!g),d.classList.toggle("psp-color-mode-bar",x?.number_fg_mode==="bar"&&g)}}async function Gr(e,t,o,n){let d=e.getMeta(n).column_header[this._config.split_by.length],p=(o.shiftKey?Ko:Zo).call(this,d);this._preserve_focus_state=!0,await t.restore({sort:p})}function Ko(e){let t=[],o=!1;for(let n of this._config.sort){let[l,d]=n;if(l===e){o=!0;let u=$r.call(this,e,d);u&&t.push(u)}else t.push(n)}return o||t.push([e,"desc"]),t}function Zo(e){for(let[t,o]of this._config.sort)if(t===e){let n=$r.call(this,e,o);return n?[n]:[]}return[[e,"desc"]]}function $r(e,t){let n=this._config.split_by.length>0?Qo:Jo,l=t?n[t]:"desc";if(l)return[e,l]}var Jo={desc:"asc",asc:void 0},Qo={desc:"asc",asc:"col desc","col desc":"col asc","col asc":void 0};async function qr(e,t){let o=e.getMeta(t.target),n=t.target.classList.contains("psp-tree-label-collapse");t.shiftKey&&n?this._view.set_depth(o.row_header.filter(l=>l!==void 0).length-2):t.shiftKey?this._view.set_depth(o.row_header.filter(l=>l!==void 0).length-1):n?this._view.collapse(o.y):this._view.expand(o.y),this._num_rows=await this._view.num_rows(),this._num_columns=await this._view.num_columns(),e.draw()}async function Yr(e,t,o){if(o.which!==1)return;let n=o.target;if(n.tagName!=="A"){for(;n.tagName!=="TD"&&n.tagName!=="TH";)if(n=n.parentElement,!e.contains(n))return;if(n.classList.contains("psp-tree-label")){qr.call(this,e,o),o.stopImmediatePropagation();return}if(n.classList.contains("psp-menu-enabled")){let d=e.getMeta(n).column_header?.[this._config.split_by.length];await t.toggleColumnSettings(d),o.preventDefault(),o.stopImmediatePropagation()}else n.classList.contains("psp-sort-enabled")&&(Gr.call(this,e,t,o,n),o.stopImmediatePropagation())}}function Br(e,t){if(t.which!==1)return;let o=t.target;for(;o.tagName!=="TD"&&o.tagName!=="TH";)if(o=o.parentElement,!e.contains(o))return;(o.classList.contains("psp-tree-label")&&t.offsetX<26||o.classList.contains("psp-header-leaf")&&!o.classList.contains("psp-header-corner"))&&t.stopImmediatePropagation()}function Xr(e,t=!1){let o=this._config.group_by.length===0&&this._config.split_by.length===0,n=e.hasAttribute("selectable"),l=t||e.children[0].dataset.editMode==="EDIT";return o&&!n&&l}function Vr(e,t,o){let n=e[xe]||{},l=Xr.call(this,t);o.classList.toggle("edit-mode-allowed",Xr.call(this,t,!0));for(let d of e.querySelectorAll("td")){let u=e.getMeta(d),p=this.get_psp_type(u);if(l&&this._is_editable[u.x]){let b=u.column_header[this._config.split_by.length];p==="string"&&n[b]?.format==="link"?(d.toggleAttribute("contenteditable",!1),d.classList.toggle("boolean-editable",!1)):p==="boolean"?(d.toggleAttribute("contenteditable",!1),d.classList.toggle("boolean-editable",u.user!==null)):(l!==d.hasAttribute("contenteditable")&&d.toggleAttribute("contenteditable",l),d.classList.toggle("boolean-editable",!1))}else d.toggleAttribute("contenteditable",!1),d.classList.toggle("boolean-editable",!1)}}var Ct=(e,t,o)=>{let n=e.querySelectorAll("td"),l=o.get(e),d=e.getRootNode();if(l){for(let u of n){let p=e.getMeta(u);if(p.x===l.x&&p.y===l.y)return d.activeElement!==u&&u.focus({preventScroll:!0}),!0}document.activeElement!==document.body&&e.contains(d.activeElement)&&d.activeElement.blur()}};function Zt(e,t,o){let n=e.getMeta(o),l=t._schema[t._column_paths[n.x]];if(n){let d=o.textContent,u=t._ids[n.y-n.y0][0];if(l==="float"||l==="integer"){if(d=parseFloat(d.replace(/,/g,"")),isNaN(d))return!1}else if(l==="date"||l==="datetime"){if(d=Date.parse(d),isNaN(d))return!1}else l==="boolean"&&(d=d==="true"?!1:d==="false"?!0:null);let p={__INDEX__:u,[t._column_paths[n.x]]:d};return t._table.update([p],{port_id:t._edit_port}),!0}}function Kr(e,t,o){let n=e.getMeta(o.target);if(typeof n?.x<"u"){let l=this._is_editable[n.x],d=this.get_psp_type(n)==="boolean",u=o.target.textContent==="-";l&&d&&!u&&Zt(e,this,o.target)}}function ts(e){let t;return async function(...o){if(!!t&&await t&&!!t)return;let n;t=new Promise(l=>n=l),await e.apply(this,o),t=void 0,n()}}function Zr(){if(this.isContentEditable){let e=this.getRootNode().getSelection().getRangeAt(0),t=e.cloneRange();return t.selectNodeContents(this),t.setEnd(e.endContainer,e.endOffset),t.toString().length}else return this.target.selectionStart}var Be=ts(async function(e,t,o,n,l){let d=e.getMeta(o),u=this._column_paths.length,p=this._num_rows,b=t.get(e);if(!b)return;d.x+n<u&&0<=d.x+n&&(b.x=d.x+n),d.y+l<p&&0<=d.y+l&&(b.y=d.y+l);let x=Math.max(d.x0-10,0),g=Math.min(d.x0+10,u),E=Math.max(d.y0-5,0),I=Math.min(d.y0+10,p),T=d.x0+n,S=d.y0+l;for(;!Ct(e,void 0,t)&&T>=x&&T<g&&S>=E&&S<I;)await e.scrollToCell(T,S,u,p),t.set(e,b),T+=n,S+=l});function rs(e,t,o){return t.getMeta(o).y===e._num_rows-1}function Jr(e,t,o,n){let l=e.getRootNode().activeElement;switch(n.target.classList.remove("psp-error"),n.key){case"Enter":n.preventDefault(),rs(this,e,l)?(l.blur(),o.delete(e)):n.shiftKey?Be.call(this,e,o,l,0,-1):Be.call(this,e,o,l,0,1);break;case"ArrowLeft":Zr.call(l)==0&&(n.preventDefault(),Be.call(this,e,o,l,-1,0));break;case"ArrowUp":n.preventDefault(),Be.call(this,e,o,l,0,-1);break;case"ArrowRight":Zr.call(l)==l.textContent.length&&(n.preventDefault(),Be.call(this,e,o,l,1,0));break;case"ArrowDown":n.preventDefault(),Be.call(this,e,o,l,0,1);break;default:}}function Nt(e,t=!1){let o=this._config.group_by.length===0&&this._config.split_by.length===0,n=e.hasAttribute("selectable"),l=t||e.children[0]._edit_mode==="EDIT";return o&&!n&&l}function Qr(e,t,o,n){if(this._edit_mode==="EDIT"){if(!Nt.call(this,t))return;Jr.call(this,e,t,o,n)}else console.debug(`Mode ${this._edit_mode} for "keydown" event not yet implemented`)}function eo(e,t,o){if(this._edit_mode==="EDIT"){if(!Nt.call(this,t))return;Kr.call(this,e,t,o)}else this._edit_mode==="READ_ONLY"||this._edit_mode==="SELECT_COLUMN"||this._edit_mode==="SELECT_ROW"||this._edit_mode==="SELECT_REGION"||console.debug(`Mode ${this._edit_mode} for "click" event not yet implemented`)}function to(e,t,o,n){if(Nt.call(this,t)&&o.has(e)){n.target.classList.remove("psp-error");let l=o.get(e);o.delete(e),l.content!==n.target.textContent&&(Zt(e,this,n.target)||(n.target.textContent=l.content,n.target.classList.add("psp-error"),n.target.focus()))}}function ro(e,t,o,n){let l=e.getMeta(n.target);if(l){let d={x:l.x,y:l.y,content:n.target.textContent};o.set(e,d)}}async function gt({_view:e,_config:t},o,n){let l=t.group_by,d=t.split_by,u=o>=0?o:0,p=u+1,b=await e.to_json({start_row:u,end_row:p}),g=b.map(q=>q.__ROW_PATH__)[0]||[],E=l.map((q,j)=>{let v=g[j];return v?[q,"==",v]:void 0}).filter(q=>q),I=l.length>0?n+1:n,T=Object.keys(b[0])[I],S={row:b[0]},W=[];if(T){let q=T.split("|");S.column_names=[q[d.length]],W=d.map((j,v)=>{let te=q[v];return te?[j,"==",te]:void 0}).filter(j=>j).filter(([,,j])=>j!=="__ROW_PATH__")}let A=t.filter.concat(E).concat(W);return S.config={filter:A},S}async function oo(e,t,o,n){let l=e.getMeta(n.target);if(!t.hasAttribute("selectable")||n.handled||n.which!==1||!l)return;let d=this._ids[l.y-l.y0];if(l&&l.y>=0){let u=o.get(e),p=!!u&&u.reduce((T,S,W)=>T&&S===d[W],!0),b=!!u&&d.length===u.length&&p,x={selected:!b},{row:g,column_names:E,config:I}=await gt(this,l.y,l.x);b?(o.delete(e),x={...x,row:g,config:{filter:structuredClone(this._config.filter)}}):(o.set(e,d),x={...x,row:g,column_names:E,config:I}),await e.draw({preserve_width:!0}),n.handled=!0,t.dispatchEvent(new CustomEvent("perspective-select",{bubbles:!0,composed:!0,detail:x}))}}function so(e,t,o){if(!t.hasAttribute("selectable"))return;let n=o.has(e),l=o.get(e);for(let d of e.querySelectorAll("td"))if(!n)d.classList.toggle("psp-row-selected",!1),d.classList.toggle("psp-row-subselected",!1);else{let u=e.getMeta(d),p=this._ids[u.y-u.y0],b=l.reduce((x,g,E)=>x&&g===p[E],!0);d.classList.toggle("psp-row-selected",p.length===l.length&&b),d.classList.toggle("psp-row-subselected",p.length!==l.length&&b)}for(let d of e.querySelectorAll("tbody th")){let u=e.getMeta(d),p=this._ids[u.y-u.y0];if(!n||!!p[u.row_header_x])d.classList.toggle("psp-row-selected",!1),d.classList.toggle("psp-row-subselected",!1);else{let b=l.reduce((x,g,E)=>x&&g===p[E],!0);d.classList.toggle("psp-row-selected",p.length===l.length&&b),d.classList.toggle("psp-row-subselected",p.length!==l.length&&b)}}}async function io(e,t,o){o.delete(e);for(let n of e.querySelectorAll("td,th"))n.classList.toggle("psp-row-selected",!1),n.classList.toggle("psp-row-subselected",!1)}var ho=Mt(pt(),1);var lo={datetime:Intl.DateTimeFormat,date:Intl.DateTimeFormat,integer:Intl.NumberFormat,float:Intl.NumberFormat,boolean:class{format(e){return e?"true":"false"}}},ss={types:{float:{format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},datetime:{format:{dateStyle:"short",timeStyle:"medium"}},date:{format:{dateStyle:"short"}}}},At=class{constructor(){this._formatters=new Map}create_datetime_formatter(t,o){let n={dateStyle:"short",timeStyle:"medium"};if(o.date_format?.format!=="custom"){let l={...n,timeZone:o.date_format?.timeZone,dateStyle:o.date_format?.dateStyle,timeStyle:o.date_format?.timeStyle};return l.dateStyle==="disabled"?l.dateStyle=void 0:l.dateStyle===void 0&&(l.dateStyle="short"),l.timeStyle==="disabled"?l.timeStyle=void 0:l.timeStyle===void 0&&(l.timeStyle="medium"),new Intl.DateTimeFormat(navigator.languages,l)}else{let l={timeZone:o.date_format?.timeZone,second:o.date_format?.second,minute:o.date_format?.minute,hour:o.date_format?.hour,day:o.date_format?.day,weekday:o.date_format?.weekday,month:o.date_format?.month,year:o.date_format?.year,hour12:o.date_format?.hour12,fractionalSecondDigits:o.date_format?.fractionalSecondDigits};return l.year==="disabled"?l.year=void 0:l.year===void 0&&(l.year="2-digit"),l.month==="disabled"?l.month=void 0:l.month===void 0&&(l.month="numeric"),l.day==="disabled"?l.day=void 0:l.day===void 0&&(l.day="numeric"),l.weekday==="disabled"&&(l.weekday=void 0),l.hour==="disabled"?l.hour=void 0:l.hour===void 0&&(l.hour="numeric"),l.minute==="disabled"?l.minute=void 0:l.minute===void 0&&(l.minute="numeric"),l.second==="disabled"?l.second=void 0:l.second===void 0&&(l.second="numeric"),l.hour12===void 0&&(l.hour12=!0),new Intl.DateTimeFormat(navigator.languages,l)}}create_date_formatter(t,o){let n={dateStyle:o.date_format?.dateStyle,timeZone:"utc"};return n.dateStyle==="disabled"?n.dateStyle=void 0:n.dateStyle===void 0&&(n.dateStyle="short"),new Intl.DateTimeFormat(navigator.languages,n)}create_number_formatter(t,o){let n=ss.types[t]?.format;return o.number_format!==void 0&&(n=o.number_format),new lo[t](navigator.languages,n)}create_boolean_formatter(t,o){return new lo[t](navigator.languages,{})}get(t,o){let n=[t,...Object.values(o.date_format??{}),...Object.values(o.number_format??{})].join("-");return this._formatters.has(n)||(t==="date"?this._formatters.set(n,this.create_date_formatter(t,o)):t==="datetime"?this._formatters.set(n,this.create_datetime_formatter(t,o)):t==="integer"||t==="float"?this._formatters.set(n,this.create_number_formatter(t,o)):t==="boolean"?this._formatters.set(n,this.create_boolean_formatter(t,o)):this._formatters.set(n,!1)),this._formatters.get(n)}};var ao=new At,no=1;function co(e,t){return ao.get(e,t)}function Rt(e,t,o={},n=!1){if(t===null)return"-";let l=n&&this._table_schema[e]||this._schema[e]||"string",d=o[e]||{};if((l==="integer"||l==="float")&&d?.number_fg_mode==="bar"){let p=Math.max(0,Math.min(no,Math.abs(t/d.fg_gradient)*no)),b=this._div_factory.get(),x=t>=0?"left":"right",g=(p*100).toFixed(2);return b.setAttribute("style",`width:calc(${g}% - 4px);position:absolute;${x}:2px;height:80%;top:10%;pointer-events:none;`),b}else if(d?.format==="link"&&l==="string"){let p=document.createElement("a");return p.setAttribute("href",t),p.setAttribute("target","_blank"),p.textContent=t,p}else if(d?.format==="bold"&&l==="string"){let p=document.createElement("b");return p.textContent=t,p}else if(d?.format==="italics"&&l==="string"){let p=document.createElement("i");return p.textContent=t,p}else{let p=ao.get(l,d);return p?p.format(t):t}}function*_o(e=[],t,o){let n=o[xe];for(let l of e){l=["TOTAL",...l];let d=l[l.length-1];l=l.slice(0,l.length-1).fill("");let u=Rt.call(this,t[l.length-1],d,n,!0);u instanceof HTMLElement?l=l.concat(u):l=l.concat({toString:()=>u}),l.length=t.length+1,yield l}}function fo(e){let t,o,n,l,d;return async function(p,b,x,g,E){let I={},T;g-b>0&&E-x>0?(this._is_old_viewport=this._last_window?.start_row===x&&this._last_window?.end_row===E&&this._last_window?.start_col===b&&this._last_window?.end_col===g,T={start_row:x,start_col:b,end_row:E,end_col:g,id:!0},I=JSON.parse(await this._view.to_columns_string(T)),this._last_window=T,this._ids=I.__ID__,this._reverse_columns=this._column_paths.slice(b,g).reduce((v,te,N)=>(v.set(te,N),v),new Map),this._reverse_ids=this._ids.reduce((v,te,N)=>(v.set(te?.join("|"),N),v),new Map)):this._div_factory.clear();let S=[],W=[],A=[],q=[],j=e.hasAttribute("settings");for(let v=b;v<Math.min(g,this._column_paths.length);++v){let te=this._column_paths[v],N=te.split("|"),ue=I[te]||new Array(E-x).fill(null);S.push(ue.map(re=>Rt.call(this,N[this._config.split_by.length],re,p[xe]))),W.push(ue),j&&N.push(""),A.push(N),q.push(te)}return g-b>0&&E-x>0&&(this.last_column_paths=o,this.last_meta=t,this.last_ids=n,this.last_reverse_ids=l,this.last_reverse_columns=d,o=q,t=W,n=this._ids,l=this._reverse_ids,d=this._reverse_columns),{num_rows:this._num_rows,num_columns:this._column_paths.length,row_headers:Array.from(_o.call(this,I.__ROW_PATH__,this._config.group_by,p)),column_headers:A,data:S,metadata:W,column_header_merge_depth:Math.max(0,this._config.split_by.length)}}}function Tt(e,t,o){let n=window.getComputedStyle(e).getPropertyValue(t).trim();return n.length>0?n:o}var Jt=class{constructor(t){this._name=t,this._elements=[],this._index=0}clear(){this._index=0}get(){this._elements[this._index]||(this._elements[this._index]=document.createElement(this._name));let t=this._elements[this._index];return this._index+=1,t}};function is(e){return e.x>=0?this._column_types[e.x]:this._row_header_types[e.row_header_x-1]}async function Qt(e,t,o,n={}){let l=await o.get_config(),d=Array.isArray(l.expressions)?Object.fromEntries(l.expressions.map(oe=>[oe[0],oe[1]])):l.expressions,[u,p,b,x,g,E,I]=await Promise.all([t.schema(),t.validate_expressions(d),o.num_rows(),o.schema(),o.expression_schema(),o.column_paths(),this.parentElement.getEditPort()]),T=(0,ho.default)(Tt(e,"--plugin--background","#FFFFFF")).rgb(),S=ke(Tt(e,"--rt-pos-cell--color","#338DCD")),W=ke(Tt(e,"--rt-neg-cell--color","#FF5942")),A=ke(Vt(S[0],T)),q=ke(Vt(W[0],T)),j=ke(Tt(e,"--active--color","#ff0000")),v={...x,...g},te={...u,...p.expression_schema},N=E.filter(oe=>oe!=="__ROW_PATH__"&&oe!=="__ID__"),ue=[],re=[];for(let oe of N){let _e=oe.split("|")[l.split_by.length];re.push(v[_e]),ue.push(!!u[_e])}let ze=this._edit_mode||"READ_ONLY";this._edit_button.dataset.editMode=ze;let J=Object.assign(n,{_edit_port:I,_view:o,_table:t,_table_schema:te,_config:l,_num_rows:b,_schema:v,_ids:[],_plugin_background:T,_color:j,_pos_fg_color:S,_neg_fg_color:W,_pos_bg_color:A,_neg_bg_color:q,_column_paths:N,_column_types:re,_is_editable:ue,_edit_mode:ze,_selection_state:{selected_areas:[],dirty:!1},_row_header_types:l.group_by.map(oe=>te[oe]),_series_color_map:new Map,_series_color_seed:new Map,get_psp_type:is});return J._div_factory=J._div_factory||new Jt("div"),e.setDataListener(fo(this.parentElement).bind(J,e),{virtual_mode:window.getComputedStyle(e).getPropertyValue("--datagrid-virtual-mode")?.trim()||"both"}),J}async function uo(e,t,o){let n=e.getMeta(o.target);if(!n)return;let{x:l,y:d}=n,{row:u,column_names:p,config:b}=await gt(this,d,l);t.dispatchEvent(new CustomEvent("perspective-click",{bubbles:!0,composed:!0,detail:{row:u,column_names:p,config:b}}))}var ls="mouse-selected-area",po=(e,t,{className:o=ls,selected:n=[]}={})=>(e.model._selection_state={selected_areas:n,dirty:!0},t.addEventListener("mousedown",ns(e,t,o)),t.addEventListener("mouseover",as(e,t,o)),t.addEventListener("mouseup",cs(e,t,o)),t.addStyleListener(()=>mt(e,t,o)),t),ns=(e,t,o)=>n=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={};let l=t.getMeta(n.target);if(l&&l.x!==void 0&&l.y!==void 0){e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={x:l.x,y:l.y},e.model._selection_state.old_selected_areas=e.model._selection_state.selected_areas,e.model._selection_state.selected_areas=[];let d={x0:l.x,x1:l.x,y0:l.y,y1:l.y};e.model._selection_state.potential_selection=d,mt(e,t,o,e.model._selection_state.selected_areas.concat([d]));return}}e.model._selection_state.selected_areas=[]},as=(e,t,o)=>n=>{if((e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN")&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0){let l=t.getMeta(n.target);if(l&&l.x!==void 0&&l.y!==void 0){let d={x0:Math.min(l.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(l.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(l.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(l.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.potential_selection=d,mt(e,t,o,e.model._selection_state.selected_areas.concat([d]))}}},cs=(e,t,o)=>n=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){let l=t.getMeta(n.target);if(e.model._selection_state.old_selected_areas?.length>0){let d=e.model._selection_state.old_selected_areas[0];if(d.x0===d.x1&&d.y0===d.y1&&d.x0===l.x&&d.y0===l.y){e.model._selection_state.selected_areas=[],e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0,mt(e,t,o,[]);return}}if(e.model._selection_state.old_selected_areas=[],e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES&&e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x!==void 0&&l.x!==void 0&&l.y!==void 0){let d={x0:Math.min(l.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),x1:Math.max(l.x,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.x),y0:Math.min(l.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y),y1:Math.max(l.y,e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES.y)};e.model._selection_state.selected_areas.push(d),mt(e,t,o)}e.model._selection_state.CURRENT_MOUSEDOWN_COORDINATES={},e.model._selection_state.potential_selection=void 0}};function ds(e,t,{x0:o,x1:n,y0:l,y1:d}){let u={},p=t.model._edit_mode;o!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(p)>-1&&(u.start_col=o),n!==void 0&&["SELECT_COLUMN","SELECT_REGION"].indexOf(p)>-1&&(u.end_col=n+1),l!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(p)>-1&&(u.start_row=l),d!==void 0&&["SELECT_ROW","SELECT_REGION"].indexOf(p)>-1&&(u.end_row=d+1),e.setSelection(u)}var mt=(e,t,o,n)=>{if(e.model._edit_mode==="SELECT_REGION"||e.model._edit_mode==="SELECT_ROW"||e.model._edit_mode==="SELECT_COLUMN"){n=e.model._selection_state.selected_areas.slice(0),e.model._selection_state.potential_selection&&n.push(e.model._selection_state.potential_selection);let l=t.querySelectorAll("tbody td");if(n.length>0)ds(e.parentElement,e,n[0]),_s(e,t,n,o);else{e.parentElement.setSelection();for(let d of l)d.classList.remove(o)}}else if(e.model._selection_state.dirty){e.model._selection_state.dirty=!1;let l=t.querySelectorAll("tbody td");for(let d of l)d.classList.remove(o)}},_s=(e,t,o,n)=>{if(e.model._edit_mode==="SELECT_REGION"&&o.length>0){let l=t.querySelectorAll("tbody td");for(let d of l){let u=t.getMeta(d),p=!1;for(let{x0:b,x1:x,y0:g,y1:E}of o)b!==void 0&&g!==void 0&&x!==void 0&&E!==void 0&&b<=u.x&&u.x<=x&&g<=u.y&&u.y<=E&&(p=!0,e.model._selection_state.dirty=!0,d.classList.add(n));p||d.classList.remove(n)}}else if(e.model._edit_mode==="SELECT_ROW"&&o.length>0){let l=t.querySelectorAll("tbody td");for(let d of l){let u=t.getMeta(d),p=!1;for(let{x0:b,x1:x,y0:g,y1:E}of o)b!==void 0&&g!==void 0&&x!==void 0&&E!==void 0&&g<=u.y&&u.y<=E&&(e.model._selection_state.dirty=!0,p=!0,d.classList.add(n));p||d.classList.remove(n)}}else if(e.model._edit_mode==="SELECT_COLUMN"&&o.length>0){let l=t.querySelectorAll("tbody td");for(let d of l){let u=t.getMeta(d),p=!1;for(let{x0:b,x1:x,y0:g,y1:E}of o)b!==void 0&&g!==void 0&&x!==void 0&&E!==void 0&&b<=u.x&&u.x<=x&&(e.model._selection_state.dirty=!0,p=!0,d.classList.add(n));p||d.classList.remove(n)}}};async function go(e){let t=this.parentElement,o=await t.getTable(!0);if(this._initialized)await Qt.call(this,this.regular_table,o,e,this.model);else{this.innerHTML="",this.shadowRoot?this.shadowRoot.appendChild(this.regular_table):this.appendChild(this.regular_table),this.model=await Qt.call(this,this.regular_table,o,e),po(this,this.regular_table,{className:"psp-select-region"}),this.regular_table.addStyleListener(Hr.bind(this.model,this.regular_table,t)),this.regular_table.addStyleListener(Dr.bind(this.model,this.regular_table)),this.regular_table.addStyleListener(Tr.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("click",Br.bind(this.model,this.regular_table)),this.regular_table.addEventListener("mousedown",Yr.bind(this.model,this.regular_table,t));let n=new WeakMap;this.regular_table.addStyleListener(so.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("mousedown",oo.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("psp-deselect-all",io.bind(this.model,this.regular_table,t,n)),this.regular_table.addEventListener("click",uo.bind(this.model,this.regular_table,t));let l=new WeakMap;this.regular_table.addStyleListener(Vr.bind(this.model,this.regular_table,t,this)),this.regular_table.addStyleListener(Ct.bind(this.model,this.regular_table,t,l)),this.regular_table.addEventListener("click",eo.bind(this.model,this.regular_table,t)),this.regular_table.addEventListener("focusin",ro.bind(this.model,this.regular_table,t,l)),this.regular_table.addEventListener("focusout",to.bind(this.model,this.regular_table,t,l)),this.regular_table.addEventListener("keydown",Qr.bind(this.model,this.regular_table,t,l)),t.addEventListener("perspective-toggle-column-settings",d=>{if(this.isConnected){if(Bt.call(this.model,this.regular_table,t,d.detail.column_name),!d.detail.open){this.model._column_settings_selected_column=null;return}this.model._column_settings_selected_column=d.detail.column_name}}),this._initialized=!0}}function Dt(e,t=!1){if(!this._initialized)return;t&&(this._cached_column_sizes=e);let o={},{group_by:n,columns:l}=this.model._config,d=n?.length>0?n.length+1:0;for(let u of Object.keys(e))if(u==="__ROW_PATH__")o[d-1]=e[u];else{let p=this.model._column_paths.indexOf(u);o[p+d]=e[u]}this.regular_table._column_sizes.override=o}function It(){if(!this._initialized)return[];if(this._cached_column_sizes){let d=this._cached_column_sizes;return this._cached_column_sizes=void 0,d}let e=this.regular_table._column_sizes.override,{group_by:t,columns:o}=this.model._config,n=t?.length>0?t.length+1:0,l={};for(let d of Object.keys(e))if(e[d]!==void 0){let u=d-n;u>-1?l[this.model._column_paths[u]]=e[d]:u===-1&&(l.__ROW_PATH__=e[d])}return l}var bt=["READ_ONLY","EDIT","SELECT_ROW","SELECT_COLUMN","SELECT_REGION"];function Wt(e=void 0){typeof e>"u"&&(e=bt[(bt.indexOf(this._edit_mode)+1)%bt.length]),this.parentElement?.setSelection(),this._edit_mode=e,this.model&&(this.model._edit_mode=e,this.model._selection_state={selected_areas:[],dirty:!0}),this._edit_button!==void 0&&(this._edit_button.dataset.editMode=e),this.dataset.editMode=e}function Pt(e=void 0){typeof e>"u"&&(e=!this._is_scroll_lock),this._is_scroll_lock=e,this.classList.toggle("sub-cell-scroll-disabled",e),this._scroll_lock!==void 0&&this._scroll_lock.classList.toggle("lock-scroll",e)}function mo(e,t){e=JSON.parse(JSON.stringify(e)),t=JSON.parse(JSON.stringify(t));let o={};if(e.columns)for(let[d,u]of Object.entries(e.columns))u.column_size_override!==void 0&&(o[d]=u.column_size_override,delete u.column_size_override);let n={};if(t)for(let[d,u]of Object.entries(t))n[d]={...u,pos_fg_color:u.pos_fg_color?ke(u.pos_fg_color):void 0,neg_fg_color:u.neg_fg_color?ke(u.neg_fg_color):void 0,pos_bg_color:u.pos_bg_color?ke(u.pos_bg_color):void 0,neg_bg_color:u.neg_bg_color?ke(u.neg_bg_color):void 0,color:u.color?ke(u.color):void 0};"edit_mode"in e&&(bt.indexOf(e.edit_mode)!==-1?Wt.call(this,e.edit_mode):console.error("Unknown edit mode "+e.edit_mode)),"scroll_lock"in e&&Pt.call(this,e.scroll_lock);let l=this.regular_table;Dt.call(this,o,!0),l[xe]=n}function bo(){if(this.regular_table){let e={columns:{},scroll_lock:!!this._is_scroll_lock,edit_mode:this._edit_mode},t=It.call(this);for(let o of Object.keys(t||{}))e.columns[o]||(e.columns[o]={}),e.columns[o].column_size_override=t[o];return JSON.parse(JSON.stringify(e))}return{}}async function vo(e){if(this.parentElement&&await this.activate(e),!this.isConnected||this.offsetParent==null)return;let t=It.call(this),o=this.regular_table.draw({invalid_columns:!0});this.model._preserve_focus_state?this.model._preserve_focus_state=!1:(this.regular_table.scrollTop=0,this.regular_table.scrollLeft=0,this.regular_table.dispatchEvent(new CustomEvent("psp-deselect-all",{bubbles:!1})),this.regular_table._resetAutoSize()),Dt.call(this,t),await o,this._toolbar.classList.toggle("aggregated",this.model._config.group_by.length>0||this.model._config.split_by.length>0)}function er(e,t){return e==="integer"||e==="float"?{datagrid_number_style:{fg_gradient:0,pos_fg_color:this.model._pos_fg_color[0],neg_fg_color:this.model._neg_fg_color[0],number_fg_mode:"color",bg_gradient:0,pos_bg_color:this.model._pos_bg_color[0],neg_bg_color:this.model._neg_bg_color[0],number_bg_mode:"disabled"},number_string_format:!0}:e==="date"||e==="datetime"||e==="string"?{[e==="date"||e==="datetime"?"datagrid_datetime_style":"datagrid_string_style"]:{color:this.model._color[0],bg_color:this.model._color[0]}}:null}var $e,tr=class extends HTMLElement{constructor(){super(),this.regular_table=document.createElement("regular-table"),this.regular_table.part="regular-table",this._is_scroll_lock=!1,this._edit_mode="READ_ONLY";let t=tr;t.renderTarget=="shadow"&&(St(t,$e)||(Lr(t,$e,new CSSStyleSheet),St(t,$e).replaceSync(zt)),this.attachShadow({mode:"open"}).adoptedStyleSheets.push(St(t,$e)))}connectedCallback(){this._toolbar||(this._toolbar=document.createElement("perspective-viewer-datagrid-toolbar"));let t=this.parentElement;t&&t.appendChild(this._toolbar)}disconnectedCallback(){this._toolbar.parentElement.removeChild(this._toolbar)}async activate(t){return await go.call(this,t)}get name(){return"Datagrid"}get category(){return"Basic"}get select_mode(){return"toggle"}get min_config_columns(){}get config_column_names(){return["Columns"]}get priority(){return 1}can_render_column_styles(t,o){return t!=="boolean"}column_style_controls(t,o){return er.call(this,t,o)}async draw(t){return await vo.call(this,t)}async update(t){this.model._num_rows=await t.num_rows(),await this.regular_table.draw()}async render(t){let o=await this.parentElement.getView(),n=await o.to_columns(t),l=await o.column_paths().then(p=>p.slice(t.start_col,t.end_col)),d=t.end_row-t.start_row,u="";for(let p=0;p<d;p++){for(let b of l){let x=n[b],g=this.model._schema[b],E=co(g,this.regular_table[xe][b.split("|").at(-1)]||{});E?u+=E.format(x[p])+"	":u+=x[p]+"	"}u+=`
`}return u.trim()}async resize(){!this.isConnected||this.offsetParent==null||this._initialized&&await this.regular_table.draw()}async clear(){this.regular_table._resetAutoSize(),this.regular_table.clear()}save(){return bo.call(this)}restore(t,o){return mo.call(this,t,o)}async restyle(t){await this.draw(t)}delete(){this.regular_table.table_model&&this.regular_table._resetAutoSize(),this.regular_table.clear()}},Xe=tr;$e=new WeakMap,xr(Xe,"renderTarget",window.CSS?.supports&&window.CSS?.supports("selector(:host-context(foo))")?"shadow":"light"),Er(Xe,$e,void 0);var yo=':host{position:relative;display:block;}:host #container{position:absolute;display:flex;flex-direction:column;justify-content:stretch;align-items:stretch;top:0;left:0;right:0;bottom:0;}:host #toolbar{display:flex;align-items:center;height:36px;}:host #toolbar .hover-target{margin:0;display:inline-flex;align-items:center;height:48px;cursor:pointer;}:host #toolbar .hover-target:hover{outline:4px solid var(--icon--color);background-color:var(--icon--color);}:host #slot-container{flex:1;position:relative;}#scroll_lock.lock-scroll:before{-webkit-mask-image:var(--toolbar-scroll-lock-active--content);}#scroll_lock:before{-webkit-mask-image:var(--toolbar-scroll-lock--content);}#select_mode:before{content:"highlight_alt";}#edit_mode:before{-webkit-mask-image:"";}#edit_mode[data-edit-mode="READ_ONLY"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--edit--content);}:host(.aggregated) #toolbar #edit_mode[data-edit-mode="EDIT"]:before{-webkit-mask-image:var(--toolbar-edit-mode--read-only--content);}#edit_mode[data-edit-mode="SELECT_ROW"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-row--content);}#edit_mode[data-edit-mode="SELECT_COLUMN"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-column--content);}#edit_mode[data-edit-mode="SELECT_REGION"]:before{-webkit-mask-image:var(--toolbar-edit-mode--select-region--content);}#edit_mode[data-edit-mode="READ_ONLY"] span:before{content:var(--edit-mode--read-only--content,"Read Only");}#edit_mode[data-edit-mode="EDIT"] span:before{content:var(--edit-mode--edit--content,"Editable");}#edit_mode[data-edit-mode="SELECT_ROW"] span:before{content:var(--edit-mode--select-row--content,"Row Select");}#edit_mode[data-edit-mode="SELECT_COLUMN"] span:before{content:var(--edit-mode--select-column--content,"Column Select");}#edit_mode[data-edit-mode="SELECT_REGION"] span:before{content:var(--edit-mode--select-region--content,"Region Select");}#scroll_lock span:before{content:var(--scroll-lock-toggle--content,"Free Scroll");}#scroll_lock.lock-scroll span:before{content:var(--scroll-lock-alt-toggle--content,"Align Scroll");}.button:before{width:21px;height:21px;content:"";-webkit-mask-size:cover;mask-size:cover;background-color:var(--icon--color);}.button.editable:before,.button.lock-scroll:before{color:inherit;}.button{display:inline-flex;justify-content:center;align-items:center;user-select:none;padding:0 5px;border:1px solid transparent;border-radius:3px;border:1px solid transparent;box-sizing:border-box;display:inline-flex;font-size:var(--label--font-size,0.75em);height:22px;user-select:none;white-space:nowrap;width:37px;}.button>span{display:none;margin:0;padding:0;}.hover-target:hover .button{position:relative;background-color:var(--icon--color);color:var(--plugin--background);opacity:1;display:flex;align-items:center;cursor:pointer;}.hover-target:hover .button:before{background-color:var(--plugin--background);}.hover-target:hover .button>span{display:block;position:absolute;top:calc(100% + 3px);left:50%;translate:-50%;margin:0;padding:5px;height:auto;white-space:pre-wrap;line-height:1;font-size:9px;background-color:var(--icon--color);width:35px;text-align:center;border-radius:0 0 3px 3px;}';var Ft=class extends HTMLElement{connectedCallback(){if(this._initialized)return;this._initialized=!0,this.setAttribute("slot","plugin-settings"),this.attachShadow({mode:"open"}),this.shadowRoot.innerHTML=`
            <style>
                ${yo}
            </style>
            <div id="toolbar">
                <span class="hover-target">
                    <span id="scroll_lock" class="button">
                        <span></span>
                    </span>
                </span>
                <span class="hover-target">
                    <span id="edit_mode" class="button" data-edit-mode="READ_ONLY">
                        <span></span>
                    </span>
                </span>
            </div>
        `;let t=this.parentElement,o=t.querySelector("perspective-viewer-datagrid");o._scroll_lock=this.shadowRoot.querySelector("#scroll_lock"),o._scroll_lock.addEventListener("click",()=>Pt.call(o)),o._edit_button=this.shadowRoot.querySelector("#edit_mode"),o._edit_button.addEventListener("click",()=>{Wt.call(o),o.regular_table.draw(),t.dispatchEvent(new Event("perspective-config-update"))})}};function hs(){let e=document.createElement("style");e.textContent=zt,document.head.insertBefore(e,document.head.firstChild)}async function us(){customElements.define("perspective-viewer-datagrid-toolbar",Ft),customElements.define("perspective-viewer-datagrid",Xe),await customElements.whenDefined("perspective-viewer"),customElements.get("perspective-viewer").registerPlugin("perspective-viewer-datagrid")}us();hs();
/**
	ColorBrewer colors for chroma.js

	Copyright (c) 2002 Cynthia Brewer, Mark Harrower, and The 
	Pennsylvania State University.

	Licensed under the Apache License, Version 2.0 (the "License"); 
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at	
	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software distributed
	under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
	CONDITIONS OF ANY KIND, either express or implied. See the License for the
	specific language governing permissions and limitations under the License.

    @preserve
 */
/**
 * @license
 *
 * chroma.js - JavaScript library for color conversions
 * 
 * Copyright (c) 2011-2017, Gregor Aisch
 * All rights reserved.
 * 
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 * 
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer.
 * 
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 * 
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 *    derived from this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 */
//# sourceMappingURL=perspective-viewer-datagrid.js.map
