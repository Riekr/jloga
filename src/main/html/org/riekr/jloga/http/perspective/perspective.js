var Be=Object.create;var Q=Object.defineProperty;var We=Object.getOwnPropertyDescriptor;var Ue=Object.getOwnPropertyNames;var Qe=Object.getPrototypeOf,et=Object.prototype.hasOwnProperty;var tt=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),rt=(t,e)=>{for(var r in e)Q(t,r,{get:e[r],enumerable:!0})},nt=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of Ue(e))!et.call(t,i)&&i!==r&&Q(t,i,{get:()=>e[i],enumerable:!(n=We(e,i))||n.enumerable});return t};var it=(t,e,r)=>(r=t!=null?Be(Qe(t)):{},nt(e||!t||!t.__esModule?Q(r,"default",{value:t,enumerable:!0}):r,t));var ze=tt((ir,Oe)=>{"use strict";Oe.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});var te={};rt(te,{COLUMN_SEPARATOR_STRING:()=>dt,CONFIG_ALIASES:()=>at,CONFIG_VALID_KEYS:()=>st,DATA_TYPES:()=>ot,FILTER_OPERATORS:()=>l,SORT_ORDERS:()=>ut,SORT_ORDER_IDS:()=>ct,TYPE_AGGREGATES:()=>ft,TYPE_FILTERS:()=>gt});var ot={integer:"integer",float:"float",string:"string",boolean:"boolean",date:"date",datetime:"datetime",object:"object"},at={row_pivot:"group_by","row-pivot":"group_by","row-pivots":"group_by",col_pivot:"split_by",col_pivots:"split_by",column_pivot:"split_by","column-pivot":"split_by","column-pivots":"split_by",filters:"filter",sorts:"sort"},st=["viewport","group_by","split_by","aggregates","columns","filter","sort","computed_columns","expressions","group_by_depth","split_by_depth","filter_op"],ke=["any","avg","abs sum","count","distinct count","dominant","first by index","last by index","last minus first","last","high","join","low","high minus low","max","mean","median","min","pct sum parent","pct sum grand total","stddev","sum","sum abs","sum not null","unique","var"],ee=["any","count","distinct count","distinct leaf","dominant","first by index","join","last by index","last","unique"],lt=["any","count","distinct count","distinct leaf","dominant","first by index","last by index","last","unique"],ut=["none","asc","desc","col asc","col desc","asc abs","desc abs","col asc abs","col desc abs"],ct=[2,0,1,0,1,3,4,3,4],ft={string:ee,float:ke,integer:ke,boolean:lt,datetime:ee,date:ee},l={lessThan:"<",greaterThan:">",equals:"==",lessThanOrEquals:"<=",greaterThanOrEquals:">=",doesNotEqual:"!=",isNull:"is null",isNotNull:"is not null",isIn:"in",isNotIn:"not in",contains:"contains",bitwiseAnd:"&",bitwiseOr:"|",and:"and",or:"or",beginsWith:"begins with",endsWith:"ends with"},ht=[l.bitwiseAnd,l.bitwiseOr,l.equals,l.doesNotEqual,l.or,l.and,l.isNull,l.isNotNull],Re=[l.lessThan,l.greaterThan,l.equals,l.lessThanOrEquals,l.greaterThanOrEquals,l.doesNotEqual,l.isNull,l.isNotNull],pt=[l.equals,l.contains,l.doesNotEqual,l.isIn,l.isNotIn,l.beginsWith,l.endsWith,l.isNull,l.isNotNull],be=[l.lessThan,l.greaterThan,l.equals,l.lessThanOrEquals,l.greaterThanOrEquals,l.doesNotEqual,l.isNull,l.isNotNull],dt="|",gt={string:pt,float:Re,integer:Re,boolean:ht,datetime:be,date:be};var re={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function ie(t){let e={};if(D().types[t]&&Object.assign(e,D().types[t]),e.type){let r=ie(e.type);return Object.assign(r,e),r}else return e}function ne(t){return t&&typeof t=="object"&&!Array.isArray(t)}function N(t,...e){if(!e.length)return t;let r=e.shift();if(ne(t)&&ne(r))for(let n in r)ne(r[n])?(t[n]||Object.assign(t,{[n]:{}}),N(t[n],r[n])):Object.assign(t,{[n]:r[n]});return N(t,...e)}function Ze(t){globalThis.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),globalThis.__PERSPECTIVE_CONFIG__=N(re,t)}function D(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=N(re,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}var ae=new WeakMap,oe=0;function q(t,e){return function(){let r,n=()=>{},i=Array.prototype.slice.call(arguments,0,arguments.length);for(let c=i.length-1;c>=0;c--)typeof i[c]=="function"&&(r=i.splice(c,1)[0]);let s=ae.get(r);ae.delete(r);let d={cmd:e||"view_method",name:this._name,method:t,args:i,subscribe:!0,callback_id:s};this._worker.post(d,r,n),this._worker.unsubscribe(e,r)}}function G(t,e){return function(){let r,n=()=>{},i=Array.prototype.slice.call(arguments,0,arguments.length);for(let d=i.length-1;d>=0;d--)typeof i[d]=="function"&&(r=i.splice(d,1)[0]);oe++,ae.set(r,oe);let s={cmd:e||"view_method",name:this._name,method:t,args:i,subscribe:!0,callback_id:oe};this._worker.post(s,r,n,!0)}}function a(t,e){return function(){var r=Array.prototype.slice.call(arguments,0,arguments.length);return new Promise(function(n,i){var s={cmd:e||"view_method",name:this._name,method:t,args:r,subscribe:!1};this._worker.post(s,n,i)}.bind(this))}}function h(t,e,r){return new Promise((n,i)=>{this._worker=t,this._name=Math.random()+"",this._worker.post({cmd:"view",view_name:this._name,table_name:e,config:r},()=>{n(this)},i),this._worker._initialized===!0&&!this._worker._features?.wait_for_response&&n(this)})}function _t(t,e){this._worker=t,this._name=e}_t.prototype=h.prototype;h.prototype.get_config=a("get_config");h.prototype.get_min_max=a("get_min_max");h.prototype.to_json=a("to_json");h.prototype.to_arrow=a("to_arrow");h.prototype.to_columns=a("to_columns");h.prototype.to_csv=a("to_csv");h.prototype.schema=a("schema");h.prototype.expression_schema=a("expression_schema");h.prototype.column_paths=a("column_paths");h.prototype.num_columns=a("num_columns");h.prototype.num_rows=a("num_rows");h.prototype.dimensions=a("dimensions");h.prototype.set_depth=a("set_depth");h.prototype.get_row_expanded=a("get_row_expanded");h.prototype.expand=a("expand");h.prototype.collapse=a("collapse");h.prototype.delete=a("delete");h.prototype.col_to_js_typed_array=a("col_to_js_typed_array");h.prototype.on_update=G("on_update","view_method",!0);h.prototype.remove_update=q("remove_update","view_method",!0);h.prototype.on_delete=G("on_delete","view_method",!0);h.prototype.remove_delete=q("remove_delete","view_method",!0);function X(t){let e=t;do for(let r of Object.getOwnPropertyNames(e)){let n=t[r];r!=="constructor"&&typeof n=="function"&&(t[r]=n.bind(t))}while(e=e!==Object&&Object.getPrototypeOf(e))}String.prototype.includes||(String.prototype.includes=function(t,e){return typeof e!="number"&&(e=0),e+t.length>this.length?!1:this.indexOf(t,e)!==-1});Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){if(this==null)throw new TypeError('"this" is null or not defined');var r=Object(this),n=r.length>>>0;if(n===0)return!1;var i=e|0,s=Math.max(i>=0?i:n-Math.abs(i),0);function d(c,o){return c===o||typeof c=="number"&&typeof o=="number"&&isNaN(c)&&isNaN(o)}for(;s<n;){if(d(r[s],t))return!0;s++}return!1}});function p(t,e,r){return new Promise((n,i)=>{this._worker=t,this._name=r.name||Math.random()+"",X(this),e.to_arrow?(this._worker.post({cmd:"table",name:this._name,args:[],options:r||{}}),e.to_arrow().then(s=>{this._worker.post({cmd:"table",name:this._name,args:[s],options:r||{}},()=>{e.on_update(d=>{this.update(d.delta)},{mode:"row"}),n(this)},i)})):this._worker.post({cmd:"table",name:this._name,args:[e],options:r||{}},()=>{n(this)},i),this._worker._initialized===!0&&!this._worker._features?.wait_for_response&&n(this)})}p.prototype.type="table";function se(t,e){this._worker=t,this._name=e}se.prototype=p.prototype;p.prototype.view=function(t){return new h(this._worker,this._name,t)};p.prototype.query_columns=a("query_columns","table_method");p.prototype.get_index=a("get_index","table_method");p.prototype.get_limit=a("get_limit","table_method");p.prototype.make_port=a("make_port","table_method");p.prototype.remove_port=a("remove_port","table_method");p.prototype.schema=a("schema","table_method");p.prototype.validate_expressions=a("validate_expressions","table_method");p.prototype.is_valid_filter=a("is_valid_filter","table_method");p.prototype.size=a("size","table_method");p.prototype.num_rows=a("num_rows","table_method");p.prototype.num_columns=a("num_columns","table_method");p.prototype.columns=a("columns","table_method");p.prototype.clear=a("clear","table_method");p.prototype.replace=a("replace","table_method");p.prototype.delete=a("delete","table_method");p.prototype.on_delete=G("on_delete","table_method",!0);p.prototype.remove=a("remove","table_method");p.prototype.remove_delete=q("remove_delete","table_method",!0);p.prototype.update=function(t,e){return new Promise((r,n)=>{this._worker.post({name:this._name,cmd:"table_method",method:"update",args:[t,e||{}]},r,n,!1)})};p.prototype.execute=function(t){this._worker.post({cmd:"table_execute",name:this._name,f:t.toString()})};var T=class{constructor(){this._initialized=!1,this._worker={initialized:{value:!1},transferable:!1,msg_id:0,handlers:{},messages:[]},X(this)}unsubscribe(e,r){for(let n of Object.keys(this._worker.handlers))this._worker.handlers[n].resolve===r&&delete this._worker.handlers[n]}post(e,r,n,i=!1){++this._worker.msg_id,(r||n)&&(this._worker.handlers[this._worker.msg_id]={resolve:r,reject:n,keep_alive:i}),e.id=this._worker.msg_id,this._worker.initialized.value?this.send(e):this._worker.messages.push(()=>{this.send(e),(e.cmd==="table"||e.cmd==="view")&&!this._features?.wait_for_response&&r&&r()})}async memory_usage(){return await new Promise((e,r)=>{this.post({cmd:"memory_usage"},e,r)})}initialize_profile_thread(){this._worker.initialized.value?this.send({id:-1,cmd:"init_profile_thread"}):this._worker.messages.push(()=>this.send({id:-1,cmd:"init_profile_thread"}))}send(){throw new Error("send() not implemented")}async open_table(e){return new se(this,e)}_handle(e){if(!this._worker.initialized.value){this._initialized||(this._initialized=!0);let r=this._worker.messages;if(this._worker.initialized.value=!0,this._worker.messages=[],e.data?.data){this._features={};for(let n of e.data.data)this._features[n]=!0}if(r)for(let n in r)r.hasOwnProperty(n)&&r[n]()}if(e.data.id){let r=this._worker.handlers[e.data.id];r&&(e.data.error?r.reject(e.data.error):r.resolve(e.data.data),r.keep_alive||delete this._worker.handlers[e.data.id])}}table(e,r){return new p(this,e,r||{})}terminate(){this._worker.terminate(),this._worker=void 0}};var Se=it(ze()),mt=3e4,J=class extends T{_ping(){this._ping_loop&&this._ws.send("ping"),this._ping_loop=setTimeout(this._ping.bind(this),mt)}_close(){clearTimeout(this._ping_loop),this._ping_loop=void 0,this._on_close_callback?.()}_onmessage(e){if(e.data!=="pong")if(this._pending_binary){let r=e.data;if(this._full_binary.set(new Uint8Array(r),this._total_chunk_length),this._total_chunk_length+=r.byteLength,this._total_chunk_length===this._pending_binary_length)r=this._full_binary.buffer;else return;let n={data:{id:this._pending_binary,data:r}};if(this._pending_port_id!==void 0){let i={port_id:this._pending_port_id,delta:r};n.data.data=i}this._handle(n),delete this._pending_binary,delete this._pending_binary_length,delete this._pending_port_id,this._total_chunk_length=0,this._full_binary=null}else e=JSON.parse(e.data),e.binary_length?(this._pending_binary=e.id,this._pending_binary_length=e.binary_length,e.data&&e.data.port_id!==void 0&&(this._pending_port_id=e.data.port_id),this._full_binary=new Uint8Array(this._pending_binary_length)):this._handle({data:e})}constructor(e){super(),this._ws=e,this._ws.binaryType="arraybuffer",this._full_binary,this._total_chunk_length=0,this._pending_binary_length=0,this._ws.onopen=()=>{this.send({id:-1,cmd:"init"})},this._ping(),this._ws.onclose=this._close.bind(this),this._ws.onmessage=this._onmessage.bind(this)}send(e){if(this._ws.readyState===Se.default.CLOSED){console.warn("Websocket connection is already closed.");return}if(e.args&&e.args.length>0&&e.args[0]instanceof ArrayBuffer&&e.args[0].byteLength!==void 0){let r=e;e.binary_length=e.args[0].byteLength,this._ws.send(JSON.stringify(r)),this._ws.send(e.args[0]);return}this._ws.send(JSON.stringify(e))}terminate(){return new Promise(e=>{this._on_close_callback=e,this._ws.close()})}};var _=Uint8Array,Z=Uint16Array,Te=Uint32Array,Fe=new _([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Ve=new _([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yt=new _([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ce=function(t,e){for(var r=new Z(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];for(var i=new Te(r[30]),n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)i[s]=s-r[n]<<5|n;return[r,i]},qe=Ce(Fe,2),Ge=qe[0],vt=qe[1];Ge[28]=258,vt[258]=28;var Ae=Ce(Ve,0),wt=Ae[0],sr=Ae[1],ce=new Z(32768);for(u=0;u<32768;++u)k=(u&43690)>>>1|(u&21845)<<1,k=(k&52428)>>>2|(k&13107)<<2,k=(k&61680)>>>4|(k&3855)<<4,ce[u]=((k&65280)>>>8|(k&255)<<8)>>>1;var k,u,A=function(t,e,r){for(var n=t.length,i=0,s=new Z(e);i<n;++i)t[i]&&++s[t[i]-1];var d=new Z(e);for(i=0;i<e;++i)d[i]=d[i-1]+s[i-1]<<1;var c;if(r){c=new Z(1<<e);var o=15-e;for(i=0;i<n;++i)if(t[i])for(var f=i<<4|t[i],g=e-t[i],y=d[t[i]-1]++<<g,b=y|(1<<g)-1;y<=b;++y)c[ce[y]>>>o]=f}else for(c=new Z(n),i=0;i<n;++i)t[i]&&(c[i]=ce[d[t[i]-1]++]>>>15-t[i]);return c},L=new _(288);for(u=0;u<144;++u)L[u]=8;var u;for(u=144;u<256;++u)L[u]=9;var u;for(u=256;u<280;++u)L[u]=7;var u;for(u=280;u<288;++u)L[u]=8;var u,Le=new _(32);for(u=0;u<32;++u)Le[u]=5;var u;var xt=A(L,9,1);var kt=A(Le,5,1),le=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},w=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(e&7)&r},ue=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(e&7)},Rt=function(t){return(t+7)/8|0},$=function(t,e,r){(e==null||e<0)&&(e=0),(r==null||r>t.length)&&(r=t.length);var n=new(t.BYTES_PER_ELEMENT==2?Z:t.BYTES_PER_ELEMENT==4?Te:_)(r-e);return n.set(t.subarray(e,r)),n};var bt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],m=function(t,e,r){var n=new Error(e||bt[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,m),!r)throw n;return n},Zt=function(t,e,r){var n=t.length;if(!n||r&&r.f&&!r.l)return e||new _(0);var i=!e||r,s=!r||r.i;r||(r={}),e||(e=new _(n*3));var d=function(ve){var we=e.length;if(ve>we){var xe=new _(Math.max(we*2,ve));xe.set(e),e=xe}},c=r.f||0,o=r.p||0,f=r.b||0,g=r.l,y=r.d,b=r.m,F=r.n,H=n*8;do{if(!g){c=w(t,o,1);var K=w(t,o+1,3);if(o+=3,K)if(K==1)g=xt,y=kt,b=9,F=5;else if(K==2){var I=w(t,o,31)+257,he=w(t,o+10,15)+4,pe=I+w(t,o+5,31)+1;o+=14;for(var V=new _(pe),P=new _(19),v=0;v<he;++v)P[yt[v]]=w(t,o+v*3,7);o+=he*3;for(var de=le(P),je=(1<<de)-1,Ye=A(P,de,1),v=0;v<pe;){var ge=Ye[w(t,o,je)];o+=ge&15;var x=ge>>>4;if(x<16)V[v++]=x;else{var z=0,E=0;for(x==16?(E=3+w(t,o,3),o+=2,z=V[v-1]):x==17?(E=3+w(t,o,7),o+=3):x==18&&(E=11+w(t,o,127),o+=7);E--;)V[v++]=z}}var _e=V.subarray(0,I),R=V.subarray(I);b=le(_e),F=le(R),g=A(_e,b,1),y=A(R,F,1)}else m(1);else{var x=Rt(o)+4,j=t[x-4]|t[x-3]<<8,Y=x+j;if(Y>n){s&&m(0);break}i&&d(f+j),e.set(t.subarray(x,Y),f),r.b=f+=j,r.p=o=Y*8,r.f=c;continue}if(o>H){s&&m(0);break}}i&&d(f+131072);for(var Ie=(1<<b)-1,Pe=(1<<F)-1,B=o;;B=o){var z=g[ue(t,o)&Ie],S=z>>>4;if(o+=z&15,o>H){s&&m(0);break}if(z||m(2),S<256)e[f++]=S;else if(S==256){B=o,g=null;break}else{var me=S-254;if(S>264){var v=S-257,C=Fe[v];me=w(t,o,(1<<C)-1)+Ge[v],o+=C}var W=y[ue(t,o)&Pe],U=W>>>4;W||m(3),o+=W&15;var R=wt[U];if(U>3){var C=Ve[U];R+=ue(t,o)&(1<<C)-1,o+=C}if(o>H){s&&m(0);break}i&&d(f+131072);for(var ye=f+me;f<ye;f+=4)e[f]=e[f-R],e[f+1]=e[f+1-R],e[f+2]=e[f+2-R],e[f+3]=e[f+3-R];f=ye}}r.l=g,r.p=B,r.b=f,r.f=c,g&&(c=1,r.m=b,r.d=y,r.n=F)}while(!c);return f==e.length?e:$(e,0,f)};var Ot=new _(0);var zt=function(t){(t[0]!=31||t[1]!=139||t[2]!=8)&&m(6,"invalid gzip data");var e=t[3],r=10;e&4&&(r+=t[10]|(t[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!t[r++]);return r+(e&2)};var O=function(){function t(e){this.s={},this.p=new _(0),this.ondata=e}return t.prototype.e=function(e){this.ondata||m(5),this.d&&m(4);var r=this.p.length,n=new _(r+e.length);n.set(this.p),n.set(e,r),this.p=n},t.prototype.c=function(e){this.d=this.s.i=e||!1;var r=this.s.b,n=Zt(this.p,this.o,this.s);this.ondata($(n,r,this.s.b),this.d),this.o=$(n,this.s.b-32768),this.s.b=this.o.length,this.p=$(this.p,this.s.p/8|0),this.s.p&=7},t.prototype.push=function(e,r){this.e(e),this.c(r)},t}();var St=function(){function t(e){this.v=1,O.call(this,e)}return t.prototype.push=function(e,r){if(O.prototype.e.call(this,e),this.v){var n=this.p.length>3?zt(this.p):4;if(n>=this.p.length&&!r)return;this.p=this.p.subarray(n),this.v=0}r&&(this.p.length<8&&m(6,"invalid gzip data"),this.p=this.p.subarray(0,-8)),O.prototype.c.call(this,r)},t}();var Tt=function(){function t(e){this.v=1,O.call(this,e)}return t.prototype.push=function(e,r){if(O.prototype.e.call(this,e),this.v){if(this.p.length<2&&!r)return;this.p=this.p.subarray(2),this.v=0}r&&(this.p.length<4&&m(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),O.prototype.c.call(this,r)},t}();var Ee=function(){function t(e){this.G=St,this.I=O,this.Z=Tt,this.ondata=e}return t.prototype.push=function(e,r){if(this.ondata||m(5),this.s)this.s.push(e,r);else{if(this.p&&this.p.length){var n=new _(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,s=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(s):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(s):new this.Z(s),this.s.push(this.p,r),this.p=null}}},t}();var Ft=typeof TextDecoder<"u"&&new TextDecoder,Vt=0;try{Ft.decode(Ot,{stream:!0}),Vt=1}catch{}var Ne="./perspective.worker.js";async function qt(){let t=new URL(Ne,import.meta.url);return await(await fetch(t)).text()}function De(t,e){function r(i,s){t.push(s)}function n(i){if(Object.keys(i).length>0)for(let s of e)s({data:i})}return{addEventListener:r,postMessage:n,location:{href:""}}}function Xe(t){let e=Function("const self = arguments[0];"+t),r=[],n=[];return e(De(r,n)),De(n,r)}var Gt=qt(),At=async function(){let t=await Gt;if(window.location.protocol.startsWith("file")&&!window.isElectron)return console.warn("file:// protocol does not support Web Workers"),Xe(t);try{let e=new Blob([t],{type:"application/javascript"}),r=URL.createObjectURL(e);return new Worker(r,{type:"module"})}catch(e){return console.warn("Failed to instantiate worker, falling back to single-threaded runtime",e),Xe(t)}},Je=At;var $e="./perspective.cpp.wasm";async function Et(){return new URL($e,import.meta.url)}var Me=Et();var Ke=!1;function He(t){return new Uint32Array(t.slice(0,4))[0]==559903}var fe=function(){let t;return function(){return t||(t=new class{async worker(){return await Je()}async wasm(){let e=await Me,r=[],n=0,i=new Ee(c=>{c&&(n+=c.byteLength,r.push(c))});if(e instanceof ArrayBuffer&&!e.buffer&&(e=new Uint8Array(e)),e.buffer&&e.buffer instanceof ArrayBuffer)Ke=!0,He(e.buffer)?i.push(e,!0):(n=e.byteLength,r=[e]);else if(e instanceof ArrayBuffer)n=e.byteLength,r=[new Uint8Array(e)];else{let o=(await fetch(e)).body.getReader(),f=0;for(;;){let{value:g,done:y}=await o.read();if(y)break;f===0&&He(g.buffer)||f===1?(f=1,i.push(g,y)):(f=2,n+=g.byteLength,r.push(g))}}let s=0,d=new Uint8Array(n);for(let c of r)d.set(c,s),s+=c.byteLength;return this._wasm=d.buffer,this._wasm}}),t}}(),M=class extends T{constructor(e){e&&Ze(e),super(),this.register()}async register(){let e,r={cmd:"init",config:D()};if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported.");[e,r.buffer]=await Promise.all([fe().worker(),fe().wasm()]);for(var n in this._worker)e[n]=this._worker[n];this._worker=e,this._worker.addEventListener("message",this._handle.bind(this)),this._worker.postMessage(r),this._detect_transferable()}send(e){this._worker.transferable&&e.args&&e.args[0]instanceof ArrayBuffer?this._worker.postMessage(e,[e.args[0]]):this._worker.postMessage(e)}terminate(){this._worker.terminate(),this._worker=void 0}get transferable(){return this._worker?.transferable||!1}get inline(){return Ke}_detect_transferable(){var e=new ArrayBuffer(1);this._worker.postMessage(e,[e]),this._worker.transferable=e.byteLength===0}},Nt=function(){let t,e;return{getInstance:function(r){t===void 0&&(t=new M(r));let n=JSON.stringify(r);if(e&&n!==e)throw new Error("Configuration object for shared_worker() has changed - this is probably a bug in your application.");return e=n,t}}}(),kr=ie;function Dt(t){return fe().set(t)}function Xt(t){return new M(t)}function Jt(t=window.location.origin.replace("http","ws")){return new J(new WebSocket(t))}function $t(t){return Nt.getInstance(t)}var Rr={override:Dt,worker:Xt,websocket:Jt,shared_worker:$t,...Object.keys(te)};export{Rr as default,kr as get_type_config,Dt as override,$t as shared_worker,Jt as websocket,Xt as worker};
//# sourceMappingURL=perspective.js.map
