var ce=Object.defineProperty;var ae=(n,e)=>{for(var t in e)ce(n,t,{get:e[t],enumerable:!0})};var z={};ae(z,{Client:()=>W,ProxySession:()=>j,Table:()=>E,View:()=>h,default:()=>F,init:()=>C,initSync:()=>me});var M=class extends Error{};var _,d=new Array(128).fill(void 0);d.push(void 0,null,!0,!1);function o(n){return d[n]}var m=0,S=null;function U(){return(S===null||S.byteLength===0)&&(S=new Uint8Array(_.memory.buffer)),S}var K=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ue=function(n,e){return K.encodeInto(n,e)};function k(n,e,t){if(t===void 0){let f=K.encode(n),l=e(f.length,1)>>>0;return U().subarray(l,l+f.length).set(f),m=f.length,l}let r=n.length,s=e(r,1)>>>0,a=U(),u=0;for(;u<r;u++){let f=n.charCodeAt(u);if(f>127)break;a[s+u]=f}if(u!==r){u!==0&&(n=n.slice(u)),s=t(s,r,r=u+n.length*3,1)>>>0;let f=U().subarray(s+u,s+r);u+=ue(n,f).written,s=t(s,r,u,1)>>>0}return m=u,s}var x=null;function g(){return(x===null||x.buffer.detached===!0||x.buffer.detached===void 0&&x.buffer!==_.memory.buffer)&&(x=new DataView(_.memory.buffer)),x}var I=d.length;function i(n){I===d.length&&d.push(d.length+1);let e=I;return I=d[e],d[e]=n,e}function w(n,e){try{return n.apply(this,e)}catch(t){_.__wbindgen_export_2(i(t))}}var Q=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Q.decode();function p(n,e){return n=n>>>0,Q.decode(U().subarray(n,n+e))}function b(n){return n==null}function fe(n){n<132||(d[n]=I,I=n)}function c(n){let e=o(n);return fe(n),e}var R=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>{_.__wbindgen_export_4.get(n.dtor)(n.a,n.b)});function be(n,e,t,r){let s={a:n,b:e,cnt:1,dtor:t},a=(...u)=>{s.cnt++;let f=s.a;s.a=0;try{return r(f,s.b,...u)}finally{--s.cnt===0?(_.__wbindgen_export_4.get(s.dtor)(f,s.b),R.unregister(s)):s.a=f}};return a.original=s,R.register(a,s,s),a}function ge(n,e,t,r){let s={a:n,b:e,cnt:1,dtor:t},a=(...u)=>{s.cnt++;try{return r(s.a,s.b,...u)}finally{--s.cnt===0&&(_.__wbindgen_export_4.get(s.dtor)(s.a,s.b),s.a=0,R.unregister(s))}};return a.original=s,R.register(a,s,s),a}function T(n){let e=typeof n;if(e=="number"||e=="boolean"||n==null)return`${n}`;if(e=="string")return`"${n}"`;if(e=="symbol"){let s=n.description;return s==null?"Symbol":`Symbol(${s})`}if(e=="function"){let s=n.name;return typeof s=="string"&&s.length>0?`Function(${s})`:"Function"}if(Array.isArray(n)){let s=n.length,a="[";s>0&&(a+=T(n[0]));for(let u=1;u<s;u++)a+=", "+T(n[u]);return a+="]",a}let t=/\[object ([^\]]+)\]/.exec(toString.call(n)),r;if(t&&t.length>1)r=t[1];else return toString.call(n);if(r=="Object")try{return"Object("+JSON.stringify(n)+")"}catch{return"Object"}return n instanceof Error?`${n.name}: ${n.message}
${n.stack}`:r}function le(n,e){if(!(n instanceof e))throw new Error(`expected instance of ${e.name}`)}var O=128;function X(n){if(O==1)throw new Error("out of js stack");return d[--O]=n,O}function C(){_.init()}function we(n,e){let t=_.__wbindgen_export_5(n,e);return c(t)}function pe(n,e,t){_.__wbindgen_export_6(n,e,i(t))}function de(n,e,t,r){_.__wbindgen_export_7(n,e,i(t),i(r))}var L=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_client_free(n>>>0,1)),W=class{static __wrap(e){e=e>>>0;let t=Object.create(W.prototype);return t.__wbg_ptr=e,L.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,L.unregister(this),e}free(){let e=this.__destroy_into_raw();_.__wbg_client_free(e,0)}__getClassname(){let e,t;try{let a=_.__wbindgen_add_to_stack_pointer(-16);_.client___getClassname(a,this.__wbg_ptr);var r=g().getInt32(a+4*0,!0),s=g().getInt32(a+4*1,!0);return e=r,t=s,p(r,s)}finally{_.__wbindgen_add_to_stack_pointer(16),_.__wbindgen_export_3(e,t,1)}}constructor(e,t){let r=_.client_new(i(e),b(t)?0:i(t));return this.__wbg_ptr=r>>>0,L.register(this,this.__wbg_ptr,this),this}new_proxy_session(e){try{let t=_.client_new_proxy_session(this.__wbg_ptr,X(e));return j.__wrap(t)}finally{d[O++]=void 0}}init(){let e=_.client_init(this.__wbg_ptr);return c(e)}handle_response(e){let t=_.client_handle_response(this.__wbg_ptr,i(e));return c(t)}handle_error(e,t){var r=b(e)?0:k(e,_.__wbindgen_export_0,_.__wbindgen_export_1),s=m;let a=_.client_handle_error(this.__wbg_ptr,r,s,b(t)?0:i(t));return c(a)}on_error(e){let t=_.client_on_error(this.__wbg_ptr,i(e));return c(t)}table(e,t){let r=_.client_table(this.__wbg_ptr,i(e),b(t)?0:i(t));return c(r)}terminate(){try{let s=_.__wbindgen_add_to_stack_pointer(-16);_.client_terminate(s,this.__wbg_ptr);var e=g().getInt32(s+4*0,!0),t=g().getInt32(s+4*1,!0),r=g().getInt32(s+4*2,!0);if(r)throw c(t);return c(e)}finally{_.__wbindgen_add_to_stack_pointer(16)}}open_table(e){let t=k(e,_.__wbindgen_export_0,_.__wbindgen_export_1),r=m,s=_.client_open_table(this.__wbg_ptr,t,r);return c(s)}get_hosted_table_names(){let e=_.client_get_hosted_table_names(this.__wbg_ptr);return c(e)}on_hosted_tables_update(e){let t=_.client_on_hosted_tables_update(this.__wbg_ptr,i(e));return c(t)}remove_hosted_tables_update(e){let t=_.client_remove_hosted_tables_update(this.__wbg_ptr,e);return c(t)}system_info(){let e=_.client_system_info(this.__wbg_ptr);return c(e)}},N=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_proxysession_free(n>>>0,1)),j=class{static __wrap(e){e=e>>>0;let t=Object.create(j.prototype);return t.__wbg_ptr=e,N.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,N.unregister(this),e}free(){let e=this.__destroy_into_raw();_.__wbg_proxysession_free(e,0)}constructor(e,t){try{le(e,W);let r=_.client_new_proxy_session(e.__wbg_ptr,X(t));return this.__wbg_ptr=r>>>0,N.register(this,this.__wbg_ptr,this),this}finally{d[O++]=void 0}}handle_request(e){let t=_.proxysession_handle_request(this.__wbg_ptr,i(e));return c(t)}poll(){let e=_.proxysession_poll(this.__wbg_ptr);return c(e)}close(){let e=this.__destroy_into_raw(),t=_.proxysession_close(e);return c(t)}},V=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_table_free(n>>>0,1)),E=class{static __wrap(e){e=e>>>0;let t=Object.create(E.prototype);return t.__wbg_ptr=e,V.register(t,t.__wbg_ptr,t),t}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,V.unregister(this),e}free(){let e=this.__destroy_into_raw();_.__wbg_table_free(e,0)}__getClassname(){let e,t;try{let a=_.__wbindgen_add_to_stack_pointer(-16);_.table___getClassname(a,this.__wbg_ptr);var r=g().getInt32(a+4*0,!0),s=g().getInt32(a+4*1,!0);return e=r,t=s,p(r,s)}finally{_.__wbindgen_add_to_stack_pointer(16),_.__wbindgen_export_3(e,t,1)}}get_index(){let e=_.table_get_index(this.__wbg_ptr);return c(e)}get_client(){let e=_.table_get_client(this.__wbg_ptr);return c(e)}get_name(){let e=_.table_get_name(this.__wbg_ptr);return c(e)}get_limit(){let e=_.table_get_limit(this.__wbg_ptr);return c(e)}clear(){let e=_.table_clear(this.__wbg_ptr);return c(e)}delete(){let e=_.table_delete(this.__wbg_ptr);return c(e)}size(){let e=_.table_size(this.__wbg_ptr);return c(e)}schema(){let e=_.table_schema(this.__wbg_ptr);return c(e)}columns(){let e=_.table_columns(this.__wbg_ptr);return c(e)}make_port(){let e=_.table_make_port(this.__wbg_ptr);return c(e)}on_delete(e){let t=_.table_on_delete(this.__wbg_ptr,i(e));return c(t)}remove_delete(e){let t=_.table_remove_delete(this.__wbg_ptr,e);return c(t)}remove(e,t){let r=_.table_remove(this.__wbg_ptr,i(e),b(t)?0:i(t));return c(r)}replace(e,t){let r=_.table_replace(this.__wbg_ptr,i(e),b(t)?0:i(t));return c(r)}update(e,t){let r=_.table_update(this.__wbg_ptr,i(e),b(t)?0:i(t));return c(r)}view(e){let t=_.table_view(this.__wbg_ptr,b(e)?0:i(e));return c(t)}validate_expressions(e){let t=_.table_validate_expressions(this.__wbg_ptr,i(e));return c(t)}},J=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>_.__wbg_view_free(n>>>0,1)),h=class{static __wrap(e){e=e>>>0;let t=Object.create(h.prototype);return t.__wbg_ptr=e,J.register(t,t.__wbg_ptr,t),t}static __unwrap(e){return e instanceof h?e.__destroy_into_raw():0}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,J.unregister(this),e}free(){let e=this.__destroy_into_raw();_.__wbg_view_free(e,0)}__get_model(){let e=_.view___get_model(this.__wbg_ptr);return h.__wrap(e)}column_paths(){let e=_.view_column_paths(this.__wbg_ptr);return c(e)}delete(){let e=_.view_delete(this.__wbg_ptr);return c(e)}dimensions(){let e=_.view_dimensions(this.__wbg_ptr);return c(e)}expression_schema(){let e=_.view_expression_schema(this.__wbg_ptr);return c(e)}get_config(){let e=_.view_get_config(this.__wbg_ptr);return c(e)}get_min_max(e){let t=k(e,_.__wbindgen_export_0,_.__wbindgen_export_1),r=m,s=_.view_get_min_max(this.__wbg_ptr,t,r);return c(s)}num_rows(){let e=_.view_num_rows(this.__wbg_ptr);return c(e)}schema(){let e=_.view_schema(this.__wbg_ptr);return c(e)}to_arrow(e){let t=_.view_to_arrow(this.__wbg_ptr,b(e)?0:i(e));return c(t)}to_columns_string(e){let t=_.view_to_columns_string(this.__wbg_ptr,b(e)?0:i(e));return c(t)}to_columns(e){let t=_.view_to_columns(this.__wbg_ptr,b(e)?0:i(e));return c(t)}to_json_string(e){let t=_.view_to_json_string(this.__wbg_ptr,b(e)?0:i(e));return c(t)}to_json(e){let t=_.view_to_json(this.__wbg_ptr,b(e)?0:i(e));return c(t)}to_ndjson(e){let t=_.view_to_ndjson(this.__wbg_ptr,b(e)?0:i(e));return c(t)}to_csv(e){let t=_.view_to_csv(this.__wbg_ptr,b(e)?0:i(e));return c(t)}on_update(e,t){let r=_.view_on_update(this.__wbg_ptr,i(e),b(t)?0:i(t));return c(r)}remove_update(e){let t=_.view_remove_update(this.__wbg_ptr,e);return c(t)}on_delete(e){let t=_.view_on_delete(this.__wbg_ptr,i(e));return c(t)}num_columns(){let e=_.view_num_columns(this.__wbg_ptr);return c(e)}remove_delete(e){let t=_.view_remove_delete(this.__wbg_ptr,e);return c(t)}collapse(e){let t=_.view_collapse(this.__wbg_ptr,e);return c(t)}expand(e){let t=_.view_expand(this.__wbg_ptr,e);return c(t)}set_depth(e){let t=_.view_set_depth(this.__wbg_ptr,e);return c(t)}};async function ye(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}let t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{let t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function Y(){let n={};return n.wbg={},n.wbg.__wbg_String_8f0eb39a4a4c2f66=function(e,t){let r=String(o(t)),s=k(r,_.__wbindgen_export_0,_.__wbindgen_export_1),a=m;g().setInt32(e+4*1,a,!0),g().setInt32(e+4*0,s,!0)},n.wbg.__wbg_at_1abf0efc31a7fc6e=function(e,t){let r=o(e).at(t);return i(r)},n.wbg.__wbg_buffer_bacd7706db793204=function(e){let t=o(e).buffer;return i(t)},n.wbg.__wbg_buffer_ef9774282e5dab94=function(e){let t=o(e).buffer;return i(t)},n.wbg.__wbg_call_0ad083564791763a=function(){return w(function(e,t){let r=o(e).call(o(t));return i(r)},arguments)},n.wbg.__wbg_call_a34b6b4765f27be0=function(){return w(function(e,t,r){let s=o(e).call(o(t),o(r));return i(s)},arguments)},n.wbg.__wbg_call_efe5a4db7065d1a2=function(){return w(function(e,t,r,s){let a=o(e).call(o(t),o(r),o(s));return i(a)},arguments)},n.wbg.__wbg_client_new=function(e){let t=W.__wrap(e);return i(t)},n.wbg.__wbg_crypto_ed58b8e10a292839=function(e){let t=o(e).crypto;return i(t)},n.wbg.__wbg_debug_338493c12960e4a7=function(e){console.debug(o(e))},n.wbg.__wbg_debug_f201c091a5d2019b=function(e,t,r,s){console.debug(o(e),o(t),o(r),o(s))},n.wbg.__wbg_done_f4c254830a095eaf=function(e){return o(e).done},n.wbg.__wbg_entries_83beb641792ccb9c=function(e){let t=Object.entries(o(e));return i(t)},n.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let r,s;try{r=e,s=t,console.error(p(e,t))}finally{_.__wbindgen_export_3(r,s,1)}},n.wbg.__wbg_error_852b114509bed301=function(e){console.error(o(e))},n.wbg.__wbg_error_94252a8e90b35b8e=function(e,t,r,s){console.error(o(e),o(t),o(r),o(s))},n.wbg.__wbg_error_afd05d3fc1f414ce=function(e,t){console.error(o(e),o(t))},n.wbg.__wbg_from_3aa0fcaa8eef0104=function(e){let t=Array.from(o(e));return i(t)},n.wbg.__wbg_getEntriesByName_6fb8ccc67553373f=function(e,t,r,s,a){let u=o(e).getEntriesByName(p(t,r),p(s,a));return i(u)},n.wbg.__wbg_getRandomValues_bcb4912f16000dc4=function(){return w(function(e,t){o(e).getRandomValues(o(t))},arguments)},n.wbg.__wbg_get_0c3cc364764a0b98=function(e,t){let r=o(e)[t>>>0];return i(r)},n.wbg.__wbg_get_977cbaa63dc20090=function(e,t,r){let s=o(e)[p(t,r)];return b(s)?0:i(s)},n.wbg.__wbg_get_b996a12be035ef4f=function(){return w(function(e,t){let r=Reflect.get(o(e),o(t));return i(r)},arguments)},n.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){let r=o(e)[o(t)];return i(r)},n.wbg.__wbg_globalThis_6b4d52a0b6aaeaea=function(){return w(function(){let e=globalThis.globalThis;return i(e)},arguments)},n.wbg.__wbg_global_49324ce12193de77=function(){return w(function(){let e=global.global;return i(e)},arguments)},n.wbg.__wbg_has_bdec43a5ed4cb454=function(){return w(function(e,t){return Reflect.has(o(e),o(t))},arguments)},n.wbg.__wbg_info_493696cc38ae1ad0=function(e,t,r,s){console.info(o(e),o(t),o(r),o(s))},n.wbg.__wbg_info_6c1abe3d4e1ae962=function(e){console.info(o(e))},n.wbg.__wbg_instanceof_ArrayBuffer_ff40e55b5978e215=function(e){let t;try{t=o(e)instanceof ArrayBuffer}catch{t=!1}return t},n.wbg.__wbg_instanceof_Array_23bc22ecdd4608e6=function(e){let t;try{t=o(e)instanceof Array}catch{t=!1}return t},n.wbg.__wbg_instanceof_Map_0f3f3653f757ced1=function(e){let t;try{t=o(e)instanceof Map}catch{t=!1}return t},n.wbg.__wbg_instanceof_Object_9108547bac1f91b1=function(e){let t;try{t=o(e)instanceof Object}catch{t=!1}return t},n.wbg.__wbg_instanceof_PerspectiveViewNotFoundError_b4d9eb94ce63f22c=function(e){let t;try{t=o(e)instanceof M}catch{t=!1}return t},n.wbg.__wbg_instanceof_Uint8Array_db97368f94b1373f=function(e){let t;try{t=o(e)instanceof Uint8Array}catch{t=!1}return t},n.wbg.__wbg_instanceof_Window_311934805c10047c=function(e){let t;try{t=o(e)instanceof Window}catch{t=!1}return t},n.wbg.__wbg_isArray_8738f1062fa88586=function(e){return Array.isArray(o(e))},n.wbg.__wbg_isSafeInteger_a1b3e0811faecf2f=function(e){return Number.isSafeInteger(o(e))},n.wbg.__wbg_iterator_c0c688f37fa815e6=function(){return i(Symbol.iterator)},n.wbg.__wbg_keys_45b15edb4089351e=function(e){let t=Object.keys(o(e));return i(t)},n.wbg.__wbg_length_12246a78d2f65d3a=function(e){return o(e).length},n.wbg.__wbg_length_c24da17096edfe57=function(e){return o(e).length},n.wbg.__wbg_mark_2e459508e2ea726f=function(){return w(function(e,t,r){o(e).mark(p(t,r))},arguments)},n.wbg.__wbg_measure_590e79f6f28bcf70=function(){return w(function(e,t,r,s,a){o(e).measure(p(t,r),p(s,a))},arguments)},n.wbg.__wbg_msCrypto_0a36e2ec3a343d26=function(e){let t=o(e).msCrypto;return i(t)},n.wbg.__wbg_new_518e2184725aa711=function(){return i(new Map)},n.wbg.__wbg_new_5479cd54aab193ea=function(){let e=new M;return i(e)},n.wbg.__wbg_new_59845962d1127937=function(e){let t=new Uint8Array(o(e));return i(t)},n.wbg.__wbg_new_67abf4a77618ee3e=function(){let e=new Object;return i(e)},n.wbg.__wbg_new_8a6f238a6ece86ea=function(){let e=new Error;return i(e)},n.wbg.__wbg_new_ac7361beaf933ba6=function(e,t){try{var r={a:e,b:t},s=(u,f)=>{let l=r.a;r.a=0;try{return de(l,r.b,u,f)}finally{r.a=l}};let a=new Promise(s);return i(a)}finally{r.a=r.b=0}},n.wbg.__wbg_new_e2d07398d7689006=function(){let e=new Array;return i(e)},n.wbg.__wbg_newnoargs_a136448eeb7d48ac=function(e,t){let r=new Function(p(e,t));return i(r)},n.wbg.__wbg_newwithbyteoffsetandlength_84908302a4c137cf=function(e,t,r){let s=new Uint8Array(o(e),t>>>0,r>>>0);return i(s)},n.wbg.__wbg_newwithlength_4c216eaaf23f2f9a=function(e){let t=new Uint8Array(e>>>0);return i(t)},n.wbg.__wbg_next_928df8c15fc0c9b0=function(e){let t=o(e).next;return i(t)},n.wbg.__wbg_next_9dc0926f351c7090=function(){return w(function(e){let t=o(e).next();return i(t)},arguments)},n.wbg.__wbg_node_02999533c4ea02e3=function(e){let t=o(e).node;return i(t)},n.wbg.__wbg_now_c893509b6d04fa0d=function(e){return o(e).now()},n.wbg.__wbg_parse_bd09af51fd7dd576=function(){return w(function(e,t){let r=JSON.parse(p(e,t));return i(r)},arguments)},n.wbg.__wbg_performance_69882c3bda965f91=function(e){let t=o(e).performance;return b(t)?0:i(t)},n.wbg.__wbg_process_5c1d670bc53614b8=function(e){let t=o(e).process;return i(t)},n.wbg.__wbg_push_e7d7247e69dad3ee=function(e,t){return o(e).push(o(t))},n.wbg.__wbg_queueMicrotask_6808622725a52272=function(e){let t=o(e).queueMicrotask;return i(t)},n.wbg.__wbg_queueMicrotask_ef0e86b0263a71ee=function(e){queueMicrotask(o(e))},n.wbg.__wbg_randomFillSync_ab2cfe79ebbf2740=function(){return w(function(e,t){o(e).randomFillSync(c(t))},arguments)},n.wbg.__wbg_reject_fd3a67e45841ae99=function(e){let t=Promise.reject(o(e));return i(t)},n.wbg.__wbg_require_79b1e9274cde3c87=function(){return w(function(){let e=module.require;return i(e)},arguments)},n.wbg.__wbg_resolve_267ff08e7e1d2ce4=function(e){let t=Promise.resolve(o(e));return i(t)},n.wbg.__wbg_self_cca3ca60d61220f4=function(){return w(function(){let e=self.self;return i(e)},arguments)},n.wbg.__wbg_set_393f510a6b7e9da5=function(e,t,r){let s=o(e).set(o(t),o(r));return i(s)},n.wbg.__wbg_set_3f1d0b984ed272ed=function(e,t,r){o(e)[c(t)]=c(r)},n.wbg.__wbg_set_5deee49b10b2b780=function(e,t,r){o(e).set(o(t),r>>>0)},n.wbg.__wbg_set_93ba9407b5476ec6=function(e,t,r){o(e)[t>>>0]=c(r)},n.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){let r=o(t).stack,s=k(r,_.__wbindgen_export_0,_.__wbindgen_export_1),a=m;g().setInt32(e+4*1,a,!0),g().setInt32(e+4*0,s,!0)},n.wbg.__wbg_startTime_06f7b6aebc293aff=function(e){return o(e).startTime},n.wbg.__wbg_stringify_841980d1bf485619=function(){return w(function(e){let t=JSON.stringify(o(e));return i(t)},arguments)},n.wbg.__wbg_subarray_2dc34705c0dc7cdb=function(e,t,r){let s=o(e).subarray(t>>>0,r>>>0);return i(s)},n.wbg.__wbg_table_new=function(e){let t=E.__wrap(e);return i(t)},n.wbg.__wbg_then_84907e7a6730461e=function(e,t){let r=o(e).then(o(t));return i(r)},n.wbg.__wbg_then_db12746ab6cec3f6=function(e,t,r){let s=o(e).then(o(t),o(r));return i(s)},n.wbg.__wbg_toString_2a965b6fc5a7e89f=function(e){let t=o(e).toString();return i(t)},n.wbg.__wbg_trace_04e683e452168e85=function(e,t,r,s){console.trace(o(e),o(t),o(r),o(s))},n.wbg.__wbg_trace_bf1357f2a705e4dd=function(e){console.trace(o(e))},n.wbg.__wbg_value_51f8a88d4a1805fb=function(e){let t=o(e).value;return i(t)},n.wbg.__wbg_values_9b070f5059e8183e=function(e){let t=Object.values(o(e));return i(t)},n.wbg.__wbg_versions_c71aa1626a93e0a1=function(e){let t=o(e).versions;return i(t)},n.wbg.__wbg_view_new=function(e){let t=h.__wrap(e);return i(t)},n.wbg.__wbg_view_unwrap=function(e){return h.__unwrap(c(e))},n.wbg.__wbg_warn_4f29d3e20ba97cd0=function(e,t,r,s){console.warn(o(e),o(t),o(r),o(s))},n.wbg.__wbg_warn_fecc8e96c5e56fb2=function(e){console.warn(o(e))},n.wbg.__wbg_window_2aba046d3fc4ad7c=function(){return w(function(){let e=window.window;return i(e)},arguments)},n.wbg.__wbindgen_as_number=function(e){return+o(e)},n.wbg.__wbindgen_bigint_from_i64=function(e){return i(e)},n.wbg.__wbindgen_bigint_from_u64=function(e){let t=BigInt.asUintN(64,e);return i(t)},n.wbg.__wbindgen_bigint_get_as_i64=function(e,t){let r=o(t),s=typeof r=="bigint"?r:void 0;g().setBigInt64(e+8*1,b(s)?BigInt(0):s,!0),g().setInt32(e+4*0,!b(s),!0)},n.wbg.__wbindgen_boolean_get=function(e){let t=o(e);return typeof t=="boolean"?t?1:0:2},n.wbg.__wbindgen_cb_drop=function(e){let t=c(e).original;return t.cnt--==1?(t.a=0,!0):!1},n.wbg.__wbindgen_closure_wrapper3145=function(e,t,r){let s=be(e,t,469,pe);return i(s)},n.wbg.__wbindgen_closure_wrapper372=function(e,t,r){let s=ge(e,t,4,we);return i(s)},n.wbg.__wbindgen_debug_string=function(e,t){let r=T(o(t)),s=k(r,_.__wbindgen_export_0,_.__wbindgen_export_1),a=m;g().setInt32(e+4*1,a,!0),g().setInt32(e+4*0,s,!0)},n.wbg.__wbindgen_error_new=function(e,t){let r=new Error(p(e,t));return i(r)},n.wbg.__wbindgen_in=function(e,t){return o(e)in o(t)},n.wbg.__wbindgen_is_bigint=function(e){return typeof o(e)=="bigint"},n.wbg.__wbindgen_is_function=function(e){return typeof o(e)=="function"},n.wbg.__wbindgen_is_object=function(e){let t=o(e);return typeof t=="object"&&t!==null},n.wbg.__wbindgen_is_string=function(e){return typeof o(e)=="string"},n.wbg.__wbindgen_is_undefined=function(e){return o(e)===void 0},n.wbg.__wbindgen_jsval_eq=function(e,t){return o(e)===o(t)},n.wbg.__wbindgen_jsval_loose_eq=function(e,t){return o(e)==o(t)},n.wbg.__wbindgen_memory=function(){let e=_.memory;return i(e)},n.wbg.__wbindgen_number_get=function(e,t){let r=o(t),s=typeof r=="number"?r:void 0;g().setFloat64(e+8*1,b(s)?0:s,!0),g().setInt32(e+4*0,!b(s),!0)},n.wbg.__wbindgen_number_new=function(e){return i(e)},n.wbg.__wbindgen_object_clone_ref=function(e){let t=o(e);return i(t)},n.wbg.__wbindgen_object_drop_ref=function(e){c(e)},n.wbg.__wbindgen_string_get=function(e,t){let r=o(t),s=typeof r=="string"?r:void 0;var a=b(s)?0:k(s,_.__wbindgen_export_0,_.__wbindgen_export_1),u=m;g().setInt32(e+4*1,u,!0),g().setInt32(e+4*0,a,!0)},n.wbg.__wbindgen_string_new=function(e,t){let r=p(e,t);return i(r)},n.wbg.__wbindgen_throw=function(e,t){throw new Error(p(e,t))},n}function Z(n,e){return _=n.exports,ee.__wbindgen_wasm_module=e,x=null,S=null,_}function me(n){if(_!==void 0)return _;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));let e=Y();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));let t=new WebAssembly.Instance(n,e);return Z(t,n)}async function ee(n){if(_!==void 0)return _;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead"));let e=Y();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));let{instance:t,module:r}=await ye(await n,e);return Z(t,r)}var F=ee;function he(){let n,e,t=new Promise((r,s)=>{n=r,e=s});return[n,t,e]}async function te(n,e,t){let r,s;async function a(){if(s?.readyState===n.CONNECTING||s?.readyState===n.OPEN){console.warn(`Already connected ${s.readyState}`);return}let[l,y,$]=he();s=new n(t),s.onopen=l,s.binaryType="arraybuffer",s.onerror=B=>{r.handle_error("WebSocket error",a),$("WebSocket error")},s.onclose=B=>{let G=`WebSocket closed ${B.code}`;r.handle_error(G,a),$(G)},s.onmessage=B=>{r.handle_response(B.data)},await y}async function u(l){if(s.readyState===n.CLOSING||s.readyState===n.CLOSED){let y=`WebSocket transport error (${s.readyState})`;throw r.handle_error(y,a),new Error(y)}else if(s.readyState===n.CONNECTING){let y=`WebSocket message dropped (${s.readyState})`;throw new Error(y)}else{let y=l.slice().buffer;s.send(y)}}async function f(){console.debug("Closing WebSocket"),s.close()}return r=new e(u,f),await a(),await r.init(),r}function Ae(){let n,e,t=new Promise((r,s)=>{n=r,e=s});return[n,t,e]}async function xe(n,e){let[t,r]=Ae();n.addEventListener("message",function s(a){n.removeEventListener("message",s),t(null)}),n.onmessage=function(a){n.onmessage=function(){},t(null)},n.onmessageerror=console.error,n.postMessage({cmd:"init",args:[e]},{transfer:e instanceof WebAssembly.Module?[]:[e]}),await r}async function ne(n,e,t){let[r,s]=await Promise.all([e,t]),{Client:a}=await n,u;if(typeof SharedWorker<"u"&&s instanceof SharedWorker)u=s.port;else{s=s;let l=new MessageChannel;s.postMessage(null,[l.port2]),u=l.port1}let f=new a(async l=>{let y=l.slice().buffer;u.postMessage(y,{transfer:[y]})},async()=>{console.debug("Closing WebWorker"),u.close()});return await xe(u,r),u.addEventListener("message",l=>{f.handle_response(l.data)}),await f.init(),f}async function re(n,e){let{Client:t}=await n;return await te(WebSocket,t,e)}if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported.");async function We(n){return n instanceof Response?(await WebAssembly.instantiateStreaming(n)).instance.exports:n instanceof WebAssembly.Module?(await WebAssembly.instantiate(n)).exports:n instanceof WebAssembly.Instance?n.exports:n instanceof ArrayBuffer?(await WebAssembly.instantiate(n)).instance.exports:n}async function q(n){n instanceof Function&&(n=await n());try{let e=await We(n),t=e.size(),r=e.offset();return new Uint8Array(e.memory.buffer).slice(r,r+t)}catch{return console.warn("Stage 0 wasm loading failed, skipping"),new Uint8Array(n)}}var D='"use strict";(()=>{var B=Object.defineProperty;var I=(n,t,r)=>t in n?B(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r;var d=(n,t,r)=>(I(n,typeof t!="symbol"?t+"":t,r),r);var g=class{constructor(t){d(this,"clients");d(this,"server");d(this,"module");this.clients=new Map,this.module=t,this.server=t._psp_new_server()}make_session(t){let r=this.module._psp_new_session(this.server);return this.clients.set(r,t),new h(this.module,this.server,r,this.clients)}delete(){this.module._psp_delete_server(this.server)}},h=class{constructor(t,r,a,i){this.mod=t;this.server=r;this.client_id=a;this.client_map=i}async handle_request(t){let r=await x(this.mod,t,async a=>this.mod._psp_handle_request(this.server,this.client_id,a,this.mod._psp_is_memory64()?BigInt(t.byteLength):t.byteLength));await A(this.mod,r,async a=>{await this.client_map.get(a.client_id)(a.data)})}poll(){let t=this.mod._psp_poll(this.server);A(this.mod,t,async r=>{await this.client_map.get(r.client_id)(r.data)})}close(){this.mod._psp_close_session(this.server,this.client_id)}};async function x(n,t,r){let a=n._psp_alloc(n._psp_is_memory64()?BigInt(t.byteLength):t.byteLength);n.HEAPU8.set(t,Number(a));let i=await r(a);return n._psp_free(a),i}async function A(n,t,r){let a=n._psp_is_memory64(),i=new DataView(n.HEAPU8.buffer,Number(t),a?12:8),c=i.getUint32(0,!0),l=a?i.getBigInt64(4,!0):i.getUint32(4,!0),e=new DataView(n.HEAPU8.buffer,Number(l),c*(a?16:12));try{for(let s=0;s<c;s++){let[o,p,f]=a?[e.getBigInt64(s*16,!0),e.getInt32(s*16+8,!0),e.getInt32(s*16+12,!0)]:[e.getInt32(s*12,!0),e.getInt32(s*12+4,!0),e.getInt32(s*12+8,!0)],_=new Uint8Array(n.HEAPU8.buffer,Number(o),p);await r({client_id:f,data:_})}}finally{for(let s=0;s<c;s++){let o=a?e.getBigInt64(s*16,!0):e.getInt32(s*12,!0);n._psp_free(o)}n._psp_free(a?BigInt(e.byteOffset):e.byteOffset),n._psp_free(a?BigInt(i.byteOffset):i.byteOffset)}}var H=console.log.bind(console),N=console.error.bind(console),L=new TextDecoder("utf8"),S=[null,[],[]];function j(n,t=0,r=NaN){for(var a=t+r,i=t;n[i]&&!(i>=a);)++i;return L.decode(n instanceof Uint8Array?n.subarray(t,i):new Uint8Array(n.slice(t,i)))}function P(n,t){var r=S[n];t===0||t===10?((n===1?H:N)(j(r,0)),r.length=0):r.push(t)}async function U(n){let t,r=!1,a,i={HaveOffsetConverter(){console.error("HaveOffsetConverter")},__syscall_ftruncate64(...e){console.error("__syscall_frtuncate64",e)},__syscall_getdents64(...e){console.error("__syscall_frtuncate64",e)},__syscall_unlinkat(...e){console.error("__syscall_frtuncate64",e)},__throw_exception_with_stack_trace(e){let s=new WebAssembly.Exception(t.__cpp_exception,[e],{traceStack:!0});throw s.message="Unexpected internal error",s},clock_time_get(e,s,o){if(r){if(o=o,o=Number(o),!(e==0||e==1||e==2||e==3))return 28;var p;e===0?p=Date.now():p=performance.now();let _=Math.round(p*1e3*1e3),u=new BigInt64Array(a.buffer);return u[o/8]=BigInt(_),0}else{if(o=o,o>>>=0,!(e==0||e==1||e==2||e==3))return 28;var p;e===0?p=Date.now():p=performance.now();var f=Math.round(p*1e6);let u=new BigInt64Array(a.buffer);return u[o>>>3]=BigInt(f),0}},emscripten_asm_const_int(...e){return 0},emscripten_notify_memory_growth(e){r?e=Number(e):(e=e,e>>>=0),e!=0&&console.error("abort")},environ_get(...e){return 0},environ_sizes_get(...e){return 0},fd_close(...e){return console.error("fd_close",e),0},fd_read(...e){return console.error("fd_read",e),0},fd_seek(...e){return console.error("fs_seek",e),0},fd_write(e,s,o,p){let f=new Uint8Array(a.buffer);if(r){s=Number(s),o=Number(o),p=Number(p);let _=0,u=new BigUint64Array(a.buffer);for(let y=0;y<o;y++){let v=Number(u[s/8]),b=Number(u[(s+8)/8]);s+=16;for(let m=0;m<b;m++)P(e,f[v+m]);_+=b}return u[p/8]=BigInt(_),0}else{s=s,o=o,p=p,s>>>=0,o>>>=0,p>>>=0;let _=0,u=new Uint32Array(a.buffer);for(let y=0;y<o;y++){let v=u[s>>>2>>>0],b=u[s+4>>>2>>>0];s+=8;for(let m=0;m<b;m++)P(e,f[v+m>>>0]);_+=b}return u[p>>>2>>>0]=_,0}},proc_exit(e){return console.error("proc_exit",e),0}},c=await n.instantiateWasm({env:i,wasi_snapshot_preview1:i},e=>{t=e.exports,r=!!t.psp_is_memory64(),a=e.exports.memory,t._initialize()}),l={};for(let[e,s]of Object.entries(c))l[`_${e}`]=s;return{...c,...l,get HEAPU8(){return new Uint8Array(a.buffer)}}}async function E(n){let t=await U({locateFile(r){return r},instantiateWasm:async(r,a)=>{r.env={...r.env,psp_stack_trace(){let c=Error().stack||"",e=new TextEncoder().encode(c),s=t._psp_alloc(t._psp_is_memory64()?BigInt(e.byteLength+1):e.byteLength+1);return t.HEAPU8.set(e,Number(s)),t.HEAPU8[Number(s)+e.byteLength]=0,s},psp_heap_size(){return t._psp_is_memory64()?BigInt(t.HEAPU8.buffer.byteLength):t.HEAPU8.buffer.byteLength}};let i=await WebAssembly.instantiate(n,r);return a(i.instance),i.instance.exports}});return t}var w;function M(n){let t=n.ports[0],r;t.addEventListener("message",async a=>{if(a.data.cmd==="init"){let i=a.data.id;if(!w){let c=await E(a.data.args[0]);w=new g(c)}r=w.make_session(async c=>{let l=c.slice().buffer;t.postMessage(l,{transfer:[l]})}),t.postMessage({id:i})}else r.handle_request(new Uint8Array(a.data)),setTimeout(()=>r.poll())}),t.start()}self.addEventListener("connect",M);self.addEventListener("message",M);})();\n';function se(n,e){function t(a,u){a==="message"&&n.push(u)}function r(a){let u=n.indexOf(a);u>-1&&n.splice(u,1)}function s(a,u){for(let f of e)f({data:a,ports:u})}return{addEventListener:t,removeEventListener:r,postMessage:s,location:{href:""}}}function Ee(n){console.error("Running perspective in single-threaded mode");let e=Function("const self = arguments[0];"+n),t=[],r=[];return e(se(t,r)),se(r,t)}var Me=async function(){try{if(window.location.protocol.startsWith("file"))return console.warn("file:// protocol does not support Web Workers"),Ee(D);{let n=new Blob([D],{type:"application/javascript"}),e=URL.createObjectURL(n);return new Worker(e,{type:"module"})}}catch(n){console.error("Error instantiating engine",n)}},oe=Me;var v;function Se(n,e=!1){n instanceof Uint8Array?v=Promise.resolve(n.buffer):n instanceof Response?v=n.arrayBuffer():n instanceof Promise?v=n.then(t=>t instanceof Response?t.arrayBuffer():t):v=Promise.resolve(n),e||(v=v.then(t=>q(t).then(r=>r.buffer)))}var A;async function P(n,e=!1){let t=e?n:await q(n);return await F({module_or_path:t}),await C(),z}function Ie(n,e=!1){n instanceof Uint8Array?A=P(n.buffer,e):n instanceof ArrayBuffer?A=P(n,e):n instanceof Response?A=n.arrayBuffer().then(t=>P(t,e)):n instanceof Promise?A=n.then(t=>t instanceof ArrayBuffer?P(t,e):t instanceof Response?t.arrayBuffer().then(r=>P(r,e)):t):n instanceof Object&&(A=Promise.resolve(n))}function ie(){let n=customElements.get("perspective-viewer");if(n)A=Promise.resolve(n.__wasm_module__);else if(A===void 0)throw new Error("Missing perspective-client.wasm");return A}function Oe(){if(v===void 0)throw new Error("Missing perspective-server.wasm");return v.then(n=>n instanceof WebAssembly.Module?n:n.slice(0))}var _e;function Pe(){return _e===void 0?oe():_e()}async function Be(n){return await re(ie(),n)}async function Ue(n){return typeof n>"u"&&(n=Pe()),await ne(ie(),Oe(),n)}var H={websocket:Be,worker:Ue,init_client:Ie,init_server:Se};var Re=new URL("../wasm/perspective-server.wasm",import.meta.url);H.init_server(fetch(Re));var Ve=H;export{Ve as default,Ie as init_client,Se as init_server,Be as websocket,Ue as worker};
//# sourceMappingURL=perspective.js.map
