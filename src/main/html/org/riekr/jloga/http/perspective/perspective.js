var qe=Object.create;var P=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var De=Object.getOwnPropertyNames;var Pe=Object.getPrototypeOf,et=Object.prototype.hasOwnProperty;var tt=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),rt=(r,e)=>{for(var t in e)P(r,t,{get:e[t],enumerable:!0})},nt=(r,e,t,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of De(e))!et.call(r,i)&&i!==t&&P(r,i,{get:()=>e[i],enumerable:!(n=Be(e,i))||n.enumerable});return r};var it=(r,e,t)=>(t=r!=null?qe(Pe(r)):{},nt(e||!r||!r.__esModule?P(t,"default",{value:r,enumerable:!0}):t,r));var Ye=tt((ir,Ze)=>{"use strict";Ze.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});var te={};rt(te,{COLUMN_SEPARATOR_STRING:()=>pt,CONFIG_ALIASES:()=>ot,CONFIG_VALID_KEYS:()=>st,DATA_TYPES:()=>at,FILTER_OPERATORS:()=>l,SORT_ORDERS:()=>ut,SORT_ORDER_IDS:()=>ft,TYPE_AGGREGATES:()=>ct,TYPE_FILTERS:()=>yt});var at={integer:"integer",float:"float",string:"string",boolean:"boolean",date:"date",datetime:"datetime",object:"object"},ot={row_pivot:"group_by","row-pivot":"group_by","row-pivots":"group_by",col_pivot:"split_by",col_pivots:"split_by",column_pivot:"split_by","column-pivot":"split_by","column-pivots":"split_by",filters:"filter",sorts:"sort"},st=["viewport","group_by","split_by","aggregates","columns","filter","sort","computed_columns","expressions","group_by_depth","split_by_depth","filter_op"],ke=["any","avg","abs sum","count","distinct count","dominant","first by index","last by index","last minus first","last","high","join","low","high minus low","max","mean","median","min","pct sum parent","pct sum grand total","stddev","sum","sum abs","sum not null","unique","var"],ee=["any","count","distinct count","distinct leaf","dominant","first by index","join","last by index","last","unique"],lt=["any","count","distinct count","distinct leaf","dominant","first by index","last by index","last","unique"],ut=["none","asc","desc","col asc","col desc","asc abs","desc abs","col asc abs","col desc abs"],ft=[2,0,1,0,1,3,4,3,4],ct={string:ee,float:ke,integer:ke,boolean:lt,datetime:ee,date:ee},l={lessThan:"<",greaterThan:">",equals:"==",lessThanOrEquals:"<=",greaterThanOrEquals:">=",doesNotEqual:"!=",isNull:"is null",isNotNull:"is not null",isIn:"in",isNotIn:"not in",contains:"contains",bitwiseAnd:"&",bitwiseOr:"|",and:"and",or:"or",beginsWith:"begins with",endsWith:"ends with"},ht=[l.bitwiseAnd,l.bitwiseOr,l.equals,l.doesNotEqual,l.or,l.and,l.isNull,l.isNotNull],Ke=[l.lessThan,l.greaterThan,l.equals,l.lessThanOrEquals,l.greaterThanOrEquals,l.doesNotEqual,l.isNull,l.isNotNull],dt=[l.equals,l.contains,l.doesNotEqual,l.isIn,l.isNotIn,l.beginsWith,l.endsWith,l.isNull,l.isNotNull],xe=[l.lessThan,l.greaterThan,l.equals,l.lessThanOrEquals,l.greaterThanOrEquals,l.doesNotEqual,l.isNull,l.isNotNull],pt="|",yt={string:dt,float:Ke,integer:Ke,boolean:ht,datetime:xe,date:xe};var re={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function ie(r){let e={};if(z().types[r]&&Object.assign(e,z().types[r]),e.type){let t=ie(e.type);return Object.assign(t,e),t}else return e}function ne(r){return r&&typeof r=="object"&&!Array.isArray(r)}function M(r,...e){if(!e.length)return r;let t=e.shift();if(ne(r)&&ne(t))for(let n in t)ne(t[n])?(r[n]||Object.assign(r,{[n]:{}}),M(r[n],t[n])):Object.assign(r,{[n]:t[n]});return M(r,...e)}function Oe(r){globalThis.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),globalThis.__PERSPECTIVE_CONFIG__=M(re,r)}function z(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=M(re,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}var oe=new WeakMap,ae=0;function A(r,e){return function(){let t,n=()=>{},i=Array.prototype.slice.call(arguments,0,arguments.length);for(let f=i.length-1;f>=0;f--)typeof i[f]=="function"&&(t=i.splice(f,1)[0]);let s=oe.get(t);oe.delete(t);let p={cmd:e||"view_method",name:this._name,method:r,args:i,subscribe:!0,callback_id:s};this._worker.post(p,t,n),this._worker.unsubscribe(e,t)}}function S(r,e){return function(){let t,n=()=>{},i=Array.prototype.slice.call(arguments,0,arguments.length);for(let p=i.length-1;p>=0;p--)typeof i[p]=="function"&&(t=i.splice(p,1)[0]);ae++,oe.set(t,ae);let s={cmd:e||"view_method",name:this._name,method:r,args:i,subscribe:!0,callback_id:ae};this._worker.post(s,t,n,!0)}}function o(r,e){return function(){var t=Array.prototype.slice.call(arguments,0,arguments.length);return new Promise(function(n,i){var s={cmd:e||"view_method",name:this._name,method:r,args:t,subscribe:!1};this._worker.post(s,n,i)}.bind(this))}}function h(r,e,t){return new Promise((n,i)=>{this._worker=r,this._name=Math.random()+"",this._worker.post({cmd:"view",view_name:this._name,table_name:e,config:t},()=>{n(this)},i),this._worker._initialized===!0&&!this._worker._features?.wait_for_response&&n(this)})}function gt(r,e){this._worker=r,this._name=e}gt.prototype=h.prototype;h.prototype.get_config=o("get_config");h.prototype.get_min_max=o("get_min_max");h.prototype.to_json=o("to_json");h.prototype.to_arrow=o("to_arrow");h.prototype.to_columns=o("to_columns");h.prototype.to_columns_string=o("to_columns_string");h.prototype.to_csv=o("to_csv");h.prototype.schema=o("schema");h.prototype.expression_schema=o("expression_schema");h.prototype.column_paths=o("column_paths");h.prototype.num_columns=o("num_columns");h.prototype.num_rows=o("num_rows");h.prototype.dimensions=o("dimensions");h.prototype.set_depth=o("set_depth");h.prototype.get_row_expanded=o("get_row_expanded");h.prototype.expand=o("expand");h.prototype.collapse=o("collapse");h.prototype.delete=o("delete");h.prototype.col_to_js_typed_array=o("col_to_js_typed_array");h.prototype.on_update=S("on_update","view_method",!0);h.prototype.remove_update=A("remove_update","view_method",!0);h.prototype.on_delete=S("on_delete","view_method",!0);h.prototype.remove_delete=A("remove_delete","view_method",!0);function C(r){let e=r;do for(let t of Object.getOwnPropertyNames(e)){let n=r[t];t!=="constructor"&&typeof n=="function"&&(r[t]=n.bind(r))}while(e=e!==Object&&Object.getPrototypeOf(e))}String.prototype.includes||(String.prototype.includes=function(r,e){return typeof e!="number"&&(e=0),e+r.length>this.length?!1:this.indexOf(r,e)!==-1});Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(r,e){if(this==null)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if(n===0)return!1;var i=e|0,s=Math.max(i>=0?i:n-Math.abs(i),0);function p(f,a){return f===a||typeof f=="number"&&typeof a=="number"&&isNaN(f)&&isNaN(a)}for(;s<n;){if(p(t[s],r))return!0;s++}return!1}});function d(r,e,t){return new Promise((n,i)=>{this._worker=r,this._name=t.name||Math.random()+"",C(this),e.to_arrow?(this._worker.post({cmd:"table",name:this._name,args:[],options:t||{}}),e.to_arrow().then(s=>{this._worker.post({cmd:"table",name:this._name,args:[s],options:t||{}},()=>{e.on_update(p=>{this.update(p.delta)},{mode:"row"}),n(this)},i)})):this._worker.post({cmd:"table",name:this._name,args:[e],options:t||{}},()=>{n(this)},i),this._worker._initialized===!0&&!this._worker._features?.wait_for_response&&n(this)})}d.prototype.type="table";function se(r,e){this._worker=r,this._name=e}se.prototype=d.prototype;d.prototype.view=function(r){return new h(this._worker,this._name,r)};d.prototype.query_columns=o("query_columns","table_method");d.prototype.get_index=o("get_index","table_method");d.prototype.get_limit=o("get_limit","table_method");d.prototype.get_num_views=o("get_num_views","table_method");d.prototype.make_port=o("make_port","table_method");d.prototype.remove_port=o("remove_port","table_method");d.prototype.schema=o("schema","table_method");d.prototype.validate_expressions=o("validate_expressions","table_method");d.prototype.is_valid_filter=o("is_valid_filter","table_method");d.prototype.size=o("size","table_method");d.prototype.num_rows=o("num_rows","table_method");d.prototype.num_columns=o("num_columns","table_method");d.prototype.columns=o("columns","table_method");d.prototype.clear=o("clear","table_method");d.prototype.replace=o("replace","table_method");d.prototype.delete=o("delete","table_method");d.prototype.on_delete=S("on_delete","table_method",!0);d.prototype.remove=o("remove","table_method");d.prototype.remove_delete=A("remove_delete","table_method",!0);d.prototype.update=function(r,e){return new Promise((t,n)=>{this._worker.post({name:this._name,cmd:"table_method",method:"update",args:[r,e||{}]},t,n,!1)})};d.prototype.execute=function(r){this._worker.post({cmd:"table_execute",name:this._name,f:r.toString()})};var G=class{constructor(){this._initialized=!1,this._worker={initialized:{value:!1},transferable:!1,msg_id:0,handlers:{},messages:[]},C(this)}unsubscribe(e,t){for(let n of Object.keys(this._worker.handlers))this._worker.handlers[n].resolve===t&&delete this._worker.handlers[n]}post(e,t,n,i=!1){++this._worker.msg_id,(t||n)&&(this._worker.handlers[this._worker.msg_id]={resolve:t,reject:n,keep_alive:i}),e.id=this._worker.msg_id,this._worker.initialized.value?this.send(e):this._worker.messages.push(()=>{this.send(e),(e.cmd==="table"||e.cmd==="view")&&!this._features?.wait_for_response&&t&&t()})}async memory_usage(){return await new Promise((e,t)=>{this.post({cmd:"memory_usage"},e,t)})}async get_hosted_table_names(){return await new Promise((e,t)=>{this.post({cmd:"get_hosted_table_names"},e,t)})}initialize_profile_thread(){this._worker.initialized.value?this.send({id:-1,cmd:"init_profile_thread"}):this._worker.messages.push(()=>this.send({id:-1,cmd:"init_profile_thread"}))}send(){throw new Error("send() not implemented")}async open_table(e){return new se(this,e)}_handle(e){if(!this._worker.initialized.value){this._initialized||(this._initialized=!0);let t=this._worker.messages;if(this._worker.initialized.value=!0,this._worker.messages=[],e.data?.data){this._features={};for(let n of e.data.data)this._features[n]=!0}if(t)for(let n in t)t.hasOwnProperty(n)&&t[n]()}if(e.data.id){let t=this._worker.handlers[e.data.id];t&&(e.data.error?t.reject(e.data.error):t.resolve(e.data.data),t.keep_alive||delete this._worker.handlers[e.data.id])}}table(e,t){return new d(this,e,t||{})}terminate(){this._worker.terminate(),this._worker=void 0}};var Re=it(Ye()),_t=3e4,I=class extends G{_ping(){this._ping_loop&&this._ws.send("ping"),this._ping_loop=setTimeout(this._ping.bind(this),_t)}_close(){clearTimeout(this._ping_loop),this._ping_loop=void 0,this._on_close_callback?.()}_onmessage(e){if(e.data!=="pong")if(this._pending_binary){let t=e.data;if(this._full_binary.set(new Uint8Array(t),this._total_chunk_length),this._total_chunk_length+=t.byteLength,this._total_chunk_length===this._pending_binary_length)t=this._full_binary.buffer;else return;let n={data:{id:this._pending_binary,data:t}};if(this._pending_port_id!==void 0){let i={port_id:this._pending_port_id,delta:t};n.data.data=i}this._handle(n),delete this._pending_binary,delete this._pending_binary_length,delete this._pending_port_id,this._total_chunk_length=0,this._full_binary=null}else e=JSON.parse(e.data),e.binary_length?(this._pending_binary=e.id,this._pending_binary_length=e.binary_length,e.data&&e.data.port_id!==void 0&&(this._pending_port_id=e.data.port_id),this._full_binary=new Uint8Array(this._pending_binary_length)):this._handle({data:e})}constructor(e){super(),this._ws=e,this._ws.binaryType="arraybuffer",this._full_binary,this._total_chunk_length=0,this._pending_binary_length=0,this._ws.onopen=()=>{this.send({id:-1,cmd:"init"})},this._ping(),this._ws.onclose=this._close.bind(this),this._ws.onmessage=this._onmessage.bind(this)}send(e){if(this._ws.readyState===Re.default.CLOSED){console.warn("Websocket connection is already closed.");return}if(e.args&&e.args.length>0&&e.args[0]instanceof ArrayBuffer&&e.args[0].byteLength!==void 0){let t=e;e.binary_length=e.args[0].byteLength,this._ws.send(JSON.stringify(t)),this._ws.send(e.args[0]);return}this._ws.send(JSON.stringify(e))}terminate(){return new Promise(e=>{this._on_close_callback=e,this._ws.close()})}};var g=Uint8Array,O=Uint16Array,Ge=Uint32Array,Ne=new g([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Te=new g([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),vt=new g([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),je=function(r,e){for(var t=new O(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Ge(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return[t,i]},Ae=je(Ne,2),Se=Ae[0],mt=Ae[1];Se[28]=258,mt[258]=28;var Xe=je(Te,0),wt=Xe[0],sr=Xe[1],fe=new O(32768);for(u=0;u<32768;++u)k=(u&43690)>>>1|(u&21845)<<1,k=(k&52428)>>>2|(k&13107)<<2,k=(k&61680)>>>4|(k&3855)<<4,fe[u]=((k&65280)>>>8|(k&255)<<8)>>>1;var k,u,X=function(r,e,t){for(var n=r.length,i=0,s=new O(e);i<n;++i)r[i]&&++s[r[i]-1];var p=new O(e);for(i=0;i<e;++i)p[i]=p[i-1]+s[i-1]<<1;var f;if(t){f=new O(1<<e);var a=15-e;for(i=0;i<n;++i)if(r[i])for(var c=i<<4|r[i],y=e-r[i],v=p[r[i]-1]++<<y,x=v|(1<<y)-1;v<=x;++v)f[fe[v]>>>a]=c}else for(f=new O(n),i=0;i<n;++i)r[i]&&(f[i]=fe[p[r[i]-1]++]>>>15-r[i]);return f},F=new g(288);for(u=0;u<144;++u)F[u]=8;var u;for(u=144;u<256;++u)F[u]=9;var u;for(u=256;u<280;++u)F[u]=7;var u;for(u=280;u<288;++u)F[u]=8;var u,Fe=new g(32);for(u=0;u<32;++u)Fe[u]=5;var u;var bt=X(F,9,1);var kt=X(Fe,5,1),le=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},w=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},ue=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Kt=function(r){return(r+7)/8|0},W=function(r,e,t){(e==null||e<0)&&(e=0),(t==null||t>r.length)&&(t=r.length);var n=new(r.BYTES_PER_ELEMENT==2?O:r.BYTES_PER_ELEMENT==4?Ge:g)(t-e);return n.set(r.subarray(e,t)),n};var xt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],_=function(r,e,t){var n=new Error(e||xt[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,_),!t)throw n;return n},Ot=function(r,e,t){var n=r.length;if(!n||t&&t.f&&!t.l)return e||new g(0);var i=!e||t,s=!t||t.i;t||(t={}),e||(e=new g(n*3));var p=function(me){var we=e.length;if(me>we){var be=new g(Math.max(we*2,me));be.set(e),e=be}},f=t.f||0,a=t.p||0,c=t.b||0,y=t.l,v=t.d,x=t.m,N=t.n,$=n*8;do{if(!y){f=w(r,a,1);var V=w(r,a+1,3);if(a+=3,V)if(V==1)y=bt,v=kt,x=9,N=5;else if(V==2){var U=w(r,a,31)+257,he=w(r,a+10,15)+4,de=U+w(r,a+5,31)+1;a+=14;for(var T=new g(de),H=new g(19),m=0;m<he;++m)H[vt[m]]=w(r,a+m*3,7);a+=he*3;for(var pe=le(H),Je=(1<<pe)-1,Ee=X(H,pe,1),m=0;m<de;){var ye=Ee[w(r,a,Je)];a+=ye&15;var b=ye>>>4;if(b<16)T[m++]=b;else{var Y=0,L=0;for(b==16?(L=3+w(r,a,3),a+=2,Y=T[m-1]):b==17?(L=3+w(r,a,7),a+=3):b==18&&(L=11+w(r,a,127),a+=7);L--;)T[m++]=Y}}var ge=T.subarray(0,U),K=T.subarray(U);x=le(ge),N=le(K),y=X(ge,x,1),v=X(K,N,1)}else _(1);else{var b=Kt(a)+4,J=r[b-4]|r[b-3]<<8,E=b+J;if(E>n){s&&_(0);break}i&&p(c+J),e.set(r.subarray(b,E),c),t.b=c+=J,t.p=a=E*8,t.f=f;continue}if(a>$){s&&_(0);break}}i&&p(c+131072);for(var Ue=(1<<x)-1,He=(1<<N)-1,q=a;;q=a){var Y=y[ue(r,a)&Ue],R=Y>>>4;if(a+=Y&15,a>$){s&&_(0);break}if(Y||_(2),R<256)e[c++]=R;else if(R==256){q=a,y=null;break}else{var _e=R-254;if(R>264){var m=R-257,j=Ne[m];_e=w(r,a,(1<<j)-1)+Se[m],a+=j}var B=v[ue(r,a)&He],D=B>>>4;B||_(3),a+=B&15;var K=wt[D];if(D>3){var j=Te[D];K+=ue(r,a)&(1<<j)-1,a+=j}if(a>$){s&&_(0);break}i&&p(c+131072);for(var ve=c+_e;c<ve;c+=4)e[c]=e[c-K],e[c+1]=e[c+1-K],e[c+2]=e[c+2-K],e[c+3]=e[c+3-K];c=ve}}t.l=y,t.p=q,t.b=c,t.f=f,y&&(f=1,t.m=x,t.d=v,t.n=N)}while(!f);return c==e.length?e:W(e,0,c)};var Zt=new g(0);var Yt=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&_(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=r[10]|(r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)};var Z=function(){function r(e){this.s={},this.p=new g(0),this.ondata=e}return r.prototype.e=function(e){this.ondata||_(5),this.d&&_(4);var t=this.p.length,n=new g(t+e.length);n.set(this.p),n.set(e,t),this.p=n},r.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,n=Ot(this.p,this.o,this.s);this.ondata(W(n,t,this.s.b),this.d),this.o=W(n,this.s.b-32768),this.s.b=this.o.length,this.p=W(this.p,this.s.p/8|0),this.s.p&=7},r.prototype.push=function(e,t){this.e(e),this.c(t)},r}();var Rt=function(){function r(e){this.v=1,Z.call(this,e)}return r.prototype.push=function(e,t){if(Z.prototype.e.call(this,e),this.v){var n=this.p.length>3?Yt(this.p):4;if(n>=this.p.length&&!t)return;this.p=this.p.subarray(n),this.v=0}t&&(this.p.length<8&&_(6,"invalid gzip data"),this.p=this.p.subarray(0,-8)),Z.prototype.c.call(this,t)},r}();var Gt=function(){function r(e){this.v=1,Z.call(this,e)}return r.prototype.push=function(e,t){if(Z.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}t&&(this.p.length<4&&_(6,"invalid zlib data"),this.p=this.p.subarray(0,-4)),Z.prototype.c.call(this,t)},r}();var Le=function(){function r(e){this.G=Rt,this.I=Z,this.Z=Gt,this.ondata=e}return r.prototype.push=function(e,t){if(this.ondata||_(5),this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var n=new g(this.p.length+e.length);n.set(this.p),n.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,s=function(){i.ondata.apply(i,arguments)};this.s=this.p[0]==31&&this.p[1]==139&&this.p[2]==8?new this.G(s):(this.p[0]&15)!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(s):new this.Z(s),this.s.push(this.p,t),this.p=null}}},r}();var Nt=typeof TextDecoder<"u"&&new TextDecoder,Tt=0;try{Nt.decode(Zt,{stream:!0}),Tt=1}catch{}var Me="./perspective.worker.js";async function At(){let r=new URL(Me,import.meta.url);return await(await fetch(r)).text()}function ze(r,e){function t(i,s){r.push(s)}function n(i){if(Object.keys(i).length>0)for(let s of e)s({data:i})}return{addEventListener:t,postMessage:n,location:{href:""}}}function Ce(r){let e=Function("const self = arguments[0];"+r),t=[],n=[];return e(ze(t,n)),ze(n,t)}var St=At(),Xt=async function(){let r=await St;if(window.location.protocol.startsWith("file")&&!window.isElectron)return console.warn("file:// protocol does not support Web Workers"),Ce(r);try{let e=new Blob([r],{type:"application/javascript"}),t=URL.createObjectURL(e);return new Worker(t,{type:"module"})}catch(e){return console.warn("Failed to instantiate worker, falling back to single-threaded runtime",e),Ce(r)}},Ie=Xt;var We="./perspective.cpp.wasm";async function Lt(){return new URL(We,import.meta.url)}var Qe=Lt();var Ve=!1;function $e(r){return new Uint32Array(r.slice(0,4))[0]==559903}var ce=function(){let r;return function(){return r||(r=new class{async worker(){return await Ie()}async wasm(){let e=await Qe,t=[],n=0,i=new Le(f=>{f&&(n+=f.byteLength,t.push(f))});if(e instanceof ArrayBuffer&&!e.buffer&&(e=new Uint8Array(e)),e.buffer&&e.buffer instanceof ArrayBuffer)Ve=!0,$e(e.buffer)?i.push(e,!0):(n=e.byteLength,t=[e]);else if(e instanceof ArrayBuffer)n=e.byteLength,t=[new Uint8Array(e)];else{let a=(await fetch(e)).body.getReader(),c=0;for(;;){let{value:y,done:v}=await a.read();if(v)break;c===0&&$e(y.buffer)||c===1?(c=1,i.push(y,v)):(c=2,n+=y.byteLength,t.push(y))}}let s=0,p=new Uint8Array(n);for(let f of t)p.set(f,s),s+=f.byteLength;return this._wasm=p.buffer,this._wasm}}),r}}(),Q=class extends G{constructor(e){e&&Oe(e),super(),this.register()}async register(){let e,t={cmd:"init",config:z()};if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported.");[e,t.buffer]=await Promise.all([ce().worker(),ce().wasm()]);for(var n in this._worker)e[n]=this._worker[n];this._worker=e,this._worker.addEventListener("message",this._handle.bind(this)),this._worker.postMessage(t),this._detect_transferable()}send(e){this._worker.transferable&&e.args&&e.args[0]instanceof ArrayBuffer?this._worker.postMessage(e,[e.args[0]]):this._worker.postMessage(e)}terminate(){this._worker.terminate(),this._worker=void 0}get transferable(){return this._worker?.transferable||!1}get inline(){return Ve}_detect_transferable(){var e=new ArrayBuffer(1);this._worker.postMessage(e,[e]),this._worker.transferable=e.byteLength===0}},Mt=function(){let r,e;return{getInstance:function(t){r===void 0&&(r=new Q(t));let n=JSON.stringify(t);if(e&&n!==e)throw new Error("Configuration object for shared_worker() has changed - this is probably a bug in your application.");return e=n,r}}}(),kr=ie;function zt(r){return ce().set(r)}function Ct(r){return new Q(r)}function It(r=window.location.origin.replace("http","ws")){return new I(new WebSocket(r))}function Wt(r){return Mt.getInstance(r)}var Kr={override:zt,worker:Ct,websocket:It,shared_worker:Wt,...Object.keys(te)};export{Kr as default,kr as get_type_config,zt as override,Wt as shared_worker,It as websocket,Ct as worker};
//# sourceMappingURL=perspective.js.map
