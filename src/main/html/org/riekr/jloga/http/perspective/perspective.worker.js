(()=>{var zi=Object.defineProperty;var Gi=(m,o)=>{for(var a in o)zi(m,a,{get:o[a],enumerable:!0})};var Or={},Bi=(()=>{var m=Or.url;return function(o={}){var a=o,b,I;a.ready=new Promise((e,t)=>{b=e,I=t});var S=Object.assign({},a),k=[],W="./this.program",H=(e,t)=>{throw t},ne=!0,O=!1,X="";function Ge(e){return a.locateFile?a.locateFile(e,X):X+e}var Se,ht,ge;(ne||O)&&(O?X=self.location.href:typeof document<"u"&&document.currentScript&&(X=document.currentScript.src),m&&(X=m),X.indexOf("blob:")!==0?X=X.substr(0,X.replace(/[?#].*/,"").lastIndexOf("/")+1):X="",Se=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},O&&(ge=e=>{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}),ht=(e,t,r)=>{var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=()=>{if(n.status==200||n.status==0&&n.response){t(n.response);return}r()},n.onerror=r,n.send(null)});var oe=a.print||console.log.bind(console),V=a.printErr||console.error.bind(console);Object.assign(a,S),S=null,a.arguments&&(k=a.arguments),a.thisProgram&&(W=a.thisProgram),a.quit&&(H=a.quit);var fe;a.wasmBinary&&(fe=a.wasmBinary),typeof WebAssembly!="object"&&Ht("no native wasm support detected");var me,ke=!1,K,_e,i,s,c,_,p,w,T,y,R;function A(){var e=me.buffer;a.HEAP8=_e=new Int8Array(e),a.HEAP16=s=new Int16Array(e),a.HEAPU8=i=new Uint8Array(e),a.HEAPU16=c=new Uint16Array(e),a.HEAP32=_=new Int32Array(e),a.HEAPU32=p=new Uint32Array(e),a.HEAPF32=w=new Float32Array(e),a.HEAPF64=R=new Float64Array(e),a.HEAP64=T=new BigInt64Array(e),a.HEAPU64=y=new BigUint64Array(e)}var x=[],q=[],de=[],L=[],ee=!1;function ae(){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)Vr(a.preRun.shift());qe(x)}function vt(){ee=!0,qe(q)}function Be(){qe(de)}function Ir(){if(a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;)Dr(a.postRun.shift());qe(L)}function Vr(e){x.unshift(e)}function Dr(e){L.unshift(e)}var ye=0,gt=null,Re=null;function Ur(e){ye++,a.monitorRunDependencies&&a.monitorRunDependencies(ye)}function jr(e){if(ye--,a.monitorRunDependencies&&a.monitorRunDependencies(ye),ye==0&&(gt!==null&&(clearInterval(gt),gt=null),Re)){var t=Re;Re=null,t()}}function Ht(e){a.onAbort&&a.onAbort(e),e="Aborted("+e+")",V(e),ke=!0,K=1,e+=". Build with -sASSERTIONS for more info.";var t=new WebAssembly.RuntimeError(e);throw I(t),t}var Wr="data:application/octet-stream;base64,",Lt=e=>e.startsWith(Wr),be;a.locateFile?(be="perspective.cpp.wasm",Lt(be)||(be=Ge(be))):be=new URL("perspective.cpp.wasm",Or.url).href;function zt(e){if(e==be&&fe)return new Uint8Array(fe);if(ge)return ge(e);throw"both async and sync fetching of the wasm failed"}function Mr(e){return!fe&&(ne||O)&&typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(t=>{if(!t.ok)throw"failed to load wasm binary file at '"+e+"'";return t.arrayBuffer()}).catch(()=>zt(e)):Promise.resolve().then(()=>zt(e))}function Gt(e,t,r){return Mr(e).then(n=>WebAssembly.instantiate(n,t)).then(n=>n).then(r,n=>{V(`failed to asynchronously prepare wasm: ${n}`),Ht(n)})}function Hr(e,t,r,n){return!e&&typeof WebAssembly.instantiateStreaming=="function"&&!Lt(t)&&typeof fetch=="function"?fetch(t,{credentials:"same-origin"}).then(l=>{var u=WebAssembly.instantiateStreaming(l,r);return u.then(n,function(d){return V(`wasm streaming compile failed: ${d}`),V("falling back to ArrayBuffer instantiation"),Gt(t,r,n)})}):Gt(t,r,n)}function Lr(){var e={env:yr,wasi_snapshot_preview1:yr};function t(n,l){return J=n.exports,J=Mi(J),me=J.memory,A(),or=J.__indirect_function_table,jr("wasm-instantiate"),J}Ur("wasm-instantiate");function r(n){t(n.instance)}if(a.instantiateWasm)try{return a.instantiateWasm(e,t)}catch(n){V(`Module.instantiateWasm callback failed with error: ${n}`),I(n)}return Hr(fe,be,e,r).catch(I),{}}var zr={848052:e=>{throw new Error(xe(e))}};function Bt(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e}var qe=e=>{for(;e.length>0;)e.shift()(a)},Gr=a.noExitRuntime||!0,qt=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0,Yt=(e,t,r)=>{t>>>=0;for(var n=t+r,l=t;e[l]&&!(l>=n);)++l;if(l-t>16&&e.buffer&&qt)return qt.decode(e.subarray(t,l));for(var u="";t<l;){var d=e[t++];if(!(d&128)){u+=String.fromCharCode(d);continue}var f=e[t++]&63;if((d&224)==192){u+=String.fromCharCode((d&31)<<6|f);continue}var v=e[t++]&63;if((d&240)==224?d=(d&15)<<12|f<<6|v:d=(d&7)<<18|f<<12|v<<6|e[t++]&63,d<65536)u+=String.fromCharCode(d);else{var h=d-65536;u+=String.fromCharCode(55296|h>>10,56320|h&1023)}}return u},xe=(e,t)=>(e>>>=0,e?Yt(i,e,t):""),mt={varargs:void 0,get(){var e=_[+mt.varargs>>>2>>>0];return mt.varargs+=4,e},getp(){return mt.get()},getStr(e){var t=xe(e);return t}},Br=9007199254740992,qr=-9007199254740992,yt=e=>e<qr||e>Br?NaN:Number(e);function Yr(e,t){t=yt(t)}var Jt=(e,t,r,n)=>{if(r>>>=0,!(n>0))return 0;for(var l=r,u=r+n-1,d=0;d<e.length;++d){var f=e.charCodeAt(d);if(f>=55296&&f<=57343){var v=e.charCodeAt(++d);f=65536+((f&1023)<<10)|v&1023}if(f<=127){if(r>=u)break;t[r++>>>0]=f}else if(f<=2047){if(r+1>=u)break;t[r++>>>0]=192|f>>6,t[r++>>>0]=128|f&63}else if(f<=65535){if(r+2>=u)break;t[r++>>>0]=224|f>>12,t[r++>>>0]=128|f>>6&63,t[r++>>>0]=128|f&63}else{if(r+3>=u)break;t[r++>>>0]=240|f>>18,t[r++>>>0]=128|f>>12&63,t[r++>>>0]=128|f>>6&63,t[r++>>>0]=128|f&63}}return t[r>>>0]=0,r-l},Jr=(e,t,r)=>Jt(e,i,t,r);function Xr(e,t,r){t>>>=0,r>>>=0}var Ye={},bt=e=>{for(;e.length;){var t=e.pop(),r=e.pop();r(t)}};function wt(e){return this.fromWireType(_[e>>>2>>>0])}var $e={},we={},Je={},Xt,Xe=e=>{throw new Xt(e)},pe=(e,t,r)=>{e.forEach(function(f){Je[f]=t});function n(f){var v=r(f);v.length!==e.length&&Xe("Mismatched type converter count");for(var h=0;h<e.length;++h)te(e[h],v[h])}var l=new Array(t.length),u=[],d=0;t.forEach((f,v)=>{we.hasOwnProperty(f)?l[v]=we[f]:(u.push(f),$e.hasOwnProperty(f)||($e[f]=[]),$e[f].push(()=>{l[v]=we[f],++d,d===u.length&&n(l)}))}),u.length===0&&n(l)},Kr=function(e){e>>>=0;var t=Ye[e];delete Ye[e];var r=t.rawConstructor,n=t.rawDestructor,l=t.fields,u=l.map(d=>d.getterReturnType).concat(l.map(d=>d.setterArgumentType));pe([e],u,d=>{var f={};return l.forEach((v,h)=>{var g=v.fieldName,$=d[h],F=v.getter,C=v.getterContext,M=d[h+l.length],G=v.setter,B=v.setterContext;f[g]={read:P=>$.fromWireType(F(C,P)),write:(P,E)=>{var U=[];G(B,P,M.toWireType(U,E)),bt(U)}}}),[{name:t.name,fromWireType:v=>{var h={};for(var g in f)h[g]=f[g].read(v);return n(v),h},toWireType:(v,h)=>{for(var g in f)if(!(g in h))throw new TypeError(`Missing field: "${g}"`);var $=r();for(g in f)f[g].write($,h[g]);return v!==null&&v.push(n,$),$},argPackAdvance:re,readValueFromPointer:wt,destructorFunction:n}]})},Fe=e=>{if(e===null)return"null";var t=typeof e;return t==="object"||t==="array"||t==="function"?e.toString():""+e},Zr=()=>{for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);Kt=e},Kt,z=e=>{for(var t="",r=e;i[r>>>0];)t+=Kt[i[r++>>>0]];return t},Ae,D=e=>{throw new Ae(e)};function Qr(e,t,r={}){var n=t.name;if(e||D(`type "${n}" must have a positive integer typeid pointer`),we.hasOwnProperty(e)){if(r.ignoreDuplicateRegistrations)return;D(`Cannot register type '${n}' twice`)}if(we[e]=t,delete Je[e],$e.hasOwnProperty(e)){var l=$e[e];delete $e[e],l.forEach(u=>u())}}function te(e,t,r={}){if(!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");return Qr(e,t,r)}var Zt=(e,t,r)=>{switch(t){case 1:return r?n=>_e[n>>>0>>>0]:n=>i[n>>>0>>>0];case 2:return r?n=>s[n>>>1>>>0]:n=>c[n>>>1>>>0];case 4:return r?n=>_[n>>>2>>>0]:n=>p[n>>>2>>>0];case 8:return r?n=>T[n>>>3]:n=>y[n>>>3];default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function en(e,t,r,n,l){e>>>=0,t>>>=0,r>>>=0,t=z(t);var u=t.indexOf("u")!=-1;u&&(l=(1n<<64n)-1n),te(e,{name:t,fromWireType:d=>d,toWireType:function(d,f){if(typeof f!="bigint"&&typeof f!="number")throw new TypeError(`Cannot convert "${Fe(f)}" to ${this.name}`);if(f<n||f>l)throw new TypeError(`Passing a number "${Fe(f)}" from JS side to C/C++ side to an argument of type "${t}", which is outside the valid range [${n}, ${l}]!`);return f},argPackAdvance:re,readValueFromPointer:Zt(t,r,!u),destructorFunction:null})}var re=8;function tn(e,t,r,n){e>>>=0,t>>>=0,t=z(t),te(e,{name:t,fromWireType:function(l){return!!l},toWireType:function(l,u){return u?r:n},argPackAdvance:re,readValueFromPointer:function(l){return this.fromWireType(i[l>>>0])},destructorFunction:null})}var rn=e=>({count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType}),Tt=e=>{function t(r){return r.$$.ptrType.registeredClass.name}D(t(e)+" instance already deleted")},$t=!1,Qt=e=>{},nn=e=>{e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)},er=e=>{e.count.value-=1;var t=e.count.value===0;t&&nn(e)},tr=(e,t,r)=>{if(t===r)return e;if(r.baseClass===void 0)return null;var n=tr(e,t,r.baseClass);return n===null?null:r.downcast(n)},rr={},sn=()=>Object.keys(Ve).length,on=()=>{var e=[];for(var t in Ve)Ve.hasOwnProperty(t)&&e.push(Ve[t]);return e},Ne=[],At=()=>{for(;Ne.length;){var e=Ne.pop();e.$$.deleteScheduled=!1,e.delete()}},Ie,an=e=>{Ie=e,Ne.length&&Ie&&Ie(At)},ln=()=>{a.getInheritedInstanceCount=sn,a.getLiveInheritedInstances=on,a.flushPendingDeletes=At,a.setDelayFunction=an},Ve={},cn=(e,t)=>{for(t===void 0&&D("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t},un=(e,t)=>(t=cn(e,t),Ve[t]),Ke=(e,t)=>{(!t.ptrType||!t.ptr)&&Xe("makeClassHandle requires ptr and ptrType");var r=!!t.smartPtrType,n=!!t.smartPtr;return r!==n&&Xe("Both smartPtrType and smartPtr must be specified"),t.count={value:1},De(Object.create(e,{$$:{value:t}}))};function fn(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var r=un(this.registeredClass,t);if(r!==void 0){if(r.$$.count.value===0)return r.$$.ptr=t,r.$$.smartPtr=e,r.clone();var n=r.clone();return this.destructor(e),n}function l(){return this.isSmartPointer?Ke(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):Ke(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var u=this.registeredClass.getActualType(t),d=rr[u];if(!d)return l.call(this);var f;this.isConst?f=d.constPointerType:f=d.pointerType;var v=tr(t,this.registeredClass,f.registeredClass);return v===null?l.call(this):this.isSmartPointer?Ke(f.registeredClass.instancePrototype,{ptrType:f,ptr:v,smartPtrType:this,smartPtr:e}):Ke(f.registeredClass.instancePrototype,{ptrType:f,ptr:v})}var De=e=>typeof FinalizationRegistry>"u"?(De=t=>t,e):($t=new FinalizationRegistry(t=>{er(t.$$)}),De=t=>{var r=t.$$,n=!!r.smartPtr;if(n){var l={$$:r};$t.register(t,l,t)}return t},Qt=t=>$t.unregister(t),De(e)),_n=()=>{Object.assign(Ze.prototype,{isAliasOf(e){if(!(this instanceof Ze)||!(e instanceof Ze))return!1;var t=this.$$.ptrType.registeredClass,r=this.$$.ptr;e.$$=e.$$;for(var n=e.$$.ptrType.registeredClass,l=e.$$.ptr;t.baseClass;)r=t.upcast(r),t=t.baseClass;for(;n.baseClass;)l=n.upcast(l),n=n.baseClass;return t===n&&r===l},clone(){if(this.$$.ptr||Tt(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e=De(Object.create(Object.getPrototypeOf(this),{$$:{value:rn(this.$$)}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e},delete(){this.$$.ptr||Tt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&D("Object already scheduled for deletion"),Qt(this),er(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)},isDeleted(){return!this.$$.ptr},deleteLater(){return this.$$.ptr||Tt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&D("Object already scheduled for deletion"),Ne.push(this),Ne.length===1&&Ie&&Ie(At),this.$$.deleteScheduled=!0,this}})};function Ze(){}var Ee=(e,t)=>Object.defineProperty(t,"name",{value:e}),nr=(e,t,r)=>{if(e[t].overloadTable===void 0){var n=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||D(`Function '${r}' called with an invalid number of arguments (${arguments.length}) - expects one of (${e[t].overloadTable})!`),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[n.argCount]=n}},Et=(e,t,r)=>{a.hasOwnProperty(e)?((r===void 0||a[e].overloadTable!==void 0&&a[e].overloadTable[r]!==void 0)&&D(`Cannot register public name '${e}' twice`),nr(a,e,e),a.hasOwnProperty(r)&&D(`Cannot register multiple overloads of a function with the same number of arguments (${r})!`),a[e].overloadTable[r]=t):(a[e]=t,r!==void 0&&(a[e].numArguments=r))},dn=48,pn=57,hn=e=>{if(e===void 0)return"_unknown";e=e.replace(/[^a-zA-Z0-9_]/g,"$");var t=e.charCodeAt(0);return t>=dn&&t<=pn?`_${e}`:e};function vn(e,t,r,n,l,u,d,f){this.name=e,this.constructor=t,this.instancePrototype=r,this.rawDestructor=n,this.baseClass=l,this.getActualType=u,this.upcast=d,this.downcast=f,this.pureVirtualFunctions=[]}var Pt=(e,t,r)=>{for(;t!==r;)t.upcast||D(`Expected null or instance of ${r.name}, got an instance of ${t.name}`),e=t.upcast(e),t=t.baseClass;return e};function gn(e,t){if(t===null)return this.isReference&&D(`null is not a valid ${this.name}`),0;t.$$||D(`Cannot pass "${Fe(t)}" as a ${this.name}`),t.$$.ptr||D(`Cannot pass deleted object as a pointer of type ${this.name}`);var r=t.$$.ptrType.registeredClass,n=Pt(t.$$.ptr,r,this.registeredClass);return n}function mn(e,t){var r;if(t===null)return this.isReference&&D(`null is not a valid ${this.name}`),this.isSmartPointer?(r=this.rawConstructor(),e!==null&&e.push(this.rawDestructor,r),r):0;t.$$||D(`Cannot pass "${Fe(t)}" as a ${this.name}`),t.$$.ptr||D(`Cannot pass deleted object as a pointer of type ${this.name}`),!this.isConst&&t.$$.ptrType.isConst&&D(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);var n=t.$$.ptrType.registeredClass;if(r=Pt(t.$$.ptr,n,this.registeredClass),this.isSmartPointer)switch(t.$$.smartPtr===void 0&&D("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?r=t.$$.smartPtr:D(`Cannot convert argument of type ${t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name} to parameter type ${this.name}`);break;case 1:r=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)r=t.$$.smartPtr;else{var l=t.clone();r=this.rawShare(r,j.toHandle(()=>l.delete())),e!==null&&e.push(this.rawDestructor,r)}break;default:D("Unsupporting sharing policy")}return r}function yn(e,t){if(t===null)return this.isReference&&D(`null is not a valid ${this.name}`),0;t.$$||D(`Cannot pass "${Fe(t)}" as a ${this.name}`),t.$$.ptr||D(`Cannot pass deleted object as a pointer of type ${this.name}`),t.$$.ptrType.isConst&&D(`Cannot convert argument of type ${t.$$.ptrType.name} to parameter type ${this.name}`);var r=t.$$.ptrType.registeredClass,n=Pt(t.$$.ptr,r,this.registeredClass);return n}function ir(e){return this.fromWireType(p[e>>>2>>>0])}var bn=()=>{Object.assign(Ue.prototype,{getPointee(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e},destructor(e){this.rawDestructor&&this.rawDestructor(e)},argPackAdvance:re,readValueFromPointer:ir,deleteObject(e){e!==null&&e.delete()},fromWireType:fn})};function Ue(e,t,r,n,l,u,d,f,v,h,g){this.name=e,this.registeredClass=t,this.isReference=r,this.isConst=n,this.isSmartPointer=l,this.pointeeType=u,this.sharingPolicy=d,this.rawGetPointee=f,this.rawConstructor=v,this.rawShare=h,this.rawDestructor=g,!l&&t.baseClass===void 0?n?(this.toWireType=gn,this.destructorFunction=null):(this.toWireType=yn,this.destructorFunction=null):this.toWireType=mn}var sr=(e,t,r)=>{a.hasOwnProperty(e)||Xe("Replacing nonexistant public symbol"),a[e].overloadTable!==void 0&&r!==void 0?a[e].overloadTable[r]=t:(a[e]=t,a[e].argCount=r)},Qe=[],or,wn=e=>{var t=Qe[e];return t||(e>=Qe.length&&(Qe.length=e+1),Qe[e]=t=or.get(e)),t},Y=(e,t)=>{e=z(e);function r(){return wn(t)}var n=r();return typeof n!="function"&&D(`unknown function pointer with signature ${e}: ${t}`),n},Tn=(e,t)=>{var r=Ee(t,function(n){this.name=t,this.message=n;var l=new Error(n).stack;l!==void 0&&(this.stack=this.toString()+`
`+l.replace(/^Error(:[^\n]*)?\n/,""))});return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.toString=function(){return this.message===void 0?this.name:`${this.name}: ${this.message}`},r},ar,lr=e=>{var t=wr(e),r=z(t);return le(t),r},et=(e,t)=>{var r=[],n={};function l(u){if(!n[u]&&!we[u]){if(Je[u]){Je[u].forEach(l);return}r.push(u),n[u]=!0}}throw t.forEach(l),new ar(`${e}: `+r.map(lr).join([", "]))};function $n(e,t,r,n,l,u,d,f,v,h,g,$,F){e>>>=0,t>>>=0,r>>>=0,n>>>=0,l>>>=0,u>>>=0,d>>>=0,f>>>=0,v>>>=0,h>>>=0,g>>>=0,$>>>=0,F>>>=0,g=z(g),u=Y(l,u),f&&(f=Y(d,f)),h&&(h=Y(v,h)),F=Y($,F);var C=hn(g);Et(C,function(){et(`Cannot construct ${g} due to unbound types`,[n])}),pe([e,t,r],n?[n]:[],function(M){M=M[0];var G,B;n?(G=M.registeredClass,B=G.instancePrototype):B=Ze.prototype;var P=Ee(g,function(){if(Object.getPrototypeOf(this)!==E)throw new Ae("Use 'new' to construct "+g);if(U.constructor_body===void 0)throw new Ae(g+" has no accessible constructor");var Me=U.constructor_body[arguments.length];if(Me===void 0)throw new Ae(`Tried to invoke ctor of ${g} with invalid number of parameters (${arguments.length}) - expected (${Object.keys(U.constructor_body).toString()}) parameters instead!`);return Me.apply(this,arguments)}),E=Object.create(B,{constructor:{value:P}});P.prototype=E;var U=new vn(g,P,E,F,G,u,f,h);U.baseClass&&(U.baseClass.__derivedClasses===void 0&&(U.baseClass.__derivedClasses=[]),U.baseClass.__derivedClasses.push(U));var lt=new Ue(g,U,!0,!1,!1),Te=new Ue(g+"*",U,!1,!1,!1),We=new Ue(g+" const*",U,!1,!0,!1);return rr[e]={pointerType:Te,constPointerType:We},sr(C,P),[lt,Te,We]})}var Ot=(e,t)=>{for(var r=[],n=0;n<e;n++)r.push(p[t+n*4>>>2>>>0]);return r};function cr(e,t){if(!(e instanceof Function))throw new TypeError(`new_ called with constructor type ${typeof e} which is not a function`);var r=Ee(e.name||"unknownFunctionName",function(){});r.prototype=e.prototype;var n=new r,l=e.apply(n,t);return l instanceof Object?l:n}function Ct(e,t,r,n,l,u){var d=t.length;d<2&&D("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var f=t[1]!==null&&r!==null,v=!1,h=1;h<t.length;++h)if(t[h]!==null&&t[h].destructorFunction===void 0){v=!0;break}for(var g=t[0].name!=="void",$="",F="",h=0;h<d-2;++h)$+=(h!==0?", ":"")+"arg"+h,F+=(h!==0?", ":"")+"arg"+h+"Wired";var C=`
        return function (${$}) {
        if (arguments.length !== ${d-2}) {
          throwBindingError('function ${e} called with ' + arguments.length + ' arguments, expected ${d-2}');
        }`;v&&(C+=`var destructors = [];
`);var M=v?"destructors":"null",G=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],B=[D,n,l,bt,t[0],t[1]];f&&(C+="var thisWired = classParam.toWireType("+M+`, this);
`);for(var h=0;h<d-2;++h)C+="var arg"+h+"Wired = argType"+h+".toWireType("+M+", arg"+h+"); // "+t[h+2].name+`
`,G.push("argType"+h),B.push(t[h+2]);if(f&&(F="thisWired"+(F.length>0?", ":"")+F),C+=(g||u?"var rv = ":"")+"invoker(fn"+(F.length>0?", ":"")+F+`);
`,v)C+=`runDestructors(destructors);
`;else for(var h=f?1:2;h<t.length;++h){var P=h===1?"thisWired":"arg"+(h-2)+"Wired";t[h].destructorFunction!==null&&(C+=P+"_dtor("+P+"); // "+t[h].name+`
`,G.push(P+"_dtor"),B.push(t[h].destructorFunction))}g&&(C+=`var ret = retType.fromWireType(rv);
return ret;
`),C+=`}
`,G.push(C);var E=cr(Function,G).apply(null,B);return Ee(e,E)}function An(e,t,r,n,l,u){e>>>=0,r>>>=0,n>>>=0,l>>>=0,u>>>=0;var d=Ot(t,r);l=Y(n,l),pe([],[e],function(f){f=f[0];var v=`constructor ${f.name}`;if(f.registeredClass.constructor_body===void 0&&(f.registeredClass.constructor_body=[]),f.registeredClass.constructor_body[t-1]!==void 0)throw new Ae(`Cannot register multiple constructors with identical number of parameters (${t-1}) for class '${f.name}'! Overload resolution is currently only performed using the parameter count, not actual type info!`);return f.registeredClass.constructor_body[t-1]=()=>{et(`Cannot construct ${f.name} due to unbound types`,d)},pe([],d,h=>(h.splice(1,0,null),f.registeredClass.constructor_body[t-1]=Ct(v,h,null,l,u),[])),[]})}var ur=e=>{e=e.trim();let t=e.indexOf("(");return t!==-1?e.substr(0,t):e};function En(e,t,r,n,l,u,d,f,v){e>>>=0,t>>>=0,n>>>=0,l>>>=0,u>>>=0,d>>>=0;var h=Ot(r,n);t=z(t),t=ur(t),u=Y(l,u),pe([],[e],function(g){g=g[0];var $=`${g.name}.${t}`;t.startsWith("@@")&&(t=Symbol[t.substring(2)]),f&&g.registeredClass.pureVirtualFunctions.push(t);function F(){et(`Cannot call ${$} due to unbound types`,h)}var C=g.registeredClass.instancePrototype,M=C[t];return M===void 0||M.overloadTable===void 0&&M.className!==g.name&&M.argCount===r-2?(F.argCount=r-2,F.className=g.name,C[t]=F):(nr(C,t,$),C[t].overloadTable[r-2]=F),pe([],h,function(G){var B=Ct($,G,g,u,d,v);return C[t].overloadTable===void 0?(B.argCount=r-2,C[t]=B):C[t].overloadTable[r-2]=B,[]}),[]})}function Pn(){Object.assign(fr.prototype,{get(e){return this.allocated[e]},has(e){return this.allocated[e]!==void 0},allocate(e){var t=this.freelist.pop()||this.allocated.length;return this.allocated[t]=e,t},free(e){this.allocated[e]=void 0,this.freelist.push(e)}})}function fr(){this.allocated=[void 0],this.freelist=[]}var Z=new fr;function St(e){e>>>=0,e>=Z.reserved&&--Z.get(e).refcount===0&&Z.free(e)}var On=()=>{for(var e=0,t=Z.reserved;t<Z.allocated.length;++t)Z.allocated[t]!==void 0&&++e;return e},Cn=()=>{Z.allocated.push({value:void 0},{value:null},{value:!0},{value:!1}),Z.reserved=Z.allocated.length,a.count_emval_handles=On},j={toValue:e=>(e||D("Cannot use deleted val. handle = "+e),Z.get(e).value),toHandle:e=>{switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:return Z.allocate({refcount:1,value:e})}}},Sn=function(e,t){e>>>=0,t>>>=0,t=z(t),te(e,{name:t,fromWireType:r=>{var n=j.toValue(r);return St(r),n},toWireType:(r,n)=>j.toHandle(n),argPackAdvance:re,readValueFromPointer:wt,destructorFunction:null})},kn=(e,t,r)=>{switch(t){case 1:return r?function(n){return this.fromWireType(_e[n>>>0>>>0])}:function(n){return this.fromWireType(i[n>>>0>>>0])};case 2:return r?function(n){return this.fromWireType(s[n>>>1>>>0])}:function(n){return this.fromWireType(c[n>>>1>>>0])};case 4:return r?function(n){return this.fromWireType(_[n>>>2>>>0])}:function(n){return this.fromWireType(p[n>>>2>>>0])};default:throw new TypeError(`invalid integer width (${t}): ${e}`)}};function Rn(e,t,r,n){e>>>=0,t>>>=0,r>>>=0,t=z(t);function l(){}l.values={},te(e,{name:t,constructor:l,fromWireType:function(u){return this.constructor.values[u]},toWireType:(u,d)=>d.value,argPackAdvance:re,readValueFromPointer:kn(t,r,n),destructorFunction:null}),Et(t,l)}var tt=(e,t)=>{var r=we[e];return r===void 0&&D(t+" has unknown type "+lr(e)),r};function xn(e,t,r){e>>>=0,t>>>=0,r>>>=0;var n=tt(e,"enum");t=z(t);var l=n.constructor,u=Object.create(n.constructor.prototype,{value:{value:r},constructor:{value:Ee(`${n.name}_${t}`,function(){})}});l.values[r]=u,l[t]=u}var Fn=(e,t)=>{switch(t){case 4:return function(r){return this.fromWireType(w[r>>>2>>>0])};case 8:return function(r){return this.fromWireType(R[r>>>3>>>0])};default:throw new TypeError(`invalid float width (${t}): ${e}`)}},Nn=function(e,t,r){e>>>=0,t>>>=0,r>>>=0,t=z(t),te(e,{name:t,fromWireType:n=>n,toWireType:(n,l)=>l,argPackAdvance:re,readValueFromPointer:Fn(t,r),destructorFunction:null})};function In(e,t,r,n,l,u,d){e>>>=0,r>>>=0,n>>>=0,l>>>=0,u>>>=0;var f=Ot(t,r);e=z(e),e=ur(e),l=Y(n,l),Et(e,function(){et(`Cannot call ${e} due to unbound types`,f)},t-1),pe([],f,function(v){var h=[v[0],null].concat(v.slice(1));return sr(e,Ct(e,h,null,l,u,d),t-1),[]})}function Vn(e,t,r,n,l){e>>>=0,t>>>=0,r>>>=0,t=z(t),l===-1&&(l=4294967295);var u=g=>g;if(n===0){var d=32-8*r;u=g=>g<<d>>>d}var f=t.includes("unsigned"),v=(g,$)=>{},h;f?h=function(g,$){return v($,this.name),$>>>0}:h=function(g,$){return v($,this.name),$},te(e,{name:t,fromWireType:u,toWireType:h,argPackAdvance:re,readValueFromPointer:Zt(t,r,n!==0),destructorFunction:null})}function Dn(e,t,r){e>>>=0,r>>>=0;var n=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,BigInt64Array,BigUint64Array],l=n[t];function u(d){var f=p[d>>>2>>>0],v=p[d+4>>>2>>>0];return new l(_e.buffer,v,f)}r=z(r),te(e,{name:r,fromWireType:u,argPackAdvance:re,readValueFromPointer:u},{ignoreDuplicateRegistrations:!0})}function Un(e,t,r,n,l,u,d,f,v,h,g,$){e>>>=0,t>>>=0,r>>>=0,l>>>=0,u>>>=0,d>>>=0,f>>>=0,v>>>=0,h>>>=0,g>>>=0,$>>>=0,r=z(r),u=Y(l,u),f=Y(d,f),h=Y(v,h),$=Y(g,$),pe([e],[t],function(F){F=F[0];var C=new Ue(r,F.registeredClass,!1,!1,!0,F,n,u,f,h,$);return[C]})}var _r=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n<=127?t++:n<=2047?t+=2:n>=55296&&n<=57343?(t+=4,++r):t+=3}return t};function jn(e,t){e>>>=0,t>>>=0,t=z(t);var r=t==="std::string";te(e,{name:t,fromWireType(n){var l=p[n>>>2>>>0],u=n+4,d;if(r)for(var f=u,v=0;v<=l;++v){var h=u+v;if(v==l||i[h>>>0]==0){var g=h-f,$=xe(f,g);d===void 0?d=$:(d+=String.fromCharCode(0),d+=$),f=h+1}}else{for(var F=new Array(l),v=0;v<l;++v)F[v]=String.fromCharCode(i[u+v>>>0]);d=F.join("")}return le(n),d},toWireType(n,l){l instanceof ArrayBuffer&&(l=new Uint8Array(l));var u,d=typeof l=="string";d||l instanceof Uint8Array||l instanceof Uint8ClampedArray||l instanceof Int8Array||D("Cannot pass non-string to std::string"),r&&d?u=_r(l):u=l.length;var f=Ft(4+u+1),v=f+4;if(p[f>>>2>>>0]=u,r&&d)Jr(l,v,u+1);else if(d)for(var h=0;h<u;++h){var g=l.charCodeAt(h);g>255&&(le(v),D("String has UTF-16 code units that do not fit in 8 bits")),i[v+h>>>0]=g}else for(var h=0;h<u;++h)i[v+h>>>0]=l[h];return n!==null&&n.push(le,f),f},argPackAdvance:re,readValueFromPointer:ir,destructorFunction(n){le(n)}})}var dr=typeof TextDecoder<"u"?new TextDecoder("utf-16le"):void 0,Wn=(e,t)=>{for(var r=e,n=r>>1,l=n+t/2;!(n>=l)&&c[n>>>0];)++n;if(r=n<<1,r-e>32&&dr)return dr.decode(i.subarray(e>>>0,r>>>0));for(var u="",d=0;!(d>=t/2);++d){var f=s[e+d*2>>>1>>>0];if(f==0)break;u+=String.fromCharCode(f)}return u},Mn=(e,t,r)=>{if(r===void 0&&(r=2147483647),r<2)return 0;r-=2;for(var n=t,l=r<e.length*2?r/2:e.length,u=0;u<l;++u){var d=e.charCodeAt(u);s[t>>>1>>>0]=d,t+=2}return s[t>>>1>>>0]=0,t-n},Hn=e=>e.length*2,Ln=(e,t)=>{for(var r=0,n="";!(r>=t/4);){var l=_[e+r*4>>>2>>>0];if(l==0)break;if(++r,l>=65536){var u=l-65536;n+=String.fromCharCode(55296|u>>10,56320|u&1023)}else n+=String.fromCharCode(l)}return n},zn=(e,t,r)=>{if(t>>>=0,r===void 0&&(r=2147483647),r<4)return 0;for(var n=t,l=n+r-4,u=0;u<e.length;++u){var d=e.charCodeAt(u);if(d>=55296&&d<=57343){var f=e.charCodeAt(++u);d=65536+((d&1023)<<10)|f&1023}if(_[t>>>2>>>0]=d,t+=4,t+4>l)break}return _[t>>>2>>>0]=0,t-n},Gn=e=>{for(var t=0,r=0;r<e.length;++r){var n=e.charCodeAt(r);n>=55296&&n<=57343&&++r,t+=4}return t},Bn=function(e,t,r){e>>>=0,t>>>=0,r>>>=0,r=z(r);var n,l,u,d,f;t===2?(n=Wn,l=Mn,d=Hn,u=()=>c,f=1):t===4&&(n=Ln,l=zn,d=Gn,u=()=>p,f=2),te(e,{name:r,fromWireType:v=>{for(var h=p[v>>>2>>>0],g=u(),$,F=v+4,C=0;C<=h;++C){var M=v+4+C*t;if(C==h||g[M>>>f]==0){var G=M-F,B=n(F,G);$===void 0?$=B:($+=String.fromCharCode(0),$+=B),F=M+t}}return le(v),$},toWireType:(v,h)=>{typeof h!="string"&&D(`Cannot pass non-string to C++ string type ${r}`);var g=d(h),$=Ft(4+g+t);return p[$>>>2]=g>>f,l(h,$+4,g+t),v!==null&&v.push(le,$),$},argPackAdvance:re,readValueFromPointer:wt,destructorFunction(v){le(v)}})};function qn(e,t,r,n,l,u){e>>>=0,t>>>=0,r>>>=0,n>>>=0,l>>>=0,u>>>=0,Ye[e]={name:z(t),rawConstructor:Y(r,n),rawDestructor:Y(l,u),fields:[]}}function Yn(e,t,r,n,l,u,d,f,v,h){e>>>=0,t>>>=0,r>>>=0,n>>>=0,l>>>=0,u>>>=0,d>>>=0,f>>>=0,v>>>=0,h>>>=0,Ye[e].fields.push({fieldName:z(t),getterReturnType:r,getter:Y(n,l),getterContext:u,setterArgumentType:d,setter:Y(f,v),setterContext:h})}var Jn=function(e,t){e>>>=0,t>>>=0,t=z(t),te(e,{isVoid:!0,name:t,argPackAdvance:0,fromWireType:()=>{},toWireType:(r,n)=>{}})},pr=(e,t,r)=>{var n=[],l=e.toWireType(n,r);return n.length&&(p[t>>>2>>>0]=j.toHandle(n)),l};function Xn(e,t,r){return e>>>=0,t>>>=0,r>>>=0,e=j.toValue(e),t=tt(t,"emval::as"),pr(t,r,e)}var rt=[];function Kn(e,t,r,n){return e>>>=0,t>>>=0,r>>>=0,n>>>=0,e=rt[e],t=j.toValue(t),e(null,t,r,n)}var Zn={},nt=e=>{var t=Zn[e];return t===void 0?z(e):t};function Qn(e,t,r,n,l){return e>>>=0,t>>>=0,r>>>=0,n>>>=0,l>>>=0,e=rt[e],t=j.toValue(t),r=nt(r),e(t,t[r],n,l)}var hr=()=>typeof globalThis=="object"?globalThis:function(){return Function}()("return this")();function ei(e){return e>>>=0,e===0?j.toHandle(hr()):(e=nt(e),j.toHandle(hr()[e]))}var ti=e=>{var t=rt.length;return rt.push(e),t},ri=(e,t)=>{for(var r=new Array(e),n=0;n<e;++n)r[n]=tt(p[t+n*4>>>2>>>0],"parameter "+n);return r},ns=Reflect.construct;function ni(e,t,r){t>>>=0;var n=ri(e,t),l=n.shift();e--;var u=`return function (obj, func, destructorsRef, args) {
`,d=0,f=[];r===0&&f.push("obj");for(var v=["retType"],h=[l],g=0;g<e;++g)f.push("arg"+g),v.push("argType"+g),h.push(n[g]),u+=`  var arg${g} = argType${g}.readValueFromPointer(args${d?"+"+d:""});
`,d+=n[g].argPackAdvance;var $=r===1?"new func":"func.call";u+=`  var rv = ${$}(${f.join(", ")});
`;for(var g=0;g<e;++g)n[g].deleteObject&&(u+=`  argType${g}.deleteObject(arg${g});
`);l.isVoid||(v.push("emval_returnValue"),h.push(pr),u+=`  return emval_returnValue(retType, destructorsRef, rv);
`),u+=`};
`,v.push(u);var F=cr(Function,v).apply(null,h),C=`methodCaller<(${n.map(M=>M.name).join(", ")}) => ${l.name}>`;return ti(Ee(C,F))}function ii(e){return e>>>=0,e=nt(e),j.toHandle(a[e])}function si(e,t){return e>>>=0,t>>>=0,e=j.toValue(e),t=j.toValue(t),j.toHandle(e[t])}function oi(e){e>>>=0,e>4&&(Z.get(e).refcount+=1)}function ai(e,t){return e>>>=0,t>>>=0,e=j.toValue(e),t=j.toValue(t),e instanceof t}function li(){return j.toHandle([])}function ci(e){return e>>>=0,j.toHandle(nt(e))}function ui(){return j.toHandle({})}function fi(e){e>>>=0;var t=j.toValue(e);bt(t),St(e)}function _i(e,t,r){e>>>=0,t>>>=0,r>>>=0,e=j.toValue(e),t=j.toValue(t),r=j.toValue(r),e[t]=r}function di(e,t){e>>>=0,t>>>=0,e=tt(e,"_emval_take_value");var r=e.readValueFromPointer(t);return j.toHandle(r)}function pi(e){return e>>>=0,e=j.toValue(e),j.toHandle(typeof e)}var vr;vr=()=>performance.now();var hi=!0,vi=e=>e==0||e==1||e==2||e==3;function gi(e,t,r){if(t=yt(t),r>>>=0,!vi(e))return 28;var n;if(e===0)n=Date.now();else if(hi)n=vr();else return 52;var l=Math.round(n*1e3*1e3);return _[r>>>2>>>0]=l>>>0,_[r+4>>>2>>>0]=l/Math.pow(2,32)>>>0,0}var kt=[],mi=(e,t)=>{kt.length=0;for(var r;r=i[e++>>>0];){var n=r!=105;n&=r!=112,t+=n&&t%8?4:0,kt.push(r==112?p[t>>>2>>>0]:r==106?T[t>>>3]:r==105?_[t>>>2>>>0]:R[t>>>3>>>0]),t+=n?8:4}return kt},yi=(e,t,r)=>{var n=mi(t,r);return zr[e].apply(null,n)};function bi(e,t,r){return e>>>=0,t>>>=0,r>>>=0,yi(e,t,r)}function wi(e){e>>>=0,A()}var Rt={},Ti=()=>W||"./this.program",je=()=>{if(!je.strings){var e=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:e,_:Ti()};for(var r in Rt)Rt[r]===void 0?delete t[r]:t[r]=Rt[r];var n=[];for(var r in t)n.push(`${r}=${t[r]}`);je.strings=n}return je.strings},$i=(e,t)=>{for(var r=0;r<e.length;++r)_e[t++>>>0>>>0]=e.charCodeAt(r);_e[t>>>0>>>0]=0},Ai=function(e,t){e>>>=0,t>>>=0;var r=0;return je().forEach((n,l)=>{var u=t+r;p[e+l*4>>>2>>>0]=u,$i(n,u),r+=n.length+1}),0},Ei=function(e,t){e>>>=0,t>>>=0;var r=je();p[e>>>2>>>0]=r.length;var n=0;return r.forEach(l=>n+=l.length+1),p[t>>>2>>>0]=n,0},Pi=e=>52;function Oi(e,t,r,n){return t>>>=0,r>>>=0,n>>>=0,52}function Ci(e,t,r,n){return t=yt(t),n>>>=0,70}var Si=[null,[],[]],ki=(e,t)=>{var r=Si[e];t===0||t===10?((e===1?oe:V)(Yt(r,0)),r.length=0):r.push(t)};function Ri(e,t,r,n){t>>>=0,r>>>=0,n>>>=0;for(var l=0,u=0;u<r;u++){var d=p[t>>>2>>>0],f=p[t+4>>>2>>>0];t+=8;for(var v=0;v<f;v++)ki(e,i[d+v>>>0]);l+=f}return p[n>>>2>>>0]=l,0}var xi=0,Fi=()=>Gr||xi>0,gr=e=>{K=e,Fi()||(a.onExit&&a.onExit(e),ke=!0),H(e,new Bt(e))},xt=e=>e%4===0&&(e%100!==0||e%400===0),mr=(e,t)=>{for(var r=0,n=0;n<=t;r+=e[n++]);return r},it=[31,29,31,30,31,30,31,31,30,31,30,31],st=[31,28,31,30,31,30,31,31,30,31,30,31],ot=(e,t)=>{for(var r=new Date(e.getTime());t>0;){var n=xt(r.getFullYear()),l=r.getMonth(),u=(n?it:st)[l];if(t>u-r.getDate())t-=u-r.getDate()+1,r.setDate(1),l<11?r.setMonth(l+1):(r.setMonth(0),r.setFullYear(r.getFullYear()+1));else return r.setDate(r.getDate()+t),r}return r},Q=e=>parseInt(e);function Ni(e,t,r){var n=r>0?r:_r(e)+1,l=new Array(n),u=Jt(e,l,0,l.length);return t&&(l.length=u),l}function Ii(e,t,r){e>>>=0,t>>>=0,r>>>=0;for(var n=xe(t),l="\\!@#$^&*()+=-[]/{}|:<>?,.",u=0,d=l.length;u<d;++u)n=n.replace(new RegExp("\\"+l[u],"g"),"\\"+l[u]);var f={"%A":"%a","%B":"%b","%c":"%a %b %d %H:%M:%S %Y","%D":"%m\\/%d\\/%y","%e":"%d","%F":"%Y-%m-%d","%h":"%b","%R":"%H\\:%M","%r":"%I\\:%M\\:%S\\s%p","%T":"%H\\:%M\\:%S","%x":"%m\\/%d\\/(?:%y|%Y)","%X":"%H\\:%M\\:%S"};for(var v in f)n=n.replace(v,f[v]);var h={"%a":"(?:Sun(?:day)?)|(?:Mon(?:day)?)|(?:Tue(?:sday)?)|(?:Wed(?:nesday)?)|(?:Thu(?:rsday)?)|(?:Fri(?:day)?)|(?:Sat(?:urday)?)","%b":"(?:Jan(?:uary)?)|(?:Feb(?:ruary)?)|(?:Mar(?:ch)?)|(?:Apr(?:il)?)|May|(?:Jun(?:e)?)|(?:Jul(?:y)?)|(?:Aug(?:ust)?)|(?:Sep(?:tember)?)|(?:Oct(?:ober)?)|(?:Nov(?:ember)?)|(?:Dec(?:ember)?)","%C":"\\d\\d","%d":"0[1-9]|[1-9](?!\\d)|1\\d|2\\d|30|31","%H":"\\d(?!\\d)|[0,1]\\d|20|21|22|23","%I":"\\d(?!\\d)|0\\d|10|11|12","%j":"00[1-9]|0?[1-9](?!\\d)|0?[1-9]\\d(?!\\d)|[1,2]\\d\\d|3[0-6]\\d","%m":"0[1-9]|[1-9](?!\\d)|10|11|12","%M":"0\\d|\\d(?!\\d)|[1-5]\\d","%n":"\\s","%p":"AM|am|PM|pm|A\\.M\\.|a\\.m\\.|P\\.M\\.|p\\.m\\.","%S":"0\\d|\\d(?!\\d)|[1-5]\\d|60","%U":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%W":"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53","%w":"[0-6]","%y":"\\d\\d","%Y":"\\d\\d\\d\\d","%%":"%","%t":"\\s"},g={JAN:0,FEB:1,MAR:2,APR:3,MAY:4,JUN:5,JUL:6,AUG:7,SEP:8,OCT:9,NOV:10,DEC:11},$={SUN:0,MON:1,TUE:2,WED:3,THU:4,FRI:5,SAT:6},F={MON:0,TUE:1,WED:2,THU:3,FRI:4,SAT:5,SUN:6};for(var C in h)n=n.replace(C,"("+C+h[C]+")");for(var M=[],u=n.indexOf("%");u>=0;u=n.indexOf("%"))M.push(n[u+1]),n=n.replace(new RegExp("\\%"+n[u+1],"g"),"");var G=new RegExp("^"+n,"i").exec(xe(e));function B(){function he(ve,Nt,Pr){return typeof ve!="number"||isNaN(ve)?Nt:ve>=Nt?ve<=Pr?ve:Pr:Nt}return{year:he(_[r+20>>>2>>>0]+1900,1970,9999),month:he(_[r+16>>>2>>>0],0,11),day:he(_[r+12>>>2>>>0],1,31),hour:he(_[r+8>>>2>>>0],0,23),min:he(_[r+4>>>2>>>0],0,59),sec:he(_[r>>>2>>>0],0,59)}}if(G){var P=B(),E,U=he=>{var ve=M.indexOf(he);if(ve>=0)return G[ve+1]};if((E=U("S"))&&(P.sec=Q(E)),(E=U("M"))&&(P.min=Q(E)),E=U("H"))P.hour=Q(E);else if(E=U("I")){var lt=Q(E);(E=U("p"))&&(lt+=E.toUpperCase()[0]==="P"?12:0),P.hour=lt}if(E=U("Y"))P.year=Q(E);else if(E=U("y")){var Te=Q(E);(E=U("C"))?Te+=Q(E)*100:Te+=Te<69?2e3:1900,P.year=Te}if((E=U("m"))?P.month=Q(E)-1:(E=U("b"))&&(P.month=g[E.substring(0,3).toUpperCase()]||0),E=U("d"))P.day=Q(E);else if(E=U("j"))for(var We=Q(E),Me=xt(P.year),ct=0;ct<12;++ct){var Ar=mr(Me?it:st,ct-1);We<=Ar+(Me?it:st)[ct]&&(P.day=We-Ar)}else if(E=U("a")){var Er=E.substring(0,3).toUpperCase();if(E=U("U")){var He=$[Er],Le=Q(E),ce=new Date(P.year,0,1),ue;ce.getDay()===0?ue=ot(ce,He+7*(Le-1)):ue=ot(ce,7-ce.getDay()+He+7*(Le-1)),P.day=ue.getDate(),P.month=ue.getMonth()}else if(E=U("W")){var He=F[Er],Le=Q(E),ce=new Date(P.year,0,1),ue;ce.getDay()===1?ue=ot(ce,He+7*(Le-1)):ue=ot(ce,7-ce.getDay()+1+He+7*(Le-1)),P.day=ue.getDate(),P.month=ue.getMonth()}}var ie=new Date(P.year,P.month,P.day,P.hour,P.min,P.sec,0);return _[r>>>2>>>0]=ie.getSeconds(),_[r+4>>>2>>>0]=ie.getMinutes(),_[r+8>>>2>>>0]=ie.getHours(),_[r+12>>>2>>>0]=ie.getDate(),_[r+16>>>2>>>0]=ie.getMonth(),_[r+20>>>2>>>0]=ie.getFullYear()-1900,_[r+24>>>2>>>0]=ie.getDay(),_[r+28>>>2>>>0]=mr(xt(ie.getFullYear())?it:st,ie.getMonth()-1)+ie.getDate()-1,_[r+32>>>2>>>0]=0,e+Ni(G[0]).length-1}return 0}var Vi=(e,t)=>{K=e,gr(e)},Di=e=>{if(e instanceof Bt||e=="unwind")return K;H(1,e)};Xt=a.InternalError=class extends Error{constructor(t){super(t),this.name="InternalError"}},Zr(),Ae=a.BindingError=class extends Error{constructor(t){super(t),this.name="BindingError"}},_n(),ln(),bn(),ar=a.UnboundTypeError=Tn(Error,"UnboundTypeError"),Pn(),Cn();var yr={__syscall_ftruncate64:Yr,__syscall_getdents64:Xr,_embind_finalize_value_object:Kr,_embind_register_bigint:en,_embind_register_bool:tn,_embind_register_class:$n,_embind_register_class_constructor:An,_embind_register_class_function:En,_embind_register_emval:Sn,_embind_register_enum:Rn,_embind_register_enum_value:xn,_embind_register_float:Nn,_embind_register_function:In,_embind_register_integer:Vn,_embind_register_memory_view:Dn,_embind_register_smart_ptr:Un,_embind_register_std_string:jn,_embind_register_std_wstring:Bn,_embind_register_value_object:qn,_embind_register_value_object_field:Yn,_embind_register_void:Jn,_emval_as:Xn,_emval_call:Kn,_emval_call_method:Qn,_emval_decref:St,_emval_get_global:ei,_emval_get_method_caller:ni,_emval_get_module_property:ii,_emval_get_property:si,_emval_incref:oi,_emval_instanceof:ai,_emval_new_array:li,_emval_new_cstring:ci,_emval_new_object:ui,_emval_run_destructors:fi,_emval_set_property:_i,_emval_take_value:di,_emval_typeof:pi,clock_time_get:gi,emscripten_asm_const_int:bi,emscripten_notify_memory_growth:wi,environ_get:Ai,environ_sizes_get:Ei,fd_close:Pi,fd_read:Oi,fd_seek:Ci,fd_write:Ri,proc_exit:gr,strptime:Ii},J=Lr(),Ft=e=>(Ft=J.malloc)(e),le=e=>(le=J.free)(e),Ui=()=>(Ui=J.__errno_location)(),br=a.__initialize=()=>(br=a.__initialize=J._initialize)(),wr=e=>(wr=J.__getTypeName)(e),ji=e=>(ji=J.__cxa_increment_exception_refcount)(e),Wi=e=>(Wi=J.__cxa_is_pointer_type)(e);function Mi(e){e=Object.assign({},e);var t=n=>l=>n(l)>>>0,r=n=>()=>n()>>>0;return e.malloc=t(e.malloc),e.__errno_location=r(e.__errno_location),e.__getTypeName=t(e.__getTypeName),e.stackSave=r(e.stackSave),e.stackAlloc=t(e.stackAlloc),e}var at,Hi=void 0;Re=function e(){at||Tr(),at||(Re=e)};function Li(e=[]){var t=br;Hi=[W].concat(e);try{t();var r=0;return Vi(r,!0),r}catch(n){return Di(n)}}function Tr(e=k){if(ye>0||(ae(),ye>0))return;function t(){at||(at=!0,a.calledRun=!0,!ke&&(vt(),Be(),b(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),$r&&Li(e),Ir()))}a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),t()},1)):t()}if(a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();var $r=!0;return a.noInitialRun&&($r=!1),Tr(),o.ready}})(),Cr=Bi;var ut={};Gi(ut,{COLUMN_SEPARATOR_STRING:()=>se,CONFIG_ALIASES:()=>Pe,CONFIG_VALID_KEYS:()=>Vt,DATA_TYPES:()=>qi,FILTER_OPERATORS:()=>N,SORT_ORDERS:()=>Ji,SORT_ORDER_IDS:()=>Xi,TYPE_AGGREGATES:()=>Ki,TYPE_FILTERS:()=>es});var qi={integer:"integer",float:"float",string:"string",boolean:"boolean",date:"date",datetime:"datetime",object:"object"},Pe={row_pivot:"group_by","row-pivot":"group_by","row-pivots":"group_by",col_pivot:"split_by",col_pivots:"split_by",column_pivot:"split_by","column-pivot":"split_by","column-pivots":"split_by",filters:"filter",sorts:"sort"},Vt=["version","viewport","group_by","split_by","aggregates","columns","filter","sort","computed_columns","expressions","group_by_depth","split_by_depth","filter_op"],Sr=["any","avg","abs sum","count","distinct count","dominant","first by index","last by index","last minus first","last","high","join","low","high minus low","max","mean","median","min","pct sum parent","pct sum grand total","stddev","sum","sum abs","sum not null","unique","var"],It=["any","count","distinct count","distinct leaf","dominant","first by index","join","last by index","last","unique"],Yi=["any","count","distinct count","distinct leaf","dominant","first by index","last by index","last","unique"],Ji=["none","asc","desc","col asc","col desc","asc abs","desc abs","col asc abs","col desc abs"],Xi=[2,0,1,0,1,3,4,3,4],Ki={string:It,float:Sr,integer:Sr,boolean:Yi,datetime:It,date:It},N={lessThan:"<",greaterThan:">",equals:"==",lessThanOrEquals:"<=",greaterThanOrEquals:">=",doesNotEqual:"!=",isNull:"is null",isNotNull:"is not null",isIn:"in",isNotIn:"not in",contains:"contains",bitwiseAnd:"&",bitwiseOr:"|",and:"and",or:"or",beginsWith:"begins with",endsWith:"ends with"},Zi=[N.bitwiseAnd,N.bitwiseOr,N.equals,N.doesNotEqual,N.or,N.and,N.isNull,N.isNotNull],kr=[N.lessThan,N.greaterThan,N.equals,N.lessThanOrEquals,N.greaterThanOrEquals,N.doesNotEqual,N.isNull,N.isNotNull],Qi=[N.equals,N.contains,N.doesNotEqual,N.isIn,N.isNotIn,N.beginsWith,N.endsWith,N.isNull,N.isNotNull],Rr=[N.lessThan,N.greaterThan,N.equals,N.lessThanOrEquals,N.greaterThanOrEquals,N.doesNotEqual,N.isNull,N.isNotNull],se="|",es={string:Qi,float:kr,integer:kr,boolean:Zi,datetime:Rr,date:Rr};var Dt={types:{float:{filter_operator:"==",aggregate:"sum",format:{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}},string:{filter_operator:"==",aggregate:"count"},integer:{filter_operator:"==",aggregate:"sum",format:{}},boolean:{filter_operator:"==",aggregate:"count"},datetime:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short",timeStyle:"medium"},null_value:-1},date:{filter_operator:"==",aggregate:"count",format:{dateStyle:"short"},null_value:-1}}};function Oe(m){let o={};if(xr().types[m]&&Object.assign(o,xr().types[m]),o.type){let a=Oe(o.type);return Object.assign(a,o),a}else return o}function Ut(m){return m&&typeof m=="object"&&!Array.isArray(m)}function ft(m,...o){if(!o.length)return m;let a=o.shift();if(Ut(m)&&Ut(a))for(let b in a)Ut(a[b])?(m[b]||Object.assign(m,{[b]:{}}),ft(m[b],a[b])):Object.assign(m,{[b]:a[b]});return ft(m,...o)}function Fr(m){globalThis.__PERSPECTIVE_CONFIG__&&console.warn("Config already initialized!"),globalThis.__PERSPECTIVE_CONFIG__=ft(Dt,m)}function xr(){return globalThis.__PERSPECTIVE_CONFIG__||(globalThis.__PERSPECTIVE_CONFIG__=ft(Dt,globalThis.__TEMPLATE_CONFIG__||{})),globalThis.__PERSPECTIVE_CONFIG__}function _t(m){if(m>=1&&m<=8)return"integer";if(m===19)return"string";if(m===10||m===9)return"float";if(m===11)return"boolean";if(m===12)return"datetime";if(m===13)return"date";console.warn(`Unknown type for value ${m} with JS type ${typeof m}`)}function jt(m){let o=m;do for(let a of Object.getOwnPropertyNames(o)){let b=m[a];a!=="constructor"&&typeof b=="function"&&(m[a]=b.bind(m))}while(o=o!==Object&&Object.getPrototypeOf(o))}String.prototype.includes||(String.prototype.includes=function(m,o){return typeof o!="number"&&(o=0),o+m.length>this.length?!1:this.indexOf(m,o)!==-1});Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(m,o){if(this==null)throw new TypeError('"this" is null or not defined');var a=Object(this),b=a.length>>>0;if(b===0)return!1;var I=o|0,S=Math.max(I>=0?I:b-Math.abs(I),0);function k(W,H){return W===H||typeof W=="number"&&typeof H=="number"&&isNaN(W)&&isNaN(H)}for(;S<b;){if(k(a[S],m))return!0;S++}return!1}});var dt=class{constructor(){this.data_formats={row:0,column:1,schema:2},this.format=void 0,this.data=void 0,this.names=void 0,this.types=void 0,this.row_count=void 0}is_format(o){if(Array.isArray(o))return this.data_formats.row;if(Array.isArray(o[Object.keys(o)[0]]))return this.data_formats.column;if(typeof o[Object.keys(o)[0]]=="string"||typeof o[Object.keys(o)[0]]=="function")return this.data_formats.schema;throw`Could not determine data format for ${JSON.stringify(o)}, with JS typeof ${typeof o}`}count_rows(o){return this.format===this.data_formats.row?o.length:this.format===this.data_formats.column?o[Object.keys(o)[0]].length:0}get_format(){return this.format}get(o,a){let b;if(this.format===this.data_formats.row){let I=this.data[a];I.hasOwnProperty(o)&&(b=I[o])}else if(this.format===this.data_formats.column)this.data.hasOwnProperty(o)&&(b=this.data[o][a]);else if(this.format===this.data_formats.schema)b=void 0;else throw`Could not get() from dataset - ${this.data} is poorly formatted.`;return b}marshal(o,a,b){let I=this.names[o],S=ts(this.get(I,a));if(S===null)return null;if(!(typeof S>"u")){switch(_t(b.value)){case"float":case"integer":{S=Number(S);break}case"boolean":{typeof S=="string"?S.toLowerCase()==="true"?S=!0:S=!1:S=!!S;break}case"datetime":case"date":break;default:S+=""}return S}}clean(){this.names=void 0,this.types=void 0}init(o){this.data=o,this.format=this.is_format(this.data),this.row_count=this.count_rows(this.data);let a={};if(this.format===this.data_formats.row)o.length>0?this.names=Object.keys(o[0]):this.clean.names=[];else if(this.format===this.data_formats.column)this.names=Object.keys(o);else if(this.format===this.data_formats.schema){this.names=Object.keys(o);for(let b of this.names){let I=Oe(o[b]);I.type&&(console.debug(`Converting "${o[b]}" to "${I.type}"`),a[b]=o[b],o[b]=I.type)}}else throw`Could not initialize - failed to determine format for ${o}`;return a}};function ts(m){return m===null||m==="null"?null:m===void 0||m==="undefined"?void 0:m}var Wt=function(m){let o=[];for(let a=0;a<m.size();a++){let b=m.get(a);o.push(b)}return m.delete(),o},Mt=function(m){let o={},a=m.keys();for(let b=0;b<a.size();b++){let I=a.get(b);o[I]=m.get(I)}return m.delete(),a.delete(),o},Ce=function(m,o){for(let a of o)m.push_back(a);return m};function rs(m){let o={};return typeof m!="string"?Object.getOwnPropertyNames(m).forEach(a=>{o[a]=m[a]},m):o.message=m,o}var ze=class{constructor(o){this.perspective=o,this._tables={},this._views={},this._callback_cache=new Map}init(o){o.config&&Fr(o.config),o.data=["wait_for_response"],this.post(o)}post(o){throw new Error(`Posting ${o} failed - post() not implemented!`)}process(o,a){switch(o.cmd){case"init_profile_thread":this.perspective.initialize_profile_thread();break;case"get_hosted_table_names":this.post({id:o.id,data:Object.keys(this._tables)});break;case"memory_usage":this.post({id:o.id,data:this.perspective.memory_usage()});break;case"init":this.init(o);break;case"table":if(typeof o.args[0]>"u")this._tables[o.name]=[];else try{let k=this._tables[o.name],W=this.perspective.table(o.args[0],o.options);if(W&&W.then)W.then(H=>{if(this._tables[o.name]=H,k)for(let ne of k)this.process(ne);this.post({id:o.id,data:o.name})}).catch(H=>this.process_error(o,H));else{if(this._tables[o.name]=W,k)for(let H of k)this.process(H);this.post({id:o.id,data:o.name})}}catch(k){this.process_error(o,k);return}break;case"table_generate":(0,eval)(o.args)(function(k){this._tables[o.name]=k,this.post({id:o.id,data:"created!"})});break;case"table_execute":(0,eval)(o.f)(this._tables[o.name]);break;case"table_method":case"view_method":this.process_method_call(o);break;case"view":let S=this._tables[o.table_name];if(S&&Array.isArray(S))S.push(o),this._views[o.view_name]=[];else try{let k=this._views[o.view_name],W=this._tables[o.table_name].view(o.config);if(W&&W.then)W.then(H=>{if(this._views[o.view_name]=H,this._views[o.view_name].client_id=a,k)for(let ne of k)this.process(ne);this.post({id:o.id,data:o.view_name})}).catch(H=>this.process_error(o,H));else{if(this._views[o.view_name]=W,this._views[o.view_name].client_id=a,k)for(let H of k)this.process(H);this.post({id:o.id,data:o.view_name})}}catch(k){this.process_error(o,k);return}break}}process_subscribe(o,a){try{let b;o.method.slice(0,2)==="on"?(b=I=>{let S={id:o.id,data:I};try{if(o.args&&o.args[0]&&o.method==="on_update"&&o.args[0].mode==="row"){this.post(S,[I.delta]);return}this.post(S)}catch{console.error(`Removing failed callback to \`${o.method}()\` (presumably due to failed connection)`);let W=o.method.substring(3);a[`remove_${W}`](b)}},o.callback_id&&this._callback_cache.set(o.callback_id,b)):o.callback_id&&(b=this._callback_cache.get(o.callback_id),this._callback_cache.delete(o.callback_id)),b?a[o.method](b,...o.args):console.error(`Callback not found for remote call "${JSON.stringify(o)}"`)}catch(b){this.process_error(o,b);return}}process_method_call(o){let a,b,I=o.view_name||o.name;if(o.cmd==="table_method"?a=this._tables[I]:a=this._views[I],!a&&o.cmd==="view_method"){this.process_error(o,{message:"View method cancelled"});return}if(a&&a.push){a.push(o);return}try{if(o.subscribe){this.process_subscribe(o,a);return}else b=a[o.method].apply(a,o.args),b instanceof Promise?b.then(S=>this.process_method_call_response(o,S)).catch(S=>this.process_error(o,S)):this.process_method_call_response(o,b)}catch(S){this.process_error(o,S);return}}process_method_call_response(o,a){o.method==="delete"&&delete this._views[o.name],o.method==="to_arrow"?this.post({id:o.id,data:a},[a]):this.post({id:o.id,data:a})}process_error(o,a){try{this.post({id:o.id,error:rs(a)})}catch{console.error("Error handler failed: {}",a)}}clear_views(o){for(let a of Object.keys(this._views))if(this._views[a].client_id===o){try{this._views[a].delete()}catch(b){console.error(b)}delete this._views[a]}console.debug(`GC ${Object.keys(this._views).length} views in memory`)}};typeof self<"u"&&self.performance===void 0&&(self.performance={now:Date.now});var pt=new Set;function Nr(m){let o=m,a=new dt,b=["zero","one","two"],I={};function S(i,s){I[s]?i.delete():(I[s]=i,setTimeout(()=>k(s)))}function k(i){let s=I[i];s&&(s._process(),W(i))}function W(i){I[i]?.delete(),delete I[i]}function H(){let i=performance.memory?JSON.parse(JSON.stringify(performance.memory,["totalJSHeapSize","usedJSHeapSize","jsHeapSizeLimit"])):process.memoryUsage();return i.wasmHeap=o.HEAP8.length,i}function ne(i,s,c,_,p,w,T,y,R){c||(c=""),_||(_=4294967295),s=o.make_table(s,i,_,c,p,w,T,y,R);let A=s.get_pool(),x=s.get_id();return w||p==o.t_op.OP_DELETE?S(A,x):(A._process(),A.delete()),s}function O(i,s,c,_,p){this.name=p,this._View=void 0,this.table=i,this.config=c||{},this.view_config=_||new _,this.is_unit_context=this.table.index===""&&s===0&&this.view_config.group_by.length===0&&this.view_config.split_by.length===0&&this.view_config.filter.length===0&&this.view_config.sort.length===0&&this.view_config.expressions.length===0,this.is_unit_context?this._View=o.make_view_unit(i._Table,p,se,this.view_config,null):s===0?this._View=o.make_view_zero(i._Table,p,se,this.view_config,null):s===1?this._View=o.make_view_one(i._Table,p,se,this.view_config,null):s===2&&(this._View=o.make_view_two(i._Table,p,se,this.view_config,null)),this.ctx=this._View.get_context(),this.column_only=this._View.is_column_only(),this.update_callbacks=this.table.update_callbacks,this.overridden_types=this.table.overridden_types,this._delete_callbacks=[],jt(this)}O.prototype.get_config=function(){return JSON.parse(JSON.stringify(this.config))},O.prototype.delete=function(){W(this.table.get_id()),this._View.delete(),this.ctx.delete(),this.table.views.splice(this.table.views.indexOf(this),1),this.table=void 0;let i=0,s=0;for(;i<this.update_callbacks.length;){let c=this.update_callbacks[i];c.view!==this&&(this.update_callbacks[s++]=c),i++}this.update_callbacks.length=s,this._delete_callbacks.forEach(c=>c())},O.prototype.sides=function(){return this._View.sides()},O.prototype._num_hidden=function(){let i=0;for(let s of this.config.sort)this.config.columns.indexOf(s[0])===-1&&i++;return i};function X(i){let s=[];for(let c=0;c<i.size();c++){let _=i.get(c);s.push(o.scalar_to_val(_,!1,!0)),_.delete()}return i.delete(),s}let Ge=function(i){let s=[];for(let c=0;c<i.size();c++){let _=i.get(c);s.push(X(_))}return i.delete(),s};O.prototype.schema=function(i=!0){let s=Mt(this._View.schema());if(i)for(let c of Object.keys(s)){let _=c.split(se);_=_[_.length-1],this.overridden_types[_]&&Oe(this.overridden_types[_]).type===s[c]&&(s[c]=this.overridden_types[_])}return s},O.prototype.expression_schema=function(i=!0){let s=Mt(this._View.expression_schema());if(i)for(let c of Object.keys(s)){let _=c.split(se);_=_[_.length-1],this.overridden_types[_]&&Oe(this.overridden_types[_]).type===s[c]&&(s[c]=this.overridden_types[_])}return s},O.prototype._column_names=function(i=!1,s=0){return Ge(this._View.column_names(i,s)).map(c=>c.join(se))},O.prototype.column_paths=function(){return Ge(this._View.column_paths()).map(i=>i.join(se))},O.prototype.get_data_slice=function(i,s,c,_){if(this.is_unit_context)return o.get_data_slice_unit(this._View,i,s,c,_);{let p=this.sides(),w=b[p];return o[`get_data_slice_${w}`](this._View,i,s,c,_)}};let Se=function(i){i=i||{};let s=this._View.num_columns()+(this.sides()===0?0:1),c=this._View.num_rows(),_=this._num_hidden(),p=this.sides()>0||this.column_only?1:0,w=this.config.viewport?this.config.viewport:{},T=i.start_row||(w.top?w.top:0),y=Math.min(c,i.end_row!==void 0?i.end_row:w.height?T+w.height:c),R=i.start_col||(w.left?w.left:0),A=Math.min(s,(i.end_col!==void 0?i.end_col+p:w.width?R+w.width:s)*(_+1));return i.start_row=Math.floor(T),i.end_row=Math.ceil(y),i.start_col=Math.floor(R),i.end_col=Math.ceil(A),i};O.prototype.get_min_max=function(i){if(this.is_unit_context)return o.get_min_max_unit(this._View,i);{let s=this.sides(),c=b[s];return o[`get_min_max_${c}`](this._View,i)}};let ht=function(i,s,c){let _=this.num_rows(),p=s.start_row||0,w=s.end_row||_,y=this._column_names().indexOf(i);if(y===-1)return;this.sides()>0&&y++;let A,x;s.data_slice?A=s.data_slice.get_column_slice(y):(x=this.get_data_slice(p,w,y,y+1),A=x.get_slice());let q=this._View.get_column_dtype(y),de=c(A,q,y);return A.delete(),x&&x.delete(),de};O.prototype.to_columns=function(i){return JSON.parse(this.to_columns_string(i))},O.prototype.to_columns_string=function(i){k(this.table.get_id()),i=Se.bind(this)(i);let s=i.start_row,c=i.end_row,_=i.start_col,p=i.end_col,w=this._num_hidden(),T=i.formatted,y=!!i.index,R=!!i.id,A=!!i.leaves_only,x=this.sides(),q=x!==0&&!this.column_only,de=b[x],L=this.get_config(),ee=L.columns.length,ae=L.group_by.length;return this._View.to_columns(s,c,_,p,w,T,y,R,A,x,q,de,ee,ae)},O.prototype.to_json=function(i){let s=this.to_columns(i),c=Object.keys(s);return(s[c[0]]||[]).map((p,w)=>{let T={};for(let y of c)T[y]=s[y][w];return T})},O.prototype.to_csv=function(i){k(this.table.get_id()),i=Se.bind(this)(i);let s=i.start_row,c=i.end_row,_=i.start_col,p=i.end_col,w=this.sides();if(this.is_unit_context)return o.to_csv_unit(this._View,s,c,_,p);if(w===0)return o.to_csv_zero(this._View,s,c,_,p);if(w===1)return o.to_csv_one(this._View,s,c,_,p);if(w===2)return o.to_csv_two(this._View,s,c,_,p)},O.prototype.col_to_js_typed_array=function(i,s={}){k(this.table.get_id());let c=o.col_to_js_typed_array;return ht.call(this,i,s,c)},O.prototype.to_arrow=function(i={}){k(this.table.get_id()),i=Se.bind(this)(i);let s=i.start_row,c=i.end_row,_=i.start_col,p=i.end_col,w=this.sides(),T="compression"in i?i.compression==="lz4":!0;if(this.is_unit_context)return o.to_arrow_unit(this._View,s,c,_,p,T);if(w===0)return o.to_arrow_zero(this._View,s,c,_,p,T);if(w===1)return o.to_arrow_one(this._View,s,c,_,p,T);if(w===2)return o.to_arrow_two(this._View,s,c,_,p,T)},O.prototype.num_rows=function(){return k(this.table.get_id()),this._View.num_rows()},O.prototype.num_columns=function(){let i=this._View.num_columns(),s=this._num_hidden();return i-i/(this.config.columns.length+s)*s},O.prototype.dimensions=function(){return{num_table_rows:this.table.num_rows(),num_table_columns:this.table.num_columns(),num_view_rows:this._View.num_rows(),num_view_columns:this.num_columns()}},O.prototype.get_row_expanded=function(i){return this._View.get_row_expanded(i)},O.prototype.expand=function(i){return this._View.expand(i,this.config.group_by.length)},O.prototype.collapse=function(i){return this._View.collapse(i)},O.prototype.set_depth=function(i){return this._View.set_depth(i,this.config.group_by.length)},O.prototype._get_step_delta=async function(){let i=this._View.get_step_delta(0,2147483647),s;if(i.cells.size()===0)s=this.to_json();else{let c={};for(let p=0;p<i.cells.size();p++)c[i.cells.get(p).row]=!0;c=Object.keys(c);let _=c.map(p=>this.to_json({start_row:Number.parseInt(p),end_row:Number.parseInt(p)+1}));s=[].concat.apply([],_)}return i.cells.delete(),s},O.prototype._get_row_delta=async function(){if(this.is_unit_context)return o.get_row_delta_unit(this._View);{let i=this.sides(),s=b[i];return o[`get_row_delta_${s}`](this._View)}},O.prototype.on_update=function(i,{mode:s="none"}={}){if(k(this.table.get_id()),["none","row"].indexOf(s)===-1)throw new Error(`Invalid update mode "${s}" - valid modes are "none" and "row".`);s==="row"&&(this._View._get_deltas_enabled()||this._View._set_deltas_enabled(!0)),this.update_callbacks.push({view:this,orig_callback:i,callback:async(c,_)=>{_[c]===void 0&&(_[c]={});let p={port_id:c};s==="row"&&(_[c].row_delta===void 0&&(_[c].row_delta=await this._get_row_delta()),p.delta=_[c].row_delta),i(p)}})};function ge(i,s){let c=0,_=0;for(;c<i.length;){let p=i[c];s(p,c,i)&&(i[_++]=p),c++}return i.length=_,i}O.prototype.remove_update=function(i){k(this.table.get_id());let s=this.update_callbacks.length;ge(this.update_callbacks,c=>c.orig_callback!==i),console.assert(s>this.update_callbacks.length,'"callback" does not match a registered updater')},O.prototype.on_delete=function(i){this._delete_callbacks.push(i)},O.prototype.remove_delete=function(i){let s=this._delete_callbacks.length;ge(this._delete_callbacks,c=>c!==i),console.assert(s>this._delete_callbacks.length,'"callback" does not match a registered delete callbacks')};function oe(i){this.group_by=i.group_by||[],this.split_by=i.split_by||[],this.aggregates=i.aggregates||{},this.columns=i.columns,this.filter=i.filter||[],this.sort=i.sort||[],this.expressions=i.expressions||[],this.filter_op=i.filter_op||"and",this.group_by_depth=i.group_by_depth,this.split_by_depth=i.split_by_depth}oe.prototype.get_group_by=function(){let i=o.make_string_vector();return Ce(i,this.group_by)},oe.prototype.get_split_by=function(){let i=o.make_string_vector();return Ce(i,this.split_by)},oe.prototype.get_columns=function(){let i=o.make_string_vector();return Ce(i,this.columns)},oe.prototype.get_filter=function(){let i=o.make_2d_val_vector();for(let s of this.filter){let c=o.make_val_vector(),_=Ce(c,s);i.push_back(_)}return i},oe.prototype.get_sort=function(){let i=o.make_2d_string_vector();for(let s of this.sort){let c=o.make_string_vector(),_=Ce(c,s);i.push_back(_)}return i},oe.prototype.get_expressions=function(){let i=o.make_2d_val_vector();for(let s of this.expressions){let c=o.make_val_vector();for(let _ of s)c.push_back(_);i.push_back(c)}return i};function V(i,s,c,_){this._Table=i;let p=this._Table.get_gnode();this.gnode_id=p.get_id(),p.delete();let w=this._Table.get_pool();w.set_update_delegate(this),w.delete(),this.name=Math.random()+"",this.initialized=!1,this.index=s,this.limit=c,this.update_callbacks=[],this._delete_callbacks=[],this.views=[],this.overridden_types=_,jt(this)}V.prototype.get_id=function(){return this._Table.get_id()},V.prototype.get_pool=function(){return this._Table.get_pool()},V.prototype.make_port=function(){return this._Table.make_port()},V.prototype.remove_port=function(){this._Table.remove_port()},V.prototype._update_callback=function(i){let s={};for(let c in this.update_callbacks)this.update_callbacks[c].callback(i,s)},V.prototype.get_index=function(){return this.index},V.prototype.get_limit=function(){return this.limit},V.prototype.clear=function(){k(this.get_id()),this._Table.reset_gnode(this.gnode_id)},V.prototype.get_num_views=function(){return this.views.length},V.prototype.replace=function(i){W(this.get_id()),this._Table.reset_gnode(this.gnode_id),this.update(i),k(this.get_id())},V.prototype.delete=function(){if(this.views.length>0)throw`Cannot delete Table as it still has ${this.views.length} registered View(s).`;W(this.get_id()),this._Table.unregister_gnode(this.gnode_id),this._Table.delete();for(let i of this._delete_callbacks)i()},V.prototype.on_delete=function(i){this._delete_callbacks.push(i)},V.prototype.remove_delete=function(i){let s=this._delete_callbacks.length;ge(this._delete_callbacks,c=>c!==i),console.assert(s>this._delete_callbacks.length,'"callback" does not match a registered delete callbacks')},V.prototype.size=function(){return k(this._Table.get_id()),this._Table.size()},V.prototype.num_rows=function(){return this.size()},V.prototype.num_columns=function(){let i=this._Table.get_schema(),s=i.columns(),c=s.size();return s.delete(),i.delete(),c-1},V.prototype.schema=function(i=!0){let s=this._Table.get_schema(),c=s.columns(),_=s.types(),p={};for(let w=0;w<c.size();w++){let T=c.get(w);T!=="psp_okey"&&(i&&this.overridden_types[T]?p[T]=this.overridden_types[T]:p[T]=_t(_.get(w).value))}return s.delete(),c.delete(),_.delete(),p};function fe(i){let s=[],c={},_=!Array.isArray(i);for(let p of _?Object.keys(i):i){let w=p;_&&(p=i[p]);let T={},y={},R=0,A;if(_)A=w;else{let L=p.match(/^\/\/(?<alias>.+?)\n/);L?.groups?.alias&&(A=L.groups.alias.trim()),(!A||A.length==0)&&(A=p)}let x=p.replace(/([a-zA-Z_]+[a-zA-Z0-9_]*)/g,L=>L=="true"?"True":L=="false"?"False":L);x=x.replace(/\"(.*?[^\\])\"/g,(L,ee)=>{if(ee=ee.replace(/\\"/g,'"'),T[ee]===void 0){let ae=`COLUMN${R}`;T[ee]=ae,y[ae]=ee}return R++,T[ee]}),x=x.replace(/'(.*?[^\\])'/g,L=>`intern(${L})`);let q=(L,ee,ae,vt)=>{let Be=L.indexOf(ae);return`${L.substring(0,Be)}'${vt}'${L.substring(Be+ae.length)}`};x=x.replace(/(bucket|match|match_all|search|indexof)\(.*?,\s*(intern\(\'(.+)\'\)).*\)/g,q),x=x.replace(/(replace_all|replace)\(.*?,\s*(intern\(\'(.*)\'\)),.*\)/g,q);let de=[A,p,x,y];if(c[A]!==void 0){let L=c[A];s[L]=de}else s.push(de),c[A]=s.length-1}return s}V.prototype.validate_expressions=function(i,s=!0){let c={expression_schema:{},expression_alias:{},errors:{}};if(!i||Object.keys(i).length===0)return c;i=fe(i);let _=o.make_2d_val_vector();for(let A of i){let x=o.make_val_vector();for(let q of A)x.push_back(q);_.push_back(x),c.expression_alias[A[0]]=A[1]}let p=o.validate_expressions(this._Table,_),w=p.get_expression_schema(),T=p.get_expression_errors(),y=w.keys();for(let A=0;A<y.size();A++){let x=y.get(A),q=w.get(x);s&&this.overridden_types[x]&&(q=this.overridden_types[x]),c.expression_schema[x]=q}let R=T.keys();for(let A=0;A<R.size();A++){let x=R.get(A),q=T.get(x);c.errors[x]=q}return R.delete(),y.delete(),T.delete(),w.delete(),p.delete(),c},V.prototype.is_valid_filter=function(i){if(i[1]===K.FILTER_OPERATORS.isNull||i[1]===K.FILTER_OPERATORS.isNotNull)return!0;let s=i[2];if(s===null)return!1;let c=this.schema();return c[i[0]]&&(c[i[0]]==="date"||c[i[0]]==="datetime")?o.is_valid_datetime(i[2]):typeof s<"u"&&s!==null},V.prototype.view=function(i={}){k(this._Table.get_id());let s={};for(let y of Object.keys(i))if(Pe[y])if(!s[Pe[y]])pt.has(y)||(console.warn(`Deprecated: "${y}" config parameter, please use "${Pe[y]}" instead`),pt.add(y)),s[Pe[y]]=i[y];else throw new Error(`Duplicate configuration parameter "${y}"`);else if(y==="aggregate"){pt.has("aggregate")||(console.warn('Deprecated: "aggregate" config parameter has been replaced by "aggregates" and "columns"'),pt.add("aggregate")),s.aggregates={},s.columns=[];for(let R of i.aggregate)s.aggregates[R.column]=R.op,s.columns.push(R.column)}else if(Vt.indexOf(y)>-1)s[y]=i[y];else throw new Error(`Unrecognized config parameter "${y}"`);s.group_by=s.group_by||[],s.split_by=s.split_by||[],s.aggregates=s.aggregates||{},s.filter=s.filter||[],s.sort=s.sort||[],s.expressions=s.expressions||{};let c=this.schema();if(s.expressions!==void 0&&(Array.isArray(s.expressions)&&console.warn("Legacy `expressions` format: "+JSON.stringify(s.expressions)),s.expressions=fe(s.expressions)),s.columns===void 0&&(s.columns=this.columns(),s.expressions!=null))for(let y of s.expressions)s.columns.push(y[0]);if(s.filter.length>0)for(let y of s.filter){let R=c[y[0]];y[1]!==K.FILTER_OPERATORS.isNull&&y[1]!==K.FILTER_OPERATORS.isNotNull&&(R==="date"||R==="datetime")&&(y[2]=new Date(y[2]))}let _=Math.random()+"",p;s.group_by.length>0||s.split_by.length>0?s.split_by&&s.split_by.length>0?p=2:p=1:p=0;let w=new oe(s),T=new O(this,p,s,w,_);return this.views.push(T),T};let me;function ke(){if(me===void 0){let i=0,s=performance.now();setTimeout(function c(){let _=performance.now();console.log(`${(1e3*i/(_-s)).toFixed(2)} msgs/sec`),i=0,s=_,setTimeout(c,5e3)},5e3),me=function(_){i+=_},console.log("Profiling initialized")}}V.prototype.query_columns=function(i,s){let c=this.view(i),_=c.to_columns(s);return c.delete(),_},V.prototype.update=function(i,s){s=s||{},s.port_id=s.port_id||0;let c,_=this.columns(),p=this._Table.get_schema(),w=p.types(),T=!1,y=!1;if(c=a,i instanceof ArrayBuffer?(c=new Uint8Array(i),T=!0):typeof i=="string"?(i[0]===","&&(i="_"+i),y=!0,T=!0,c=i):(a.init(i),a.names=_.concat(a.names.filter(R=>R==="__INDEX__")),a.types=Wt(w).slice(0,_.length),me&&me(a.row_count)),!T){if(c.row_count===0){console.warn("table.update called with no data - ignoring");return}a.names.indexOf("__INDEX__")!=-1&&(!!this.index?a.types.push(a.types[a.names.indexOf(this.index)]):a.types.push(o.t_dtype.DTYPE_INT32))}try{let R=o.t_op.OP_INSERT;ne(c,this._Table,this.index,this.limit,R,!0,T,y,s.port_id).delete(),this.initialized=!0}catch(R){console.error(`Update failed: ${R}`)}finally{p.delete()}},V.prototype.remove=function(i,s){if(!this.index){console.error("Cannot call `remove()` on a Table without a user-specified index.");return}s=s||{},s.port_id=s.port_id||0;let c,_=this.columns(),p=this._Table.get_schema(),w=p.types(),T=!1;i=i.map(y=>({[this.index]:y})),i instanceof ArrayBuffer?(c=new Uint8Array(i),T=!0):(a.init(i),a.names=[this.index],a.types=[Wt(w)[_.indexOf(this.index)]],c=a);try{let y=o.t_op.OP_DELETE;ne(c,this._Table,this.index,this.limit,y,!1,T,!1,s.port_id).delete(),this.initialized=!0}catch(y){console.error("Remove failed",y)}finally{p.delete()}},V.prototype.columns=function(){let i=this._Table.get_schema(),s=i.columns(),c=[];for(let _=0;_<s.size();_++){let p=s.get(_);p!=="psp_okey"&&c.push(p)}return i.delete(),s.delete(),c},V.prototype.execute=function(i){i(this)};let K={__module__:o,Server:ze,worker:function(){return this},initialize_profile_thread:ke,memory_usage:H,table:function(i,s){s=s||{},s.index=s.index||null,s.limit=s.limit||null;let c,_=!1,p={},w=!1;if(i instanceof ArrayBuffer||typeof Buffer<"u"&&i instanceof Buffer?(c=new Uint8Array(i),_=!0):typeof i=="string"?(i[0]===","&&(i="_"+i),w=!0,_=!0,c=i):(a.clean(),p=a.init(i),c=a),s.index&&s.limit)throw`Cannot specify both index '${s.index}' and limit '${s.limit}'.`;let T;try{let y=o.t_op.OP_INSERT;return T=ne(c,void 0,s.index,s.limit,y,!1,_,w,0),new V(T,s.index,s.limit,p)}catch(y){throw T&&T.delete(),console.error(`Table initialization failed: ${y}`),y}}};for(let i of Object.keys(ut))K[i]=ut[i];class _e extends ze{constructor(s){super(s),self.addEventListener("message",c=>this.process(c.data),!1)}post(s,c){self.postMessage(s,c)}async init(s){let c=s.buffer,p=(await WebAssembly.instantiate(c)).instance.exports,w=p.size(),T=p.offset();c=new Uint8Array(p.memory.buffer).slice(T,T+w),o=await o({wasmBinary:c,wasmJSMethod:"native-wasm",locateFile:R=>R}),o.init(),super.init(s)}}return typeof self<"u"&&self.addEventListener&&new _e(K),K}var Ps=globalThis.perspective=Nr(Cr);})();
//# sourceMappingURL=perspective.worker.js.map
